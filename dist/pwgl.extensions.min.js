(()=>{var $="$nodesConnected,removeEventListener,textureTransform,addEventListener,disconnect,$feedbackGainNode,$lowPassNode,$delayNode,lightRenderer,connect,filterRenderer,$gainNode,$highPassNode,getOwnPropertyNames,$nodesCreated,$panNode,$disconnectNodes,$setOptions,highPassFilterFrequency,lowPassFilterFrequency,$connectNodes,object,transform,renderToFramebuffer,$createNodes,createBiquadFilter,reverbFeedbackGain,currentTime,addLightForRender,touchmove,reverbDelayTime,touchstart,mousedown,mousemove,touchend".split(",");"use strict";var $m=Math,$w=window,$n=null,$o=Object;var FPS={init(){this.fps=this.delay=this.$d=this.$p=this.$C=0;this.$d=Date.now();this.$D=1e3/60},update(){var b=Date.now();this.delay=(b-this.$d)/this.$D;this.$d=b;this.$p++;if(b>=this.$C+1e3){this.fps=(this.$p*1e3)/(b-this.$C);this.$C=b;this.$p=0}}};FPS.start=FPS.init;class PressState{constructor(){this.$j={};this.$F={};this.$E={}};isDown(b){return this.$j[b]===0};isUp(b){return this.$j[b]===1};isPressed(b){return this.isUp(b)&&this.$E[b]<=200};isLongPressed(b){return this.isUp(b)&&this.$E[b]>200};update(){for(var c in this.$j)if(this.$j[c]){delete this.$j[c];delete this.$E[c];delete this.$F[c]}};$setDownState(b){this.$j[b]=0;this.$F[b]=Date.now()};$setUpState(b){var d=Date.now();this.$j[b]=1;this.$E[b]=d-this.$F[b];this.$F[b]=d}};class Mouse extends PressState{constructor(c){super();this.position={x:0,y:0};this.$q=c??$w;this.$z={mousedown:1,mouseup:1,touchstart:0,touchend:0};this.$O=this.$O.bind(this);this.$G=this.$G.bind(this);this.$P=this.$P.bind(this);this.$q[$[3]]($[32],this.$O);this.$q[$[3]]("mouseup",this.$G);this.$q[$[3]]($[33],this.$P);this.$q[$[3]]($[31],this.$O);this.$q[$[3]]($[34],this.$G);this.$q[$[3]]($[29],this.$P)};destruct(){this.$q[$[1]]($[32],this.$O);this.$q[$[1]]("mouseup",this.$G);this.$q[$[1]]($[33],this.$P);this.$q[$[1]]($[31],this.$O);this.$q[$[1]]($[34],this.$G);this.$q[$[1]]($[29],this.$P)};$O(b){if(this.$z[b.type]===b.which){this.$setDownState(0)}};$G(b){if(this.$z[b.type]===b.which){this.$setUpState(0)}};$P(b){var d=b.type===$[29]?b.touches[0]:b;this.position.x=d.clientX;this.position.y=d.clientY}};class Keyboard extends PressState{constructor(c){super();this.$q=c??$w;this.$H=this.$H.bind(this);this.$A=this.$A.bind(this);this.$q[$[3]]("keydown",this.$H);this.$q[$[3]]("keyup",this.$A)};destruct(){this.$q[$[1]]("keydown",this.$H);this.$q[$[1]]("keyup",this.$A)};$H(b){this.$setDownState(b.keyCode)};$A(b){this.$setUpState(b.keyCode)}};class Gamepad{get gamepads(){return navigator.getGamepads?navigator.getGamepads():navigator.webkitGetGamepads||[]};get(b){var f=this.gamepads[b];return f?{axes:f.axes.map((c)=>$m.abs(c)>=.05?c:0),buttons:f.buttons.map((d)=>typeof d==="number"?{pressed:d===1,touched:d===1,value:d}:d),timestamp:f.timestamp}:$n}};var areObjectsEqual=(a,b)=>{if(typeof a!==typeof b)return 0;if(typeof a!==$[21])return a===b;var c=$o[$[13]](a),d=$o[$[13]](b);if(c.length!==d.length)return 0;var f,g,h,j;var i=c.length;while((f=c[--i])){g=a[f];h=b[f];if(g!==h){j=0;if(typeof g===$[21]&&typeof h===$[21])j=areObjectsEqual(g,h);if(!j)return 0}};return 1};var clone=(c)=>{if(typeof c!==$[21]||c===$n||c===undefined)return c;var d=Array.isArray(c)?[]:{};var f=$o[$[13]](c);var b,i=f.length;while((b=f[--i]))d[b]=typeof c[b]===$[21]?clone(c[b]):c[b];return d};class DataObserver{constructor(c={}){this.$j=c;this.$I=clone(this.$j);this.$b=0;this.$K=this.$K.bind(this);this.$K()};start(){this.$b=1};stop(){this.$b=0};$K(){if(this.$b&&!areObjectsEqual(this.$j,this.$I)){var b=clone(this.$j),d=clone(this.$I);this.$r(b,d);this.$I=b};requestAnimationFrame(this.$K)}};var mix=(a,b,c)=>c*a+(1-c)*b;var fadeAudioVolume=(g,b,c,d)=>(g.volume=mix(b,c,d));var crossFadeAudioVolumes=(h,j,b,c,d)=>{var f=mix(b,c,d);h.volume=f;j.volume=1-f};class ABA{get volume(){return this.$s};set volume(c){this.$s=c;if(this[$[0]])this[$[11]].gain.value=c};get pan(){return this.$c};set pan(b){this.$c=b;if(this[$[0]])this[$[15]].pan.value=b};get reverbDelayTime(){return this.$S};set reverbDelayTime(g){this.$S=g;if(this[$[0]])this[$[7]].delayTime.value=g};get reverbFeedbackGain(){return this.$U};set reverbFeedbackGain(k){this.$U=k;if(this[$[0]])this[$[5]].gain.value=k};get lowPassFilterFrequency(){return this.$V};set lowPassFilterFrequency(h){this.$V=h;if(this[$[0]])this[$[6]].frequency.value=h};get highPassFilterFrequency(){return this.$W};set highPassFilterFrequency(h){this.$W=h;if(this[$[0]])this[$[12]].frequency.value=h};$createNodes(d){if(d){this[$[11]]=d.createGain();this[$[15]]=d.createStereoPanner();this[$[7]]=d.createDelay();this[$[5]]=d.createGain();this[$[6]]=d[$[25]]();this[$[6]].type="lowpass";this[$[12]]=d[$[25]]();this[$[12]].type="highpass";this[$[14]]=1}};$connectNodes(j){if(j&&this[$[14]]){this[$[11]][$[9]](this[$[15]]);this[$[15]][$[9]](this[$[7]]);this[$[7]][$[9]](this[$[5]]);this[$[5]][$[9]](this[$[7]]);this[$[7]][$[9]](this[$[12]]);this[$[12]][$[9]](this[$[6]]);this[$[6]][$[9]](j);this[$[0]]=1}};$disconnectNodes(){if(this[$[0]]){this[$[11]][$[4]]();this[$[15]][$[4]]();this[$[7]][$[4]]();this[$[5]][$[4]]();this[$[6]][$[4]]();this[$[11]]=this[$[15]]=this[$[7]]=this[$[5]]=this[$[6]]=$n;this[$[0]]=this[$[14]]=0}};$setOptions(f){this.volume=f.volume??1;this.pan=f.pan??0;this[$[30]]=f[$[30]]??0;this[$[26]]=f[$[26]]??0;this[$[19]]=f[$[19]]??22050;this[$[18]]=f[$[18]]??0}};class AudioItem extends ABA{constructor(b=$n,j={}){super();this[$[17]](j);this.load(b)};get loop(){return this.$f};set loop(d){this.$f=d;if(this[$[0]])this.$t.loop=d};get pitch(){return this.$k};set pitch(g){this.$k=g;if(this[$[0]])this.$t.playbackRate.value=g};async load(b){if(b){this.url=b;this.$R=await fetch(b);this.$r()}};unload(){this[$[4]]();this.$v=$n};connect(l){if(this.$L!==l){this[$[4]]();this.$L=l;this.$r();l[$[9]](this)}};disconnect(){if(this.$L){this.stop();this.$L[$[4]](this);this.$L=$n}};play(f=0){this.stop();this.isPlaying=1;var l=this.$L,k=l.context;this[$[24]](k);this[$[20]](l.node);if(k){this.$J=k[$[27]];try{this[$[0]]&&this.$t.start(k[$[27]],f)}catch(e){}};this[$[17]](this)};stop(){this.isPlaying=0;var l=this.$L,h=this.$v;if(l&&h)this.$J=(l.context[$[27]]-this.$J)%h.duration;this[$[16]]()};resume(){this.play(this.$J)};$createNodes(k){var h=this.$v;if(k&&h){this.$t=k.createBufferSource();this.$t.buffer=h;super[$[24]](k)}};$connectNodes(m){if(m&&this[$[14]]){this.$t[$[9]](this[$[11]]);super[$[20]](m)}};$disconnectNodes(){if(this[$[0]]){this.$t.stop();this.$t[$[4]]();this.$t=$n;super[$[16]]()}};$setOptions(j={}){this.loop=j.loop??0;this.pitch=j.pitch??1;super[$[17]](j)};async $r(){var p=this.$R,l=this.$L;if(p&&l){var n=await p.arrayBuffer();this.$v=await l.context.decodeAudioData(n);this.isPlaying&&this.play()}}};class AudioMixer extends ABA{constructor(c={}){super();var d=new($w.AudioContext||$w.webkitAudioContext)();this.$B=d;this.$l=[];this[$[24]](d);this[$[20]](d.destination);this[$[17]](c)};get context(){return this.$B};get node(){return this[$[11]]};play(){this.$l.forEach((b)=>b.play())};stop(){this.$l.forEach((b)=>b.stop())};destruct(){this.stop();this[$[16]]()};resume(){this.$l.forEach((b)=>b.resume())};connect(f){if(!this.$l.includes(f)){this.$l.push(f);f[$[9]](this)}};disconnect(f){if(this.$l.includes(f)){this.$l.splice(this.$l.indexOf(f),1);f[$[4]]()}}};class SmoothLight extends AGL.Image{constructor(b={}){super();this.$Q=new AGL.Framebuffer;this[$[8]]=new AGL.LightRenderer(b);this.$w=new AGL.BlurFilter;this[$[10]]=new AGL.FilterRenderer({config:{context:this[$[8]].context},sourceTexture:this.$Q,filters:[this.$w]});this[$[10]].clearColor.set(0,0,0,0);this[$[10]].clearBeforeRender=1;this[$[28]]=this[$[8]][$[28]].bind(this[$[8]]);this.blendMode=AGL.BlendMode.SHADOW;this.$T=new AGL.Framebuffer;this.texture=this.$T;this.blur=typeof b.blur==="number"?b.blur:1};get blur(){return this.$g};set blur(v){this.$g=this.$w.intensityX=this.$w.intensityY=v};render(){this.$M();this[$[8]][$[23]](this.$Q);this[$[10]][$[23]](this.$T)};setSize(w,h){this.$m=w;this.$x=h;this.$M=this.$y};$y(){this.$M=()=>{};this[$[8]].setSize(this.$m,this.$x);this[$[10]].setSize(this.$m,this.$x)}};class WaterRenderer extends AGL.Container{constructor(l,b){super();this.$n=b;this.$m=1;this.$x=1;var m=AGL.Texture.loadImage(l);m.magFilter=AGL.Const.LINEAR;this.$X=new AGL.Image(m);this.$X[$[2]].repeatX=.7;this.$X.tintType=AGL.Image.TintType.GRAYSCALE;this.$X.color.set(0,.1,.75,1);this.addChild(this.$X);this.$Y=new AGL.Image(m);this.$Y.blendMode=AGL.BlendMode.ADD;this.$Y[$[2]].repeatX=4;this.$Y[$[2]].repeatRandomRotation=1;this.$Y.tintType=AGL.Image.TintType.GRAYSCALE;this.$Y.color.set(0,.06,.75,1);this.addChild(this.$Y);this.$N={x:0,y:0};this.$h=0};setSize(w,h){this.$m=w;this.$x=h;var c=h/w;this.$Y[$[22]].width=this.$X[$[22]].width=w;this.$Y[$[22]].height=this.$X[$[22]].height=h;this.$Y[$[2]].repeatY=this.$Y[$[2]].repeatX*c;this.$X[$[2]].repeatY=this.$X[$[2]].repeatX*c};render(d){var j=this.$n*d,k=j*2;this.$h+=j*2.5;var f=$m.sin(this.$h)*.3,g=$m.cos(this.$h)*.3;var n=this.$X[$[2]];n.x=this.$N.x*n.repeatX+((j*.75+f)%1);n.y=this.$N.y*n.repeatY+((k*.75+g)%1);n=this.$Y[$[2]];n.x=this.$N.x*n.repeatX+((j-f)%1);n.y=this.$N.y*n.repeatY+((k-g)%1)};move(x,y){this.$N.x=x/this.$m;this.$N.y=y/this.$x}};var clamp=(b,c,d)=>$m.max(b,$m.min(c,d));var cross=(a,b)=>a.x*b.y-a.y*b.x;var dot=(a,b)=>a.x*b.x+a.y*b.y;var distanceBetweenPointAndLine=(p,l)=>{var j={x:l.b.x-l.a.x,y:l.b.y-l.a.y},k={x:p.x-l.a.x,y:p.y-l.a.y},m={x:p.x-l.b.x,y:p.y-l.b.y},n=dot(j,k)<0,q=dot(j,m)>0;if(!n&&!q)return $m.abs(cross(j,k))/$m.hypot(j.x,j.y);var P=n?k:m;return $m.hypot(P.x,P.y)};var areTwoLinesCollided=(r,s)=>{var a=r.b.y-r.a.y,b=r.b.x-r.a.x,c=s.b.y-s.a.y,d=s.b.x-s.a.x,t=b*c-d*a;if(t!==0){var e=s.b.x-r.a.x,f=s.a.x-s.b.x,g=s.b.y-r.a.y,h=r.a.y-r.b.y,y=(c*e+f*g)/t,v=(h*e+b*g)/t;if(y>0&&y<1&&v>0&&v<1)return{lambda:y,gamma:v}}};var lineToLineIntersection=(r,s)=>{var z=areTwoLinesCollided(r,s);return z?{x:r.a.x+(r.b.x-r.a.x)*z.lambda,y:r.a.y+(r.b.y-r.a.y)*z.lambda}:$n};var areTwoRectsCollided=(w,x)=>w.width>x.x&&w.x<x.width&&w.height>x.y&&w.y<x.height;var rectToRectIntersection=(w,x)=>areTwoRectsCollided(w,x)?{x:$m.max(w.x,x.x),y:$m.max(w.y,x.y),width:$m.min(w.width,x.width),height:$m.min(w.height,x.height)}:$n;var collisionDetection={distanceBetweenPointAndLine,areTwoLinesCollided,lineToLineIntersection,areTwoRectsCollided,rectToRectIntersection};var enterFrame=(f)=>{var h,g=0;var d=()=>{if(g){FPS.update();f(FPS.fps,FPS.delay);h=requestAnimationFrame(d)}};var c=()=>{if(!g){g=1;FPS.init();d()}};var b=()=>{cancelAnimationFrame(h);g=0};c();return{c,b,get isPlaying(){return g}}};var enumCheck=(c,b)=>(c&b)===b;var fract=(f)=>f%1;var getFPS=async()=>new Promise((d)=>{requestAnimationFrame((c)=>requestAnimationFrame((b)=>d($m.round(1e3/(b-c)))))});var nthCall=(g,b,d=0)=>{var f=b-(d+1);return(...c)=>!(f=f>-1?(1+f)%b:++f)&&g(...c)};var hash=1;var rand=(x,y,b)=>(hash=$m.abs(fract(hash*(.12+34.56*x+b*y*78.9))));var fixRand=(x,y,b)=>fract($m.sin(dot({x,y},{x:$m.sin(x+y),y:$m.cos(y-x)*b}))*b)*.5+.5;var random={rand,fixRand};var generateDungeon=(F,J)=>{var G=[{x:1,y:0},{x:1,y:1},{x:0,y:1},{x:-1,y:1},{x:-1,y:0},{x:-1,y:-1},{x:0,y:-1}];var p=[];var d=Infinity;var f=Infinity;var g=-Infinity;var j=-Infinity;for(var i=0;i<F;i++){var C=getRandom(G);var H=clone(getRandom(J));if($m.random()<.5)H.data.reverse();var k={...H,x:0,y:0};var z=100;while(z--){var D=0;for(var I of p){if(areTwoRectsCollided({x:I.x,y:I.y,width:I.x+I.width,height:I.y+I.height},{x:k.x,y:k.y,width:k.x+k.width,height:k.y+k.height})){var b=$m.random()-.5;var L=$m.round(($m.random()-.5)*2);k.x+=C.x?b>=0||!C.y?C.x:L:L;k.y+=C.y?b<0||!C.x?C.y:L:L;D=1;break}};if(!D)break};d=$m.min(k.x,d);f=$m.min(k.y,f);g=$m.max(k.x+k.width,g);j=$m.max(k.y+k.height,j);p.push(k)};var q=g-d,t=j-f;var l=Array(q*t).fill(0);p.forEach(({x,y,width:w,height:h,data:A})=>{var m=x-d,n=y-f;A.forEach((r,s)=>{const{x:px,y:py}=vectorToCoord(s,w);l[coordToVector(m+px,n+py,q)]=r})});for(var i=0,c=l.length-q;i<c;i++){const{x:px,y:py}=vectorToCoord(i,q);if(px<q-1&&l[i]>0){var E=coordToVector(px,py+1,q);var B=coordToVector(px+1,py,q);var M=coordToVector(px+1,py+1,q);var v=coordToVector(px-1,py,q);var K=coordToVector(px-1,py+1,q);if(l[E]===l[B]&&l[i]===l[M]&&l[i]!==l[B]){l[E]=l[B]=1};if(px>0&&l[E]===l[v]&&l[i]===l[K]&&l[i]!==l[v]){l[E]=l[v]=1}}};return{width:q,height:t,data:l}};$w.PWGLExtensions=$w.AGLExtensions={version:"0.0.3",FPS,DataObserver,PressState,Mouse,Keyboard,Gamepad,AudioItem,AudioMixer,fadeAudioVolume,crossFadeAudioVolumes,SmoothLight,WaterRenderer,areObjectsEqual,clamp,mix,clone,collisionDetection,cross,dot,enterFrame,enumCheck,fract,getFPS,nthCall,random,generateDungeon};console.log(`%cPWGL Extensions v${AGLExtensions.version}\nhttps:\/\/github.com/asjs-dev/pwgl`,"background:#222;color:#0F0");})();