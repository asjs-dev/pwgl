(()=>{var $="$nodesConnected,removeEventListener,textureTransform,addEventListener,disconnect,$feedbackGainNode,$lowPassNode,$delayNode,lightRenderer,connect,filterRenderer,$gainNode,$highPassNode,transform,getOwnPropertyNames,$nodesCreated,$panNode,$disconnectNodes,highPassFilterFrequency,lowPassFilterFrequency,$setConfig,$connectNodes,object,isPlaying,renderToFramebuffer,$createNodes,createBiquadFilter,reverbFeedbackGain,currentTime,addLightForRender,touchmove,reverbDelayTime,touchstart,mousedown,mousemove,touchend".split(",");"use strict";var $m=Math,$w=window,$n=null,$o=Object;var noop=()=>{};var FPS=(()=>{var d={fps:0,delay:0};var g=16.6667;var f=0,h=0,j=0,c=Date.now();d.update=()=>{var b=Date.now();f++;d.delay=(b-c)/g;c=b;if(b>=j){d.fps=(f*1e3)/(b-h);h=b;j=b+1e3;f=0}};d.init=d.start=noop;return d})();class PressState{constructor(){this.$h={};this.$D={};this.$C={}};isDown(b){return this.$h[b]===0};isUp(b){return this.$h[b]===1};isPressed(b){return this.isUp(b)&&this.$C[b]<=200};isLongPressed(b){return this.isUp(b)&&this.$C[b]>200};getDuration(b){return Date.now()-this.$D[b]};update(){for(var c in this.$h)if(this.$h[c]){delete this.$h[c];delete this.$C[c];delete this.$D[c]}};$setDownState(b){this.$h[b]=0;this.$D[b]=Date.now()};$setUpState(b){var d=Date.now();this.$h[b]=1;this.$C[b]=d-this.$D[b];this.$D[b]=d}};class Mouse extends PressState{constructor(c){super();this.position={x:0,y:0};this.$q=c??$w;this.$z={mousedown:1,mouseup:1,touchstart:0,touchend:0};this.$M=this.$M.bind(this);this.$E=this.$E.bind(this);this.$N=this.$N.bind(this);this.$q[$[3]]($[33],this.$M);this.$q[$[3]]("mouseup",this.$E);this.$q[$[3]]($[34],this.$N);this.$q[$[3]]($[32],this.$M);this.$q[$[3]]($[35],this.$E);this.$q[$[3]]($[30],this.$N)};destruct(){this.$q[$[1]]($[33],this.$M);this.$q[$[1]]("mouseup",this.$E);this.$q[$[1]]($[34],this.$N);this.$q[$[1]]($[32],this.$M);this.$q[$[1]]($[35],this.$E);this.$q[$[1]]($[30],this.$N)};$M(b){if(this.$z[b.type]===b.which){this.$setDownState(0)}};$E(b){if(this.$z[b.type]===b.which){this.$setUpState(0)}};$N(b){var d=b.type===$[30]?b.touches[0]:b;this.position.x=d.clientX;this.position.y=d.clientY}};class Keyboard extends PressState{constructor(c){super();this.$q=c??$w;this.$F=this.$F.bind(this);this.$A=this.$A.bind(this);this.$q[$[3]]("keydown",this.$F);this.$q[$[3]]("keyup",this.$A)};destruct(){this.$q[$[1]]("keydown",this.$F);this.$q[$[1]]("keyup",this.$A)};$F(b){this.$setDownState(b.keyCode)};$A(b){this.$setUpState(b.keyCode)}};class Gamepad{get gamepads(){return navigator.getGamepads?navigator.getGamepads():navigator.webkitGetGamepads||[]};get(b){var f=this.gamepads[b];return f?{axes:f.axes.map((c)=>$m.abs(c)>=.05?c:0),buttons:f.buttons.map((d)=>typeof d==="number"?{pressed:d===1,touched:d===1,value:d}:d),timestamp:f.timestamp}:$n}};var areObjectsEqual=(a,b)=>{if(typeof a!==typeof b)return 0;if(typeof a!==$[22])return a===b;var c=$o[$[14]](a),d=$o[$[14]](b);if(c.length!==d.length)return 0;var f,g,h,j,i=c.length;while((f=c[--i])){g=a[f];h=b[f];if(g!==h){j=0;if(typeof g===$[22]&&typeof h===$[22])j=areObjectsEqual(g,h);if(!j)return 0}};return 1};var clone=(c)=>{if(typeof c!==$[22]||c===$n||c===undefined)return c;var f=$o[$[14]](c);var d=Array.isArray(c)?[]:{},b,i=f.length;while((b=f[--i]))d[b]=typeof c[b]===$[22]?clone(c[b]):c[b];return d};class DataObserver{constructor(c={}){this.$h=c;this.$G=clone(this.$h);this.$b=0;this.$I=this.$I.bind(this);this.$I()};start(){this.$b=1};stop(){this.$b=0};$I(){if(this.$b&&!areObjectsEqual(this.$h,this.$G)){var b=clone(this.$h),d=clone(this.$G);this.$r(b,d);this.$G=b};requestAnimationFrame(this.$I)}};var mix=(a,b,c)=>c*a+(1-c)*b;var fadeAudioVolume=(g,b,c,d)=>(g.volume=mix(b,c,d));var crossFadeAudioVolumes=(h,j,b,c,d)=>{var f=mix(b,c,d);h.volume=f;j.volume=1-f};class ABA{get volume(){return this.$s};set volume(c){this.$s=c;if(this[$[0]])this[$[11]].gain.value=c};get pan(){return this.$c};set pan(b){this.$c=b;if(this[$[0]])this[$[16]].pan.value=b};get reverbDelayTime(){return this.$R};set reverbDelayTime(g){this.$R=g;if(this[$[0]])this[$[7]].delayTime.value=g};get reverbFeedbackGain(){return this.$T};set reverbFeedbackGain(k){this.$T=k;if(this[$[0]])this[$[5]].gain.value=k};get lowPassFilterFrequency(){return this.$U};set lowPassFilterFrequency(h){this.$U=h;if(this[$[0]])this[$[6]].frequency.value=h};get highPassFilterFrequency(){return this.$V};set highPassFilterFrequency(h){this.$V=h;if(this[$[0]])this[$[12]].frequency.value=h};$createNodes(f){if(f){this[$[11]]=f.createGain();this[$[16]]=f.createStereoPanner();this[$[7]]=f.createDelay();this[$[5]]=f.createGain();this[$[6]]=f[$[26]]();this[$[6]].type="lowpass";this[$[12]]=f[$[26]]();this[$[12]].type="highpass";this[$[15]]=1}};$connectNodes(j){if(j&&this[$[15]]){this[$[11]][$[9]](this[$[16]]);this[$[16]][$[9]](this[$[7]]);this[$[7]][$[9]](this[$[5]]);this[$[5]][$[9]](this[$[7]]);this[$[7]][$[9]](this[$[12]]);this[$[12]][$[9]](this[$[6]]);this[$[6]][$[9]](j);this[$[0]]=1}};$disconnectNodes(){if(this[$[0]]){this[$[11]][$[4]]();this[$[16]][$[4]]();this[$[7]][$[4]]();this[$[5]][$[4]]();this[$[6]][$[4]]();this[$[11]]=this[$[16]]=this[$[7]]=this[$[5]]=this[$[6]]=$n;this[$[0]]=this[$[15]]=0}};$setConfig(d){this.volume=d.volume??1;this.pan=d.pan??0;this[$[31]]=d[$[31]]??0;this[$[27]]=d[$[27]]??0;this[$[19]]=d[$[19]]??22050;this[$[18]]=d[$[18]]??0}};class AudioItem extends ABA{constructor(b=$n,h={}){super();this[$[20]](h);this.load(b)};get loop(){return this.$d};set loop(d){this.$d=d;if(this[$[0]])this.$t.loop=d};get pitch(){return this.$j};set pitch(g){this.$j=g;if(this[$[0]])this.$t.playbackRate.value=g};async load(b){if(b){this.url=b;this.$P=await fetch(b);this.$r()}};unload(){this[$[4]]();this.$v=$n};connect(l){if(this.$J!==l){this[$[4]]();this.$J=l;this.$r();l[$[9]](this)}};disconnect(){if(this.$J){this.stop();this.$J[$[4]](this);this.$J=$n}};play(f=0){this.stop();this[$[23]]=1;var l=this.$J,k=l.context;this[$[25]](k);this[$[21]](l.node);if(k){this.$H=k[$[28]];try{this[$[0]]&&this.$t.start(k[$[28]],f)}catch(e){}};this[$[20]](this)};stop(){this[$[23]]=0;var l=this.$J,j=this.$v;if(l&&j)this.$H=(l.context[$[28]]-this.$H)%j.duration;this[$[17]]()};resume(){this.play(this.$H)};$createNodes(k){var j=this.$v;if(k&&j){this.$t=k.createBufferSource();this.$t.buffer=j;super[$[25]](k)}};$connectNodes(m){if(m&&this[$[15]]){this.$t[$[9]](this[$[11]]);super[$[21]](m)}};$disconnectNodes(){if(this[$[0]]){this.$t.stop();this.$t[$[4]]();this.$t=$n;super[$[17]]()}};$setConfig(h={}){this.loop=h.loop??0;this.pitch=h.pitch??1;super[$[20]](h)};async $r(){var p=this.$P,l=this.$J;if(p&&l){var n=await p.arrayBuffer();this.$v=await l.context.decodeAudioData(n);this[$[23]]&&this.play()}}};class AudioMixer extends ABA{constructor(c={}){super();var d=new($w.AudioContext||$w.webkitAudioContext)();this.$B=d;this.$k=[];this[$[25]](d);this[$[21]](d.destination);this[$[20]](c)};get context(){return this.$B};get node(){return this[$[11]]};play(){this.$k.forEach((b)=>b.play())};stop(){this.$k.forEach((b)=>b.stop())};destruct(){this.stop();this[$[17]]()};resume(){this.$k.forEach((b)=>b.resume())};connect(f){if(!this.$k.includes(f)){this.$k.push(f);f[$[9]](this)}};disconnect(f){if(this.$k.includes(f)){this.$k.splice(this.$k.indexOf(f),1);f[$[4]]()}}};class SmoothLight extends AGL.Image{constructor(b={}){super();this.$O=new AGL.Framebuffer;this[$[8]]=new AGL.LightRenderer(b);this.$w=new AGL.BlurFilter;this[$[10]]=new AGL.FilterRenderer({context:this[$[8]].context,sourceTexture:this.$O,filters:[this.$w]});this[$[10]].clearColor.set(0,0,0,0);this[$[10]].clearBeforeRender=1;this[$[29]]=this[$[8]][$[29]].bind(this[$[8]]);this.blendMode=AGL.BlendMode.SHADOW;this.$S=new AGL.Framebuffer;this.texture=this.$S;this.blur=typeof b.blur==="number"?b.blur:1};get blur(){return this.$f};set blur(v){this.$f=this.$w.intensityX=this.$w.intensityY=v};render(){this.$K();this[$[8]][$[24]](this.$O);this[$[10]][$[24]](this.$S)};setSize(w,h){this.$l=w;this.$x=h;this.$K=this.$y};$y(){this.$K=noop;this[$[8]].setSize(this.$l,this.$x);this[$[10]].setSize(this.$l,this.$x)}};class AnimatedWater extends AGL.Container{constructor(n,b=1,c=0,d=1){super();this.$l=1;this.$x=1;var p=AGL.Texture.loadImage(n);p.magFilter=AGL.Const.LINEAR;this.$Q=new AGL.Image;this.addChild(this.$Q);this.$W=new AGL.Image(p);this.$W.blendMode=AGL.BlendMode.ADD;this.$W[$[2]].repeatX=.7;this.$W.tintType=AGL.Image.TintType.GRAYSCALE;this.addChild(this.$W);this.$X=new AGL.Image(p);this.$X.blendMode=AGL.BlendMode.ADD;this.$X[$[2]].repeatX=4;this.$X[$[2]].repeatRandomRotation=1;this.$X.tintType=AGL.Image.TintType.GRAYSCALE;this.addChild(this.$X);this.speed=b;this.level=c;this.scale=d;this.$L={x:0,y:0};this.$g=0};get speed(){return this.$m};set speed(v){this.$m=v};get scale(){return this.$n};set scale(v){this.$n=v;this.$W.color.set(0,.1*v,.75,1);this.$X.color.set(0,.06*v,.75,1)};get level(){return this.$p};set level(v){this.$p=v;this.$Q.color.g=v};setSize(w,h){this.$l=w;this.$x=h;var f=h/w;this.$X[$[13]].width=this.$W[$[13]].width=this.$Q[$[13]].width=w;this.$X[$[13]].height=this.$W[$[13]].height=this.$Q[$[13]].height=h;this.$X[$[2]].repeatY=this.$X[$[2]].repeatX*f;this.$W[$[2]].repeatY=this.$W[$[2]].repeatX*f};render(g){var l=this.$m*g,m=l*2;this.$g+=l*2.5;var j=$m.sin(this.$g)*.3,k=$m.cos(this.$g)*.3;var q=this.$W[$[2]];q.x=this.$L.x*q.repeatX+((l*.75+j)%1);q.y=this.$L.y*q.repeatY+((m*.75+k)%1);q=this.$X[$[2]];q.x=this.$L.x*q.repeatX+((l*2-j)%1);q.y=this.$L.y*q.repeatY+((m*2-k)%1)};move(x,y){this.$L.x=x/this.$l;this.$L.y=y/this.$x}};var clamp=(b,c,d)=>$m.max(b,$m.min(c,d));var cross=(a,b)=>a.x*b.y-a.y*b.x;var dot=(a,b)=>a.x*b.x+a.y*b.y;var distanceBetweenPointAndLine=(p,l)=>{var j={x:l.b.x-l.a.x,y:l.b.y-l.a.y},k={x:p.x-l.a.x,y:p.y-l.a.y},m={x:p.x-l.b.x,y:p.y-l.b.y},n=dot(j,k)<0,q=dot(j,m)>0;if(!n&&!q)return $m.abs(cross(j,k))/$m.hypot(j.x,j.y);var P=n?k:m;return $m.hypot(P.x,P.y)};var areTwoLinesCollided=(r,s)=>{var a=r.b.y-r.a.y,b=r.b.x-r.a.x,c=s.b.y-s.a.y,d=s.b.x-s.a.x,t=b*c-d*a;if(t!==0){var e=s.b.x-r.a.x,f=s.a.x-s.b.x,g=s.b.y-r.a.y,h=r.a.y-r.b.y,y=(c*e+f*g)/t,v=(h*e+b*g)/t;if(y>0&&y<1&&v>0&&v<1)return{lambda:y,gamma:v}}};var lineToLineIntersection=(r,s)=>{var z=areTwoLinesCollided(r,s);return z?{x:r.a.x+(r.b.x-r.a.x)*z.lambda,y:r.a.y+(r.b.y-r.a.y)*z.lambda}:$n};var areTwoRectsCollided=(w,x)=>w.width>x.x&&w.x<x.width&&w.height>x.y&&w.y<x.height;var rectToRectIntersection=(w,x)=>areTwoRectsCollided(w,x)?{x:$m.max(w.x,x.x),y:$m.max(w.y,x.y),width:$m.min(w.width,x.width),height:$m.min(w.height,x.height)}:$n;var collisionDetection={distanceBetweenPointAndLine,areTwoLinesCollided,lineToLineIntersection,areTwoRectsCollided,rectToRectIntersection};var enterFrame=(k,l=0)=>{var f={};var p,h,g,n,c=Date.now(),s,m=0;var q=()=>{FPS.update();k(FPS.fps,FPS.delay)};var r=()=>{var b=Date.now();var d=b-c;if(d>=n){n=2*g-d;c=b;q()}};var j=()=>{if(m){p();s=requestAnimationFrame(j)}};f[$[23]]=()=>m;f.clearMaxFPS=()=>{h=1/0;p=q};f.getMaxFPS=()=>h;f.setMaxFPS=(l)=>{if(!l||l<=0)return f.clearMaxFPS();h=l;n=g=$m.floor(1e3/h)-1;p=r};f.start=()=>{if(!m){m=1;j()}};f.stop=()=>{cancelAnimationFrame(s);m=0};f.setMaxFPS(l);f.start();return f};var enumCheck=(c,b)=>(c&b)===b;var fract=(f)=>f%1;var getFPS=async()=>new Promise((d)=>{requestAnimationFrame((c)=>requestAnimationFrame((b)=>d($m.round(1e3/(b-c)))))});var nthCall=(g,b,d=0)=>{var f=b-(d+1);return(...c)=>!(f=f>-1?(1+f)%b:++f)&&g(...c)};var hash=1;var rand=(x,y,b)=>(hash=$m.abs(fract(hash*(.12+34.56*x+b*y*78.9))));var fixRand=(x,y,b)=>fract($m.sin(dot({x,y},{x:$m.sin(x+y),y:$m.cos(y-x)*b}))*b)*.5+.5;var random={rand,fixRand};var generateDungeon=(F,J)=>{var G=[{x:1,y:0},{x:1,y:1},{x:0,y:1},{x:-1,y:1},{x:-1,y:0},{x:-1,y:-1},{x:0,y:-1}],p=[];var d=Infinity,f=Infinity,g=-Infinity,j=-Infinity;for(var i=0;i<F;i++){var C=getRandom(G),H=clone(getRandom(J));if($m.random()<.5)H.data.reverse();var k={...H,x:0,y:0};var z=100;while(z--){var D=0;for(var I of p){if(areTwoRectsCollided({x:I.x,y:I.y,width:I.x+I.width,height:I.y+I.height},{x:k.x,y:k.y,width:k.x+k.width,height:k.y+k.height})){var b=$m.random()-.5,L=$m.round(($m.random()-.5)*2);k.x+=C.x?b>=0||!C.y?C.x:L:L;k.y+=C.y?b<0||!C.x?C.y:L:L;D=1;break}};if(!D)break};d=$m.min(k.x,d);f=$m.min(k.y,f);g=$m.max(k.x+k.width,g);j=$m.max(k.y+k.height,j);p.push(k)};var q=g-d,t=j-f,l=Array(q*t).fill(0);p.forEach(({x,y,width:w,height:h,data:A})=>{var m=x-d,n=y-f;A.forEach((r,s)=>{const{x:px,y:py}=vectorToCoord(s,w);l[coordToVector(m+px,n+py,q)]=r})});for(var i=0,c=l.length-q;i<c;i++){const{x:px,y:py}=vectorToCoord(i,q);if(px<q-1&&l[i]>0){var E=coordToVector(px,py+1,q),B=coordToVector(px+1,py,q),M=coordToVector(px+1,py+1,q),v=coordToVector(px-1,py,q),K=coordToVector(px-1,py+1,q);if(l[E]===l[B]&&l[i]===l[M]&&l[i]!==l[B]){l[E]=l[B]=1};if(px>0&&l[E]===l[v]&&l[i]===l[K]&&l[i]!==l[v]){l[E]=l[v]=1}}};return{width:q,height:t,data:l}};var noopReturnsOne=()=>1;var arraySet=(c,d,b=0)=>{var i=d.length;while(--i>-1)c[b+i]=d[i];return c};var removeFromArray=(c,b)=>{var d=c.indexOf(b);d>-1&&c.splice(d,1)};$w.PWGLExtensions=$w.AGLExtensions={version:"0.1.2",FPS,DataObserver,PressState,Mouse,Keyboard,Gamepad,AudioItem,AudioMixer,fadeAudioVolume,crossFadeAudioVolumes,SmoothLight,AnimatedWater,areObjectsEqual,clamp,mix,clone,collisionDetection,cross,dot,enterFrame,enumCheck,fract,getFPS,nthCall,random,generateDungeon,noop,noopReturnsOne,arraySet,removeFromArray};console.log(`%cPWGL Extensions v${AGLExtensions.version}\nhttps:\/\/github.com/asjs-dev/pwgl`,"background:#222;color:#0F0");})();