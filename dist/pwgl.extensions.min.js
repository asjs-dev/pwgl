(()=>{var $="removeEventListener,textureTransform,addEventListener,feedbackGainNode,lowPassNode,isPlaying,delayNode,lightRenderer,filterRenderer,connect,disconnect,highPassNode,getOwnPropertyNames,gainNode,highPassFilterFrequency,lowPassFilterFrequency,object,setVolume,startTime,transform,renderToFramebuffer,reverbFeedbackGain,createBiquadFilter,currentTime,addLightForRender,touchmove,createGain,reverbDelayTime,touchstart,mousedown,mousemove,touchend".split(",");"use strict";var $m=Math,$w=window,$n=null,$o=Object;var FPS={init(){this.fps=this.delay=this._$c=this._$p=this._$A=0;this._$c=Date.now();this._$B=1e3/60},update(){var b=Date.now();this.delay=(b-this._$c)/this._$B;this._$c=b;this._$p++;if(b>=this._$A+1e3){this.fps=(this._$p*1e3)/(b-this._$A);this._$A=b;this._$p=0}}};FPS.start=FPS.init;class PressState{constructor(){this._$k={};this._$F={};this._$C={}};isDown(b){return this._$k[b]===0};isUp(b){return this._$k[b]===1};isPressed(b){return this.isUp(b)&&this._$C[b]<=200};isLongPressed(b){return this.isUp(b)&&this._$C[b]>200};update(){for(var c in this._$k)if(this._$k[c]){delete this._$k[c];delete this._$C[c];delete this._$F[c]}};$setDownState(b){this._$k[b]=0;this._$F[b]=Date.now()};$setUpState(b){var d=Date.now();this._$k[b]=1;this._$C[b]=d-this._$F[b];this._$F[b]=d}};class Mouse extends PressState{constructor(c){super();this.position={x:0,y:0};this._$q=c??$w;this._$y={mousedown:1,mouseup:1,touchstart:0,touchend:0};this._$M=this._$M.bind(this);this._$G=this._$G.bind(this);this._$N=this._$N.bind(this);this._$q[$[2]]($[29],this._$M);this._$q[$[2]]("mouseup",this._$G);this._$q[$[2]]($[30],this._$N);this._$q[$[2]]($[28],this._$M);this._$q[$[2]]($[31],this._$G);this._$q[$[2]]($[25],this._$N)};destruct(){this._$q[$[0]]($[29],this._$M);this._$q[$[0]]("mouseup",this._$G);this._$q[$[0]]($[30],this._$N);this._$q[$[0]]($[28],this._$M);this._$q[$[0]]($[31],this._$G);this._$q[$[0]]($[25],this._$N)};_$M(b){if(this._$y[b.type]===b.which){this.$setDownState(0)}};_$G(b){if(this._$y[b.type]===b.which){this.$setUpState(0)}};_$N(b){var d=b.type===$[25]?b.touches[0]:b;this.position.x=d.clientX;this.position.y=d.clientY}};class Keyboard extends PressState{constructor(c){super();this._$q=c??$w;this._$H=this._$H.bind(this);this._$z=this._$z.bind(this);this._$q[$[2]]("keydown",this._$H);this._$q[$[2]]("keyup",this._$z)};destruct(){this._$q[$[0]]("keydown",this._$H);this._$q[$[0]]("keyup",this._$z)};_$H(b){this.$setDownState(b.keyCode)};_$z(b){this.$setUpState(b.keyCode)}};class Gamepad{get gamepads(){return navigator.getGamepads?navigator.getGamepads():navigator.webkitGetGamepads||[]};get(b){var f=this.gamepads[b];return f?{axes:f.axes.map((c)=>$m.abs(c)>=.05?c:0),buttons:f.buttons.map((d)=>typeof d==="number"?{pressed:d===1,touched:d===1,value:d}:d),timestamp:f.timestamp}:$n}};var areObjectsEqual=(a,b)=>{if(typeof a!==typeof b)return 0;if(typeof a!==$[16])return a===b;var c=$o[$[12]](a),d=$o[$[12]](b);if(c.length!==d.length)return 0;var f,g,h,j;var i=c.length;while((f=c[--i])){g=a[f];h=b[f];if(g!==h){j=0;if(typeof g===$[16]&&typeof h===$[16])j=areObjectsEqual(g,h);if(!j)return 0}};return 1};var clone=(c)=>{if(typeof c!==$[16]||c===$n||c===undefined)return c;var d=Array.isArray(c)?[]:{};var f=$o[$[12]](c);var b,i=f.length;while((b=f[--i]))d[b]=typeof c[b]===$[16]?clone(c[b]):c[b];return d};class DataObserver{constructor(c={}){this._$k=c;this._$I=clone(this._$k);this._$b=0;this._$J=this._$J.bind(this);this._$J()};start(){this._$b=1};stop(){this._$b=0};_$J(){if(this._$b&&!areObjectsEqual(this._$k,this._$I)){var b=clone(this._$k),d=clone(this._$I);this._$r(b,d);this._$I=b};requestAnimationFrame(this._$J)}};var mix=(a,b,c)=>c*a+(1-c)*b;var fadeAudioVolume=(m,v,b,c,h)=>m[$[17]](v,mix(b,c,h));var crossFadeAudioVolumes=(m,z,A,b,c,h)=>{var w=mix(b,c,h);m[$[17]](z,w);m[$[17]](A,1-w)};class AudioMixer{constructor(F=1){this.get=this.get.bind(this);this._$s=this._$s.bind(this);this._$d=this._$d.bind(this);this._$f=this._$f.bind(this);this._$t=this._$t.bind(this);this._$P=new($w.AudioContext||$w.webkitAudioContext)();this._$D={};this._$R=this._$P[$[26]]();this._$R[$[9]](this._$P.destination);this.masterVolume=F};get masterVolume(){return this._$R.gain.value};set masterVolume(q){this._$R.gain.value=q};get(v){var G=this._$D[v];return G?{...G.state}:{}};getAll(){var r={};this._$E((d)=>(r[d]=this.get(d)));return r};async load(n){return Promise.all((Array.isArray(n)?n:[n]).map((j)=>this._$g(j)))};unload(v){this._$Q(this._$s,v)};play(v,t){this._$Q(this._$d,v,t)};stop(v){this._$Q(this._$f,v)};resume(v,t){this._$Q(this._$t,v,t)};setLoop(v,k){var G=this._$D[v];if(G){G.state.loop=k;if(G.state[$[5]])G.source.loop=k}};setVolume(v,q){var G=this._$D[v];if(G){G.state.volume=q;if(G.state[$[5]])G[$[13]].gain.value=q}};setPan(v,f){var G=this._$D[v];if(G){G.state.pan=f;if(G.state[$[5]])G.panNode.pan.value=f}};setPitch(v,p){var G=this._$D[v];if(G){G.state.pitch=p;if(G.state[$[5]])G.source.playbackRate.value=p}};setReverb(v,B,H){var G=this._$D[v];if(G){G.state[$[27]]=B;G.state[$[21]]=H;if(G.state[$[5]]){G[$[6]].delayTime.value=B;G[$[3]].gain.value=H}}};setLowPassFilter(v,C){var G=this._$D[v];if(G){G.state[$[15]]=C;if(G.state[$[5]])G[$[4]].frequency.value=C}};setHighPassFilter(v,C){var G=this._$D[v];if(G){G.state[$[14]]=C;if(G.state[$[5]])G[$[11]].frequency.value=C}};async _$g(j){var v=j.fileName,g=j.url;if(!this._$D[v]){try{var x=await fetch(g),E=await x.arrayBuffer(),s=await this._$P.decodeAudioData(E);this._$D[v]={buffer:s,url:g,state:{loop:0,volume:1,pan:0,pitch:1,reverbDelayTime:0,reverbFeedbackGain:0,lowPassFilterFrequency:22050,highPassFilterFrequency:0}}}catch(e){return};return v}};_$s(v){this.stop(v);delete this._$D[v]};_$d(v,t={}){var G=this._$D[v];if(G){this._$f(v);G.source=this._$P.createBufferSource();G[$[13]]=this._$P[$[26]]();G.panNode=this._$P.createStereoPanner();G[$[6]]=this._$P.createDelay();G[$[3]]=this._$P[$[26]]();G[$[4]]=this._$P[$[22]]();G[$[4]].type="lowpass";G[$[11]]=this._$P[$[22]]();G[$[11]].type="highpass";G.source.buffer=G.buffer;G.source[$[9]](G[$[13]]);G[$[13]][$[9]](G.panNode);G.panNode[$[9]](G[$[6]]);G[$[6]][$[9]](G[$[3]]);G[$[3]][$[9]](G[$[6]]);G[$[6]][$[9]](G[$[11]]);G[$[11]][$[9]](G[$[4]]);G[$[4]][$[9]](this._$R);G.inited=1;this._$l(v,t[$[18]]??0);this[$[17]](v,t.volume??1);this.setPan(v,t.pan??0);this.setPitch(v,t.pitch??1);this.setLoop(v,t.loop??0);this.setReverb(v,t[$[27]]??0,t[$[21]]??0);this.setLowPassFilter(v,t[$[15]]??22050);this.setHighPassFilter(v,t[$[14]]??0)}};_$l(v,D){var G=this._$D[v];if(G){G.state[$[18]]=this._$P[$[23]];if(G.inited){G.source.start(this._$P[$[23]],D);G.state[$[5]]=1}}};_$f(v){var G=this._$D[v];if(G&&G.inited){G.state[$[18]]=(this._$P[$[23]]-G.state[$[18]])%G.buffer.duration;G.source.stop();G.source[$[10]]();G[$[13]][$[10]]();G.panNode[$[10]]();if(G[$[6]]){G[$[6]][$[10]]();G[$[3]][$[10]]()};if(G[$[4]]){G[$[4]][$[10]]()};G.inited=G.state[$[5]]=0;delete G.source;delete G[$[13]];delete G.panNode;delete G[$[6]];delete G[$[3]];delete G[$[4]]}};_$t(v,t){var G=this._$D[v];G&&this._$d(v,{...G.state,...t})};_$Q(l,v,t){v?l(v,t):this._$E(l)};_$E(y){$o.keys(this._$D).forEach(y)}};class SmoothLight extends AGL.Image{constructor(b={}){super();this._$O=new AGL.Framebuffer;this[$[7]]=new AGL.LightRenderer(b);this._$v=new AGL.BlurFilter;this[$[8]]=new AGL.FilterRenderer({config:{context:this[$[7]].context},sourceTexture:this._$O,filters:[this._$v]});this[$[8]].clearColor.set(0,0,0,0);this[$[8]].clearBeforeRender=1;this[$[24]]=this[$[7]][$[24]].bind(this[$[7]]);this.blendMode=AGL.BlendMode.SHADOW;this._$S=new AGL.Framebuffer;this.texture=this._$S;this.blur=typeof b.blur==="number"?b.blur:1};get blur(){return this._$h};set blur(v){this._$h=this._$v.intensityX=this._$v.intensityY=v};render(){this._$K();this[$[7]][$[20]](this._$O);this[$[8]][$[20]](this._$S)};setSize(w,h){this._$m=w;this._$w=h;this._$K=this._$x};_$x(){this._$K=()=>{};this[$[7]].setSize(this._$m,this._$w);this[$[8]].setSize(this._$m,this._$w)}};class WaterRenderer extends AGL.Container{constructor(l,b){super();this._$n=b;this._$m=1;this._$w=1;var m=AGL.Texture.loadImage(l);m.magFilter=AGL.Const.LINEAR;this._$T=new AGL.Image(m);this._$T[$[1]].repeatX=.7;this._$T.tintType=AGL.Image.TintType.GRAYSCALE;this._$T.color.set(0,.1,.75,1);this.addChild(this._$T);this._$U=new AGL.Image(m);this._$U.blendMode=AGL.BlendMode.ADD;this._$U[$[1]].repeatX=4;this._$U[$[1]].repeatRandomRotation=1;this._$U.tintType=AGL.Image.TintType.GRAYSCALE;this._$U.color.set(0,.06,.75,1);this.addChild(this._$U);this._$L={x:0,y:0};this._$j=0};setSize(w,h){this._$m=w;this._$w=h;var c=h/w;this._$U[$[19]].width=this._$T[$[19]].width=w;this._$U[$[19]].height=this._$T[$[19]].height=h;this._$U[$[1]].repeatY=this._$U[$[1]].repeatX*c;this._$T[$[1]].repeatY=this._$T[$[1]].repeatX*c};render(d){var j=this._$n*d,k=j*2;this._$j+=j*2.5;var f=$m.sin(this._$j)*.3,g=$m.cos(this._$j)*.3;var n=this._$T[$[1]];n.x=this._$L.x*n.repeatX+((j*.75+f)%1);n.y=this._$L.y*n.repeatY+((k*.75+g)%1);n=this._$U[$[1]];n.x=this._$L.x*n.repeatX+((j-f)%1);n.y=this._$L.y*n.repeatY+((k-g)%1)};move(x,y){this._$L.x=x/this._$m;this._$L.y=y/this._$w}};var clamp=(b,c,d)=>$m.max(b,$m.min(c,d));var cross=(a,b)=>a.x*b.y-a.y*b.x;var dot=(a,b)=>a.x*b.x+a.y*b.y;var distanceBetweenPointAndLine=(p,l)=>{var j={x:l.b.x-l.a.x,y:l.b.y-l.a.y},k={x:p.x-l.a.x,y:p.y-l.a.y},m={x:p.x-l.b.x,y:p.y-l.b.y},n=dot(j,k)<0,q=dot(j,m)>0;if(!n&&!q)return $m.abs(cross(j,k))/$m.hypot(j.x,j.y);var P=n?k:m;return $m.hypot(P.x,P.y)};var areTwoLinesCollided=(r,s)=>{var a=r.b.y-r.a.y,b=r.b.x-r.a.x,c=s.b.y-s.a.y,d=s.b.x-s.a.x,t=b*c-d*a;if(t!==0){var e=s.b.x-r.a.x,f=s.a.x-s.b.x,g=s.b.y-r.a.y,h=r.a.y-r.b.y,y=(c*e+f*g)/t,v=(h*e+b*g)/t;if(y>0&&y<1&&v>0&&v<1)return{lambda:y,gamma:v}}};var lineToLineIntersection=(r,s)=>{var z=areTwoLinesCollided(r,s);return z?{x:r.a.x+(r.b.x-r.a.x)*z.lambda,y:r.a.y+(r.b.y-r.a.y)*z.lambda}:$n};var areTwoRectsCollided=(w,x)=>w.width>x.x&&w.x<x.width&&w.height>x.y&&w.y<x.height;var rectToRectIntersection=(w,x)=>areTwoRectsCollided(w,x)?{x:$m.max(w.x,x.x),y:$m.max(w.y,x.y),width:$m.min(w.width,x.width),height:$m.min(w.height,x.height)}:$n;var collisionDetection={distanceBetweenPointAndLine,areTwoLinesCollided,lineToLineIntersection,areTwoRectsCollided,rectToRectIntersection};var enterFrame=(f)=>{var h,g=0;var d=()=>{if(g){FPS.update();f(FPS.fps,FPS.delay);h=requestAnimationFrame(d)}};var c=()=>{if(!g){g=1;FPS.init();d()}};var b=()=>{cancelAnimationFrame(h);g=0};c();return{c,b,get isPlaying(){return g}}};var enumCheck=(c,b)=>(c&b)===b;var fract=(f)=>f%1;var getFPS=async()=>new Promise((d)=>{requestAnimationFrame((c)=>requestAnimationFrame((b)=>d($m.round(1e3/(b-c)))))});var nthCall=(g,b,d=0)=>{var f=b-(d+1);return(...c)=>!(f=f>-1?(1+f)%b:++f)&&g(...c)};var hash=1;var rand=(x,y,b)=>(hash=$m.abs(fract(hash*(.12+34.56*x+b*y*78.9))));var fixRand=(x,y,b)=>fract($m.sin(dot({x,y},{x:$m.sin(x+y),y:$m.cos(y-x)*b}))*b)*.5+.5;var random={rand,fixRand};$w.PWGLExtensions=$w.AGLExtensions={FPS,PressState,Mouse,Keyboard,Gamepad,DataObserver,AudioMixer,fadeAudioVolume,crossFadeAudioVolumes,SmoothLight,WaterRenderer,areObjectsEqual,clamp,mix,clone,collisionDetection,cross,dot,enterFrame,enumCheck,fract,getFPS,nthCall,random};})();