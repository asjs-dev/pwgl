const e=(e,a)=>(e&a)===a,a=(e,a=0)=>{const r=(()=>{let e=0,a=0,r=0,t=Date.now();const s={fps:0,delay:0,update:()=>{const n=Date.now();e++,s.delay=(n-t)/16.6667,t=n,n>=r&&(s.fps=1e3*e/(n-a),a=n,r=n+1e3,e=0)}};return s})();let t,s,n,c,o,u=Date.now(),i=!1;const l=()=>{r.update(),e(r.fps,r.delay)},S=()=>{const e=Date.now(),a=e-u;a>=c&&(c=2*n-a,u=e,l())},f=()=>{i&&(t(),o=requestAnimationFrame(f))},m={isPlaying:()=>i,clearMaxFPS:()=>(s=1/0,t=l,m),getMaxFPS:()=>s,setMaxFPS:e=>!e||e<=0?m.clearMaxFPS():(s=e,c=n=Math.floor(1e3/s)-1,t=S,m),start:()=>(i||(i=!0,f()),m),stop:()=>(cancelAnimationFrame(o),i=!1,m)};return m.setMaxFPS(a).start(),m},r=(e,a,r,t)=>({icon:e,label:a,style:`background: ${t}; color: ${r}; font-family: monospace;`}),t={BASE:r("- ·","----","#999","#000"),PROGRAM:r("- ◉","PROG","#7CFF9B","#0b3d1f"),BINDING:r("| ↔","BIND","#4FC3F7","#002233"),RESOURCES:r("| □","RSRC","#FFD54F","#3a2a00"),BUFFER_UPLOAD:r("| ↑","UPLD","#FF7043","#3b1200"),TEXTURE_PARAMS:r("| ▦","TEXT","#c792ea","#2a1433"),UNIFORMS:r("| ≡","UNIF","#FF7AA2","#2a0f1a"),VERTEX_ATTRIBUTES:r("| ▣","ATTR","#26E6A6","#00382f"),VIEWPORT:r("| ▢","FRAM","#90a4ae","#1c262b"),BLENDING:r("| ≈","BLND","#69f0ae","#032"),SAMPLERS:r("| ⇅","SAMP","#000","#33F"),FRAMEBUFFERS:r("| ▭","FBO ","#fff","#4a148c"),RENDERBUFFERS:r("| ▩","RBO ","#fff","#004d40"),DEPTH_STENCIL:r("| ∠","DPTH","#999","#333"),SHADER:r("| ∞","SHDR","#8cedd4","#390b5a"),DRAW:r("- ●","DRAW","#fff","#086818"),ALERT:r("- ■","ALRT","#fff","#b00020"),WARN:r("- ▲","WARN","#000","#fc0")},s=["DEPTH_TEST","CULL_FACE","STENCIL_TEST"],n=e=>e,c=()=>"\n   | "+(new Error).stack.split("\n").slice(3).map(e=>e.trim().slice(3)).join("\n   | "),o=(r,o={})=>{const u=(m=o.maxFrameCount??5,E=0,R=20,Math.max(m,Math.min(E,R))),i=o.flags??0,l=[],S=[],f=PWGL?Object.entries(PWGL.Const).reduce((e,[a,r])=>(e[r]=a,e),{}):{};var m,E,R;let d,g,D,A,b,p=-1;const F=e=>e.map(e=>f[e]??e),T=e(i,4)?n:e=>e.map(e=>e&&(Array.isArray(e)||e.constructor?.name?.endsWith("Array"))?`[${e.constructor.name}(${e.length})]`:e),M=e(i,2)?n:F,P=e(i,1)?c:(e=>()=>e)(""),h={canvas:r.canvas,snapshots:l,toString:()=>{l.forEach((e,a)=>{console.log("%c > FRAME #"+a+" => ","background:#000;color:#00ff00;font-weight:bold;");const r=S[a];e.forEach((e,a)=>{const n=((e,a,r)=>{if(e>5)return t.ALERT;if(e>2)return t.WARN;switch(a){case"createProgram":case"attachShader":case"linkProgram":case"validateProgram":case"deleteProgram":case"useProgram":return t.PROGRAM;case"createShader":case"shaderSource":case"compileShader":case"deleteShader":return t.SHADER;case"getBufferSubData":case"finish":case"flush":case"readPixels":return t.WARN;case"getError":return t.ALERT;case"bindVertexArray":case"bindBuffer":case"activeTexture":case"bindTexture":return t.BINDING;case"createBuffer":return t.RESOURCES;case"bufferData":case"texImage2D":case"bufferSubData":case"copyBufferSubData":case"texSubImage2D":case"texStorage2D":case"copyTexImage2D":case"copyTexSubImage2D":case"compressedTexImage2D":case"compressedTexSubImage2D":return t.BUFFER_UPLOAD;case"texParameteri":case"generateMipmap":return t.TEXTURE_PARAMS;case"bindBufferBase":case"bindBufferRange":return t.UNIFORMS;case"enableVertexAttribArray":case"vertexAttribPointer":case"vertexAttribDivisor":case"vertexAttribIPointer":case"disableVertexAttribArray":return t.VERTEX_ATTRIBUTES;case"viewport":case"scissor":case"clearColor":case"clear":return t.VIEWPORT;case"blendEquation":case"blendFuncSeparate":return t.BLENDING;case"drawElementsInstanced":case"drawArrays":case"drawElements":case"drawArraysInstanced":case"drawRangeElements":case"drawBuffers":case"drawElementsInstancedBaseVertex":return t.DRAW;case"createSampler":case"samplerParameteri":case"bindSampler":case"deleteSampler":return t.SAMPLERS;case"createFramebuffer":case"bindFramebuffer":case"framebufferTexture2D":case"framebufferRenderbuffer":case"checkFramebufferStatus":case"blitFramebuffer":return t.FRAMEBUFFERS;case"createRenderbuffer":case"bindRenderbuffer":case"renderbufferStorage":case"renderbufferStorageMultisample":return t.RENDERBUFFERS;case"depthFunc":case"depthMask":case"cullFace":case"frontFace":case"stencilFunc":case"stencilOp":return t.DEPTH_STENCIL}return a.startsWith("createTexture")?t.RESOURCES:a.startsWith("uniform")?t.UNIFORMS:a.startsWith("enable")&&s.includes(r[0])?t.DEPTH_STENCIL:t.BASE})(e.currentCallDurationMS,e.prop,F(e.args));console.log("%c "+n.icon+" "+n.label+`|${String(e.sumFrameDurationMS).padStart(r.sumFrameDurationMS)}ms|${String(e.currentCallDurationMS).padStart(r.currentCallDurationMS)}ms| ${String(e.prop).padStart(r.prop)}`+(e.args.length?`( ${M(e.args).join(" ")} )`:"")+e.stackTrace,`${n.style}t:${a};`)})})}};return a(()=>p++),PWGLDebugger.instances.push(h),console.log("PWGL Debugger",h),new Proxy(r,{get(e,a){const r=e[a];return"function"==typeof r?((e,a,r)=>function(...t){if(p<=u&&(d!==p&&(D=[],A={},l[p]=D,S[p]=A,d=p,g=Date.now(),b=0),d>=0)){const e=D.length,a=Date.now(),s=a-g;b+=s,g=a,e>0&&(D[e-1].currentCallDurationMS=s,A.currentCallDurationMS=Math.max(String(s).length,A.currentCallDurationMS??0)),D.push({stackTrace:P(),currentCallDurationMS:0,sumFrameDurationMS:b,prop:r,args:T(t.map(e=>[null,void 0].includes(e)?`${e}`:""===e?'""':e))}),A.sumFrameDurationMS=Math.max(String(b).length,A.sumFrameDurationMS??0),A.prop=Math.max(r.length,A.prop??0)}return e.apply(a,t)})(r,e,a):r}})};window.PWGLDebugger={version:"0.0.3",SHOW_CALL_STACKS:1,SHOW_ORIGINAL_VALUES:2,SHOW_ARRAYS:4,init:(e={})=>{const a=HTMLCanvasElement.prototype.getContext;HTMLCanvasElement.prototype.getContext=function(...r){const t=a.call(this,...r);return r[0]&&r[0].startsWith("webgl")?o(t,e):t}},instances:[]},console.log(`%cPWGL Debugger v${PWGLDebugger.version}\nhttps://github.com/asjs-dev/pwgl`,"background:#222;color:#0F0");
