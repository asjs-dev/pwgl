const e=(e,t)=>(e&t)===t,t=(e,t=0)=>{const a=(()=>{let e=0,t=0,a=0,r=Date.now();const n={fps:0,delay:0,update:()=>{const o=Date.now();e++,n.delay=(o-r)/16.6667,r=o,o>=a&&(n.fps=1e3*e/(o-t),t=o,a=o+1e3,e=0)}};return n})();let r,n,o,i,c,s=Date.now(),l=!1;const d=()=>{a.update(),e(a.fps,a.delay)},p=()=>{const e=Date.now(),t=e-s;t>=i&&(i=2*o-t,s=e,d())},u=()=>{l&&(r(),c=requestAnimationFrame(u))},b={isPlaying:()=>l,clearMaxFPS:()=>(n=1/0,r=d,b),getMaxFPS:()=>n,setMaxFPS:e=>!e||e<=0?b.clearMaxFPS():(n=e,i=o=Math.floor(1e3/n)-1,r=p,b),start:()=>(l||(l=!0,u()),b),stop:()=>(cancelAnimationFrame(c),l=!1,b)};return b.setMaxFPS(t).start(),b},a=e=>e,r=()=>"\n\n<i>Stack trace:\n| "+(new Error).stack.split("\n").slice(3).map(e=>{const t=e.trim().slice(3).split(" (");return t[1]?'<a href="'+t[1].slice(0,-1)+'" target="_blank">'+t[0]+"</a>":e}).join("\n| ")+"</i>",n=e=>e.map(e=>e&&(Array.isArray(e)||e.constructor?.name?.endsWith("Array"))?`[${e.constructor.name}(${e.length})]`:e),o=(o,i={})=>{const c=(p=i.maxFrameCount??5,u=0,b=20,Math.max(p,Math.min(u,b))),s=i.flags??0,l=[],d=PWGL?Object.entries(PWGL.Const).reduce((e,[t,a])=>(e[a]=t,e),{}):{};var p,u,b;let g,f,h,m,x=-1;const w=e(s,4)?a:n,S=e(s,2)?a:e=>e.map(e=>d[e]??e),y=e(s,1)?r:(e=>()=>e)("");return t(()=>x++),PWGLDebugger.instances.push({canvas:o.canvas,snapshots:l}),new Proxy(o,{get(e,t){const a=e[t];return"function"==typeof a?((e,t,a)=>function(...r){if(x<=c&&(g!==x&&(h=[],l[x]=h,g=x,f=Date.now(),m=0),g>=0)){const e=h.length,t=Date.now(),n=t-f;m+=n,f=t,e>0&&(h[e-1].currentCallDurationMS=n),h.push({stackTrace:y(),currentCallDurationMS:0,sumFrameDurationMS:m,prop:a,args:S(w(r.map(e=>[null,void 0].includes(e)?`${e}`:""===e?'""':e)))})}return e.apply(t,r)})(a,e,t):a}})},i="FRAME",c="    ",s="PROG",l="BIND",d="RSRC",p="UPLD",u="TEXT",b="UNIF",g="ATTR",f="VIEW",h="BLND",m="SAMP",x="FBO ",w="RBO ",S="DPTH",y="SHDR",v="DRAW",D="ALRT",A="WARN",F=[{icon:"",label:i,color:"#0f0",bg:"#000"},{icon:"-",label:c,color:"#999",bg:"#111"},{icon:"◉",label:s,color:"#7CFF9B",bg:"#0b3d1f"},{icon:"↔",label:l,color:"#4FC3F7",bg:"#002233"},{icon:"□",label:d,color:"#FFD54F",bg:"#3a2a00"},{icon:"↑",label:p,color:"#FF7043",bg:"#3b1200"},{icon:"▦",label:u,color:"#c792ea",bg:"#2a1433"},{icon:"≡",label:b,color:"#FF7AA2",bg:"#2a0f1a"},{icon:"▣",label:g,color:"#26E6A6",bg:"#00382f"},{icon:"▢",label:f,color:"#90a4ae",bg:"#1c262b"},{icon:"≈",label:h,color:"#69f0ae",bg:"#032"},{icon:"⇅",label:m,color:"#000",bg:"#33F"},{icon:"▭",label:x,color:"#fff",bg:"#4a148c"},{icon:"▩",label:w,color:"#fff",bg:"#004d40"},{icon:"∠",label:S,color:"#999",bg:"#333"},{icon:"∞",label:y,color:"#8cedd4",bg:"#390b5a"},{icon:"●",label:v,color:"#fff",bg:"#086818"},{icon:"■",label:D,color:"#fff",bg:"#b00020"},{icon:"▲",label:A,color:"#000",bg:"#fc0"}],C=String(Math.random()).split(".")[1],P='*[hidden] {display:none !important;}*[class*="-'+C+'"],*[class*="-'+C+'"] > * {box-sizing:border-box;}.info-button-'+C+" {position:fixed;top:10px;left:10px;width:20px;height:20px;border-radius:100%;opacity:.2;background:#0097e6;color:white;font-size:16px;transition:opacity 250ms linear;cursor:pointer;z-index:99999999;display:flex;align-items:center;justify-content:center;font-family:monospace;box-shadow:0 0 10px 0 rgba(0,0,0,.6);}.info-button-"+C+':after {content:"i";}.info-button-'+C+":hover {opacity:1;}.debugger-container-"+C+" {position:fixed;top:0;left:0;right:0;bottom:0;z-index:99999999;background:rgba(0,0,0,.5);display:flex;justify-content:center;align-items:center;background-image:linear-gradient(45deg,#00000075 25%,transparent 25%,transparent 50%,#00000075 50%,#00000075 75%,transparent 75%);background-size:8px 8px;}.debugger-panel-"+C+" {min-width:320px;min-height:240px;width:90vw;max-width:960px;background:rgba(0,0,0,.5);position:relative;padding:10px;gap:10px;display:flex;flex-direction:column;box-shadow:0 0 30px rgba(0,0,0,.35);backdrop-filter:blur(10px);border:1px solid rgba(255,255,255,.2);border-radius:3px;}.panel-container-"+C+" {display:flex;flex-direction:row;align-items:center;gap:10px;}.panel-container-bottom-"+C+" {height:70vh;gap:5px;}.panel-title-"+C+" {color:white;font-size:16px;font-family:Arial;width:100%;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;padding-left:5px;}.close-button-"+C+" {width:20px;height:20px;cursor:pointer;display:flex;align-items:center;justify-content:center;color:white;font-size:16px;}.close-button-"+C+':after {content:"✖";}.instance-list-'+C+" {width:120px;height:100%;padding:0;margin:0;overflow:auto;}.instance-button-"+C+" {padding:4px 6px;background:black;font-family:Arial;font-size:14px;color:white;transition:opacity 250ms linear;cursor:pointer;overflow:hidden;text-overflow:ellipsis;font-weight:bold;white-space:nowrap;opacity:.75;}.instance-button-"+C+":hover {opacity:1;}.output-"+C+" {width:100%;height:100%;padding:1px;background:rgba(0,0,0,.75);overflow:scroll;display:flex;flex-direction:column;gap:2px;margin:0;scrollbar-width:none;}.output-"+C+" span {min-width:fit-content;width:100%;text-wrap-mode:wrap;word-break:break-word;border:1px solid rgba(255,255,255,0);transition:all 250ms linear;cursor:pointer;padding:3px 6px;}.output-"+C+" span:hover {border:1px solid rgba(255,255,255,.5);}"+F.map(e=>".output-"+C+' span[type="'+e.label+'"] {background:'+e.bg+";color:"+e.color+";}.output-"+C+' span[type="'+e.label+'"]:before {content:"'+e.icon+" "+e.label+' ";}').join("")+".output-"+C+" span a {color:inherit;}",M=(e="div",t=[])=>{const a=document.createElement(e);return a.classList.add(...t),a},E=(e,t)=>`<span type="${t}">${e}</span>\n`,L=()=>{const e=M("style");e.textContent=P;const t=M("div",["info-button-"+C]),a=M("div",["debugger-container-"+C]),r=M("div",["debugger-panel-"+C]),n=M("div",["panel-container-"+C]),o=M("div",["panel-container-"+C,"panel-container-bottom-"+C]),F=M("div",["panel-title-"+C]),L=M("div",["close-button-"+C]),k=M("ul",["instance-list-"+C]),T=M("pre",["output-"+C]);F.textContent="WebGL2 debug panel";const W=()=>a.setAttribute("hidden",null),R=e=>{const t=PWGLDebugger.instances[e];if(t){let e="",a=0,r=0,n=0;t.snapshots.forEach(e=>e.forEach(e=>{a=Math.max(a,String(e.sumFrameDurationMS).length),r=Math.max(r,String(e.currentCallDurationMS).length),n=Math.max(n,e.prop.length)}));const o=String("").padStart(14+a+r+n);t.snapshots.forEach((t,F)=>{e+=E("#"+F,i),t.forEach(t=>{const i=((e,t)=>{if(e>5)return D;if(e>2)return A;switch(t){case"createProgram":case"attachShader":case"linkProgram":case"validateProgram":case"deleteProgram":case"useProgram":return s;case"createShader":case"shaderSource":case"compileShader":case"deleteShader":return y;case"getBufferSubData":case"finish":case"flush":case"readPixels":return A;case"getError":return D;case"bindVertexArray":case"bindBuffer":case"activeTexture":case"bindTexture":return l;case"createBuffer":return d;case"bufferData":case"texImage2D":case"bufferSubData":case"copyBufferSubData":case"texSubImage2D":case"texStorage2D":case"copyTexImage2D":case"copyTexSubImage2D":case"compressedTexImage2D":case"compressedTexSubImage2D":return p;case"texParameteri":case"generateMipmap":return u;case"bindBufferBase":case"bindBufferRange":return b;case"enableVertexAttribArray":case"vertexAttribPointer":case"vertexAttribDivisor":case"vertexAttribIPointer":case"disableVertexAttribArray":return g;case"viewport":case"scissor":case"clearColor":case"clear":return f;case"blendEquation":case"blendFuncSeparate":return h;case"drawElementsInstanced":case"drawArrays":case"drawElements":case"drawArraysInstanced":case"drawRangeElements":case"drawBuffers":case"drawElementsInstancedBaseVertex":return v;case"createSampler":case"samplerParameteri":case"bindSampler":case"deleteSampler":return m;case"createFramebuffer":case"bindFramebuffer":case"framebufferTexture2D":case"framebufferRenderbuffer":case"checkFramebufferStatus":case"blitFramebuffer":return x;case"createRenderbuffer":case"bindRenderbuffer":case"renderbufferStorage":case"renderbufferStorageMultisample":return w;case"depthFunc":case"depthMask":case"cullFace":case"frontFace":case"stencilFunc":case"stencilOp":return S}return t.startsWith("createTexture")?d:t.startsWith("uniform")?b:c})(t.currentCallDurationMS,t.prop);e+=E(`${String(t.sumFrameDurationMS).padStart(a)}ms ${String(t.currentCallDurationMS).padStart(r)}ms ${String(t.prop).padStart(n)} `+(t.args.length?t.args.join("\n"+o):"")+t.stackTrace,i)})}),T.innerHTML=e}};W(),t.addEventListener("mousedown",e=>{e.stopPropagation(),[...k.children].forEach(e=>e.remove()),PWGLDebugger.instances.forEach((e,t)=>{const a=M("div",["instance-button-"+C]);a.setAttribute("instance-id",t),a.textContent=`#${t+1} Canvas`,k.appendChild(a),0===t&&R(0)}),a.removeAttribute("hidden")}),L.addEventListener("click",W),k.addEventListener("click",e=>R(parseInt(e.target.getAttribute("instance-id")))),a.addEventListener("mousedown",e=>e.stopPropagation()),n.appendChild(F),n.appendChild(L),o.appendChild(k),o.appendChild(T),r.appendChild(n),r.appendChild(o),a.appendChild(r),document.body.appendChild(e),document.body.appendChild(t),document.body.appendChild(a)};window.PWGLDebugger={version:"0.0.3",SHOW_CALL_STACKS:1,SHOW_ORIGINAL_VALUES:2,SHOW_ARRAYS:4,init:(e={})=>{L();const t=HTMLCanvasElement.prototype.getContext;HTMLCanvasElement.prototype.getContext=function(...a){const r=t.call(this,...a);return a[0]&&a[0].startsWith("webgl")?o(r,e):r}},instances:[]},console.log(`%cPWGL Debugger v${PWGLDebugger.version}\nhttps://github.com/asjs-dev/pwgl`,"background:#222;color:#0F0");
