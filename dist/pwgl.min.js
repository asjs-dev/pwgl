(()=>{var $="$locations,updateId,removeEventListener,$currentAdditionalPropsUpdateId,addEventListener,context,sourceTexture,propsUpdateId,uniform1f,height,locations,$updateId,$currentInverseMatrixPropsUpdateId,$enableBuffers,$currentColorUpdateId,$parent,matrixCache,$renderTime,$scaleUpdateId,$uploadBuffers,useActiveTexture,$currentParentColorUpdateId,heightMap,children,clearColor,$attachFramebufferAndClearCustom,$matrixBuffer,$height,initRendererConfig,textureProps,$currentUpdateId,texParameteri,$attachFramebufferAndClear,VERSION,updateAnimation,colorCache,$drawInstanced,createElement,$currentAglId,activeTexture,$useTextureAt,callEventHandler,$MAX_BATCH_ITEMS,sinRotationA,sinRotationB,cosRotationA,cosRotationB,setBlendMode,roughnessMap,maxTextureImageUnits,container,$createBuffers,$inverseMatrixCache,textureMatrixCache,colorUpdateId,maxBatchItems,textureIds,$corners,clearBeforeRender,scaledHeight,$updateInverseMatrixCache,normalMap,textureRepeatRandomCache,$attachFramebufferCustom,interactive,bindTexture,scaledWidth,removeChild,textureCrop,$useTexture,distortionProps,depthMultiplier,useTexture,useProgram,heightHalf,webglcontextrestored,$updateAdditionalData,clearTextures,getChildIndex,setChildIndex,callbackBeforeRender,distortionPropsCache,contextId,widthHalf,getProgramParameter,callbackAfterRender,initCallback,useTextureAt,premultipliedAlpha,$attachFramebuffer,frameLength,contextAttributes,isWebGl2Supported,uploadTextureInfo,webglcontextlost,bindActiveTexture,deactivateTexture,useRepeatTextures,getShaderInfoLog,_MAX_TEXTURE_NUM,$updateTransform,specularStrength,textureCropCache,touchstart".split(",");"use strict";var F32A=Float32Array,$m=Math,$d=document,$n=null,$o=Object;var $rfa=(d,b)=>{var f=d.indexOf(b);f>-1&&d.splice(f,1)};var noop=()=>{};var $as=(g,h,c)=>{var i=h.length;while(--i>-1)g[c+i]=h[i]};var _4s={a:"Attrib",u:"Uniform"};var _4r=(b,m,p)=>{var g=b.createShader(m);b.shaderSource(g,p);b.compileShader(g);return g};var Utils={THETA:$m.PI/180,GLSL:{VERSION:"#version 300 es\n",DEFINE:{RADIAN_360:"#define RADIAN_360 6.283185307179586\n",HEIGHT:"#define HEIGHT 255.\n",Z:"#define Z vec3(0,1,-1)\n",PI:"#define PI 3.141592653589793\n"},RANDOM:"float rand(vec2 p,float s){p=mod(p,vec2(10000));return fract(sin(dot(p,vec2(sin(p.x+p.y),cos(p.y-p.x))))*s);}float rand(vec2 p){return rand(p,1.);}"},INFO:{isWebGl2Supported:!1},initContextConfig:(h={})=>({canvas:h.canvas||$d[$[37]]("canvas"),initCallback:h[$[86]],contextAttributes:{...{powerPreference:"high-performance",preserveDrawingBuffer:!1,premultipliedAlpha:!1},...(h[$[91]]||{})}}),initRendererConfig:(h={})=>({locations:h[$[10]]||[],context:h[$[5]]||new Context()}),initApplication:(k)=>{var n=()=>(k??noop)(Utils.INFO[$[92]]);[$[64],"complete"].includes($d.readyState)?n():$d[$[4]]("DOMContentLoaded",n,{once:!0})},createProgram:(b,v,x)=>{var q=_4r(b,35633,v);var t=_4r(b,35632,x);var j=b.createProgram();b.attachShader(j,q);b.attachShader(j,t);b.linkProgram(j);if(!b[$[84]](j,35714)){console.error("Program info:",b.getProgramInfoLog(j),"\n","Validate status:",b[$[84]](j,35715),"\n","Vertex shader info:",b[$[98]](q),"\n","Fragment shader info:",b[$[98]](t));b.deleteShader(q);b.deleteShader(t);b.deleteProgram(j);throw"WebGL application stoped"};return j},getLocationsFor:(b,j,w)=>{var l={};w.forEach((d)=>{l[d]=b["get"+_4s[d[0]]+"Location"](j,d)});return l}};var Const={};var _gl=$d[$[37]]("canvas").getContext("webgl2");if(_gl){for(var c in _gl){var f=_gl[c];if(typeof f==="number"&&c===c.toUpperCase())Const[c]=f};Utils.INFO[$[92]]=!0;Utils.INFO[$[49]]=_gl.getParameter(34930)};var BlendMode=(()=>{var b=(c,d)=>({functionName:"blendFunc"+(c.length<3?"":"Separate"),functions:c,equationName:"blendEquation"+(!d||d.length<2?"":"Separate"),equations:d||[32774]});return{createBlendMode:b,NONE:b([0,0]),NORMAL_PM:b([1,771]),ADD_PM:b([1,1]),MULTIPLY_PM:b([774,771,1,771]),SCREEN_PM:b([1,769,1,771]),ADD_NPM:b([770,1,1,1]),SRC_IN:b([772,0]),SRC_OUT:b([773,0]),SRC_ATOP:b([772,771]),DST_OVER:b([773,1]),DST_IN:b([0,770]),DST_OUT:b([0,771]),DST_ATOP:b([773,770]),XOR:b([773,771]),NORMAL:b([770,771,1,771]),ADD:b([770,772,1,772]),MULTIPLY:b([774,0]),SCREEN:b([770,769,1,769]),OVERLAY:b([1,771]),EXCLUSION:b([775,769]),LIGHTEN:b([1,1],[32776]),DARKEN:b([1,1],[32775]),SHADOW:b([774,768])}})();class TextureInfo{constructor(){this.target=3553;this[$[38]]=this._$cz=this[$[30]]=-1;this.wrapS=this.wrapT=33071;this.internalFormat=this.format=6408;this.minFilter=this.magFilter=9729;this[$[11]]=this.maxMipMapLevel=this.baseMipMapLevel=0;this.$width=this[$[27]]=1;this.type=5121};get width(){return this.$width};get height(){return this[$[27]]};get wrapS(){return this._$g};set wrapS(v){if(this._$g!==v){this._$g=v;++this[$[11]]}};get wrapT(){return this._$h};set wrapT(v){if(this._$h!==v){this._$h=v;++this[$[11]]}};get internalFormat(){return this._$cA};set internalFormat(v){if(this._$cA!==v){this._$cA=v;++this[$[11]]}};get format(){return this._$n};set format(v){if(this._$n!==v){this._$n=v;++this[$[11]]}};get minFilter(){return this._$O};set minFilter(v){if(this._$O!==v){this._$O=v;++this[$[11]]}};get magFilter(){return this._$P};set magFilter(v){if(this._$P!==v){this._$P=v;++this[$[11]]}};get maxMipMapLevel(){return this._$cB};set maxMipMapLevel(v){if(this._$cB!==v){this._$cB=v;++this[$[11]]}};get baseMipMapLevel(){return this._$cH};set baseMipMapLevel(v){if(this._$cH!==v){this._$cH=v;++this[$[11]]}};get type(){return this._$c};set type(v){if(this._$c!==v){this._$c=v;++this[$[11]]}};useActiveTexture(b,c){this[$[39]](b,c);this[$[72]](b)};useActiveTextureAfterUpdate(b,c){this[$[39]](b,c);this.useTextureAfterUpdate(b)};unbindTexture(b,c){this[$[39]](b,c);this._$cz=-1;b[$[65]](this.target,$n)};activeTexture(b,c){this._$cz=c;b[$[39]](33984+c)};bindActiveTexture(b,c){this[$[39]](b,c);b[$[65]](this.target,this._$Y)};useTexture(b){b[$[65]](this.target,this._$Y);this.createTexImage2D(b)};useTextureAfterUpdate(b){b[$[65]](this.target,this._$Y);this[$[93]](b)};createTexImage2D(b){b.texImage2D(this.target,0,this._$cA,this.width,this[$[9]],0,this._$n,this._$c,this._$ck);this[$[93]](b)};uploadTextureInfo(b){b[$[31]](this.target,10242,this._$g);b[$[31]](this.target,10243,this._$h);b[$[31]](this.target,10241,this._$O);b[$[31]](this.target,10240,this._$P);b[$[31]](this.target,33085,this._$cB);b[$[31]](this.target,33084,this._$cH);b.generateMipmap(this.target)};destruct(){}};class Context{constructor(h={}){this[$[82]]=0;this._$p=Utils.initContextConfig(h);this.canvas=this._$p.canvas;this[$[99]]=Utils.INFO[$[49]];this._$cs=this._$cs.bind(this);this._$Z=this._$Z.bind(this);this._$cC=this._$cC.bind(this);this.canvas[$[4]]($[94],this._$cs);this.canvas[$[4]]($[75],this._$Z);this._$Z()};isLost(){return this.gl&&this.gl.isContextLost&&this.gl.isContextLost()};useBlendMode(m){this._$cO=m;this.gl[m.equationName].apply(this.gl,m.equations);this.gl[m.functionName].apply(this.gl,m.functions)};setBlendMode(m,s){if(this._$cO!==m){s&&s();this.useBlendMode(m)}};destruct(){this.gl[$[73]]($n);this.canvas[$[2]]($[94],this._$cs);this.canvas[$[2]]($[75],this._$Z);this._$cD&&this._$cD.loseContext()};clearTextures(){for(var i=0;i<this[$[99]];++i){this._$U[i]=$n;this._$cX[i]=i};this[$[56]].length=0};useTexture(r,q,n,l){if(!r)return-1;var p=this._$U.indexOf(r);if(p<0){p=this._$cX[0];n=!0};if(this._$cX.length<1){l&&l();this[$[77]]();p=0;n=!0};return this[$[87]](r,p,q,n)};useTextureAt(r,p,q,n=!0){r.use(this.gl,p,n,q);this._$U[p]=r;!this[$[56]].includes(p)&&this[$[56]].push(p);$rfa(this._$cX,p);return p};deactivateTexture(r){var p=this._$U.indexOf(r);p>-1&&r.unbindTexture(this.gl,p)};useProgram(k,c){if(this._$cE!==k){this._$cE=k;this[$[77]]();var b=this.gl;b.bindVertexArray($n);b[$[73]](k);b.bindVertexArray(c);return!0}};setCanvasSize(f,j){this.canvas.width=f;this.canvas[$[9]]=j};setSize(f,j){if(this._$j!==f||this._$q!==j){this._$j=f;this._$q=j;this.gl.viewport(0,0,f,j);this.gl.scissor(0,0,f,j)}};_$cs(g){g.preventDefault();this._$cD&&setTimeout(this._$cC,1)};_$cC(){this._$cD.restoreContext()};_$Z(){var b=(this.gl=this.canvas.getContext("webgl2",this._$p[$[91]]));b.agl_id=++this[$[82]];this._$cD=b.getExtension("WEBGL_lose_context");b.pixelStorei(37441,!0);b.enable(3042);b.blendColor(1,1,1,1);b.enable(3089);this._$j=this._$q=this._$cE=this._$cO=$n;this._$U=[];this._$cX=[];this[$[56]]=[];this[$[77]]();this.setCanvasSize(1,1);this._$p[$[86]]&&setTimeout(this._$p[$[86]],1)}};class Buffer{constructor(p,d,f,g,j,h,m=1){var k=f*g;this.data=typeof d==="number"?new F32A(d*k):d;this._$cl=p;this._$d=f;this._$f=g;this._$r=j??34962;this._$c=h??35048;this._$s=k*4;this._$t=g*4;this._$D=m;if(this._$c===35044)this._$s=this._$t=0};create(b,n){this._$L=n[this._$cl];this._$v=b.createBuffer();this.bind(b)};bind(b){b.bindBuffer(this._$r,this._$v)};upload(b,l){this.bind(b);l&&this._$w(b);b.bufferData(this._$r,this.data,this._$c)};destruct(){this.data=$n};_$w(b){var i=-1;while(++i<this._$d){var c=this._$L+i;b.enableVertexAttribArray(c);b.vertexAttribPointer(c,this._$f,5126,!1,this._$s,i*this._$t);b.vertexAttribDivisor(c,this._$D)}}};class BaseTransformProps{constructor(){this[$[1]]=0;this._$cP=this._$dr=this[$[43]]=this[$[44]]=this._x=this._y=this._$M=this._$E=this._$F=this._$k=this._$l=0;this[$[45]]=this[$[46]]=1};get x(){return this._x};set x(v){if(this._x!==v){this._x=v;++this[$[1]]}};get y(){return this._y};set y(v){if(this._y!==v){this._y=v;++this[$[1]]}};get rotation(){return this._$M};set rotation(v){if(this._$M!==v){this._$M=v;++this._$cP}};get anchorX(){return this._$E};set anchorX(v){if(this._$E!==v){this._$E=v;++this[$[1]]}};get anchorY(){return this._$F};set anchorY(v){if(this._$F!==v){this._$F=v;++this[$[1]]}};get skewX(){return this._$k};set skewX(v){if(this._$k!==v){this._$k=v;++this._$cP}};get skewY(){return this._$l};set skewY(v){if(this._$l!==v){this._$l=v;++this._$cP}};updateRotation(){if(this._$dr<this._$cP){this._$dr=this._$cP;++this[$[1]];if(this._$k===0&&this._$l===0){this[$[43]]=this[$[44]]=$m.sin(this._$M);this[$[45]]=this[$[46]]=$m.cos(this._$M)}else{var k=this._$M-this._$k;var l=this._$M+this._$l;this[$[43]]=$m.sin(l);this[$[45]]=$m.cos(l);this[$[44]]=$m.sin(k);this[$[46]]=$m.cos(k)}}}};class ColorProps{constructor(){this[$[1]]=0;this.cache=[1,1,1,1]};get r(){return this.cache[0]};set r(v){if(this.cache[0]!==v){this.cache[0]=v;++this[$[1]]}};get g(){return this.cache[1]};set g(v){if(this.cache[1]!==v){this.cache[1]=v;++this[$[1]]}};get b(){return this.cache[2]};set b(v){if(this.cache[2]!==v){this.cache[2]=v;++this[$[1]]}};get a(){return this.cache[3]};set a(v){if(this.cache[3]!==v){this.cache[3]=v;++this[$[1]]}};set(r,g,b,a){this.r=r;this.g=g;this.b=b;this.a=a}};class ItemProps extends BaseTransformProps{constructor(){super();this[$[18]]=0;this._$dl=-1;this[$[66]]=this[$[59]]=this._$x=this._$y=this.$width=this[$[27]]=this.alpha=1};get scaleX(){return this._$x};set scaleX(v){if(this._$x!==v){this._$x=v;++this[$[18]]}};get scaleY(){return this._$y};set scaleY(v){if(this._$y!==v){this._$y=v;++this[$[18]]}};get width(){return this.$width};set width(v){if(this.$width!==v){this.$width=v;++this[$[18]]}};get height(){return this[$[27]]};set height(v){if(this[$[27]]!==v){this[$[27]]=v;++this[$[18]]}};updateScale(){if(this._$dl<this[$[18]]){this._$dl=this[$[18]];++this[$[1]];this[$[66]]=this.$width*this._$x;this[$[59]]=this[$[27]]*this._$y}}};class LightProps extends ItemProps{constructor(){super();this.z=0};get width(){return this.$width};set width(v){if(this.$width!==v){this.$width=this[$[27]]=v;++this[$[18]]}};get height(){return this[$[27]]};set height(v){}};class TextureCrop{constructor(){this[$[1]]=0;this._$cI=-1;this.cache=[0,0,1,1];this._$j=this._$q=1};get x(){return this.cache[0]};set x(v){if(this.cache[0]!==v){this.cache[0]=v;++this[$[1]]}};get y(){return this.cache[1]};set y(v){if(this.cache[1]!==v){this.cache[1]=v;++this[$[1]]}};get width(){return this._$j};set width(v){if(this._$j!==v){this._$j=v;++this[$[1]]}};get height(){return this._$q};set height(v){if(this._$q!==v){this._$q=v;++this[$[1]]}};updateCrop(){if(this._$cI<this[$[1]]){this._$cI=this[$[1]];this.cache[2]=this._$j-this.cache[0];this.cache[3]=this._$q-this.cache[1]}};setRect(b){this.x=b.x;this.y=b.y;this.width=b.width;this[$[9]]=b[$[9]]}};class TextureProps extends BaseTransformProps{constructor(){super();this._$G=this._$H=1;this.cache=[0,0,0]};get scaledWidth(){return this._$G};get scaledHeight(){return this._$H};get repeatX(){return this._$G};set repeatX(v){if(this._$G!==v){this._$G=v;++this[$[1]]}};get repeatY(){return this._$H};set repeatY(v){if(this._$H!==v){this._$H=v;++this[$[1]]}};get repeatRandomRotation(){return this.cache[0]};set repeatRandomRotation(v){this.cache[0]=v};get repeatRandomAlpha(){return this.cache[1]};set repeatRandomAlpha(v){this.cache[1]=v};get repeatRandomBlur(){return this.cache[2]};set repeatRandomBlur(v){this.cache[2]=v}};class DistortionProps{constructor(){this.distortTexture=!0;this.cache=[0,0,1,0,1,1,0,1]};get topLeftX(){return this.cache[0]};set topLeftX(v){this.cache[0]=v};get topLeftY(){return this.cache[1]};set topLeftY(v){this.cache[1]=v};get topRightX(){return this.cache[2]};set topRightX(v){this.cache[2]=v};get topRightY(){return this.cache[3]};set topRightY(v){this.cache[3]=v};get bottomRightX(){return this.cache[4]};set bottomRightX(v){this.cache[4]=v};get bottomRightY(){return this.cache[5]};set bottomRightY(v){this.cache[5]=v};get bottomLeftX(){return this.cache[6]};set bottomLeftX(v){this.cache[6]=v};get bottomLeftY(){return this.cache[7]};set bottomLeftY(v){this.cache[7]=v}};class BaseFilter{constructor(b,c,d=0){this.TYPE=b;this.SUB_TYPE=c;this.on=!0;this.v=new F32A(9);this.kernels=new F32A(16);this.intensity=d};get intensity(){return this.v[0]};set intensity(v){this.v[0]=v};get intensityX(){return this.v[0]};set intensityX(v){this.v[0]=v};get intensityY(){return this.v[1]};set intensityY(v){this.v[1]=v};get mix(){return this.v[1]};set mix(v){this.v[1]=v};get r(){return this.v[2]};set r(v){this.v[2]=v};get g(){return this.v[3]};set g(v){this.v[3]=v};get b(){return this.v[4]};set b(v){this.v[4]=v}};class FilterTextureProps{constructor(d,f,h=0,j=0,b=0,c=0,g=1,k=1){this._$z=d;this.texture=f;this.translateX=h;this.translateY=j;this.cropX=b;this.cropY=c;this.cropWidth=g;this.cropHeight=k};get translateX(){return this._$z.v[1]};set translateX(v){this._$z.v[1]=v};get translateY(){return this._$z.v[2]};set translateY(v){this._$z.v[2]=v};get cropX(){return this._$z.v[3]};set cropX(v){this._$z.v[3]=v};get cropY(){return this._$z.v[4]};set cropY(v){this._$z.v[4]=v};get cropWidth(){return this._$z.v[5]};set cropWidth(v){this._$z.v[5]=v};get cropHeight(){return this._$z.v[6]};set cropHeight(v){this._$z.v[6]=v}};var _18n=$d[$[37]]("img");class Texture extends TextureInfo{constructor(j,m){super();this._$A=_18n;this._$cQ=this._$cQ.bind(this);this.isVideo=!1;this.source=j;this.shouldUpdate=m;this._$cZ="width";this._$df=$[9];this._$cY=this._$cm=this._$dg=0;this._$Q};get width(){return this._$cb||1};get height(){return this._$cn||1};get source(){return this._$A};set source(f){if(f){this._$A[$[2]](this._$Q,this._$cQ);this._$A=f;this.isVideo=f.tagName.toLowerCase()==="video";this._$Q=this.isVideo?"canplay":"load";!this._$cQ()&&f[$[4]](this._$Q,this._$cQ,{once:!0})}};destruct(){this._$A[$[2]](this._$Q,this._$cQ)};use(b,c,k,l){if(this[$[38]]<b.agl_id){this[$[38]]=b.agl_id;this._$Y=b.createTexture();this[$[20]](b,c);return};if(this[$[30]]<this[$[11]]){this[$[30]]=this[$[11]];this[$[20]](b,c);return};if(this._$dg<this._$cm){this._$dg=this._$cm;this[$[20]](b,c);return};if(this.shouldUpdate&&this._$cY<l){this._$cY=l;this[$[20]](b,c);return};if(this.isVideo&&!this._$A.paused){this[$[20]](b,c);return};if(this._$cz!==c||k)this[$[95]](b,c)};get _$cb(){return this._$A[this._$cZ]};get _$cn(){return this._$A[this._$df]};_$cQ(){this._$cZ="width";this._$df=$[9];if(this._$A.naturalWidth){this._$cZ="naturalWidth";this._$df="naturalHeight"}else if(this._$A.videoWidth){this._$cZ="videoWidth";this._$df="videoHeight"};if(this._$cb*this._$cn>0){this._$ck=this._$A;++this._$cm;return!0}else this._$ck=$n}};Texture.loadImage=(d,m)=>{var g=$d[$[37]]("img");g.src=d;return new Texture(g,m)};Texture.loadVideo=(d,m)=>{var h=$d[$[37]]("video");h.src=d;return new Texture(h,m)};class Framebuffer extends TextureInfo{constructor(){super();this._$cF=0;this._$dp=-1};get width(){return this.$width};set width(v){if(this.$width!==v&&v>0){this.$width=v;++this._$cF}};get height(){return this[$[27]]};set height(v){if(this[$[27]]!==v&&v>0){this[$[27]]=v;++this._$cF}};setSize(w,h){this.width=w;this[$[9]]=h};bind(b){b.bindFramebuffer(36160,this._$cc)};unbind(b){b.bindFramebuffer(36160,$n)};use(b,c,d){if(this[$[38]]<b.agl_id){this[$[38]]=b.agl_id;this._$Y=b.createTexture();this[$[20]](b,c);this._$cc=b.createFramebuffer();this.bind(b);b.framebufferTexture2D(36160,36064,3553,this._$Y,0);this.unbind(b);return};if(this[$[30]]<this[$[11]]){this[$[30]]=this[$[11]];this.useActiveTextureAfterUpdate(b,c);return};if(this._$dp<this._$cF){this._$dp=this._$cF;this[$[20]](b,c);return};if(this._$cz!==c||d)this[$[95]](b,c)}};var Matrix3Utilities={identity:()=>new F32A([1,0,0,1,0,0]),projection:(v,l)=>{v[0]=2/l.width;v[1]=v[2]=0;v[3]=-2/l[$[9]];v[4]=-1;v[5]=1},transformLocal:(c,v)=>{var g=c.anchorX;var h=c.anchorY;var n=c[$[66]];var p=c[$[59]];v[0]=c[$[45]]*n;v[1]=c[$[43]]*n;v[2]=-c[$[44]]*p;v[3]=c[$[46]]*p;v[4]=c.x-g*v[0]-h*v[2];v[5]=c.y-g*v[1]-h*v[3]},transform:(f,c,v)=>{var x=c.x;var y=c.y;var g=c.anchorX;var h=c.anchorY;var q=c[$[43]];var r=c[$[44]];var s=c[$[45]];var t=c[$[46]];var n=c[$[66]];var p=c[$[59]];v[0]=(s*f[0]+q*f[2])*n;v[1]=(s*f[1]+q*f[3])*n;v[2]=(t*f[2]-r*f[0])*p;v[3]=(t*f[3]-r*f[1])*p;v[4]=-g*v[0]-h*v[2]+x*f[0]+y*f[2]+f[4];v[5]=-g*v[1]-h*v[3]+x*f[1]+y*f[3]+f[5]},inverse:(f,v)=>{var b=1/(f[0]*f[3]-f[2]*f[1]);v[0]=b*f[3];v[1]=-b*f[1];v[2]=-b*f[2];v[3]=b*f[0];v[4]=b*(f[2]*f[5]-f[3]*f[4]);v[5]=-b*(f[0]*f[5]-f[1]*f[4])},isPointInMatrix:(f,d)=>{var x=d.x*f[0]+d.y*f[2]+f[4];var y=d.x*f[1]+d.y*f[3]+f[5];return x>=0&&x<=1&&y>=0&&y<=1},calcCorners:(f,j,l)=>{var k=l[$[83]];var m=l[$[74]];j[0].x=k+f[4]*k;j[0].y=l[$[9]]-(m+f[5]*m);j[1].x=j[0].x+(f[0]+f[2])*k;j[1].y=j[0].y-(f[1]+f[3])*m;j[2].x=j[0].x+(f[0]+k*f[2]);j[2].y=j[0].y-(f[1]+m*f[3]);j[3].x=j[0].x+(k*f[0]+f[2]);j[3].y=j[0].y-(m*f[1]+f[3])}};class Item{constructor(){this.TYPE=Item.TYPE;this[$[64]]=!1;this[$[16]]=Matrix3Utilities.identity();this[$[54]]=this[$[7]]=0;this[$[35]]=[1,1,1,1];this.renderable=!0;this.props=new ItemProps();this.color=new ColorProps();this._$dm=this[$[14]]=this._$ds=this[$[21]]=this[$[3]]=this[$[12]]=-1;this[$[80]]=this[$[85]]=noop;this.$bounds={x:0,y:0,width:0,height:0}};get stage(){return this[$[15]]?this[$[15]].stage:$n};get parent(){return this[$[15]]};set parent(v){if(this[$[15]]!==v){this[$[15]]=v;this._$ds=this[$[21]]=this[$[3]]=this[$[12]]=-1}};get callbackBeforeRender(){return this._$dn};set callbackBeforeRender(v){this._$dn=v??noop};get callbackAfterRender(){return this._$dh};set callbackAfterRender(v){this._$dh=v??noop};callEventHandler(d,b){if(this[$[64]]){var g=this["on"+b.type];g&&g(this,d,b)};this[$[15]]&&this[$[15]][$[41]](d,b)};getBounds(){return this.$bounds};destruct(){this[$[15]]&&this[$[15]][$[67]]&&this[$[15]][$[67]](this)};update(){var c=this.props;c.updateRotation();c.updateScale();var f=this[$[15]];(this._$ds<f[$[7]]||this._$dm<c[$[1]])&&this[$[100]](c,f)};$updateTransform(c,f){this._$ds=f[$[7]];this._$dm=c[$[1]];++this[$[7]];Matrix3Utilities.transform(f[$[16]],c,this[$[16]])}};Item.TYPE="item";class BaseDrawable extends Item{constructor(){super();this[$[52]]=new F32A(6);this[$[57]]=[{x:0,y:0},{x:0,y:0},{x:0,y:0},{x:0,y:0}]};getCorners(){this[$[76]]();return this[$[57]]};getBounds(){this[$[76]]();return this.$bounds};$calcCorners(){var g=this.stage;g&&Matrix3Utilities.calcCorners(this[$[16]],this[$[57]],g.renderer)};$calcBounds(){this.$calcCorners();var j=this[$[57]];var h=this.$bounds;var a=j[0];var b=j[1];var c=j[2];var d=j[3];h.x=$m.min(a.x,b.x,c.x,d.x);h.y=$m.min(a.y,b.y,c.y,d.y);h.width=$m.max(a.x,b.x,c.x,d.x);h[$[9]]=$m.max(a.y,b.y,c.y,d.y)};$updateAdditionalData(){if(this[$[3]]<this[$[7]]){this[$[3]]=this[$[7]];this[$[60]]();this.$calcBounds()}};$updateInverseMatrixCache(){if(this[$[12]]<this[$[7]]){this[$[12]]=this[$[7]];Matrix3Utilities.inverse(this[$[16]],this[$[52]])}}};class Container extends Item{constructor(){super();this.TYPE=Container.TYPE;this[$[23]]=[]};get premultipliedAlpha(){return this.props.alpha*this[$[15]][$[88]]};destruct(){this.empty();super.destruct()};empty(){while(this[$[23]].length)this.removeChildAt(0)};contains(b){return this[$[78]](b)>-1};addChild(b){this.addChildAt(b,this[$[23]].length)};addChildAt(b,c){if(b){b.parent&&b.parent[$[67]](b);this[$[23]].push(b);this[$[79]](b,c);b.parent=this}};removeChild(b){if(b){$rfa(this[$[23]],b);b.parent=$n}};removeChildAt(c){this[$[67]](this.getChildAt(c))};getChildAt(c){return this[$[23]][c]};setChildIndex(b,c){$rfa(this[$[23]],b);this[$[23]].splice(c,0,b)};getChildIndex(b){return this[$[23]].indexOf(b)};swapChildren(f,g){var l=this[$[78]](f);var m=this[$[78]](g);if(l>-1&&m>-1){this[$[79]](f,m);this[$[79]](g,l)}};getBounds(){var h=this.$bounds;h.x=h.y=1/0;h.width=h[$[9]]=-1/0;for(var i=0,l=this[$[23]].length;i<l;++i){var n=this[$[23]][i].getBounds();h.x=$m.min(h.x,n.x);h.y=$m.min(h.y,n.y);h.width=$m.max(h.width,n.width);h[$[9]]=$m.max(h[$[9]],n[$[9]])};return h};update(){super.update();this._$cd()};_$cd(){var j=this[$[15]];var d=this.color;if(this[$[21]]<j[$[54]]||this[$[14]]<d[$[1]]){this[$[14]]=d[$[1]];this[$[21]]=j[$[54]];++this[$[54]];var k=this[$[35]];var p=j[$[35]];k[0]=p[0]*d.r;k[1]=p[1]*d.g;k[2]=p[2]*d.b;k[3]=p[3]*d.a}}};Container.TYPE=$[50];var TEMP_ARRAY=[];class Light extends BaseDrawable{constructor(){super();this.props=new LightProps();this.unregisterData();this.castShadow=this.shading=this.centerReflection=!0;this.flattenShadow=!1;this.angle=0;this.spotAngle=180*Utils.THETA;this.type=Light.Type.POINT;this.precision=this.shadowLength=this[$[101]]=1;this.maxShadowStep=128};registerData(f,l,n){this._id=f;this._$cf=f*16;this._$cJ=f*8;this._$R=l;this._$ct=n;this[$[14]]=-1;this._$cR()};unregisterData(){this.registerData(0,TEMP_ARRAY,TEMP_ARRAY)};get castShadow(){return this._$V};set castShadow(v){this._$V=v;this._$cR()};get shading(){return this._$I};set shading(v){this._$I=v;this._$cR()};get flattenShadow(){return this._$cv};set flattenShadow(v){this._$cv=v;this._$cR()};get centerReflection(){return this._$cS};set centerReflection(v){this._$cS=v;this._$cR()};isOn(){return this.renderable&&this.stage!==$n};update(){var l=this._$R;var m=this._$cf;if(this.isOn()){super.update();this._$cd();var p=this._$cJ;var n=this._$ct;n[p]=this.type;n[p+2]=this.props.z;n[p+3]=this.precision;n[p+4]=this.maxShadowStep;n[p+5]=this[$[101]];l[m+6]=this.props.width;l[m+7]=this.spotAngle;l[m+12]=l[m+11]>0?1:0;l[m+13]=this.shadowLength;l[m+14]=this.props.alpha;l[m+15]=this.angle}else l[m+12]=0};_$cR(){this._$ct[this._$cJ+1]=(this._$V*1)|(this._$I*2)|(this._$cv*4)|(this._$cS*8)};$updateAdditionalData(){if(this.isOn()&&this[$[3]]<this[$[7]]){this[$[3]]=this[$[7]];this.$calcBounds()}};$calcCorners(){Matrix3Utilities.calcCorners(this[$[16]],this[$[57]],this.stage.renderer);var k=this[$[57]];var a=k[0];var b=k[1];var c=k[2];var d=k[3];a.x+=a.x-d.x+(a.x-c.x);a.y+=a.y-d.y+(a.y-c.y);c.x+=c.x-b.x;c.y+=c.y-b.y;d.x+=d.x-b.x;d.y+=d.y-b.y};$updateTransform(g,j){super[$[100]](g,j);$as(this._$R,this[$[16]],this._$cf)};_$cd(){var h=this.color;if(this[$[14]]<h[$[1]]){this[$[14]]=h[$[1]];var l=this._$R;var q=this[$[15]][$[35]];var m=this._$cf;l[m+8]=q[0]*h.r;l[m+9]=q[1]*h.g;l[m+10]=q[2]*h.b;l[m+11]=q[3]*h.a}}};Light.Type={POINT:0,DIRECTIONAL:1};class Image extends BaseDrawable{constructor(texture){super();this.TYPE=Image.TYPE;this[$[53]]=Matrix3Utilities.identity();this.tintType=Image.TintType.NONE;this.blendMode=BlendMode.NORMAL;this[$[29]]=new TextureProps();this[$[68]]=new TextureCrop();this[$[70]]=new DistortionProps();this._$dt=-1;this[$[102]]=this[$[68]].cache;this[$[62]]=this[$[29]].cache;this[$[81]]=this[$[70]].cache;this[$[35]]=this.color.cache;this.texture=texture};update(){super.update();this._$cw();this[$[68]].updateCrop()};isContainsPoint(c){this[$[60]]();return Matrix3Utilities.isPointInMatrix(this[$[52]],c)};_$cw(){var d=this[$[29]];d.updateRotation();if(this._$dt<d[$[1]]){this._$dt=d[$[1]];Matrix3Utilities.transformLocal(d,this[$[53]])}}};Image.TYPE="drawable";Image.TintType={NONE:0,NORMAL:1,GRAYSCALE:2,OVERRIDE:3,ADD:4};class AnimatedImage extends Image{constructor(c){super(c);this._$db=this[$[90]]=120;this._$B=[];this.frame=0;this._$cY=Date.now();this[$[34]];this.stop()};get isPlaying(){return this[$[34]]===this._$cK};get frames(){return this._$B};set frames(v){this._$B=v;var d=this._$B[0];if(d){this._$db=d.length??this[$[90]];this._$cY=Date.now()}};gotoAndStop(b){this.stop();this.frame=b;this._$cL()};gotoAndPlay(b){this.frame=b;this.play()};stop(){this[$[34]]=noop};play(){this[$[34]]=this._$cK;this._$cL()};update(f){super.update();this[$[34]](f)};destruct(){this.stop();super.destruct()};_$cK(f){var g=f-this._$cY;if(g>this._$db){this._$cY=f;this.frame+=~~(g/this._$db);if(this.frame>=this._$B.length)this.frame=0;this._$cL()}};_$cL(){var h=this._$B[this.frame];this[$[68]].setRect(h);this._$db=h.length??this[$[90]]}};class BaseRenderer{constructor(g){this[$[63]]=this[$[89]];this[$[25]]=this[$[32]];this._$dq=noop;this._$cp=1;this.width=this[$[9]]=this[$[83]]=this[$[74]]=0;this[$[24]]=new ColorProps();this._$cT=this[$[17]]=0;this._$J=g;this._$p=this._$J.config;this[$[5]]=this._$p[$[5]];this._$p[$[10]]=this._$p[$[10]].concat(["uFlpY","aPos","uTex"]);this[$[13]]=!1;this._$dc=new Buffer("",new Uint16Array([0,1,3,2]),0,0,34963,35044);this._$cG=new Buffer("aPos",new F32A([0,0,1,0,1,1,0,1]),1,2,34962,35044,0)};get clearBeforeRender(){return this._$dq===this._$m};set clearBeforeRender(v){this._$dq=v?this._$m:noop};setSize(b,f){this.width=b;this[$[9]]=f;++this._$cp};renderToFramebuffer(l){if(!this[$[5]].isLost()){this._$cM();this[$[25]](l);this._$cg(l);l.unbind(this.$gl)}};render(){if(!this[$[5]].isLost()){this._$cM();this.$gl[$[8]](this[$[0]].uFlpY,1);this._$dq();this._$cg()}};destruct(){};$attachFramebuffer(l){l.bind(this.$gl);l.setSize(this.width,this[$[9]]);this[$[5]][$[72]](l,this[$[17]],!1);this[$[5]][$[96]](l);this.$gl[$[8]](this[$[0]].uFlpY,-1)};$attachFramebufferAndClear(l){this[$[89]](l);this._$dq()};$resize(){this[$[83]]=this.width/2;this[$[74]]=this[$[9]]/2;this[$[5]].setSize(this.width,this[$[9]])};$drawInstanced(c){this.$gl.drawElementsInstanced(5,4,5123,0,c)};$useTextureAt(h,j,d,k){this.$gl.uniform1i(j,this[$[5]][$[87]](h,d,this[$[17]],k))};$useTexture(h,j,k){this.$gl.uniform1i(j,this[$[5]][$[72]](h,this[$[17]],k))};$uploadBuffers(){this._$cG.upload(this.$gl,this[$[13]]);this._$dc.upload(this.$gl);this[$[13]]=!1};$createBuffers(){this._$dc.create(this.$gl,this[$[0]]);this._$cG.create(this.$gl,this[$[0]])};_$cg(l){this[$[17]]=Date.now();this.$render(l);this.$gl.flush()};_$cM(){this.$gl=this[$[5]].gl;if(this._$cT!==this[$[5]][$[82]]){this._$cT=this[$[5]][$[82]];this._$cq();this[$[13]]=!0}else if(this[$[5]][$[73]](this._$K,this._$b))this[$[13]]=!0;this.$resize()};_$m(){this.$gl[$[24]](this[$[24]].r,this[$[24]].g,this[$[24]].b,this[$[24]].a);this.$gl.clear(16384)};_$cq(){var g=this._$J;this._$K=Utils.createProgram(this.$gl,this.$createVertexShader(g),this.$createFragmentShader(g));this[$[0]]=Utils.getLocationsFor(this.$gl,this._$K,this._$p[$[10]]);this._$b=this.$gl.createVertexArray();this[$[5]][$[73]](this._$K,this._$b);this[$[51]]()}};class BatchRenderer extends BaseRenderer{constructor(b){b.config[$[10]]=b.config[$[10]].concat(["aMt"]);super(b);this[$[42]]=b[$[55]]||1;this[$[26]]=new Buffer("aMt",this[$[42]],4,4)};$uploadBuffers(){this[$[26]].upload(this.$gl,this[$[13]]);super[$[19]]()};$createBuffers(){super[$[51]]();this[$[26]].create(this.$gl,this[$[0]])}};class StageContainer extends Container{constructor(b){super();this.renderer=b;this[$[15]]=new Item()};get stage(){return this};get parent(){return this[$[15]]};get premultipliedAlpha(){return this.props.alpha}};class FilterRenderer extends BaseRenderer{constructor(h={}){h.config=Utils[$[28]](h.config);h.config[$[10]]=h.config[$[10]].concat(["uFTex","uFtrT","uFtrV","uFtrK"]);super(h);this[$[63]]=this[$[25]]=noop;this.filters=h.filters||[];this[$[6]]=h[$[6]];this._$cr=[new Framebuffer(),new Framebuffer()]};$render(q){var j=this[$[5]];var b=this.$gl;var p=this[$[17]];var m=this[$[0]];j[$[47]](BlendMode.NORMAL);this[$[19]]();this[$[40]](this[$[6]],m.uTex,0);var l=this.filters.length||1;var c=l-2;for(var i=0;i<l;++i){var s;var f=this.filters[i];var n=f&&f.on;var g=i>c;var r=n&&f[$[29]]&&f[$[29]].texture;r&&this[$[40]](r,m.uFTex,1);if(g)q?this[$[32]](q):b[$[8]](m.uFlpY,1);else if(n){s=this._$cr[i&1];this[$[32]](s)};if(n){b.uniform1fv(m.uFtrV,f.v);b.uniformMatrix4fv(m.uFtrK,!1,f.kernels);b.uniform2i(m.uFtrT,f.TYPE,f.SUB_TYPE)};(n||g)&&this[$[36]](1);r&&j[$[96]](r);if(s){s.unbind(b);j[$[87]](s,0,p)}}};$createVertexShader(){return Utils.GLSL[$[33]]+"precision highp float;\nin vec2 aPos;uniform float uFlpY;out vec2 vUv,vTUv;void main(void){gl_Position=vec4(aPos*2.-1.,1,1);vUv=gl_Position.xy;gl_Position.y*=uFlpY;vTUv=vec2(aPos.x,1.-aPos.y);}"};$createFragmentShader(){var k=(d)=>"for(float i=0.;i<RADIAN_360;i+=t){poft=clamp(f+ivec2(floor(wh*vec2(cos(i),sin(i)))),ivec2(Z.xx),ts-1);clg=texelFetch(uTex,poft,0);"+d+"}";return Utils.GLSL[$[33]]+"precision highp float;\n"+Utils.GLSL.DEFINE.Z+Utils.GLSL.DEFINE.RADIAN_360+"uniform sampler2D uTex,uFTex;uniform ivec2 uFtrT;uniform float uFtrV[9];uniform mat4 uFtrK;in vec2 vUv,vTUv;out vec4 oCl;"+Utils.GLSL.RANDOM+"float gtGS(vec4 cl){return .3*oCl.r+.59*oCl.g+.11*oCl.b;}void main(void){oCl=texture(uTex,vTUv);if(uFtrT.x>0){float vl[]=uFtrV,v=vl[0];ivec2 ts=textureSize(uTex,0),f=ivec2(floor(vTUv*vec2(ts)));vec2 vol=v/vec2(ts);vec3 rgb=vec3(vl[2],vl[3],vl[4]);mat4 kr=uFtrK;if(uFtrT.x<2){kr*=v;oCl.rgb=(oCl.rgb*(1.-vl[1]))+(texelFetch(uTex,f-ivec2(1),0)*kr[0].x+texelFetch(uTex,f+ivec2(0,-1),0)*kr[0].y+texelFetch(uTex,f+ivec2(1,-1),0)*kr[0].z+texelFetch(uTex,f+ivec2(-1,0),0)*kr[0].w+oCl*kr[1].x+texelFetch(uTex,f+ivec2(1,0),0)*kr[1].y+texelFetch(uTex,f+ivec2(-1,1),0)*kr[1].z+texelFetch(uTex,f+ivec2(0,1),0)*kr[1].w+texelFetch(uTex,f+ivec2(1),0)*kr[2].x).rgb*vl[1];}else if(uFtrT.x<3)oCl.rgb=(oCl.rgb*(1.-vl[1]))+vec3(kr[0].r*oCl.r+kr[0].g*oCl.g+kr[0].b*oCl.b,kr[1].r*oCl.r+kr[1].g*oCl.g+kr[1].b*oCl.b,kr[2].r*oCl.r+kr[2].g*oCl.g+kr[2].b*oCl.b);else if(uFtrT.x<4){vec4 oClVl=oCl*(1.-v);if(uFtrT.y<2)oCl=oClVl+vec4(vec3(gtGS(oCl)),oCl.a)*v;else if(uFtrT.y<3)oCl=oClVl+vec4(vec3(.874,.514,.156)*gtGS(oCl),oCl.a)*v;else if(uFtrT.y<4)oCl=oClVl+vec4(1.-oCl.rgb,oCl.a)*v;else if(uFtrT.y<5)oCl.rgb*=rgb*v;else if(uFtrT.y<6)oCl.rgb=(round((oCl.rgb*255.)/v)/255.)*v;else if(uFtrT.y<7){vec2 pv=pow(abs(vUv*v),vec2(vl[1]));float cv=clamp((1.-length(pv))*vl[5],0.,1.);oCl.rgb=oCl.rgb*cv+rgb*(1.-cv);}else if(uFtrT.y<8)oCl.rgb+=vec3(vUv.xy*.15,(vUv.x*vUv.y)*.15)*v;else if(uFtrT.y<9)oCl.rgb=(vl[1]+1.)*oCl.rgb*v-.5*vl[1];else if(uFtrT.y<10)oCl.rgb=pow(oCl.rgb,vec3(1./v));}else if(uFtrT.x<5){vec2 wh=vec2(v,vl[1]);ivec2 poft;vec4 clg,cl=oCl;float cnt=1.,rnd=rand(vTUv*100.+50.),t=RADIAN_360/(3.+ceil(3.*rnd));if(uFtrT.y<2){"+k("cl+=clg;cnt++;")+"cl/=cnt;}else{float omx=max(oCl.r,max(oCl.g,oCl.b));cl=vec4(0);"+k("if(max(clg.r,max(clg.g,clg.b))>omx){cl+=clg;cnt++;}")+"cl=(oCl+cl)/cnt;}float dst=vl[2]<1.?1.:clamp(distance(vec2(vl[3],vl[4]),vTUv)*vl[5],0.,1.);oCl=dst*cl+(1.-dst)*oCl;}else if(uFtrT.x<6)oCl=texture(uTex,floor(vTUv/vol)*vol);else if(uFtrT.x<8){vec4 mskCl=texture(uFTex,mod(vec2(vl[1],vl[2])+vTUv,1.)*vec2(vl[5]-vl[3],vl[6]-vl[4]));if(uFtrT.x<7)oCl=texture(uTex,vTUv+(Z.yz*(mskCl.rg-.5)*2.*vol));else if(uFtrT.x<8)oCl.a*=v<4.?mskCl[int(v)]:(mskCl.r+mskCl.g+mskCl.b+mskCl.a)/4.;}else if(uFtrT.x<9){vec4 pcl=vec4(texture(uFTex,vTUv-vec2(vol.x,0)).r,oCl.g,texture(uFTex,vTUv+vec2(vol.x,0)).b,1);float dst=vl[2]<1.?1.:clamp(distance(vec2(vl[3],vl[4]),vTUv),0.,1.),mA=vl[5]==0.?dst:1.-dst,mB=1.-mA;oCl=mA*pcl+mB*oCl;}}}"}};class NormalMapRenderer extends BaseRenderer{constructor(b={}){b.config=Utils[$[28]](b.config);super(b);this[$[58]]=!0;this[$[24]].set(0,0,0,1);this[$[22]]=b[$[22]]};$render(){this[$[5]][$[47]](BlendMode.NORMAL);this[$[40]](this[$[22]],this[$[0]].uTex,0);this[$[19]]();this[$[36]](1)};$createVertexShader(){return Utils.GLSL[$[33]]+"precision highp float;\nin vec2 aPos;uniform float uFlpY;out vec2 vTUv;void main(void){gl_Position=vec4(aPos*2.-1.,1,1);vTUv=vec2(aPos.x,1.-aPos.y);gl_Position.y*=uFlpY;}"};$createFragmentShader(){return Utils.GLSL[$[33]]+"precision highp float;\n"+Utils.GLSL.DEFINE.HEIGHT+Utils.GLSL.DEFINE.Z+"in vec2 vTUv;uniform sampler2D uTex;out vec4 oCl;void main(void){vec2 its=vec2(textureSize(uTex,0)),ts=1./its,p0=floor(vTUv*its),p1=p0+Z.yx,p2=p0+Z.yy;vec3 A=vec3(p0,texture(uTex,p0*ts).g),B=vec3(p1,texture(uTex,p1*ts).g),C=vec3(p2,texture(uTex,p2*ts).g),nm=normalize(cross(B-A,C-A))*HEIGHT*Z.yzy;oCl=vec4(nm*.5+.5,1);}"}};class AmbientOcclusionMapRenderer extends BaseRenderer{constructor(b={}){b.config=Utils[$[28]](b.config);b.config[$[10]]=b.config[$[10]].concat(["uSTTex","uR","uS","uDM","uUSTT"]);super(b);this[$[58]]=!0;this[$[24]].set(0,0,0,1);this[$[6]]=b[$[6]];this[$[22]]=b[$[22]];this.radius=b.radius??4;this.samples=b.samples??4;this[$[71]]=b[$[71]]??1};$render(){this[$[5]][$[47]](BlendMode.NORMAL);this[$[40]](this[$[22]],this[$[0]].uTex,0);if(this[$[6]]){this[$[40]](this[$[6]],this[$[0]].uSTTex,1);this.$gl[$[8]](this[$[0]].uUSTT,1)}else this.$gl[$[8]](this[$[0]].uUSTT,0);this.$gl[$[8]](this[$[0]].uR,this.radius);this.$gl[$[8]](this[$[0]].uS,this.samples);this.$gl[$[8]](this[$[0]].uDM,this[$[71]]);this[$[19]]();this[$[36]](1)};$createVertexShader(){return Utils.GLSL[$[33]]+"precision highp float;\nin vec2 aPos;uniform float uFlpY;out vec2 vTUv;void main(void){gl_Position=vec4(aPos*2.-1.,1,1);vTUv=vec2(aPos.x,1.-aPos.y);gl_Position.y*=uFlpY;}"};$createFragmentShader(){return Utils.GLSL[$[33]]+"precision highp float;\n"+Utils.GLSL.DEFINE.HEIGHT+Utils.GLSL.DEFINE.RADIAN_360+Utils.GLSL.DEFINE.PI+Utils.GLSL.DEFINE.Z+"in vec2 vTUv;uniform sampler2D uSTTex,uTex;uniform float uR,uS,uUSTT,uDM;out vec4 oCl;"+Utils.GLSL.RANDOM+"void main(void){float tx=texture(uTex,vTUv).g,v=0.;if(uS>0.&&uR>0.){vec2 its=vec2(textureSize(uTex,0)),ts=uR/its,dr=Z.yx,p;float lng=length(ts),l=3.+ceil(uS*rand(vTUv*100.+50.)),t=RADIAN_360/l,rad;vec2 sts=ts*(.8+rand(vTUv*100.+50.)*.4),r=vec2(cos(t),sin(t));for(rad=0.;rad<RADIAN_360;rad+=t){p=dr*sts;v+=(texture(uTex,vTUv+p).g-tx)*length(p)/lng;dr=vec2(dr.x*r.x-dr.y*r.y,dr.x*r.y+dr.y*r.x);}v/=l;}vec3 stCl=uUSTT<1.?Z.yyy:texture(uSTTex,vTUv).rgb;oCl=vec4(stCl*(1.-(1.-tx)*uDM-clamp(v,0.,1.)),1);}"}};class LightRenderer extends BatchRenderer{constructor(g={}){g.config=Utils[$[28]](g.config);g.config[$[10]]=g.config[$[10]].concat(["uNMTex","uSTTex","uRGTex","aExt","uTS","uUSTT","uUNMT","uURGT"]);var j=(g[$[55]]=g.lightNum||1);super(g);this[$[58]]=!0;this[$[24]].set(0,0,0,1);this[$[6]]=g[$[6]];this[$[61]]=g[$[61]];this[$[22]]=g[$[22]];this[$[48]]=g[$[48]];this._$cN=new Buffer("aExt",j,2,4);this._$C=[]};registerLight(d){if(this._$C.includes(d))return;var f=this._$C.indexOf($n);f>-1?(this._$C[f]=d):(f=this._$C.push(d)-1);d.registerData(f,this[$[26]].data,this._$cN.data)};unregisterLight(d){var f=this._$C.indexOf(d);if(f>-1){this._$C[f]=$n;d.unregisterData()}};$render(){this[$[5]][$[47]](BlendMode.ADD);var h=this;if(this[$[6]]){this[$[69]](this[$[6]],this[$[0]].uSTTex);h=this[$[6]];this.$gl[$[8]](this[$[0]].uUSTT,1)}else this.$gl[$[8]](this[$[0]].uUSTT,0);if(this[$[61]]){this[$[69]](this[$[61]],this[$[0]].uNMTex);h=this[$[61]];this.$gl[$[8]](this[$[0]].uUNMT,1)}else this.$gl[$[8]](this[$[0]].uUNMT,0);if(this[$[48]]){this[$[69]](this[$[48]],this[$[0]].uRGTex);h=this[$[48]];this.$gl[$[8]](this[$[0]].uURGT,1)}else this.$gl[$[8]](this[$[0]].uURGT,0);if(this[$[22]]){this[$[69]](this[$[22]],this[$[0]].uTex);h=this[$[22]]};this.$gl.uniform2f(this[$[0]].uTS,h.width,h[$[9]]);this[$[19]]();this[$[36]](this[$[42]])};$uploadBuffers(){this._$cN.upload(this.$gl,this[$[13]]);super[$[19]]()};$createBuffers(){super[$[51]]();this._$cN.create(this.$gl,this[$[0]])};$createVertexShader(){return Utils.GLSL[$[33]]+"precision highp float;\n"+Utils.GLSL.DEFINE.PI+Utils.GLSL.DEFINE.Z+"#define P vec4(1,-1,2,-2)\nin vec2 aPos;in mat4 aMt;in mat2x4 aExt;uniform float uFlpY;out float vHS,vD,vSpt;out vec2 vTUv,vSln;out vec4 vUv,vCl,vDt;out mat2x4 vExt;out vec4 flg;void main(void){vec3 pos=vec3(aPos*2.-1.,1);vExt=aExt;vCl=aMt[2];vDt=aMt[3];int f=int(vExt[0].y);flg=vec4(f&1,f&2,f&4,f&8);vUv.xy=pos.xy;vHS=vExt[0].z;mat3 mt=mat3(aMt[0].xy,0,aMt[0].zw,0,aMt[1].xy,1);vD=aMt[1].z;if(vExt[0].x<1.){gl_Position=vec4(mt*pos,1);vTUv=(gl_Position.xy+P.xy)/P.zw;vUv.zw=(aMt[1].xy+P.xy)/P.zw;vSpt=PI-aMt[1].w;vSln=vec2(sin(vDt.w),cos(vDt.w));}else{mt[2].xy=Z.zy;gl_Position=vec4(pos,1);vTUv=vec2(aPos.x,1.-aPos.y);vUv.zw=vTUv+((mt*vec3(1)).xy+P.xy)/P.zw;}gl_Position.y*=uFlpY;}"};$createFragmentShader(){var b=(c)=>"for(i=m;i<l;i+=st){p=ivec2((vUv.zw+i*opdm)*uTS);tc=texelFetch(uTex,p,0)*HEIGHT;"+c+"}";return Utils.GLSL[$[33]]+"precision highp float;\n"+Utils.GLSL.DEFINE.HEIGHT+Utils.GLSL.DEFINE.PI+Utils.GLSL.DEFINE.Z+"in float vHS,vD,vSpt;in vec2 vTUv,vSln;in vec4 vUv,vCl,vDt;in mat2x4 vExt;in vec4 flg;uniform sampler2D uNMTex,uSTTex,uRGTex,uTex;uniform float uUSTT,uURGT,uUNMT;uniform vec2 uTS;out vec4 oCl;"+Utils.GLSL.RANDOM+"void main(void){if(vDt.x==0.)discard;vec2 tUv=vTUv*uTS,tCnt=vUv.zw*uTS;vec4 tc=texelFetch(uTex,ivec2(tUv),0);float ph=tc.g*HEIGHT,shn=tc.b,rgh=1.;vec3 sf=vec3(tUv,ph),lp=vec3(tCnt,vHS),sftla=lp-sf;float dst=1.-length(sftla)/vD,vol=vDt.z*vCl.a,spc=0.;if(vol<=0.)discard;if(vExt[0].x<1.){vol*=dst;if(vol<=0.)discard;float slh=(vHS-ph)/HEIGHT;vec2 sl=vec2(slh*vSln.y-vUv.x*vSln.x,slh*vSln.x+vUv.x*vSln.y);if(atan(sl.x,length(vec2(sl.y,vUv.y)))+1.5707963267948966-vSpt<0.)discard;}float fltDst=distance(tCnt,tUv),shdw=1.;if(flg.y>0.){vec3 nm=uUNMT<1.?Z.xxy:normalize((texture(uNMTex,vTUv).rgb*2.-1.)*Z.yzy),sftl=normalize(sftla),sftv=normalize(vec3(flg.w>0.?uTS*.5:tUv,HEIGHT)-sf),hlf=normalize(sftl+sftv);float lght=dot(nm,sftl);vol*=lght;if(vol<=0.)discard;if(uURGT>0.){vec2 rgt=texture(uRGTex,vTUv).rg;rgh=rgt.r;shn=rgt.g;}spc=pow(dot(nm,hlf),rgh*HEIGHT)*shn*vExt[1].y;}if(flg.x>0.){ivec2 p;vec2 opd=(tUv-tCnt)/fltDst,opdm=opd/uTS;float shl=vD*vDt.y,st=max(1.,ceil(fltDst/vExt[1].x)),hst=(ph-vHS)/fltDst,opdL=length(opd),i,pc,l=fltDst-st,m=max(st,l-shl);if(flg.z>0.){"+b("if(tc.g>=vHS)discard;")+"}else{float rnd=vExt[0].w*rand(vTUv*100.+50.);"+b("st+=rnd;pc=vHS+i*hst;if(tc.r<=pc&&tc.g>=pc)shdw*=(fltDst-i*opdL)/shl;")+"}}if(shdw<=0.)discard;vec3 stCl=uUSTT<1.?Z.yyy:texture(uSTTex,vTUv).rgb;oCl=vec4((stCl+spc)*vCl.rgb*vol*shdw,1);}"}};class Stage2D extends BatchRenderer{constructor(l={}){l={...{useTint:!0},...l};l.config=Utils[$[28]](l.config);l.config[$[10]]=l.config[$[10]].concat(["aDt","aDst","uWCl","uWA"]);var s=(l[$[55]]=l[$[55]]||1e4);super(l);this[$[50]]=new StageContainer(this);this._$W=0;this["_draw"+Item.TYPE]=noop;this["_draw"+Image.TYPE]=this._$S.bind(this);this["_draw"+Container.TYPE]=this._$cx.bind(this);this._$T=this._$T.bind(this);this._$N=this._$N.bind(this);this._$cy={x:0,y:0};this._$X=new Buffer("aDt",s,3,4);this._$cU=new Buffer("aDst",s,4,2);this._$dj=this._$dj.bind(this);var c=$d.body;c[$[4]]("mousemove",this._$dj);c[$[4]]("mousedown",this._$dj);c[$[4]]("mouseup",this._$dj);c[$[4]]("click",this._$dj);c[$[4]]($[103],this._$dj);c[$[4]]("touchmove",this._$dj);c[$[4]]("touchend",this._$dj)};render(){this._$ch=$n;super.render();this._$dd=!1;this._$cV()};destruct(){var c=$d.body;c[$[2]]("mousemove",this._$dj);c[$[2]]("mousedown",this._$dj);c[$[2]]("mouseup",this._$dj);c[$[2]]("click",this._$dj);c[$[2]]($[103],this._$dj);c[$[2]]("touchmove",this._$dj);c[$[2]]("touchend",this._$dj)};_$cV(){if(this._$cj){if(this._$ch!==this._$dk){var m={};for(var b in this._$cj)m[b]=this._$cj[b];this._$dk&&this._$dk[$[41]](this._$dk,{...m,type:"mouseout"});this._$ch&&this._$ch[$[41]](this._$ch,{...m,type:"mouseover"})};this._$ch&&this._$ch[$[41]](this._$ch,this._$cj);this._$dk=this._$ch};this._$cj=$n};_$cW(x,y){this._$dd=!0;var q=this[$[50]].parent[$[16]];this._$cy.x=(x-this[$[83]])*q[0];this._$cy.y=(y-this[$[74]])*q[3]};_$N(d){d.update(this[$[17]]);d[$[80]](d,this[$[17]]);d.renderable&&this["_draw"+d.TYPE](d);d[$[85]](d,this[$[17]])};_$cx(p){this.$gl.uniform4fv(this[$[0]].uWCl,p[$[35]]);this.$gl[$[8]](this[$[0]].uWA,p[$[88]]);var n=p[$[23]];for(var i=0,l=n.length;i<l;++i)this._$N(n[i])};_$S(d){this[$[5]][$[47]](d.blendMode,this._$T);if(this._$dd&&d[$[64]]&&d.isContainsPoint(this._$cy))this._$ch=d;var f=this._$W*12;var h=this._$W*16;$as(this._$X.data,d[$[35]],f);$as(this._$X.data,d[$[62]],f+8);this._$X.data[f+4]=d.props.alpha;this._$X.data[f+5]=d.tintType;this._$X.data[f+6]=this[$[5]][$[72]](d.texture,this[$[17]],!1,this._$T);this._$X.data[f+7]=d[$[70]].distortTexture;$as(this[$[26]].data,d[$[16]],h);$as(this[$[26]].data,d[$[53]],h+6);$as(this[$[26]].data,d[$[102]],h+12);$as(this._$cU.data,d[$[81]],this._$W*8);++this._$W===this[$[42]]&&this._$T()};_$T(){if(this._$W>0){this[$[19]]();this.$gl.uniform1iv(this[$[0]].uTex,this[$[5]][$[56]]);this[$[36]](this._$W);this._$W=0}};_$dj(j){var k=this[$[5]].canvas;if(j.target===k){this._$cj=j;this._$cW((k.width/k.offsetWidth)*j.offsetX,(k[$[9]]/k.offsetHeight)*j.offsetY)}};$render(){this._$N(this[$[50]]);this._$T()};$resize(){super.$resize();if(this._$cp){this._$cp=0;Matrix3Utilities.projection(this[$[50]].parent[$[16]],this);++this[$[50]].parent[$[7]]}};$uploadBuffers(){this._$X.upload(this.$gl,this[$[13]]);this._$cU.upload(this.$gl,this[$[13]]);super[$[19]]()};$createBuffers(){super[$[51]]();this._$X.create(this.$gl,this[$[0]]);this._$cU.create(this.$gl,this[$[0]])};$createVertexShader(l){var t=l[$[97]];return Utils.GLSL[$[33]]+"precision highp float;\nin vec2 aPos;in mat4x2 aDst;in mat3x4 aDt;in mat4 aMt;uniform float uFlpY,uWA;uniform vec4 uWCl;out float vACl,vTId,vTTp;out vec2 vTUv;out vec4 vTCrop"+(t?",vRR;":";")+"out mat2x4 vCl;vec2 clcQd(vec2 p){vec3 P0=vec3(aDst[0],1.),P1=vec3(aDst[1],1.),P2=vec3(aDst[2],1.),P3=vec3(aDst[3],1.),t=mix(P0,P1,p.x),b=mix(P3,P2,p.x),r=mix(t,b,p.y);return r.xy/r.z;}void main(void){mat3 mt=mat3(aMt[0].xy,0,aMt[0].zw,0,aMt[1].xy,1),tMt=mat3(aMt[1].zw,0,aMt[2].xy,0,aMt[2].zw,1);vec3 tPos=vec3(clcQd(aPos),1);gl_Position=vec4(mt*tPos,1);gl_Position.y*=uFlpY;float dt=aDt[1].w;vTUv=(tMt*((dt*vec3(aPos,1))+((1.-dt)*tPos))).xy;vTCrop=aMt[3];vCl=mat2x4(uWCl,aDt[0].rgb*aDt[0].a,1.-aDt[0].a);vACl=uWA*aDt[1].x;vTTp=aDt[1].y;vTId=aDt[1].z;"+(t?"vRR=aDt[2].xyzw;vRR.w=vRR.x+vRR.y;":"")+"}"};$createFragmentShader(l){var w=Utils.INFO[$[49]];var t=l[$[97]];var z=(w)=>{var g="vec4 gtTexCl(float i,vec4 s,vec2 m){vec2 tsh;";for(var i=0;i<w;++i)g+="if(i<"+(i+1)+".){tsh=.5/vec2(textureSize(uTex["+i+"],0));return texture(uTex["+i+"],clamp(s.xy+s.zw*m,s.xy+tsh,s.xy+s.zw-tsh));}";g+="return Z.yyyy;}";return g};var v=(r)=>"gtTexCl(vTId,vTCrop,"+r+")";return Utils.GLSL[$[33]]+"precision highp float;\n"+Utils.GLSL.DEFINE.RADIAN_360+Utils.GLSL.DEFINE.Z+"in float vACl,vTId,vTTp;in vec2 vTUv;in vec4 vTCrop"+(t?",vRR;":";")+"in mat2x4 vCl;uniform sampler2D uTex["+w+"];out vec4 oCl;"+z(w)+"float cosine(float a,float b,float v){v=abs(v);v=v<.5?2.*v*v:1.-pow(-2.*v+2.,2.)/2.;return a*(1.-v)+b*v;}"+(t?Utils.GLSL.RANDOM+"vec4 gtClBUv(vec2 st){vec2 uv=vTUv;float rnd=rand(floor(uv+st)),rndDg=rnd*RADIAN_360*vRR.x;if(rndDg>0.){vec2 rt=vec2(sin(rndDg),cos(rndDg));uv=vec2(uv.x*rt.y-uv.y*rt.x,uv.x*rt.x+uv.y*rt.y);}return "+v("mod(uv,Z.yy)")+";}float gtRClBUv(vec2 st,vec2 uv){float rnd=rand(floor(vTUv+st));return (1.-(2.*rnd-1.)*vRR.y)*cosine(0.,1.,1.-st.x-uv.x)*cosine(0.,1.,1.-st.y-uv.y);}":"")+"void main(void){if(vTId>-1.){vec2 uv=mod(vTUv,Z.yy);"+(t?"if(vRR.w>0.){float rca,rcb,rcc,rcd;if(vRR.y+vRR.z>0.){rca=gtRClBUv(Z.xx,uv);rcb=gtRClBUv(Z.yx,uv);rcc=gtRClBUv(Z.xy,uv);rcd=gtRClBUv(Z.yy,uv);}oCl=vRR.z>0.?clamp(gtClBUv(Z.xx)*rca+gtClBUv(Z.yx)*rcb+gtClBUv(Z.xy)*rcc+gtClBUv(Z.yy)*rcd,0.,1.):gtClBUv(Z.xy);if(vRR.y>0.)oCl.a=clamp(oCl.a*(rca+rcb+rcc+rcd),0.,1.);}else oCl="+v("uv")+";":"oCl="+v("uv")+";")+"}else oCl+=1.;oCl.a*=vACl;if(oCl.a<=0.)discard;"+(l.useTint?"if(vTTp>0.){vec3 cl=vCl[1].rgb+oCl.rgb*vCl[1].a;if(vTTp==1.||(vTTp==2.&&oCl.r==oCl.g&&oCl.r==oCl.b))oCl.rgb*=cl+oCl.rgb*vCl[1].a;else if(vTTp==3.)oCl.rgb=cl;else if(vTTp==4.)oCl.rgb+=cl;}":"")+"oCl*=vCl[0];}"}};class DisplacementFilter extends BaseFilter{constructor(d,f,h,j,b,c,g,k){super(6,0,f);this[$[29]]=new FilterTextureProps(this,d,h,j,b,c,g,k)}};class MaskFilter extends BaseFilter{constructor(f,b,h,j,c,d,g,k){super(7,0,b);this[$[29]]=new FilterTextureProps(this,f,h,j,c,d,g,k)};get type(){return this.v[0]};set type(v){this.v[0]=v}};MaskFilter.Type={RED:0,GREEN:1,BLUE:2,ALPHA:3,AVG:4};class PixelateFilter extends BaseFilter{constructor(b){super(5,0,b)}};class EdgeDetectFilter extends BaseFilter{constructor(c,b=1){super(1,0,c);this.mix=b;$as(this.kernels,[-1,-1,-1,-1,8,-1,-1,-1,-1],0)}};class SharpenFilter extends BaseFilter{constructor(c,b=1){super(1,0,c);this.mix=b;$as(this.kernels,[0,-1,0,-1,5,-1,0,-1,0],0)}};class SaturateFilter extends BaseFilter{constructor(h,c=1){super(2,0,h);this.mix=c};set intensity(v){this.v[0]=v;var b=1-v;var d=b*.3;var f=b*.59;var g=b*.11;$as(this.kernels,[d+v,f,g,0,d,f+v,g,0,d,f,g+v,0],0)}};class GrayscaleFilter extends BaseFilter{constructor(b){super(3,1,b)}};class SepiaFilter extends BaseFilter{constructor(b){super(3,2,b)}};class InvertFilter extends BaseFilter{constructor(b){super(3,3,b)}};class TintFilter extends BaseFilter{constructor(c,r,g,b){super(3,4,c);this.r=r;this.g=g;this.b=b}};class ColorLimitFilter extends BaseFilter{constructor(b){super(3,5,b)}};class VignetteFilter extends BaseFilter{constructor(c,d,f,r,g,b){super(3,6,c);this.roundness=d;this.transition=f;this.r=r;this.g=g;this.b=b};get roundness(){return this.v[1]};set roundness(v){this.v[1]=v};get transition(){return 1/this.v[5]};set transition(v){this.v[5]=1/v}};class RainbowFilter extends BaseFilter{constructor(b){super(3,7,b)}};class BrightnessContrastFilter extends BaseFilter{constructor(c,b){super(3,8,c);this.contrast=b};get brightness(){return this.v[0]};set brightness(v){this.v[0]=v};get contrast(){return this.v[1]*100};set contrast(v){this.v[1]=v/100}};class GammaFilter extends BaseFilter{constructor(b){super(3,9,b)}};class BaseSamplingFilter extends BaseFilter{constructor(b,j,k,h=!1,f=.5,g=.5,c=1){super(4,b,j);this.intensityY=k;this.isRadial=h;this.centerX=f;this.centerY=g;this.size=c};get isRadial(){return this.v[2]===1};set isRadial(v){this.v[2]=v?1:0};get centerX(){return this.v[3]};set centerX(v){this.v[3]=v};get centerY(){return this.v[4]};set centerY(v){this.v[4]=v};get size(){return this.v[5]};set size(v){this.v[5]=v}};class BlurFilter extends BaseSamplingFilter{constructor(h,j,g=!1,d=.5,f=.5,b=1){super(1,h,j,g,d,f,b)}};class GlowFilter extends BaseSamplingFilter{constructor(h,j,g=!1,d=.5,f=.5,b=1){super(2,h,j,g,d,f,b)}};class ChromaticAberrationFilter extends BaseFilter{constructor(g,f=!1,c=.5,d=.5,h=!1){super(8,0,g);this.isRadial=f;this.centerX=c;this.centerY=d;this.invertRadial=h};get isRadial(){return this.v[2]===1};set isRadial(v){this.v[2]=v?1:0};get centerX(){return this.v[3]};set centerX(v){this.v[3]=v};get centerY(){return this.v[4]};set centerY(v){this.v[4]=v};get invertRadial(){return this.v[5]};set invertRadial(v){this.v[5]=v}};window.PWGL=window.AGL={version:"3.0.1",BlendMode,BaseTransformProps,ColorProps,ItemProps,LightProps,TextureCrop,TextureProps,DistortionProps,FilterTextureProps,TextureInfo,Texture,Framebuffer,Context,Buffer,Utils,Const,Matrix3Utilities,Item,BaseDrawable,Light,AnimatedImage,Container,StageContainer,Image,BaseRenderer,BatchRenderer,FilterRenderer,NormalMapRenderer,AmbientOcclusionMapRenderer,LightRenderer,Stage2D,DisplacementFilter,MaskFilter,PixelateFilter,EdgeDetectFilter,SharpenFilter,SaturateFilter,GrayscaleFilter,SepiaFilter,InvertFilter,TintFilter,ColorLimitFilter,VignetteFilter,RainbowFilter,BrightnessContrastFilter,GammaFilter,BlurFilter,GlowFilter,ChromaticAberrationFilter};console.log(`%cPWGL v${PWGL.version}\nhttps:\/\/github.com/asjs-dev/pwgl`,"background:#222;color:#00FF00");})();