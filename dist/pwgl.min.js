(()=>{var $="RENDERING_TYPE,context,$transformUpdated,repeatRandomCache,height,sourceTexture,length,$locations,$updated,$updateScaleFv,$uploadBuffers,transformUpdated,matrixCache,$MAX_RENDER_COUNT,textureTransform,removeEventListener,children,$height,$renderTime,initRendererConfig,transform,heightMap,addEventListener,texParameteri,maxTextureImageUnits,$attachFramebufferAndClear,canvas,setLocations,$drawInstanced,$createGLSL,createElement,$currentAglId,activeTexture,$matrixBuffer,$useTextureAt,useActiveTexture,callEventHandler,colorCache,getPremultipliedAlpha,cosRotationA,cosRotationB,sinRotationA,sinRotationB,$updateScale,setBlendMode,measureText,$createBuffers,textureMatrixCache,textureIds,scaledHeight,colorUpdated,uniform1f,textureRepeatRandomCache,interactive,bindTexture,scaledWidth,textureCrop,RADIANS_360,$useTexture,distortionProps,depthMultiplier,getPremultipliedUseTint,useTexture,heightHalf,clearColor,webglcontextrestored,$renderSource,clearTextures,getChildIndex,setChildIndex,callbackBeforeRender,distortionPropsCache,container,locations,widthHalf,getProgramParameter,callbackAfterRender,useTextureAt,roughnessMap,frameLength,contextAttributes,isWebGl2Supported,uploadTextureInfo,webglcontextlost,bindActiveTexture,deactivateTexture,useRepeatTextures,getShaderInfoLog,specularStrength,textureCropCache,getContext,useProgram,multiplier,bindVertexArray,bindFramebuffer,distortTexture,naturalWidth,Separate".split(",");"use strict";var F32A=Float32Array,$m=Math,$d=document,$n=null;var $nf=()=>{};var $nfrw=(b)=>()=>b;var $rfa=(c,b)=>{var d=c.indexOf(b);d>-1&&c.splice(d,1)};var _6s={a:"Attrib",u:"Uniform"};var _6r=(b,p,n)=>{var g=b.createShader(n);b.shaderSource(g,p);b.compileShader(g);return g};var _6h=$m.PI/180;var Utils={ALPHA:90*_6h,THETA:_6h,GLSL:{VERSION:"#version 300 es\n",DEFINE:{RADIANS_360:"#define RADIANS_360 radians(360.)\n",HEIGHT:"#define HEIGHT 255.\n",Z:"#define Z vec3(0,1,-1)\n",PI:`#define PI ${$m.PI}\n`},RANDOM:"float rand(vec2 p,float s){p=mod(p,vec2(1e4));return fract(sin((p.x*12.9898+p.y*78.233)*s)*43758.5453);}float rand(vec2 p){return rand(p,1.);}",RANDOM2:"float rand2(vec2 p,float s){p=mod(p*100.,vec2(1e4))+100.;return fract(dot(p,vec2(sin(p.x+p.y),cos(p.y-p.x))*s));}float rand2(vec2 p){return rand2(p,1.);}"},INFO:{isWebGl2Supported:0},initContextConfig:(j={})=>({canvas:$d[$[30]]($[26]),...j,contextAttributes:{powerPreference:"high-performance",preserveDrawingBuffer:0,premultipliedAlpha:0,...(j[$[80]]||{})}}),initRendererConfig:(j={})=>({...j,locations:j[$[73]]??[],context:(j.config&&j.config[$[1]])??j[$[1]]??new Context}),setLocations:(j,m)=>(j[$[73]]=[...j[$[73]],...m]),initApplication:(l)=>{var t=()=>l(Utils.INFO[$[81]]);[$[53],"complete"].includes($d.readyState)?t():$d[$[22]]("DOMContentLoaded",t,{once:1})},createProgram:(b,x,A)=>{var q=_6r(b,x,35633),v=_6r(b,A,35632),k=b.createProgram();b.attachShader(k,q);b.attachShader(k,v);b.linkProgram(k);if(!b[$[75]](k,35714)){var w=b[$[87]](q),y=b[$[87]](v);console.error(["Program info: "+b.getProgramInfoLog(k),"Validate status: "+b[$[75]](k,35715),...(w?["","Vertex shader info: "+w,"Vertex shader: "+x]:[]),...(y?["","Fragment shader info: "+y,"Fragment shader: "+A]:[])].join("\n"));b.deleteShader(q);b.deleteShader(v);b.deleteProgram(k);throw"WebGL application stoped"};return k},getLocationsFor:(b,k,z)=>{var m={};z.forEach((d)=>(m[d]=b[`get${_6s[d[0]]}Location`](k,d)));return m}};var Const={};var _gl=$d[$[30]]($[26])[$[90]]("webgl2");if(_gl){for(var c in _gl){var f=_gl[c];if(typeof f==="number"&&c===c.toUpperCase())Const[c]=f};Utils.INFO[$[81]]=1;Utils.INFO[$[24]]=_gl.getParameter(34930)};class DTI{constructor(){this.target=3553;this.wrapS=this.wrapT=33071;this.internalFormat=this.format=6408;this.minFilter=this.magFilter=9729;this.maxMipMapLevel=this.baseMipMapLevel=0;this.type=5121;this[$[31]]=this.$cU=-1;this[$[8]]=1;this.$width=this[$[17]]=1};get width(){return this.$width};get height(){return this[$[17]]};get wrapS(){return this.$j};set wrapS(v){this.$j=v;this[$[8]]=1};get wrapT(){return this.$k};set wrapT(v){this.$k=v;this[$[8]]=1};get internalFormat(){return this.$cV};set internalFormat(v){this.$cV=v;this[$[8]]=1};get format(){return this.$s};set format(v){this.$s=v;this[$[8]]=1};get minFilter(){return this.$Z};set minFilter(v){this.$Z=v;this[$[8]]=1};get magFilter(){return this.$cb};set magFilter(v){this.$cb=v;this[$[8]]=1};get maxMipMapLevel(){return this.$cW};set maxMipMapLevel(v){this.$cW=v;this[$[8]]=1};get baseMipMapLevel(){return this.$dc};set baseMipMapLevel(v){this.$dc=v;this[$[8]]=1};get type(){return this.$d};set type(v){this.$d=v;this[$[8]]=1};useActiveTexture(b,c){this[$[32]](b,c);this[$[62]](b)};useActiveTextureAfterUpdate(b,c){this[$[32]](b,c);this.useTextureAfterUpdate(b)};unbindTexture(b,c){this[$[32]](b,c);this.$cU=-1;b[$[54]](this.target,$n)};activeTexture(b,c){this.$cU=c;b[$[32]](33984+c)};bindActiveTexture(b,c){this[$[32]](b,c);b[$[54]](this.target,this.$ct)};useTexture(b){b[$[54]](this.target,this.$ct);this.createTexImage2D(b)};useTextureAfterUpdate(b){b[$[54]](this.target,this.$ct);this[$[82]](b)};createTexImage2D(b){b.texImage2D(this.target,0,this.$cV,this.width,this[$[4]],0,this.$s,this.$d,this[$[66]]);this[$[82]](b)};uploadTextureInfo(b){b[$[23]](this.target,10242,this.$j);b[$[23]](this.target,10243,this.$k);b[$[23]](this.target,10241,this.$Z);b[$[23]](this.target,10240,this.$cb);b[$[23]](this.target,33085,this.$cW);b[$[23]](this.target,33084,this.$dc);b.generateMipmap(this.target)}};var BlendMode=(()=>{var b=(c,d)=>({functionName:"blendFunc"+(c[$[6]]<3?"":$[97]),functions:c,equationName:"blendEquation"+(!d||d[$[6]]<2?"":$[97]),equations:d||[32774]});return{createBlendMode:b,NONE:b([0,0]),NORMAL_PM:b([1,771]),ADD_PM:b([1,1]),MULTIPLY_PM:b([774,771,1,771]),SCREEN_PM:b([1,769,1,771]),ADD_NPM:b([770,1,1,1]),SRC_IN:b([772,0]),SRC_OUT:b([773,0]),SRC_ATOP:b([772,771]),DST_OVER:b([773,1]),DST_IN:b([0,770]),DST_OUT:b([0,771]),DST_ATOP:b([773,770]),XOR:b([773,771]),NORMAL:b([770,771,1,771]),ADD:b([770,772,1,772]),MULTIPLY:b([774,0]),SCREEN:b([770,769,1,769]),OVERLAY:b([1,771]),EXCLUSION:b([775,769]),LIGHTEN:b([1,1],[32776]),DARKEN:b([1,1],[32775]),SHADOW:b([774,768])}})();class Context{constructor(h={}){this.contextId=0;this.isLost=$nfrw(1);this.$t=Utils.initContextConfig(h);this.$cM=this.$cM.bind(this);this.$cv=this.$cv.bind(this);var j=this.$t[$[26]];this[$[26]]=j;j[$[22]]($[83],this.$cM);j[$[22]]($[65],this.$cv);this.$cv()};useBlendMode(p){this.$dj=p;var b=this.gl;b[p.equationName].apply(b,p.equations);b[p.functionName].apply(b,p.functions)};setBlendMode(p,v){if(this.$dj!==p){v&&v();this.useBlendMode(p)}};destruct(){this.gl[$[91]]($n);var j=this[$[26]];j[$[15]]($[83],this.$cM);j[$[15]]($[65],this.$cv);this.$cw()};clearTextures(){var l=Utils.INFO[$[24]];var i=-1;while(++i<l){this.$ck[i]=$n;this.$ds[i]=i};this[$[48]][$[6]]=0};useTexture(t,s,q=1,n){if(!t)return-1;var r=this.$ck.indexOf(t);if(r<0){if(!this.$ds[$[6]]){n&&n();this[$[67]]();r=0}else r=this.$ds[0];q=1};return this[$[77]](t,r,s,q)};useTextureAt(t,r,s,q=1){t.use(this.gl,r,q,s);this.$ck[r]=t;!this[$[48]].includes(r)&&this[$[48]].push(r);$rfa(this.$ds,r);return r};deactivateTexture(t){var r=this.$ck.indexOf(t);r>-1&&t.unbindTexture(this.gl,r)};useProgram(m,c){if(this.$cX!==m){this.$cX=m;this[$[67]]();var b=this.gl;b[$[93]]($n);b[$[91]](m);b[$[93]](c)}};setCanvasSize(f,k){var j=this[$[26]];j.width=f;j[$[4]]=k};setSize(f,k){if(this.$l!==f||this.$v!==k){this.$l=f;this.$v=k;var b=this.gl;b.viewport(0,0,f,k);b.scissor(0,0,f,k)}};$cM(g){g.preventDefault();setTimeout(this.$cY,1)};$cv(){var b=(this.gl=this[$[26]][$[90]]("webgl2",this.$t[$[80]]));b.gl_id=++this.contextId;var w=b.getExtension("WEBGL_lose_context");if(w){this.$cY=w.restoreContext.bind(w);this.$cw=w.loseContext.bind(w)}else this.$cY=this.$cw=$nf;this.isLost=b.isContextLost?b.isContextLost.bind(b):$nfrw(1);b.pixelStorei(37441,1);b.enable(3042);b.blendColor(1,1,1,1);b.enable(3089);this.$l=this.$v=this.$cX=this.$dj=$n;this.$ck=[];this.$ds=[];this[$[48]]=[];this[$[67]]();this.setCanvasSize(1,1);this.$t.initCallback&&setTimeout(this.$t.initCallback,1)}};class Buffer{constructor(q,d,f,g,j,h,m=1){var k=f*g;this.data=typeof d==="number"?new F32A(d*k):d;this.$cE=q;this.$f=f;this.$g=g;this.$w=j??34962;this.$d=h??35048;this.$x=k*4;this.$y=g*4;this.$J=m;if(this.$d===35044)this.$x=this.$y=0};create(b,p){this.$U=p[this.$cE];this.$z=b.createBuffer();this.bind(b)};bind(b){b.bindBuffer(this.$w,this.$z)};upload(b){this.bind(b);this.$A(b);b.bufferData(this.$w,this.data,this.$d)};destruct(){this.data=$n};$A(b){var f=this.$f,n=this.$U,g=this.$g,k=this.$x,l=this.$y,m=this.$J;var i=-1;while(++i<f){var c=n+i;b.enableVertexAttribArray(c);b.vertexAttribPointer(c,g,5126,0,k,i*l);b.vertexAttribDivisor(c,m)}}};var _10n=$d[$[30]]("img");var create=(d,f)=>{var j=$d[$[30]](d);j.crossOrigin="anonymous";j.src=f;return j};class Texture extends DTI{constructor(h,m){super();this.$B=_10n;this.$dk=this.$dk.bind(this);this.source=h;this.shouldUpdate=m;this.$dt=0};get width(){return this.$cx||1};get height(){return this.$cF||1};get source(){return this.$B};set source(g){if(g){this.$B[$[15]](this.$cc,this.$dk);this.$B=g;this.isVideo=g.tagName.toLowerCase()==="video";this.$cc=this.isVideo?"canplay":"load";!this.$dk()&&g[$[22]](this.$cc,this.$dk,{once:1})}};destruct(){this.$B[$[15]](this.$cc,this.$dk)};use(b,c,k,l){if(this[$[31]]<b.gl_id){this[$[31]]=b.gl_id;this.$ct=b.createTexture();this[$[35]](b,c)}else if(this[$[8]]||this.$C||(this.shouldUpdate&&this.$dt<l)||(this.isVideo&&!this.$B.paused)){this[$[8]]=this.$C=0;this.$dt=l;this[$[35]](b,c)}else if(this.$cU!==c||k)this[$[84]](b,c)};get $cx(){return this.$B[this.$dx]};get $cF(){return this.$B[this.$dC]};$dk(){this.$dx="width";this.$dC=$[4];if(this.$B[$[96]]){this.$dx=$[96];this.$dC="naturalHeight"}else if(this.$B.videoWidth){this.$dx="videoWidth";this.$dC="videoHeight"};if(this.$cx*this.$cF){this[$[66]]=this.$B;this.$C=1;return 1};this[$[66]]=$n}};Texture.loadImage=(f,m)=>new Texture(create("img",f),m);Texture.loadVideo=(f)=>new Texture(create("video",f));class Framebuffer extends DTI{constructor(){super();this.$K=1};get width(){return this.$width};set width(v){if(this.$width!==v){this.$width=v;this.$K=1}};get height(){return this[$[17]]};set height(v){if(this[$[17]]!==v){this[$[17]]=v;this.$K=1}};setSize(w,h){this.width=w;this[$[4]]=h};bind(b){b[$[94]](36160,this.$cy)};unbind(b){b[$[94]](36160,$n)};use(b,c,d){if(this[$[31]]<b.gl_id){this[$[31]]=b.gl_id;this.$ct=b.createTexture();this[$[35]](b,c);this.$cy=b.createFramebuffer();this.bind(b);b.framebufferTexture2D(36160,36064,3553,this.$ct,0);this.unbind(b)}else if(this[$[8]]){this[$[8]]=0;this.useActiveTextureAfterUpdate(b,c)}else if(this.$K){this.$K=0;this[$[35]](b,c)}else if(this.$cU!==c||d)this[$[84]](b,c)};destruct(){}};class DBTP{constructor(){this.$dl=$nf;this[$[39]]=this[$[40]]=1;this[$[41]]=this[$[42]]=this._x=this._y=this.$V=this.$L=this.$M=this.$m=this.$n=0};get x(){return this._x};set x(v){this._x=v;this[$[2]]=1};get y(){return this._y};set y(v){this._y=v;this[$[2]]=1};get rotation(){return this.$V};set rotation(v){this.$V=v;this.$dl=this.$cZ};get anchorX(){return this.$L};set anchorX(v){this.$L=v;this[$[2]]=1};get anchorY(){return this.$M};set anchorY(v){this.$M=v;this[$[2]]=1};get skewX(){return this.$m};set skewX(v){this.$m=v;this.$dl=this.$cZ};get skewY(){return this.$n};set skewY(v){this.$n=v;this.$dl=this.$cZ};update(){this.$dl();this.updated=this[$[2]];this[$[2]]=0};$cZ(){this.$dl=$nf;this[$[2]]=1;if(!this.$m&&!this.$n){this[$[41]]=this[$[42]]=$m.sin(this.$V);this[$[39]]=this[$[40]]=$m.cos(this.$V)}else{var b=this.$V-this.$m,c=this.$V+this.$n;this[$[41]]=$m.sin(c);this[$[39]]=$m.cos(c);this[$[42]]=$m.sin(b);this[$[40]]=$m.cos(b)}}};class DITP extends DBTP{constructor(){super();this[$[9]]=$nf;this[$[55]]=this[$[49]]=this.$D=this.$E=this.$width=this[$[17]]=1};get scaleX(){return this.$D};set scaleX(v){this.$D=v;this[$[9]]=this[$[43]]};get scaleY(){return this.$E};set scaleY(v){this.$E=v;this[$[9]]=this[$[43]]};get width(){return this.$width};set width(v){this.$width=v;this[$[9]]=this[$[43]]};get height(){return this[$[17]]};set height(v){this[$[17]]=v;this[$[9]]=this[$[43]]};update(){this[$[9]]();super.update()};$updateScale(){this[$[9]]=$nf;this[$[2]]=1;this[$[55]]=this.$width*this.$D;this[$[49]]=this[$[17]]*this.$E}};class DCP{constructor(){this.cache=[];this.set(1,1,1,1)};get r(){return this.cache[0]};set r(v){this.cache[0]=v;this.$cG=1};get g(){return this.cache[1]};set g(v){this.cache[1]=v;this.$cG=1};get b(){return this.cache[2]};set b(v){this.cache[2]=v;this.$cG=1};get a(){return this.cache[3]};set a(v){this.cache[3]=v;this.$cG=1};set(r,g,b,a){this.cache[0]=r;this.cache[1]=g;this.cache[2]=b;this.cache[3]=a;this.$cG=1};update(){this.updated=this.$cG;this.$cG=0}};var GM3U={identity:()=>new F32A([1,0,0,1,0,0]),projection:(v,k)=>{v[0]=2/k.width;v[1]=v[2]=0;v[3]=-2/k[$[4]];v[4]=-1;v[5]=1},transformLocal:(v,t)=>{var f=t.anchorX,g=t.anchorY,m=t[$[55]],n=t[$[49]];v[0]=t[$[39]]*m;v[1]=t[$[41]]*m;v[2]=-t[$[42]]*n;v[3]=t[$[40]]*n;v[4]=t.x-f*v[0]-g*v[2];v[5]=t.y-f*v[1]-g*v[3]},transform:(v,d,t)=>{var x=t.x,y=t.y,f=t.anchorX,g=t.anchorY,p=t[$[41]],q=t[$[42]],r=t[$[39]],s=t[$[40]],m=t[$[55]],n=t[$[49]];v[0]=(r*d[0]+p*d[2])*m;v[1]=(r*d[1]+p*d[3])*m;v[2]=(s*d[2]-q*d[0])*n;v[3]=(s*d[3]-q*d[1])*n;v[4]=-f*v[0]-g*v[2]+x*d[0]+y*d[2]+d[4];v[5]=-f*v[1]-g*v[3]+x*d[1]+y*d[3]+d[5]},inverse:(v,d)=>{var b=1/(d[0]*d[3]-d[2]*d[1]);v[0]=b*d[3];v[1]=-b*d[1];v[2]=-b*d[2];v[3]=b*d[0];v[4]=b*(d[2]*d[5]-d[3]*d[4]);v[5]=-b*(d[0]*d[5]-d[1]*d[4])},isPointInMatrix:(d,c)=>{var x=c.x*d[0]+c.y*d[2]+d[4],y=c.x*d[1]+c.y*d[3]+d[5];return x>=0&&x<=1&&y>=0&&y<=1},calcCorners:(h,d,k)=>{var j=k[$[74]],l=k[$[63]];h[0].x=j+d[4]*j;h[0].y=k[$[4]]-(l+d[5]*l);h[1].x=h[0].x+(d[0]+d[2])*j;h[1].y=h[0].y-(d[1]+d[3])*l;h[2].x=h[0].x+(d[0]+j*d[2]);h[2].y=h[0].y-(d[1]+l*d[3]);h[3].x=h[0].x+(j*d[0]+d[2]);h[3].y=h[0].y-(l*d[1]+d[3])}};class Item{constructor(){this[$[0]]=Item[$[0]];this[$[12]]=GM3U.identity();this[$[37]]=[1,1,1,1];this[$[20]]=new this.$transformClass;this.color=new DCP;this.alpha=1;this[$[70]]=this[$[76]]=$nf;this.renderable=1;this.$bounds={x:0,y:0,width:0,height:0}};get stage(){return this.$parent?this.$parent.stage:$n};get parent(){return this.$parent};set parent(v){this.$parent=v;this.$cN=1};get callbackBeforeRender(){return this.$dG};set callbackBeforeRender(v){this.$dG=v??$nf};get callbackAfterRender(){return this.$dD};set callbackAfterRender(v){this.$dD=v??$nf};callEventHandler(d,b){if(this[$[53]]){var g=this["on"+b.type];g&&g(this,d,b)};var f=this.$parent;f&&f[$[36]](d,b)};getBounds(){return this.$bounds};destruct(){this.remove()};remove(){var f=this.$parent;f&&f.removeChild(this)};update(){var h=this[$[20]],c=this.color,f=this.$parent,k=this.$cN;this.$cN=0;c.update();this[$[50]]=k||c.updated||f[$[50]];if(this[$[50]]){var j=this[$[37]],m=c.cache,l=f[$[37]];j[0]=l[0]*m[0];j[1]=l[1]*m[1];j[2]=l[2]*m[2];j[3]=l[3]*m[3]};h.update();this[$[11]]=k||h.updated||f[$[11]];this[$[11]]&&GM3U[$[20]](this[$[12]],f[$[12]],h)};get $transformClass(){return DITP}};Item[$[0]]="item";class BaseDrawable extends Item{constructor(){super();this.$corners=[{x:0,y:0},{x:0,y:0},{x:0,y:0},{x:0,y:0}]};getCorners(){this.$calcCorners();return this.$corners};getBounds(){var h=this.getCorners(),g=this.$bounds,a=h[0],b=h[1],c=h[2],d=h[3];g.x=$m.min(a.x,b.x,c.x,d.x);g.y=$m.min(a.y,b.y,c.y,d.y);g.width=$m.max(a.x,b.x,c.x,d.x);g[$[4]]=$m.max(a.y,b.y,c.y,d.y);return g};$calcCorners(){var f=this.stage;f&&GM3U.calcCorners(this.$corners,this[$[12]],f.renderer)}};class DLTP extends DITP{constructor(){super();this.z=0};get width(){return this.$width};set width(v){this.$width=this[$[17]]=v;this[$[9]]=this[$[43]]};get height(){return this[$[17]]};set height(v){this.width=v}};class Light extends BaseDrawable{constructor(){super();this[$[0]]=Light[$[0]];this.castShadow=this.shading=this.centerReflection=1;this.angle=0;this.spotAngle=180*Utils.THETA;this.type=Light.Type.POINT;this.precision=this.shadowLength=this[$[88]]=1;this.maxShadowStep=128;this.fading=1;this.attenuation=1};get castShadow(){return this.$cl};set castShadow(v){this.$cl=v;this.$cz()};get shading(){return this.$N};set shading(v){this.$N=v;this.$cz()};get flattenShadow(){return this.$cO};set flattenShadow(v){this.$cO=v;this.$cz()};get fading(){return this.$F};set fading(v){this.$F=v;this.$cz()};get centerReflection(){return this.$dm};set centerReflection(v){this.$dm=v;this.$cz()};get $transformClass(){return DLTP};$calcCorners(){super.$calcCorners();var f=this.$corners,a=f[0],b=f[1],c=f[2],d=f[3];a.x+=a.x-d.x+(a.x-c.x);a.y+=a.y-d.y+(a.y-c.y);c.x+=c.x-b.x;c.y+=c.y-b.y;d.x+=d.x-b.x;d.y+=d.y-b.y};$cz(){this.flags=this.$cl|(this.$N*2)|(this.$cO*4)|(this.$dm*8)|(this.$F*16)}};Light[$[0]]="light";Light.Type={POINT:0,DIRECTIONAL:1};class DTTP extends DBTP{constructor(){super();this[$[3]]=[0,0,0,2];this.$O=this.$P=1};get scaledWidth(){return this.$O};get scaledHeight(){return this.$P};get repeatX(){return this.$O};set repeatX(v){this.$O=v;this[$[2]]=1};get repeatY(){return this.$P};set repeatY(v){this.$P=v;this[$[2]]=1};get repeatRandomRotation(){return this[$[3]][0]};set repeatRandomRotation(v){this[$[3]][0]=v};get repeatRandomAlpha(){return this[$[3]][1]};set repeatRandomAlpha(v){this[$[3]][1]=v};get repeatRandomBlur(){return this[$[3]][2]};set repeatRandomBlur(v){this[$[3]][2]=v};get repeatRandomOffset(){return this[$[3]][3]};set repeatRandomOffset(v){this[$[3]][3]=v}};class DTC{constructor(){this.cache=[0,0,1,1];this.$cP=this.$cA;this.$l=this.$v=1};get x(){return this.cache[0]};set x(v){this.cache[0]=v;this.$cP=this.$cA};get y(){return this.cache[1]};set y(v){this.cache[1]=v;this.$cP=this.$cA};get width(){return this.$l};set width(v){this.$l=v;this.$cP=this.$cA};get height(){return this.$v};set height(v){this.$v=v;this.$cP=this.$cA};setRect(b){this.x=b.x;this.y=b.y;this.width=b.width;this[$[4]]=b[$[4]]};update(){this.$cP();this.updated=this.$cH;this.$cH=0};$cA(){this.$cP=$nf;this.$cH=1;this.cache[2]=this.$l-this.cache[0];this.cache[3]=this.$v-this.cache[1]}};class DDP{constructor(){this[$[95]]=1;this.cache=[0,0,1,0,1,1,0,1]};get topLeftX(){return this.cache[0]};set topLeftX(v){this.cache[0]=v};get topLeftY(){return this.cache[1]};set topLeftY(v){this.cache[1]=v};get topRightX(){return this.cache[2]};set topRightX(v){this.cache[2]=v};get topRightY(){return this.cache[3]};set topRightY(v){this.cache[3]=v};get bottomRightX(){return this.cache[4]};set bottomRightX(v){this.cache[4]=v};get bottomRightY(){return this.cache[5]};set bottomRightY(v){this.cache[5]=v};get bottomLeftX(){return this.cache[6]};set bottomLeftX(v){this.cache[6]=v};get bottomLeftY(){return this.cache[7]};set bottomLeftY(v){this.cache[7]=v}};class Image extends BaseDrawable{constructor(c){super();this[$[0]]=Image[$[0]];this.texture=c;this.tintType=Image.TintType.NORMAL;this.blendMode=BlendMode.NORMAL;this.$dy=new F32A(6);this[$[47]]=GM3U.identity();this[$[14]]=new DTTP;this[$[56]]=new DTC;this[$[59]]=new DDP;this[$[89]]=this[$[56]].cache;this[$[52]]=this[$[14]][$[3]];this[$[71]]=this[$[59]].cache};update(){super.update();this[$[56]].update();var d=this[$[14]];d.update();d.updated&&GM3U.transformLocal(this[$[47]],d);this[$[53]]&&this[$[11]]&&GM3U.inverse(this.$dy,this[$[12]])};isContainsPoint(b){return GM3U.isPointInMatrix(this.$dy,b)}};Image[$[0]]="drawable";Image.TintType={NONE:0,NORMAL:1,GRAYSCALE:2,OVERRIDE:3,ADD:4};class AnimatedImage extends Image{constructor(c){super(c);this.$p=0;this[$[79]]=this.$dz=120;this.$G=[];this.$dt=Date.now();this.stop()};get frames(){return this.$G};set frames(v){this.$G=v;var d=this.$G[0];if(d){this.$dz=d[$[6]]??this[$[79]];this.$dt=Date.now()}};gotoAndStop(b){this.stop();this.$p=b;this.$dd()};gotoAndPlay(b){this.$p=b;this.play()};stop(){this.$dv=$nf;this.isPlaying=0};play(){this.$dv=this.$df;this.isPlaying=1;this.$dd()};update(f){super.update();this.$dv(f)};destruct(){this.stop();super.destruct()};$df(f){var g=f-this.$dt;if(g>this.$dz){this.$dt=f;this.$p+=~~(g/this.$dz);if(this.$p>=this.$G[$[6]])this.$p=0;this.$dd()}};$dd(){var h=this.$G[this.$p];this[$[56]].setRect(h);this.$dz=h[$[6]]??this[$[79]]}};class Container extends Item{constructor(){super();this[$[0]]=Container[$[0]];this[$[16]]=[];this.useTint=1};get parent(){return this.$parent};set parent(v){super.parent=v;if(v){this.$dK=v[$[61]].bind(v);this.$dI=v[$[38]].bind(v)}else this.$dK=this.$dI=$nfrw(1)};getPremultipliedUseTint(){return this.useTint*this.$dK()};getPremultipliedAlpha(){return this.alpha*this.$dI()};destruct(){this.empty();super.destruct()};empty(){while(this[$[16]][$[6]])this.removeChildAt(0)};contains(b){return this[$[68]](b)>-1};addChild(b){this.addChildAt(b,this[$[16]][$[6]])};addChildAt(b,c){if(b){b.remove();this[$[16]].push(b);this[$[69]](b,c);b.parent=this}};removeChild(b){if(b){$rfa(this[$[16]],b);b.parent=$n}};removeChildAt(c){this.removeChild(this.getChildAt(c))};getChildAt(c){return this[$[16]][c]};setChildIndex(b,c){$rfa(this[$[16]],b);this[$[16]].splice(c,0,b)};getChildIndex(b){return this[$[16]].indexOf(b)};swapChildren(d,f){var j=this[$[68]](d),k=this[$[68]](f);if(j>-1&&k>-1){this[$[69]](d,k);this[$[69]](f,j)}};getBounds(){var g=this.$bounds,h=this[$[16]],l=h[$[6]];var i=-1;g.x=g.y=1/0;g.width=g[$[4]]=-1/0;while(++i<l){var m=h[i].getBounds();g.x=$m.min(g.x,m.x);g.y=$m.min(g.y,m.y);g.width=$m.max(g.width,m.width);g[$[4]]=$m.max(g[$[4]],m[$[4]])};return g}};Container[$[0]]=$[72];class BaseRenderer{constructor(h){this.$dH=$nf;this.$cI=$nf;this.$cm=1;this.width=this[$[4]]=this[$[74]]=this[$[63]]=this.$dn=this.$dw=this[$[18]]=0;this.setSize(1,1);this[$[64]]=new DCP;this.$t=h;this[$[1]]=h[$[1]];Utils[$[27]](h,["uFY","aPs","uTx"]);this.$dA=new Buffer("",new Uint16Array([0,1,3,2]),0,0,34963,35044);this.$db=new Buffer("aPs",new F32A([0,0,1,0,1,1,0,1]),1,2,34962,35044,0)};set clearBeforeRender(v){this.$dH=v?this.$q:$nf};setSize(c,j){this.width=c;this[$[4]]=j;this.$cI=this.$resize};renderToFramebuffer(r){if(!this[$[1]].isLost()){this.$dg();this[$[25]](r);this.$cB(r);r.unbind(this.$gl)}};render(){if(!this[$[1]].isLost()){this.$dg();this.$gl[$[51]](this[$[7]].uFY,1);this.$dH();this.$cB()}};destruct(){};$attachFramebuffer(r){r.bind(this.$gl);r.setSize(this.width,this[$[4]]);this[$[1]][$[62]](r,this[$[18]],0);this[$[1]][$[85]](r);this.$gl[$[51]](this[$[7]].uFY,-1)};$attachFramebufferAndClear(r){this.$attachFramebuffer(r);this.$dH()};$drawInstanced(d){this.$gl.drawElementsInstanced(5,4,5123,0,d)};$useTextureAt(k,m,f,n){this.$gl.uniform1i(m,this[$[1]][$[77]](k,f,this[$[18]],n))};$useTexture(k,m,n){this.$gl.uniform1i(m,this[$[1]][$[62]](k,this[$[18]],n))};$uploadBuffers(){var b=this.$gl;this.$db.upload(b);this.$dA.upload(b)};$createBuffers(){var b=this.$gl,p=this[$[7]];this.$dA.create(b,p);this.$db.create(b,p)};$resize(){this.resized=1;this.$cI=$nf;this[$[74]]=this.width/2;this[$[63]]=this[$[4]]/2};$cB(r){this[$[18]]=Date.now();this.$render(r)};$dg(){this.$gl=this[$[1]].gl;var l=this[$[1]],q=l.contextId;if(this.$dn!==q||this.$dw!==this.$cm){this.$dn=q;this.$dw=this.$cm;this.$cJ()}else this.$cn();this.resized=0;this.$cI();this[$[1]].setSize(this.width,this[$[4]])};$q(){var b=this.$gl,g=this[$[64]];this.$gl[$[64]](g.r,g.g,g.b,g.a);this.$gl.clear(16384)};$cJ(){var b=this.$gl,s=Utils.GLSL.VERSION+"precision highp float;\n";this.$Q=Utils.createProgram(b,s+this.$createVertexShader(),s+this.$createFragmentShader());this[$[7]]=Utils.getLocationsFor(b,this.$Q,this.$t[$[73]]);this.$b=b.createVertexArray();this.$cn();this[$[46]]()};$cn(){this[$[1]][$[91]](this.$Q,this.$b)}};class BatchRenderer extends BaseRenderer{constructor(b){Utils[$[27]](b,["aMt"]);super(b);this[$[13]]=b.maxRenderCount||1e4;this[$[33]]=new Buffer("aMt",this[$[13]],4,4)};$uploadBuffers(){this[$[33]].upload(this.$gl);super[$[10]]()};$createBuffers(){super[$[46]]();this[$[33]].create(this.$gl,this[$[7]])}};var BVS="vec4 pos=vec4(aPs*2.-1.,1,1);gl_Position=pos;gl_Position.y*=uFY;";var BVSP="vec2(aPs.x,1.-aPs.y)";var BVSA="in vec2 aPs;";var BVSU="uniform float uFY;";var BVSI=BVSA+BVSU;class FilterRenderer extends BaseRenderer{constructor(j={}){j=Utils[$[19]](j);Utils[$[27]](j,["uFTx","uId","uFV","uFK","uRT","uSz"]);super(j);this.$dJ=this[$[25]];this[$[25]]=$nf;this.filters=j.filters||[];this[$[5]]=j[$[5]];this.$cK=[new Framebuffer,new Framebuffer]};get filters(){return this.$R};set filters(v){this.$R=new Proxy(v,{deleteProperty:(k,s)=>{delete k[s];this.$cm++;return 1},set:(k,s,g)=>{k[s]=g;this.$cm++;return 1}});this.$cm++};$render(y){var q=this[$[1]],b=this.$gl,x=this[$[18]],t=this[$[7]],r=this.$R,l=r[$[6]]||1,d=l-2;var i=-1;q[$[44]](BlendMode.NORMAL);this[$[10]]();b[$[51]](t.uRT,x%864e5);b.uniform2i(t.uSz,this.$width,this[$[17]]);this[$[34]](this[$[5]],t.uTx,0);while(++i<l){var m=r[i],w=m&&m.on,n=i>d,z=w&&m[$[14]]&&m[$[14]].texture;var A;z&&this[$[34]](z,t.uFTx,1);if(n)y?this.$dJ(y):b[$[51]](t.uFY,1);else if(w){A=this.$cK[i&1];this.$dJ(A)};if(w){b.uniform1i(t.uId,m.uniqueId);b.uniform1fv(t.uFV,m.v);m.kernels&&b.uniformMatrix4fv(t.uFK,0,m.kernels)};(w||n)&&this[$[28]](1);z&&q[$[85]](z);if(A){A.unbind(b);q[$[77]](A,0,x)}}};$createVertexShader(){return BVSI+"out vec4 v0;void main(void){"+BVS+"v0=vec4(pos.xy,"+BVSP+");}"};$createFragmentShader(){return Utils.GLSL.DEFINE.Z+Utils.GLSL.DEFINE[$[57]]+"in vec4 v0;uniform int uId;uniform float uRT,uFV[9];uniform ivec2 uSz;uniform mat4 uFK;uniform sampler2D uTx,uFTx;out vec4 oCl;"+Utils.GLSL.RANDOM+"float tl(float c){return c<=.04045?c/12.92:pow((c+.055)/1.055,2.4);}float rl(vec3 c){return .2126*tl(c.r)+.7152*tl(c.g)+.0722*tl(c.b);}float gtGS(vec3 cl){return .3*cl.r+.59*cl.g+.11*cl.b;}void main(void){oCl=texture(uTx,v0.zw);float vl[]=uFV,v=vl[0];vec2 ts=vec2(textureSize(uTx,0));ivec2 f=ivec2(floor(v0.zw*ts));vec2 vol=v/ts;vec3 rgb=vec3(vl[2],vl[3],vl[4]);vec4 oClVl=oCl*(1.-v);mat4 kr=uFK;"+this.filters.reduce((c,f)=>{var h=c.findIndex((p)=>p.GLSL===f.GLSL);if(h<0)h=c.push(f)-1;f.uniqueId=h;return c},[]).map((f)=>"if(uId=="+f.uniqueId+"){"+f.GLSL+"}").join("else ")+"}"}};class NormalMapRenderer extends BaseRenderer{constructor(b={}){b=Utils[$[19]](b);super(b);this[$[21]]=b[$[21]]};$render(){this[$[1]][$[44]](BlendMode.NORMAL);this[$[34]](this[$[21]],this[$[7]].uTx,0);this[$[10]]();this[$[28]](1)};$createVertexShader(){return BVSI+"uniform sampler2D uTx;out vec2 v0;void main(void){"+BVS+"v0="+BVSP+";}"};$createFragmentShader(){return Utils.GLSL.DEFINE.Z+Utils.GLSL.DEFINE.HEIGHT+"in vec2 v0;uniform sampler2D uTx;out vec4 oCl;void main(void){vec2 ts=vec2(textureSize(uTx,0)),p=1./ts,p0=floor(v0.xy*ts),p1=p0+Z.yx,p2=p0+Z.yy;vec3 A=vec3(p0,texture(uTx,p0*p).g),B=vec3(p1,texture(uTx,p1*p).g),C=vec3(p2,texture(uTx,p2*p).g),nm=normalize(cross(B-A,C-A))*HEIGHT*Z.yzy;oCl=vec4(nm*.5+.5,1);}"}};class AmbientOcclusionMapRenderer extends BaseRenderer{constructor(c={}){c=Utils[$[19]](c);Utils[$[27]](c,["uSTx","uP","uUST","uOs"]);super(c);this[$[5]]=c[$[5]];this[$[21]]=c[$[21]];this.radius=c.radius??4;this.samples=c.samples??4;this[$[92]]=c[$[92]]??1;this[$[60]]=c[$[60]]??1;this.offsetX=c.offsetX??0;this.offsetY=c.offsetY??0};setOffset(x,y){this.offsetX=x;this.offsetY=y};$render(){var b=this.$gl,d=this[$[7]],f=!!this[$[5]];this[$[1]][$[44]](BlendMode.NORMAL);this[$[34]](this[$[21]],d.uTx,0);f&&this[$[34]](this[$[5]],d.uSTx,1);b[$[51]](d.uUST,f);b.uniform4f(d.uP,this.radius,this.samples,this[$[92]],this[$[60]],);b.uniform2f(d.uOs,this.offsetX,this.offsetY);this[$[10]]();this[$[28]](1)};$createVertexShader(){return Utils.GLSL.DEFINE[$[57]]+BVSI+"uniform vec4 uP;out vec4 v0;void main(void){"+BVS+"float r=RADIANS_360/uP.y;v0=vec4("+BVSP+",cos(r),sin(r));}"};$createFragmentShader(){return Utils.GLSL.DEFINE.Z+Utils.GLSL.DEFINE[$[57]]+"in vec4 v0;uniform sampler2D uSTx,uTx;uniform float uUST;uniform vec2 uOs;uniform vec4 uP;out vec4 oCl;"+Utils.GLSL.RANDOM+"void main(void){vec2 vxy=v0.xy,ts=1./vec2(textureSize(uTx,0));float tx=texture(uTx,vxy).g,v=0.;if(uP.y>0.&&uP.x>0.){vec2 rg;float rnd=rand(vxy+floor(uOs)*ts),ta=RADIANS_360*rnd,l=min(uP.y,32.);vec2 tn=uP.x*ts,n=tn*rnd,dr=vec2(cos(ta),sin(ta));float ln=1.-length(n)/length(tn);mat2 r=mat2(v0.z,-v0.w,v0.w,v0.z);for(float i=0.;i<l;i++){rg=max(texture(uTx,vxy+dr*n).rg-tx,Z.xx);v+=max(0.,(rg.y-rg.x)*(1.-rg.x)*ln);dr*=r;}v/=l;}vec3 stCl=uUST>0.?texture(uSTx,vxy).rgb:Z.yyy;oCl=vec4(stCl*mix(1.,tx,uP.w)*(1.-v*uP.z),1);}"}};var $as=(c,d,b=0)=>{var i=d[$[6]];while(--i>-1)c[b+i]=d[i];return c};class LightRenderer extends BatchRenderer{constructor(g={}){g=Utils[$[19]](g);Utils[$[27]](g,["aExt","uNTx","uSTx","uRTx","uTS","uUT"]);super(g);this.clearBeforeRender=1;this[$[64]].set(0,0,0,1);this.$S=this;this[$[5]]=g[$[5]];this.normalMap=g.normalMap;this[$[21]]=g[$[21]];this[$[78]]=g[$[78]];this.$dh=new Buffer("aExt",this[$[13]],2,3)};get sourceTexture(){return this.$cQ};set sourceTexture(v){this.$cQ=v;if(v)this.$S=v};get normalMap(){return this.$cd};set normalMap(v){this.$cd=v;if(v)this.$S=v};get heightMap(){return this.$cf};set heightMap(v){this.$cf=v;if(v)this.$S=v};get roughnessMap(){return this.$cL};set roughnessMap(v){this.$cL=v;if(v)this.$S=v};addLightForRender(f){var k=this.$cp,h=f.parent;if(k<this[$[13]]&&h){var l=k*16,q=k*6,m=this[$[33]].data,r=this.$dh.data;$as(m,f[$[12]],l);m[l+6]=f[$[20]].width;m[l+7]=f.spotAngle;$as(m,f[$[37]],l+8);m[l+12]=f.shadowLength;m[l+13]=f.alpha*h[$[38]]();m[l+14]=f.angle;m[l+15]=f.type;r[q]=f.flags;r[q+1]=f[$[20]].z;r[q+2]=f.precision;r[q+3]=f.maxShadowStep;r[q+4]=f[$[88]];r[q+5]=f.attenuation;++this.$cp}};$render(){var b=this.$gl,j=this[$[7]],t=!!this[$[5]],n=!!this.normalMap,s=!!this[$[78]],p=!!this[$[21]];this[$[1]][$[44]](BlendMode.ADD);t&&this[$[58]](this.$cQ,j.uSTx);n&&this[$[58]](this.$cd,j.uNTx);s&&this[$[58]](this.$cL,j.uRTx);p&&this[$[58]](this.$cf,j.uTx);b.uniform3f(j.uUT,t,s,n);b.uniform2f(j.uTS,this.$S.width,this.$S[$[4]]);this[$[10]]();this[$[28]](this.$cp);this.$cp=0};$uploadBuffers(){this.$dh.upload(this.$gl);super[$[10]]()};$createBuffers(){super[$[46]]();this.$dh.create(this.$gl,this[$[7]])};$createVertexShader(){return Utils.GLSL.DEFINE.Z+Utils.GLSL.DEFINE.PI+"#define P vec4(1,-1,2,-2)\n"+BVSA+"in mat4 aMt;in mat2x3 aExt;"+BVSU+"out vec2 v0;out vec4 v1,v2,v3,v4,v5;void main(void){vec3 pos=vec3(aPs*2.-1.,1);v2=vec4(aMt[3].w,aExt[0]);v1=vec4(aExt[1],PI-aMt[1].w);v5=aMt[2];v5.a*=aMt[3].y;v4.xy=pos.xy;mat3 mt=mat3(aMt[0].xy,0,aMt[0].zw,0,aMt[1].xy,1);v0.x=aMt[1].z;v0.y=v0.x*aMt[3].x;if(v2.x<1.){gl_Position=vec4(mt*pos,1);v3.xy=(gl_Position.xy+P.xy)/P.zw;v4.zw=(aMt[1].xy+P.xy)/P.zw;float amtz=aMt[3].z;v3.zw=vec2(sin(amtz),cos(amtz));}else{mt[2].xy=Z.zy;gl_Position=vec4(pos,1);v3.xy=(gl_Position.xy+P.xy)/P.zw;v4.zw=v3.xy+((mt*vec3(1)).xy+P.xy)/P.zw;}gl_Position.y*=uFY;}"};$createFragmentShader(){var c=(d)=>"for(i=m;i<l;i+=st){p=ivec2((v4.zw+i*opdm)*uTS);tc=texelFetch(uTx,p,0)*HEIGHT;"+d+"}";return Utils.GLSL.DEFINE.HEIGHT+Utils.GLSL.DEFINE.Z+"in vec2 v0;in vec4 v1,v2,v3,v4,v5;uniform vec2 uTS;uniform vec3 uUT;uniform sampler2D uNTx,uSTx,uRTx,uTx;out vec4 oCl;"+Utils.GLSL.RANDOM+"void main(void){float vol=v5.a;if(vol<=0.)discard;vec2 p2xy=v3.xy,tUv=p2xy*uTS,tCnt=v4.zw*uTS;vec4 tc=texelFetch(uTx,ivec2(tUv),0);int flg=int(v2.y);float ph=tc.g*HEIGHT,spc=0.;vec3 sf=vec3(tUv,ph),lp=vec3(tCnt,v2.z),sftla=lp-sf;if(v2.x<1.){float d=length(sftla)/v0.x,od=1.-d,dv=(flg&16)>0?pow(od,v1.z):1.;vol*=dv;float slh=(v2.z-ph)/HEIGHT;vec2 sl=vec2(slh*v3.w-v4.x*v3.z,slh*v3.z+v4.x*v3.w);if(vol<=0.||od<=0.||atan(sl.x,length(vec2(sl.y,v4.y)))+"+Utils.ALPHA+"-v1.w<0.)discard;}float fltDst=distance(tCnt,tUv),shdw=1.;if((flg&2)>0){vec3 nm=uUT.z>0.?normalize((texture(uNTx,p2xy).rgb*2.-1.)*Z.yzy):Z.xxy,sftl=normalize(sftla),sftv=normalize(vec3((flg&8)>0?uTS*.5:tUv,HEIGHT)-sf),hlf=normalize(sftl+sftv);vol*=dot(nm,sftl);if(vol<=0.)discard;float rgh=1.,shn=uUT.y>0.?texture(uRTx,p2xy).r:tc.b;spc=pow(max(dot(nm,hlf),0.),32.)*shn*v1.y;}if((flg&1)>0){ivec2 p;vec2 opd=(tUv-tCnt)/fltDst,opdm=opd/uTS;float st=max(1.,ceil(fltDst/v1.x)),i,pc,l=min(fltDst-st,4096.),m=max(st,l-v0.y);if((flg&4)>0)"+c("if(tc.g>=v2.z)discard;")+"else{float opdL=length(opd),hst=(ph-v2.z)/fltDst,rnd=v2.w*rand(p2xy);"+c("st+=rnd;pc=v2.z+i*hst;shdw*=mix(1.,(fltDst-i*opdL)/v0.y,step(tc.r,pc)*step(pc,tc.g));")+"}}vec3 stCl=uUT.x>0.?texture(uSTx,p2xy).rgb:Z.yyy;oCl=vec4((stCl+spc)*v5.rgb*vol*shdw,1);}"}};class DSC extends Container{constructor(c){super();this.renderer=c;this[$[37]]=this.color.cache;delete this.parent;delete this[$[20]]};get stage(){return this};getPremultipliedUseTint(){return this.useTint};getPremultipliedAlpha(){return this.alpha};update(){var b=this.color,c=this.renderer;b.update();this[$[50]]=b.updated;this[$[11]]=c.resized;this[$[11]]&&GM3U.projection(this[$[12]],c)}};var _36N="_draw",_36T="mousemove",_36U="mousedown",_36R="mouseup",_36P="click",_36W="touchstart",_36V="touchmove",_36S="touchend",_36cd="PointerClick",_36Z="PointerDown",_36cb="PointerMove",_36X="PointerUp",_36Y="PointerOut",_36cc="PointerOver",_36O=[_36T,_36U,_36R,_36P,_36W,_36V,_36S],_36Q={[_36P]:_36cd,[_36U]:_36Z,[_36W]:_36Z,[_36T]:_36cb,[_36V]:_36cb,[_36R]:_36X,[_36S]:_36X};class Stage2D extends BatchRenderer{constructor(h={}){h=Utils[$[19]](h);h.useTint=h.useTint??1;Utils[$[27]](h,["aDt","aDst"]);super(h);var F=this[$[13]];this[$[72]]=new DSC(this);this.$cp=0;this[_36N+Item[$[0]]]=this[_36N+Light[$[0]]]=$nf;this[_36N+Image[$[0]]]=this.$cg;this[_36N+Container[$[0]]]=this.$cR;this.$ch=this.$ch.bind(this);this.$cS={x:0,y:0};this.$cq=new Buffer("aDt",F,3,4);this.$dp=new Buffer("aDst",F,4,2);this.$dE=this.$dE.bind(this);var j=this[$[1]][$[26]],D=h.lightRenderer;_36O.forEach((c)=>j[$[22]](c,this.$dE));D&&this.attachLightRenderer(D)};attachLightRenderer(v){this[_36N+Light[$[0]]]=v.addLightForRender.bind(v)};detachLightRenderer(){this[_36N+Light[$[0]]]=$nf};destruct(){var j=this[$[1]][$[26]];_36O.forEach((c)=>j[$[15]](c,this.$dE))};$dr(){var w=this.$cC,z=this.$cD,L=this.$dF;if(w){if(z!==L){var m={...w};L&&L[$[36]](L,{...m,type:_36Y});z&&z[$[36]](z,{...m,type:_36cc})};z&&z[$[36]](z,{...w,type:_36Q[w.type]});this.$dF=z};this.$cC=$n};$dq(x,y){this.$dB=1;var A=this[$[72]][$[12]],E=this.$cS;E.x=(x-this[$[74]])*A[0];E.y=(y-this[$[63]])*A[3]};$W(d){var r=this[$[18]];d.update(r);d[$[70]](d,r);d.renderable&&this[_36N+d[$[0]]](d);d[$[76]](d,r)};$cR(p){var n=p[$[16]],l=n[$[6]];var i=-1;while(++i<l)this.$W(n[i])};$cg(f){this[$[1]][$[44]](f.blendMode,this.$ch);var s=this.$cp,B=s*12,G=s*16,t=f.parent,H=this.$cq.data,I=this[$[33]].data;if(t){if(this.$dB&&f[$[53]]&&f.isContainsPoint(this.$cS))this.$cD=f;$as(H,f[$[37]],B);$as(H,f[$[52]],B+8);H[B+4]=f.alpha*t[$[38]]();H[B+5]=f.tintType*t[$[61]]();H[B+6]=this[$[1]][$[62]](f.texture,this[$[18]],0,this.$ch);H[B+7]=f[$[59]][$[95]];$as(I,f[$[12]],G);$as(I,f[$[47]],G+6);$as(I,f[$[89]],G+12);$as(this.$dp.data,f[$[71]],s*8);++this.$cp===this[$[13]]&&this.$ch()}};$ch(){if(this.$cp){this[$[10]]();this.$gl.uniform1iv(this[$[7]].uTx,this[$[1]][$[48]]);this[$[28]](this.$cp);this.$cp=0}};$dE(g){this.$cC=g;var j=this[$[1]][$[26]];this.$dq((j.width/j.offsetWidth)*g.offsetX,(j[$[4]]/j.offsetHeight)*g.offsetY)};$render(){this.$cD=$n;this.$W(this[$[72]]);this.$ch();this.$dB=0;this.$dr()};$uploadBuffers(){var b=this.$gl;this.$cq.upload(b);this.$dp.upload(b);super[$[10]]()};$createBuffers(){var b=this.$gl,q=this[$[7]];super[$[46]]();this.$cq.create(b,q);this.$dp.create(b,q)};$createVertexShader(){var J=this.$t[$[86]],M=Utils.INFO[$[24]];return Utils.GLSL.DEFINE.Z+BVSA+"in mat4x2 aDst;in mat3x4 aDt;in mat4 aMt;"+BVSU+"uniform sampler2D uTx["+M+"];out vec3 v0;out vec4 v1,v2,v3"+(J?",v4;":";")+"vec2 gtTexS(float i){"+Array(M).fill().map((v,i)=>"if(i<"+(i+1)+".)return .5/vec2(textureSize(uTx["+i+"],0));").join("")+"return Z.yy;}vec2 clcQd(vec2 p){return mix(mix(aDst[0],aDst[1],p.x),mix(aDst[3],aDst[2],p.x),p.y);}void main(void){vec2 tPs=clcQd(aPs);gl_Position=vec4(mat3(aMt[0].xy,0,aMt[0].zw,0,aMt[1].xy,1)*vec3(tPs,1.),1)*vec4(1.,uFY,1.,1.);v0=aDt[1].xyz;v1=vec4((mat3(aMt[1].zw,0,aMt[2].xy,0,aMt[2].zw,1)*vec3(mix(tPs,aPs,aDt[1].w),1.)).xy,gtTexS(v0.z));v2=aMt[3];v3=aDt[0];"+(J?"v4=aDt[2];":"")+"}"};$createFragmentShader(){var h=this.$t,M=Utils.INFO[$[24]],J=h[$[86]],k=h.useTint;var K=(C)=>"gtTexCl(v0.z,v2,"+C+")";return Utils.GLSL.DEFINE.Z+Utils.GLSL.DEFINE[$[57]]+"in vec3 v0;in vec4 v1,v2,v3"+(J?",v4;":";")+"uniform sampler2D uTx["+M+"];out vec4 oCl;vec4 gtTexCl(float i,vec4 s,vec2 m){vec2 sxy=s.xy,szw=s.zw,ofs=szw*m,vpzw=v1.zw,cp=clamp(sxy+ofs,sxy+vpzw,sxy+szw-vpzw);"+Array(M).fill().map((v,i)=>"if(i<"+(i+1)+".)return texture(uTx["+i+"],cp);").join("")+"return Z.yyyy;}float cosine(float a,float b,float v){v=abs(v);float t=-2.*v+2.;v=mix(2.*v*v,1.-t*t*.5,step(.5,v));return a*(1.-v)+b*v;}"+(J?Utils.GLSL.RANDOM2+"vec4 gtClBUv(vec2 st){vec2 uv=v1.xy;float rnd=rand2(floor(uv+st)/100.),rndDg=rnd*RADIANS_360*v4.x;if(rndDg>0.){vec2 rt=vec2(sin(rndDg),cos(rndDg));uv=vec2(uv.x*rt.y-uv.y*rt.x,uv.x*rt.x+uv.y*rt.y);}return "+K("mod(uv,Z.yy)")+";}float gtRClBUv(vec2 st,vec2 uv){float rnd=rand2(floor(v1.xy+st)/100.);return (1.-(v4.w*rnd-v4.w*.5)*v4.y)*cosine(0.,1.,1.-st.x-uv.x)*cosine(0.,1.,1.-st.y-uv.y);}":"")+"void main(void){if(v0.z>-1.){vec2 uv=mod(v1.xy,Z.yy);"+(J?"if(v4.x>0.||v4.y>0.){vec4 rc=vec4(gtRClBUv(Z.xx,uv),gtRClBUv(Z.yx,uv),gtRClBUv(Z.xy,uv),gtRClBUv(Z.yy,uv));oCl=mix(gtClBUv(Z.xy),clamp(gtClBUv(Z.xx)*rc.x+gtClBUv(Z.yx)*rc.y+gtClBUv(Z.xy)*rc.z+gtClBUv(Z.yy)*rc.w,0.,1.),vec4(v4.z));oCl.a=mix(oCl.a,clamp(oCl.a*(rc.x+rc.y+rc.z+rc.w),0.,1.),v4.y);}else oCl="+K("uv")+";":"oCl="+K("uv")+";")+"}else oCl+=1.;oCl.a*=v0.x;if(oCl.a<=0.)discard;"+(k?"if(v0.y>0.)if(v0.y==1.||(v0.y==2.&&oCl.r==oCl.g&&oCl.r==oCl.b))oCl*=v3;else if(v0.y==3.)oCl=v3;else if(v0.y==4.)oCl+=v3;":"")+"}"}};class BaseFilter{constructor(b=0){this.on=1;this.v=new F32A(9);this.intensity=b};get intensity(){return this.v[0]};set intensity(v){this.v[0]=v};get intensityX(){return this.v[0]};set intensityX(v){this.v[0]=v};get intensityY(){return this.v[1]};set intensityY(v){this.v[1]=v};get mix(){return this.v[1]};set mix(v){this.v[1]=v};get r(){return this.v[2]};set r(v){this.v[2]=v};get g(){return this.v[3]};set g(v){this.v[3]=v};get b(){return this.v[4]};set b(v){this.v[4]=v}};class BaseKernelFilter extends BaseFilter{constructor(c,b=1){super(c);this.mix=b};get GLSL(){return"kr*=v;oCl.rgb=(oCl.rgb*(1.-vl[1]))+(texelFetch(uTx,f-ivec2(1),0)*kr[0].x+texelFetch(uTx,f+ivec2(0,-1),0)*kr[0].y+texelFetch(uTx,f+ivec2(1,-1),0)*kr[0].z+texelFetch(uTx,f+ivec2(-1,0),0)*kr[0].w+oCl*kr[1].x+texelFetch(uTx,f+ivec2(1,0),0)*kr[1].y+texelFetch(uTx,f+ivec2(-1,1),0)*kr[1].z+texelFetch(uTx,f+ivec2(0,1),0)*kr[1].w+texelFetch(uTx,f+ivec2(1),0)*kr[2].x).rgb*vl[1];"};get kernels(){return this.$T};set kernels(v){this.$T=$as(this.$T??new F32A(16),v)}};class BaseSamplingFilter extends BaseFilter{constructor(k,l,h=0,f=.5,g=.5,b=1){super(k);this.intensityY=l;this.isRadial=h;this.centerX=f;this.centerY=g;this.size=b};get isRadial(){return this.v[2]};set isRadial(v){this.v[2]=v?1:0};get centerX(){return this.v[3]};set centerX(v){this.v[3]=v};get centerY(){return this.v[4]};set centerY(v){this.v[4]=v};get size(){return this.v[5]};set size(v){this.v[5]=v}};BaseSamplingFilter[$[29]]=(m,d,j="")=>"vec2 wh=vec2(v,vl[1]);float lngWH=length(wh/ts);if(lngWH>0.){float cnt=1.,rnd=rand(v0.zw),l=clamp(max(wh.x,wh.y)/8.,3.,8.)+4.*rnd,ta=RADIANS_360*rnd,t=RADIANS_360/l;vec2 ps,dr=vec2(cos(ta),sin(ta)),r=vec2(cos(t),sin(t));vec4 clg,cl=oCl;ivec2 mn=ivec2(Z.xx),mx=ivec2(ts)-1;mat2 rt=mat2(r.x,-r.y,r.y,r.x);"+m+"for(float i=0.;i<l;i++){ps=wh*dr;clg=texelFetch(uTx,clamp(f+ivec2(ps),mn,mx),0);dr*=rt;"+d+"}"+j+"cl/=cnt;float dst=mix(1.,clamp(distance(vec2(vl[3],vl[4]),v0.zw)*vl[5],0.,1.),vl[2]);oCl=dst*cl+(1.-dst)*oCl;}";class DFTTP{constructor(d,f,h=0,j=0,b=0,c=0,g=1,k=1){this.$H=d;this.texture=f;this.translateX=h;this.translateY=j;this.cropX=b;this.cropY=c;this.cropWidth=g;this.cropHeight=k};get translateX(){return this.$H.v[1]};set translateX(v){this.$H.v[1]=v};get translateY(){return this.$H.v[2]};set translateY(v){this.$H.v[2]=v};get cropX(){return this.$H.v[3]};set cropX(v){this.$H.v[3]=v};get cropY(){return this.$H.v[4]};set cropY(v){this.$H.v[4]=v};get cropWidth(){return this.$H.v[5]};set cropWidth(v){this.$H.v[5]=v};get cropHeight(){return this.$H.v[6]};set cropHeight(v){this.$H.v[6]=v}};class BaseTextureFilter extends BaseFilter{constructor(f,l,h,j,c,d,g,k){super(l);this[$[14]]=new DFTTP(this,f,h,j,c,d,g,k)}};BaseTextureFilter[$[29]]=(b)=>"vec4 mskCl=texture(uFTx,mod(vec2(vl[1],vl[2])+v0.zw,1.)*vec2(vl[5]-vl[3],vl[6]-vl[4]));"+b;var _43b=BaseTextureFilter[$[29]]("oCl=texture(uTx,v0.zw+(Z.yz*(mskCl.rg-.5)*2.*vol));");class DisplacementFilter extends BaseTextureFilter{get GLSL(){return _43b}};var _44b=BaseTextureFilter[$[29]]("oCl.a*=v<4.?mskCl[int(v)]:(mskCl.r+mskCl.g+mskCl.b+mskCl.a)/4.;");class MaskFilter extends BaseTextureFilter{get GLSL(){return _44b};get type(){return this.v[0]};set type(v){this.v[0]=v}};MaskFilter.Type={RED:0,GREEN:1,BLUE:2,ALPHA:3,AVG:4};class PixelateFilter extends BaseFilter{get GLSL(){return"oCl=texture(uTx,floor(v0.zw/vol)*vol);"}};class EdgeDetectFilter extends BaseKernelFilter{constructor(c,b=1){super(c,b);this.kernels=[-1,-1,-1,-1,8,-1,-1,-1,-1]}};class SharpenFilter extends BaseKernelFilter{constructor(c,b=1){super(c,b);this.kernels=[0,-1,0,-1,5,-1,0,-1,0]}};class SaturateFilter extends BaseKernelFilter{get GLSL(){return"oCl.rgb=(oCl.rgb*(1.-vl[1]))+vec3(kr[0].r*oCl.r+kr[0].g*oCl.g+kr[0].b*oCl.b,kr[1].r*oCl.r+kr[1].g*oCl.g+kr[1].b*oCl.b,kr[2].r*oCl.r+kr[2].g*oCl.g+kr[2].b*oCl.b);"};get intensity(){return this.v[0]};set intensity(v){this.v[0]=v;var b=1-v,c=b*.3,d=b*.59,f=b*.11;this.kernels=[c+v,d,f,0,c,d+v,f,0,c,d,f+v,0]}};class GrayscaleFilter extends BaseFilter{get GLSL(){return"oCl=oClVl+vec4(vec3(gtGS(oCl.rgb)),oCl.a)*v;"}};class SepiaFilter extends BaseFilter{get GLSL(){return"oCl=oClVl+vec4(vec3(.874,.514,.156)*gtGS(oCl.rgb),oCl.a)*v;"}};class InvertFilter extends BaseFilter{get GLSL(){return"oCl=oClVl+vec4(1.-oCl.rgb,oCl.a)*v;"}};class TintFilter extends BaseFilter{constructor(c,r,g,b){super(c);this.r=r;this.g=g;this.b=b};get GLSL(){return"oCl.rgb*=rgb*v;"}};class ColorLimitFilter extends BaseFilter{get GLSL(){return"oCl.rgb=(round((oCl.rgb*255.)/v)/255.)*v;"}};class VignetteFilter extends BaseFilter{constructor(c,d,f,r,g,b){super(c);this.roundness=d;this.transition=f;this.r=r;this.g=g;this.b=b};get GLSL(){return"vec2 pv=pow(abs(v0.xy*v),vec2(vl[1]));float cv=clamp((1.-length(pv))*vl[5],0.,1.);oCl.rgb=oCl.rgb*cv+rgb*(1.-cv);"};get roundness(){return this.v[1]};set roundness(v){this.v[1]=v};get transition(){return 1/this.v[5]};set transition(v){this.v[5]=1/v}};class RainbowFilter extends BaseFilter{get GLSL(){return"oCl.rgb+=vec3(v0.xy*.15,(v0.x*v0.y)*.15)*v;"}};class BrightnessContrastFilter extends BaseFilter{constructor(c,b){super(c);this.contrast=b};get GLSL(){return"oCl.rgb=(vl[1]+1.)*oCl.rgb*v-.5*vl[1];"};get brightness(){return this.v[0]};set brightness(v){this.v[0]=v};get contrast(){return this.v[1]*100};set contrast(v){this.v[1]=v/100}};class GammaFilter extends BaseFilter{get GLSL(){return"oCl.rgb=pow(oCl.rgb,vec3(1./v));"}};var _58b=BaseSamplingFilter[$[29]]("","cl+=clg;cnt++;");class BlurFilter extends BaseSamplingFilter{get GLSL(){return _58b}};var _59b=BaseSamplingFilter[$[29]]("float clgRl,bst=1.,oClRl=rl(oCl.rgb);","clgRl=rl(clg.rgb);bst+=max(0.,(clgRl-oClRl)/length(ps));","cl*=bst+(bst>1.?lngWH:0.);");class GlowFilter extends BaseSamplingFilter{get GLSL(){return _59b}};class ChromaticAberrationFilter extends BaseFilter{constructor(g,f=0,c=.5,d=.5,h=0){super(g);this.isRadial=f;this.centerX=c;this.centerY=d;this.invertRadial=h};get GLSL(){return"vec4 pcl=vec4(texture(uTx,v0.zw-vec2(vol.x,0)).r,oCl.g,texture(uTx,v0.zw+vec2(vol.x,0)).b,1);float dst=mix(1.,clamp(distance(vec2(vl[3],vl[4]),v0.zw),0.,1.),vl[2]),mA=mix(dst,1.-dst,vl[5]),mB=1.-mA;oCl=mA*pcl+mB*oCl;"};get isRadial(){return this.v[2]};set isRadial(v){this.v[2]=v?1:0};get centerX(){return this.v[3]};set centerX(v){this.v[3]=v};get centerY(){return this.v[4]};set centerY(v){this.v[4]=v};get invertRadial(){return this.v[5]};set invertRadial(v){this.v[5]=v}};var layoutPart=(g,b,h,l)=>{var m="";for(var c=0;c<h[$[6]];c++){var n=m+h[c];if(b[$[45]](n).width<=l)m=n;else{m&&g.push(m);m=h[c]}};m&&g.push(m)};var layoutText=(b,d,l)=>{var g=[],t=d.split("\n");for(var i=0;i<t[$[6]];i++){var v=t[i];if(v.trim()===""){g.push("");continue};var x="",k=0;while(k<v[$[6]]){var w=v.indexOf(" ",k);if(w===-1)w=v[$[6]];var f=v.slice(k,w),q=x+(x===""?"":" ")+f;if(b[$[45]](q).width<=l)x=q;else{if(b[$[45]](f).width>l){if(x){g.push(x);x=""};if(f.includes("-")){var j=f.split(/(-)/);var r="";for(var p=0;p<j[$[6]];p++){var s=r+j[p];if(b[$[45]](s).width<=l)r=s;else{r&&g.push(r);if(b[$[45]](j[p]).width>l){layoutPart(g,b,[...j[p]],l);r=""}else r=j[p]}};r&&g.push(r)}else layoutPart(g,b,[...f],l)}else{x&&g.push(x);x=f}};k=w+1};x&&g.push(x)};return g};class Text extends Image{constructor(c="",j={}){var h=$d[$[30]]($[26]);super(new Texture(h,1));this.$I=h;this.$c=h[$[90]]("2d",{alpha:1});this.text=c;this.fontSize=j.fontSize??12;this.lineHeight=j.lineHeight??1.3;this.fontFamily=j.fontFamily??"sans-serif";this.fontColor=j.fontColor??"#000";this.align=j.align??"left"};get text(){return this.$h};set text(v){this.$h=v;this.$X=this.$cT};get fontSize(){return this.$Y};set fontSize(v){this.$Y=v;this.$X=this.$cT};get fontFamily(){return this.$cr};set fontFamily(v){this.$cr=v;this.$X=this.$cT};get fontColor(){return this.$cj};set fontColor(v){this.$cj=v;this.$X=this.$cT};get align(){return this.$r};set align(v){this.$r=v;this.$X=this.$cT};get lineHeight(){return this.$cs};set lineHeight(v){this.$cs=v;this.$X=this.$cT};update(){super.update();this[$[11]]?this.$cT():this.$X()};$cT(){this.$X=$nf;var b=this.$c,h=this.$I,f=this.$r,k=this.$Y,n=this.$cs*k,m=this[$[20]].width;h.width=this[$[20]].width;h[$[4]]=this[$[20]][$[4]];b.font=k+"px "+this.$cr;b.textBaseline="top";b.textAlign=f;b.fillStyle=this.$cj;var g=layoutText(b,this.$h,m),x=f==="center"?m/2:f==="right"?m:0;for(var i=0,l=g[$[6]];i<l;i++){var d=g[i],y=n*i;b.fillText(d,x,y)}}};window.PWGL=window.AGL={version:"5.1.2",BlendMode,Texture,Framebuffer,Context,Buffer,Utils,Const,Item,BaseDrawable,Light,AnimatedImage,Container,Image,Text,BaseRenderer,BatchRenderer,FilterRenderer,NormalMapRenderer,AmbientOcclusionMapRenderer,LightRenderer,Stage2D,BaseFilter,BaseKernelFilter,BaseSamplingFilter,BaseTextureFilter,DisplacementFilter,MaskFilter,PixelateFilter,EdgeDetectFilter,SharpenFilter,SaturateFilter,GrayscaleFilter,SepiaFilter,InvertFilter,TintFilter,ColorLimitFilter,VignetteFilter,RainbowFilter,BrightnessContrastFilter,GammaFilter,BlurFilter,GlowFilter,ChromaticAberrationFilter};console.log(`%cPWGL v${AGL.version}\nhttps:\/\/github.com/asjs-dev/pwgl`,"background:#222;color:#0F0");})();