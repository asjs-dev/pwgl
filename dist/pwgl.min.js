(function(){var $="_locations,updateId,config,_height,_width,_currentAdditionalPropsUpdateId,context,_extensionData,createVersion,locations,_currentUpdateId,_enableBuffers,matrixCache,propsUpdateId,_scaleUpdateId,_updateId,precision,_renderTime,heightMap,_uploadBuffers,useActiveTexture,_clearBeforeRenderFunc,_currentRenderTime,_parent,_currentParentColorUpdateId,_currentParentPropsUpdateId,_currentColorUpdateId,_parseTextureSize,children,_dataBuffer,_rotationUpdateId,_dimensionHeightName,_filter,removeEventListener,_dimensionWidthName,clearColor,_attachFramebufferAndClearCustom,_matrixBuffer,_batchItems,_emptyTextureSlots,initRendererConfig,textureProps,_source,_lightData,_currentTexturePropsUpdateId,_attachFramebufferAndClear,_config,updateAnimation,_rotation,_resizeUpdateId,_loseContextExt,_baseTexture,colorCache,_currentRotationUpdateId,_drawInstanced,_updateLightProps,_distortionBuffer,createElement,texParameteri,activeTexture,_currentAglId,_currentResizeUpdateId,addEventListener,_extensionBuffer,_currentPropsUpdateId,_colorProofReflection,_batchDraw,_updateAdditionalData,_currentScaleUpdateId,useTexture,_initContext,sinRotationB,cosRotationB,cosRotationA,setBlendMode,sinRotationA,_internalFormat,_currenActiveId,_currentLoadUpdateId,maxTextureImageUnits,_createBuffers,_onContextLost,_inverseMatrixCache,_textureMap,_elementArrayBuffer,textureMatrixCache,maxBatchItems,_loadUpdateId,colorUpdateId,textureIds,_eventType,_currentContextId,_currentBlendMode,_corners,clearBeforeRender,_updateProps,useTextureAt,scaledHeight,_MAX_BATCH_ITEMS,container,placeholderImage,_attachFramebufferCustom,textureRepeatRandomCache,_positionBuffer,textureCrop,distortionProps,_currentProgram,_restoreContext,pickerPoint,sourceImage,bindTexture,scaledWidth,removeChild,_flattenShadow,useProgram,_magFilter,webglcontextrestored,_minFilter,_renderSource,distortionPropsCache,clearTextures,setChildIndex,getChildIndex,getProgramParameter,_isPickerSet,initCallback,_attachFramebuffer,premultipliedAlpha,deactivateTexture,contextAttributes,useRepeatTextures,webglcontextlost,readystatechange,uploadTextureInfo,_updateTransform,_switchToProgram,_updateAnimation,_useTextureFrame,_MAX_TEXTURE_NUM,getShaderInfoLog,textureCropCache".split(",");"use strict";var F32A=Float32Array,$m=Math,$d=document,$n=null;var $rfa=(d,b)=>{var f=d.indexOf(b);f>-1&&d.splice(f,1)};var $ef=()=>{};var $as=(g,h,c)=>{var i=h.length;while(--i>-1)g[c+i]=h[i]};var _4t={a:"Attrib",u:"Uniform"};var _4s=(b,n,q)=>{var g=b.createShader(n);b.shaderSource(g,q);b.compileShader(g);return g};var Utils={THETA:$m.PI/180,GLSL:{RANDOM:"float rand(vec2 p,float s){return fract(sin(dot(p,vec2(sin(p.x+p.y),cos(p.y-p.x)*s))*s)*.5+.5);}float rand(vec2 p){return rand(p,1.);}"},INFO:{isWebGl2Supported:!1},initContextConfig:(h)=>({canvas:(h=h||{}).canvas||$d[$[57]]("canvas"),initCallback:h[$[125]],contextAttributes:{...{powerPreference:"high-performance",preserveDrawingBuffer:!1,premultipliedAlpha:!1},...(h[$[129]]||{})}}),initRendererConfig:(h)=>({locations:(h=h||{})[$[9]]||[],precision:h[$[16]]||"highp",context:h[$[6]]||new Context()}),createVersion:(m)=>"#version 300 es\nprecision "+m+" float;\n",initApplication:(k)=>{var p=()=>{if($d.readyState==="complete"){$d[$[33]]($[132],p);k(Utils.INFO.isWebGl2Supported)}else $d[$[62]]($[132],p)};p()},createProgram:(b,w,y)=>{var r=_4s(b,35633,w);var v=_4s(b,35632,y);var j=b.createProgram();b.attachShader(j,r);b.attachShader(j,v);b.linkProgram(j);if(!b[$[123]](j,35714)){console.error("Program info:",b.getProgramInfoLog(j),"\n","Validate status:",b[$[123]](j,35715),"\n","Vertex shader info:",b[$[139]](r),"\n","Fragment shader info:",b[$[139]](v));b.deleteShader(r);b.deleteShader(v);b.deleteProgram(j);throw"WebGL application stoped"};return j},getLocationsFor:(b,j,x)=>{var l={};x.forEach((d)=>{l[d]=b["get"+_4t[d[0]]+"Location"](j,d)});return l}};var Const={};var _gl=$d[$[57]]("canvas").getContext("webgl2");if(_gl){for(var c in _gl){var f=_gl[c];if(typeof f==="number"&&c===c.toUpperCase())Const[c]=f};Utils.INFO.isWebGl2Supported=!0;Utils.INFO[$[79]]=_gl.getParameter(34930)};class Context{constructor(g){this.contextId=0;this[$[46]]=Utils.initContextConfig(g||{});this.canvas=this[$[46]].canvas;this[$[138]]=Utils.INFO[$[79]];this[$[81]]=this[$[81]].bind(this);this[$[70]]=this[$[70]].bind(this);this[$[107]]=this[$[107]].bind(this);this.canvas[$[62]]($[131],this[$[81]]);this.canvas[$[62]]($[116],this[$[70]]);this[$[70]]()};isLost(){return this.gl&&this.gl.isContextLost&&this.gl.isContextLost()};useBlendMode(l){this[$[92]]=l;this.gl[l.equationName].apply(this.gl,l.equations);this.gl[l.functionName].apply(this.gl,l.functions)};setBlendMode(l,r){if(this[$[92]]!==l){r&&r();this.useBlendMode(l)}};destruct(){this.gl[$[114]]($n);this.canvas[$[33]]($[131],this[$[81]]);this.canvas[$[33]]($[116],this[$[70]]);this[$[50]]&&this[$[50]].loseContext()};clearTextures(){for(var i=0;i<this[$[138]];++i){this[$[83]][i]=$n;this[$[39]][i]=i};this[$[89]].length=0};useTexture(q,p,m,k){if(!q)return-1;var n=this[$[83]].indexOf(q);if(n<0){n=this[$[39]][0];m=!0};if(this[$[39]].length<1){k&&k();this[$[120]]();n=0;m=!0};return this[$[96]](q,n,p,m)};useTextureAt(q,n,p,m){q.use(this.gl,n,m,p);this[$[83]][n]=q;this[$[89]].indexOf(n)<0&&this[$[89]].push(n);$rfa(this[$[39]],n);return n};deactivateTexture(q){var n=this[$[83]].indexOf(q);n>-1&&q.unbindTexture(this.gl,n)};useProgram(j,c){if(this[$[106]]!==j){this[$[106]]=j;this[$[120]]();var b=this.gl;b.bindVertexArray($n);b[$[114]](j);b.bindVertexArray(c);return!0};return!1};setCanvasSize(d,h){this.canvas.width=d;this.canvas.height=h};setSize(d,h){if(this[$[4]]!==d||this[$[3]]!==h){this[$[4]]=d;this[$[3]]=h;this.gl.viewport(0,0,d,h);this.gl.scissor(0,0,d,h)}};_onContextLost(f){f.preventDefault();this[$[50]]&&setTimeout(this[$[107]],1)};_restoreContext(){this[$[50]].restoreContext()};_initContext(){var b=this.gl=this.canvas.getContext("webgl2",this[$[46]][$[129]]);b.agl_id=++this.contextId;this[$[50]]=b.getExtension('WEBGL_lose_context');b.pixelStorei(37441,!0);b.enable(3042);b.blendColor(1,1,1,1);b.enable(3089);this[$[4]]=this[$[3]]=this[$[106]]=this[$[92]]=$n;this[$[83]]=[];this[$[39]]=[];this[$[89]]=[];this[$[120]]();this.setCanvasSize(1,1);this[$[46]][$[125]]&&setTimeout(this[$[46]][$[125]],1)}};class Buffer{constructor(p,d,f,g,j,h,m){var k=f*g;this.data=typeof d==="number"?new F32A(d*k):d;this._locationName=p;this._rows=f;this._cols=g;this._target=j||34962;this._type=h||35048;this._length=k*4;this._offset=g*4;this._divisor=typeof m==="number"?m:1;if(this._type===35044)this._length=this._offset=0};create(b,n){this._location=n[this._locationName];this._buffer=b.createBuffer();this.bind(b)};bind(b){b.bindBuffer(this._target,this._buffer)};upload(b,l){this.bind(b);l&&this._enable(b);b.bufferData(this._target,this.data,this._type)};destruct(){this.data=$n};_enable(b){var i=-1;while(++i<this._rows){var c=this._location+i;b.enableVertexAttribArray(c);b.vertexAttribPointer(c,this._cols,5126,!1,this._length,i*this._offset);b.vertexAttribDivisor(c,this._divisor)}}};var FPS={start:function(c){this._targetMS=this._then=this._frames=this._prevTime=this.fps=this.delay=0;this._then=Date.now();this._targetMS=1e3/(c||60)},update:function(){this._frames++;var b=Date.now();this.delay=(b-this._then)/this._targetMS;if(b>=this._prevTime+1e3){this.fps=(this._frames*1e3)/(b-this._prevTime);this._prevTime=b;this._frames=0};this._then=b}};var _7d=(c,b)=>({functionName:"blendFunc"+(c.length<3?"":"Separate"),functions:c,equationName:"blendEquation"+(!b||b.length<2?"":"Separate"),equations:b||[32774]});var BlendMode={NONE:_7d([0,0]),NORMAL_PM:_7d([1,771]),ADD_PM:_7d([1,1]),MULTIPLY_PM:_7d([774,771,1,771]),SCREEN_PM:_7d([1,769,1,771]),ADD_NPM:_7d([770,1,1,1]),SRC_IN:_7d([772,0]),SRC_OUT:_7d([773,0]),SRC_ATOP:_7d([772,771]),DST_OVER:_7d([773,1]),DST_IN:_7d([0,770]),DST_OUT:_7d([0,771]),DST_ATOP:_7d([773,770]),XOR:_7d([773,771]),NORMAL:_7d([770,771,1,771]),ADD:_7d([770,772,1,772]),MULTIPLY:_7d([774,0]),SCREEN:_7d([770,769,1,769]),OVERLAY:_7d([1,771]),EXCLUSION:_7d([775,769]),LIGHTEN:_7d([1,1],[32776]),DARKEN:_7d([1,1],[32775]),SHADOW:_7d([774,768])};class BaseProps{constructor(){this[$[1]]=0}};class BasePositioningProps extends BaseProps{constructor(){super();this[$[30]]=this[$[53]]=this[$[75]]=this[$[71]]=this._x=this._y=this[$[48]]=this._anchorX=this._anchorY=this._skewX=this._skewY=0;this[$[73]]=this[$[72]]=1};get x(){return this._x};set x(v){if(this._x!==v){this._x=v;++this[$[1]]}};get y(){return this._y};set y(v){if(this._y!==v){this._y=v;++this[$[1]]}};get rotation(){return this[$[48]]};set rotation(v){if(this[$[48]]!==v){this[$[48]]=v;++this[$[30]]}};get anchorX(){return this._anchorX};set anchorX(v){if(this._anchorX!==v){this._anchorX=v;++this[$[1]]}};get anchorY(){return this._anchorY};set anchorY(v){if(this._anchorY!==v){this._anchorY=v;++this[$[1]]}};get skewX(){return this._skewX};set skewX(v){if(this._skewX!==v){this._skewX=v;++this[$[30]]}};get skewY(){return this._skewY};set skewY(v){if(this._skewY!==v){this._skewY=v;++this[$[30]]}};updateRotation(){if(this[$[53]]<this[$[30]]){this[$[53]]=this[$[30]];++this[$[1]];if(this._skewX===0&&this._skewY===0){this[$[75]]=this[$[71]]=$m.sin(this[$[48]]);this[$[73]]=this[$[72]]=$m.cos(this[$[48]])}else{var b=this[$[48]]-this._skewX;var c=this[$[48]]+this._skewY;this[$[75]]=$m.sin(c);this[$[73]]=$m.cos(c);this[$[71]]=$m.sin(b);this[$[72]]=$m.cos(b)}}}};class ColorProps extends BaseProps{constructor(){super();this.items=[1,1,1,1]};get r(){return this.items[0]};set r(v){if(this.items[0]!==v){this.items[0]=v;++this[$[1]]}};get g(){return this.items[1]};set g(v){if(this.items[1]!==v){this.items[1]=v;++this[$[1]]}};get b(){return this.items[2]};set b(v){if(this.items[2]!==v){this.items[2]=v;++this[$[1]]}};get a(){return this.items[3]};set a(v){if(this.items[3]!==v){this.items[3]=v;++this[$[1]]}};set(r,g,b,a){this.r=r;this.g=g;this.b=b;this.a=a}};class ItemProps extends BasePositioningProps{constructor(){super();this[$[14]]=this[$[68]]=0;this[$[111]]=this[$[97]]=this._scaleX=this._scaleY=this[$[4]]=this[$[3]]=this.alpha=1};get scaleX(){return this._scaleX};set scaleX(v){if(this._scaleX!==v){this._scaleX=v;++this[$[14]]}};get scaleY(){return this._scaleY};set scaleY(v){if(this._scaleY!==v){this._scaleY=v;++this[$[14]]}};get width(){return this[$[4]]};set width(v){if(this[$[4]]!==v){this[$[4]]=v;++this[$[14]]}};get height(){return this[$[3]]};set height(v){if(this[$[3]]!==v){this[$[3]]=v;++this[$[14]]}};updateScale(){if(this[$[68]]<this[$[14]]){this[$[68]]=this[$[14]];++this[$[1]];this[$[111]]=this[$[4]]*this._scaleX;this[$[97]]=this[$[3]]*this._scaleY}}};class LightProps extends ItemProps{constructor(){super();this.z=0};get width(){return this[$[4]]};set width(v){if(this[$[4]]!==v){this[$[4]]=this[$[3]]=v;++this[$[14]]}};get height(){return this[$[3]]};set height(v){}};class TextureCrop extends BaseProps{constructor(){super();this[$[10]]=0;this.items=[0,0,1,1];this[$[4]]=this[$[3]]=1};get x(){return this.items[0]};set x(v){if(this.items[0]!==v){this.items[0]=v;++this[$[1]]}};get y(){return this.items[1]};set y(v){if(this.items[1]!==v){this.items[1]=v;++this[$[1]]}};get width(){return this[$[4]]};set width(v){if(this[$[4]]!==v){this[$[4]]=v;++this[$[1]]}};get height(){return this[$[3]]};set height(v){if(this[$[3]]!==v){this[$[3]]=v;++this[$[1]]}};updateCrop(){if(this[$[10]]<this[$[1]]){this[$[10]]=this[$[1]];this.items[2]=this[$[4]]-this.items[0];this.items[3]=this[$[3]]-this.items[1]}};setRect(b){this.x=b.x;this.y=b.y;this.width=b.width;this.height=b.height}};class TextureProps extends BasePositioningProps{constructor(){super();this._repeatX=this._repeatY=1;this.items=[0,0,0]};get scaledWidth(){return this._repeatX};get scaledHeight(){return this._repeatY};get repeatX(){return this._repeatX};set repeatX(v){if(this._repeatX!==v){this._repeatX=v;++this[$[1]]}};get repeatY(){return this._repeatY};set repeatY(v){if(this._repeatY!==v){this._repeatY=v;++this[$[1]]}};get repeatRandomRotation(){return this.items[0]};set repeatRandomRotation(v){this.items[0]=v};get repeatRandomAlpha(){return this.items[1]};set repeatRandomAlpha(v){this.items[1]=v};get repeatRandomBlur(){return this.items[2]};set repeatRandomBlur(v){this.items[2]=v}};class DistortionProps{constructor(){this.distortTexture=!0;this.items=[0,0,1,0,1,1,0,1]};get topLeftX(){return this.items[0]};set topLeftX(v){this.items[0]=v};get topLeftY(){return this.items[1]};set topLeftY(v){this.items[1]=v};get topRightX(){return this.items[2]};set topRightX(v){this.items[2]=v};get topRightY(){return this.items[3]};set topRightY(v){this.items[3]=v};get bottomRightX(){return this.items[4]};set bottomRightX(v){this.items[4]=v};get bottomRightY(){return this.items[5]};set bottomRightY(v){this.items[5]=v};get bottomLeftX(){return this.items[6]};set bottomLeftX(v){this.items[6]=v};get bottomLeftY(){return this.items[7]};set bottomLeftY(v){this.items[7]=v}};class FilterTextureProps{constructor(d,f,h,j,b,c,g,k){this[$[32]]=d;this.texture=f;this.translateX=h||0;this.translateY=j||0;this.cropX=b||0;this.cropY=c||0;this.cropWidth=g||1;this.cropHeight=k||1};get translateX(){return this[$[32]].v[1]};set translateX(v){this[$[32]].v[1]=v};get translateY(){return this[$[32]].v[2]};set translateY(v){this[$[32]].v[2]=v};get cropX(){return this[$[32]].v[3]};set cropX(v){this[$[32]].v[3]=v};get cropY(){return this[$[32]].v[4]};set cropY(v){this[$[32]].v[4]=v};get cropWidth(){return this[$[32]].v[5]};set cropWidth(v){this[$[32]].v[5]=v};get cropHeight(){return this[$[32]].v[6]};set cropHeight(v){this[$[32]].v[6]=v}};class TextureInfo{constructor(){this.target=3553;this[$[77]]=-1;this[$[60]]=this[$[15]]=this[$[10]]=0;this.wrapS=this.wrapT=33071;this.internalFormat=this.format=6408;this.minFilter=9986;this.magFilter=9728;this[$[4]]=this[$[3]]=1;this.type=5121};get width(){return this[$[4]]};get height(){return this[$[3]]};get wrapS(){return this._wrapS};set wrapS(v){if(this._wrapS!==v){this._wrapS=v;++this[$[15]]}};get wrapT(){return this._wrapT};set wrapT(v){if(this._wrapT!==v){this._wrapT=v;++this[$[15]]}};get internalFormat(){return this[$[76]]};set internalFormat(v){if(this[$[76]]!==v){this[$[76]]=v;++this[$[15]]}};get format(){return this._format};set format(v){if(this._format!==v){this._format=v;++this[$[15]]}};get minFilter(){return this[$[117]]};set minFilter(v){if(this[$[117]]!==v){this[$[117]]=v;++this[$[15]]}};get magFilter(){return this[$[115]]};set magFilter(v){if(this[$[115]]!==v){this[$[115]]=v;++this[$[15]]}};get type(){return this._type};set type(v){if(this._type!==v){this._type=v;++this[$[15]]}};use(b,c,d,f){if(!this._isNeedToDraw(b,c,f)&&(this[$[77]]!==c||d))this.bindActiveTexture(b,c)};useActiveTexture(b,c){this[$[59]](b,c);this[$[69]](b)};useActiveTextureAfterUpdate(b,c){this[$[59]](b,c);this.useTextureAfterUpdate(b)};unbindTexture(b,c){this[$[59]](b,c);this[$[77]]=-1;b[$[110]](this.target,$n)};activeTexture(b,c){this[$[77]]=c;b[$[59]](33984+c)};bindActiveTexture(b,c){this[$[59]](b,c);b[$[110]](this.target,this[$[51]])};useTexture(b){b[$[110]](this.target,this[$[51]]);this.uploadTexture(b)};useTextureAfterUpdate(b){b[$[110]](this.target,this[$[51]]);this[$[133]](b)};uploadTexture(b){b.texImage2D(this.target,0,this[$[76]],this.width,this.height,0,this._format,this._type,this[$[118]]);this[$[133]](b)};uploadTextureInfo(b){b[$[58]](this.target,10242,this._wrapS);b[$[58]](this.target,10243,this._wrapT);b[$[58]](this.target,10241,this[$[117]]);b[$[58]](this.target,10240,this[$[115]]);b[$[58]](this.target,33085,0);b.generateMipmap(this.target)};destruct(){};_isNeedToDraw(){}};class Texture extends TextureInfo{constructor(j,m){super();this[$[42]]=Texture[$[100]];this[$[27]]=this[$[27]].bind(this);this.source=j;this.shouldUpdate=m;this[$[34]]="width";this[$[31]]="height";this[$[22]]=this[$[87]]=this[$[78]]=0;this[$[90]]};get width(){return this._sourceWidth||1};get height(){return this._sourceHeight||1};get source(){return this[$[42]]};set source(f){if(f){this._loaded=!1;this[$[42]][$[33]](this[$[90]],this[$[27]]);this[$[42]]=f?f:Texture[$[100]];this.isVideo=f.tagName?f.tagName.toLowerCase()==="video":!1;this[$[90]]=this.isVideo?"canplay":"load";if(f){this[$[27]]();!this._loaded&&f[$[62]](this[$[90]],this[$[27]])}}};destruct(){this[$[42]][$[33]](this[$[90]],this[$[27]])};_isNeedToDraw(b,c,l){if(this[$[60]]<b.agl_id){this[$[60]]=b.agl_id;this[$[51]]=b.createTexture();this[$[20]](b,c);return!0};if(this[$[10]]<this[$[15]]){this[$[10]]=this[$[15]];this[$[20]](b,c);return!0};if(this[$[78]]<this[$[87]]){this[$[78]]=this[$[87]];this[$[20]](b,c);return!0};if(this.shouldUpdate&&this[$[22]]<l){this[$[22]]=l;this[$[20]](b,c);return!0};if(this.isVideo&&!this[$[42]].paused){this[$[20]](b,c);return!0};return!1};get _sourceWidth(){return this[$[42]][this[$[34]]]};get _sourceHeight(){return this[$[42]][this[$[31]]]};_parseTextureSize(){this[$[34]]="width";this[$[31]]="height";if(this[$[42]].naturalWidth){this[$[34]]="naturalWidth";this[$[31]]="naturalHeight"}else if(this[$[42]].videoWidth){this[$[34]]="videoWidth";this[$[31]]="videoHeight"};this._loaded=this._sourceWidth*this._sourceHeight>0;if(this._loaded){this[$[118]]=this[$[42]];++this[$[87]]}else this[$[118]]=$n}};Texture[$[100]]=$d[$[57]]("img");Texture.loadImage=(d,m)=>{var g=$d[$[57]]("img");var k=new Texture(g,m);g.src=d;return k};Texture.loadVideo=(d,m)=>{var h=$d[$[57]]("video");var k=new Texture(h,m);h.src=d;return k};class Framebuffer extends TextureInfo{constructor(){super();this[$[49]]=this[$[61]]=0};get width(){return this[$[4]]};set width(v){if(this[$[4]]!==v&&v>0){this[$[4]]=v;++this[$[49]]}};get height(){return this[$[3]]};set height(v){if(this[$[3]]!==v&&v>0){this[$[3]]=v;++this[$[49]]}};setSize(w,h){this.width=w;this.height=h};bind(b){b.bindFramebuffer(36160,this._framebuffer)};unbind(b){b.bindFramebuffer(36160,$n)};_isNeedToDraw(b,c){if(this[$[60]]<b.agl_id){this[$[60]]=b.agl_id;this[$[51]]=b.createTexture();this[$[20]](b,c);this._framebuffer=b.createFramebuffer();this.bind(b);b.framebufferTexture2D(36160,36064,3553,this[$[51]],0);this.unbind(b);return!0};if(this[$[10]]<this[$[15]]){this[$[10]]=this[$[15]];this.useActiveTextureAfterUpdate(b,c);return!0};if(this[$[61]]<this[$[49]]){this[$[61]]=this[$[49]];this[$[20]](b,c);return!0};return!1}};var Matrix3={identity:()=>new F32A([1,0,0,1,0,0]),projection:(d,h,z)=>{z[0]=2/d;z[1]=z[2]=0;z[3]=-2/h;z[4]=-1;z[5]=1},transformLocal:(f,z)=>{var k=f.anchorX;var j=f.anchorY;var q=f[$[111]];var r=f[$[97]];z[0]=f[$[73]]*q;z[1]=f[$[75]]*q;z[2]=-f[$[71]]*r;z[3]=f[$[72]]*r;z[4]=f.x-k*z[0]-j*z[2];z[5]=f.y-k*z[1]-j*z[3]},transform:(g,f,z)=>{var x=f.x;var y=f.y;var k=f.anchorX;var j=f.anchorY;var s=f[$[75]];var t=f[$[71]];var v=f[$[73]];var w=f[$[72]];var q=f[$[111]];var r=f[$[97]];z[0]=(v*g[0]+s*g[2])*q;z[1]=(v*g[1]+s*g[3])*q;z[2]=(w*g[2]-t*g[0])*r;z[3]=(w*g[3]-t*g[1])*r;z[4]=-k*z[0]-j*z[2]+x*g[0]+y*g[2]+g[4];z[5]=-k*z[1]-j*z[3]+x*g[1]+y*g[3]+g[5]},inverse:(g,z)=>{var b=1/(g[0]*g[3]-g[2]*g[1]);z[0]=b*g[3];z[1]=-b*g[1];z[2]=-b*g[2];z[3]=b*g[0];z[4]=b*(g[2]*g[5]-g[3]*g[4]);z[5]=-b*(g[0]*g[5]-g[1]*g[4])},isPointInMatrix:(g,c)=>{var x=c.x*g[0]+c.y*g[2]+g[4];var y=c.x*g[1]+c.y*g[3]+g[5];return x>=0&&x<=1&&y>=0&&y<=1},calcCorners:(g,l,n)=>{var m=n.widthHalf;var p=n.heightHalf;l[0].x=m+g[4]*m;l[0].y=n.height-(p+g[5]*p);l[1].x=l[0].x+(g[0]+g[2])*m;l[1].y=l[0].y-(g[1]+g[3])*p;l[2].x=l[0].x+(g[0]+m*g[2]);l[2].y=l[0].y-(g[1]+p*g[3]);l[3].x=l[0].x+(m*g[0]+g[2]);l[3].y=l[0].y-(p*g[1]+g[3])}};var Point={create:(x,y)=>({x:x||0,y:y||0})};var Rect={create:(x,y,c,d)=>({x:x||0,y:y||0,width:c||0,height:d||0}),toRelativeSize:(b,c,d)=>({x:b.x/c,y:b.y/d,width:b.width/c,height:b.height/d})};class BaseItem{constructor(){this[$[12]]=Matrix3.identity();this[$[88]]=this[$[13]]=0;this[$[52]]=[1,1,1,1]};destruct(){}};class Item extends BaseItem{constructor(){super();this.TYPE=Item.TYPE;this.renderable=!0;this.props=new ItemProps();this.color=new ColorProps();this[$[64]]=this[$[26]]=this[$[25]]=this[$[24]]=this[$[5]]=0;this.callback=$ef;this._bounds=Rect.create()};get stage(){return this[$[23]]?this[$[23]].stage:$n};get parent(){return this[$[23]]};set parent(v){if(this[$[23]]!==v){this[$[23]]=v;this[$[25]]=this[$[24]]=this[$[5]]=0}};get callback(){return this._callback};set callback(v){this._callback=v||$ef};getBounds(){return this._bounds};destruct(){this[$[23]]&&this[$[23]][$[112]]&&this[$[23]][$[112]](this);super.destruct()};update(){this[$[95]]()};_updateProps(){var b=this.props;b.updateRotation();b.updateScale();var c=this[$[23]];(this[$[25]]<c[$[13]]||this[$[64]]<b[$[1]])&&this[$[134]](b,c)};_updateTransform(b,c){this[$[25]]=c[$[13]];this[$[64]]=b[$[1]];++this[$[13]];Matrix3.transform(c[$[12]],b,this[$[12]])}};Item.TYPE="item";class BaseDrawable extends Item{constructor(g){super();this[$[82]]=new F32A(6);this[$[93]]=[Point.create(),Point.create(),Point.create(),Point.create()]};getCorners(){this[$[67]]();return this[$[93]]};getBounds(){this[$[67]]();return this._bounds};_calcCorners(){Matrix3.calcCorners(this[$[12]],this[$[93]],this.stage.renderer)};_calcBounds(){this._calcCorners();var h=this[$[93]];var f=this._bounds;var a=h[0];var b=h[1];var c=h[2];var d=h[3];f.x=$m.min(a.x,b.x,c.x,d.x);f.y=$m.min(a.y,b.y,c.y,d.y);f.width=$m.max(a.x,b.x,c.x,d.x);f.height=$m.max(a.y,b.y,c.y,d.y)};_updateAdditionalData(){if(this[$[5]]<this[$[13]]){this[$[5]]=this[$[13]];Matrix3.inverse(this[$[12]],this[$[82]]);this._calcBounds()}}};class Light extends BaseDrawable{constructor(f,n,p){super();this.props=new LightProps();this.color.a=0;this._id=f;this._matId=f*16;this._quadId=this._matId+4;this._octId=this._matId+8;this._datId=this._matId+12;this[$[43]]=n;this[$[7]]=p;this.castShadow=this.shading=!0;this.flattenShadow=!1;this.angle=0;this.spotAngle=180*Utils.THETA;this.type=Light.Type.POINT;this[$[16]]=this.diffuse=1;this.maxShadowStep=128;this.shadeSize=1};get type(){return this[$[7]][this._matId]};set type(v){this[$[7]][this._matId]=v};get castShadow(){return this._castShadow};set castShadow(v){this._castShadow=v;this[$[55]]()};get shading(){return this._shading};set shading(v){this._shading=v;this[$[55]]()};get flattenShadow(){return this[$[113]]};set flattenShadow(v){this[$[113]]=v;this[$[55]]()};get colorProofReflection(){return this[$[65]]};set colorProofReflection(v){this[$[65]]=v;this[$[55]]()};get maxShadowStep(){return this[$[7]][this._quadId]};set maxShadowStep(v){this[$[7]][this._quadId]=v};get shadeSize(){return this[$[7]][this._quadId+1]};set shadeSize(v){this[$[7]][this._quadId+1]=v};get precision(){return this[$[7]][this._matId+3]};set precision(v){this[$[7]][this._matId+3]=$m.max(1,v)};get angle(){return this[$[43]][this._datId+3]};set angle(v){this[$[43]][this._datId+3]=v};get spotAngle(){return this[$[43]][this._matId+7]};set spotAngle(v){this[$[43]][this._matId+7]=v};isOn(){return this.renderable&&this.stage!==$n};update(){var n=this[$[43]];var g=this._datId;if(this.isOn()){this[$[95]]();this._updateColor();n[g]=n[g-1]>0?1:0;n[g+1]=this.diffuse;n[g+2]=this.props.alpha;n[this._matId+6]=this.props.width;this[$[7]][this._matId+2]=this.props.z}else n[g]=0};_updateLightProps(){this[$[7]][this._matId+1]=this._castShadow*1|this._shading*2|this[$[113]]*4|this[$[65]]*8};_updateAdditionalData(){if(this.isOn()&&this[$[5]]<this[$[13]]){this[$[5]]=this[$[13]];this._calcBounds()}};_calcCorners(){Matrix3.calcCorners(this[$[12]],this[$[93]],this.stage.renderer);var m=this[$[93]];var a=m[0];var b=m[1];var c=m[2];var d=m[3];a.x+=(a.x-d.x)+(a.x-c.x);a.y+=(a.y-d.y)+(a.y-c.y);c.x+=(c.x-b.x);c.y+=(c.y-b.y);d.x+=(d.x-b.x);d.y+=(d.y-b.y)};_updateTransform(h,l){super[$[134]](h,l);$as(this[$[43]],this[$[12]],this._matId)};_updateColor(){var j=this.color;if(this[$[26]]<j[$[1]]){this[$[26]]=j[$[1]];var n=this[$[43]];var q=this[$[23]][$[52]];var k=this._octId;n[k]=q[0]*j.r;n[k+1]=q[1]*j.g;n[k+2]=q[2]*j.b;n[k+3]=q[3]*j.a}}};Light.Type={POINT:0,DIRECTIONAL:1};class Image extends BaseDrawable{constructor(d){super();this.TYPE=Image.TYPE;this[$[85]]=Matrix3.identity();this.tintType=Image.TintType.NONE;this.blendMode=BlendMode.NORMAL;this[$[41]]=new TextureProps();this[$[104]]=new TextureCrop();this[$[105]]=new DistortionProps();this[$[44]]=0;this[$[140]]=this[$[104]].items;this[$[102]]=this[$[41]].items;this[$[119]]=this[$[105]].items;this[$[52]]=this.color.items;this.texture=d};update(){this[$[95]]();this._updateTexture();this[$[104]].updateCrop()};isContainsPoint(c){this[$[67]]();return Matrix3.isPointInMatrix(this[$[82]],c)};_updateTexture(){var b=this[$[41]];b.updateRotation();if(this[$[44]]<b[$[1]]){this[$[44]]=b[$[1]];Matrix3.transformLocal(b,this[$[85]])}}};Image.TYPE="drawable";Image.TintType={NONE:0,NORMAL:1,GRAYSCALE:2,OVERRIDE:3,ADD:4};class AnimatedImage extends Image{constructor(c){super(c);this.frameLength=120;this.frames=[];this.frame=this[$[22]]=0;this[$[47]];this.stop()};get isPlaying(){return this[$[47]]===this[$[136]]};gotoAndStop(b){this.stop();this.frame=b;this[$[137]]()};gotoAndPlay(b){this.frame=b;this.play()};stop(){this[$[47]]=$ef};play(){this[$[47]]=this[$[136]]};update(d){super.update();this[$[47]](d)};destruct(){this.stop();super.destruct()};_updateAnimation(d){var f=d-this[$[22]];if(f>this.frameLength){this[$[22]]=d;this.frame+=~~(f/this.frameLength);this.frame>=this.frames.length&&(this.frame=0);this[$[137]]()}};_useTextureFrame(){this[$[104]].setRect(this.frames[this.frame])}};class Container extends Item{constructor(){super();this.TYPE=Container.TYPE;this[$[28]]=[]};destruct(){this.empty();super.destruct()};empty(){while(this[$[28]].length)this.removeChildAt(0)};contains(b){return this[$[122]](b)>-1};addChild(b){this.addChildAt(b,this[$[28]].length)};addChildAt(b,c){if(b){b.parent&&b.parent[$[112]](b);this[$[28]].push(b);this[$[121]](b,c);b.parent=this}};removeChild(b){if(b){$rfa(this[$[28]],b);b.parent=$n}};removeChildAt(c){this[$[112]](this.getChildAt(c))};getChildAt(c){return this[$[28]][c]};setChildIndex(b,c){$rfa(this[$[28]],b);this[$[28]].splice(c,0,b)};getChildIndex(b){return this[$[28]].indexOf(b)};swapChildren(f,g){var l=this[$[122]](f);var m=this[$[122]](g);if(l>-1&&m>-1){this[$[121]](f,m);this[$[121]](g,l)}};getBounds(){var h=this._bounds;h.x=h.y=1/0;h.width=h.height=-1/0;for(var i=0,l=this[$[28]].length;i<l;++i){var n=this[$[28]][i].getBounds();h.x=$m.min(h.x,n.x);h.y=$m.min(h.y,n.y);h.width=$m.max(h.width,n.width);h.height=$m.max(h.height,n.height)};return h};update(){this[$[95]]();this._updateColor()};get premultipliedAlpha(){return this.props.alpha*this[$[23]][$[127]]};_updateColor(){var j=this[$[23]];var d=this.color;if(this[$[24]]<j[$[88]]||this[$[26]]<d[$[1]]){this[$[26]]=d[$[1]];this[$[24]]=j[$[88]];++this[$[88]];var k=this[$[52]];var p=j[$[52]];k[0]=p[0]*d.r;k[1]=p[1]*d.g;k[2]=p[2]*d.b;k[3]=p[3]*d.a}}};Container.TYPE=$[99];class StageContainer extends Container{constructor(b){super();this.renderer=b;this[$[23]]=new BaseItem()};get stage(){return this};get parent(){return this[$[23]]};get premultipliedAlpha(){return this.props.alpha}};class BaseRenderer{constructor(f){this[$[101]]=this[$[126]];this[$[36]]=this[$[45]];this[$[21]]=$ef;this[$[35]]=new ColorProps();this[$[91]]=this[$[17]]=0;this._options=f;this[$[46]]=this._options[$[2]];this[$[6]]=this[$[46]][$[6]];this[$[46]][$[9]]=this[$[46]][$[9]].concat(["uFlpY","aPos","uTex"]);this[$[11]]=!1;this[$[84]]=new Buffer("",new Uint16Array([0,1,3,2]),0,0,34963,35044);this[$[103]]=new Buffer("aPos",new F32A([0,0,1,0,1,1,0,1]),1,2,34962,35044,0)};get width(){return this[$[4]]};set width(v){this[$[4]]=v};get height(){return this[$[3]]};set height(v){this[$[3]]=v};get clearBeforeRender(){return this[$[21]]===this._clear};set clearBeforeRender(v){this[$[21]]=v?this._clear:$ef};setSize(b,d){this.width=b;this.height=d};renderToFramebuffer(g){if(!this[$[6]].isLost()){this[$[135]]();this[$[36]](g);this._renderBatch(g);g.unbind(this._gl)}};render(){if(!this[$[6]].isLost()){this[$[135]]();this._gl.uniform1f(this[$[0]].uFlpY,1);this[$[21]]();this._renderBatch()}};_renderBatch(g){this[$[17]]=Date.now();this._render(g);this._gl.flush()};_switchToProgram(){this._gl=this[$[6]].gl;if(this[$[91]]<this[$[6]].contextId){this[$[91]]=this[$[6]].contextId;this._buildProgram();this[$[11]]=!0}else if(this[$[6]][$[114]](this._program,this._vao))this[$[11]]=!0;this._resize()};_attachFramebuffer(g){g.bind(this._gl);g.setSize(this[$[4]],this[$[3]]);this[$[6]][$[69]](g,this[$[17]]);this[$[6]][$[128]](g);this._gl.uniform1f(this[$[0]].uFlpY,-1)};_attachFramebufferAndClear(g){this[$[126]](g);this[$[21]]()};_clear(){this._gl[$[35]](this[$[35]].r,this[$[35]].g,this[$[35]].b,this[$[35]].a);this._gl.clear(16384)};_resize(){this.widthHalf=this[$[4]]*.5;this.heightHalf=this[$[3]]*.5;this[$[6]].setSize(this[$[4]],this[$[3]])};_drawInstanced(c){this._gl.drawElementsInstanced(5,4,5123,0,c)};_buildProgram(){var f=this._options;this._program=Utils.createProgram(this._gl,this._createVertexShader(f),this._createFragmentShader(f));this[$[0]]=Utils.getLocationsFor(this._gl,this._program,this[$[46]][$[9]]);this._vao=this._gl.createVertexArray();this[$[6]][$[114]](this._program,this._vao);this[$[80]]()};_uploadBuffers(){this[$[103]].upload(this._gl,this[$[11]]);this[$[84]].upload(this._gl);this[$[11]]=!1};_createBuffers(){this[$[84]].create(this._gl,this[$[0]]);this[$[103]].create(this._gl,this[$[0]])}};class BatchRenderer extends BaseRenderer{constructor(b){b[$[2]][$[9]]=b[$[2]][$[9]].concat(["aMt"]);super(b);this[$[98]]=b[$[86]]||1;this[$[37]]=new Buffer("aMt",this[$[98]],4,4)};_uploadBuffers(){this[$[37]].upload(this._gl,this[$[11]]);super[$[19]]()};_createBuffers(){super[$[80]]();this[$[37]].create(this._gl,this[$[0]])}};class FilterRenderer extends BaseRenderer{constructor(h){h=h||{};h[$[2]]=Utils[$[40]](h[$[2]]);h[$[2]][$[9]]=h[$[2]][$[9]].concat(["uFTex","uFtrT","uFtrV","uFtrK"]);super(h);this[$[101]]=this[$[36]]=$ef;this.filters=h.filters||[];this.texture=h.texture;this._framebuffers=[new Framebuffer(),new Framebuffer()]};_render(q){var j=this[$[6]];var b=this._gl;var p=this[$[17]];var m=this[$[0]];j[$[74]](BlendMode.NORMAL);this[$[19]]();j[$[96]](this.texture,0,p,!0);b.uniform1i(m.uTex,0);var l=this.filters.length||1;var c=l-2;for(var i=0;i<l;++i){var s;var f=this.filters[i];var n=f&&f.on;var g=i>c;var r=n&&f[$[41]]&&f[$[41]].texture;if(r){j[$[96]](r,1,p,!0);b.uniform1i(m.uFTex,1)};if(g)q?this[$[45]](q):b.uniform1f(m.uFlpY,1);else if(n){s=this._framebuffers[i&1];this[$[45]](s)};if(n){b.uniform1fv(m.uFtrV,f.v);b.uniformMatrix4fv(m.uFtrK,!1,f.kernels);b.uniform2i(m.uFtrT,f.TYPE,f.SUB_TYPE)};(n||g)&&this[$[54]](1);r&&j[$[128]](r);if(s){s.unbind(b);j[$[96]](s,0,p,!0)}}};_createVertexShader(h){return Utils[$[8]](h[$[2]][$[16]])+"in vec2 aPos;uniform float uFlpY;out vec2 vUv,vTUv;void main(void){gl_Position=vec4(aPos*2.-1.,1,1);vUv=gl_Position.xy;gl_Position.y*=uFlpY;vTUv=vec2(aPos.x,1.-aPos.y);}"};_createFragmentShader(h){var k=(d)=>"for(oft.x=-2.;oft.x<3.;++oft.x)for(oft.y=-2.;oft.y<3.;++oft.y)if(oft.x!=0.&&oft.y!=0.){poft=clamp(f+ivec2(floor(wh*oft)),P.xx,ts-1);clg=texelFetch(uTex,poft,0);"+d+"}pcl=cl/c;";return Utils[$[8]](h[$[2]][$[16]])+"#define P ivec2(0,1)\nuniform sampler2D uTex,uFTex;uniform ivec2 uFtrT;uniform float uFtrV[9];uniform mat4 uFtrK;in vec2 vUv,vTUv;out vec4 oCl;void main(void){oCl=texture(uTex,vTUv);if(uFtrT.x>0){float vl[]=uFtrV,v=vl[0];ivec2 ts=textureSize(uTex,0),f=ivec2(floor(vTUv*vec2(ts)));vec2 vol=v*(1./vec2(ts));vec3 rgb=vec3(vl[2],vl[3],vl[4]);mat4 kr=uFtrK;if(uFtrT.x<2){kr*=v;oCl=vec4((texelFetch(uTex,f-ivec2(1),0)*kr[0].x+texelFetch(uTex,f+ivec2(0,-1),0)*kr[0].y+texelFetch(uTex,f+ivec2(1,-1),0)*kr[0].z+texelFetch(uTex,f+ivec2(-1,0),0)*kr[0].w+oCl*kr[1].x+texelFetch(uTex,f+ivec2(1,0),0)*kr[1].y+texelFetch(uTex,f+ivec2(-1,1),0)*kr[1].z+texelFetch(uTex,f+ivec2(0,1),0)*kr[1].w+texelFetch(uTex,f+ivec2(1),0)*kr[2].x).rgb,oCl.a);}else if(uFtrT.x<3)oCl.rgb=vec3(kr[0].r*oCl.r+kr[0].g*oCl.g+kr[0].b*oCl.b+kr[0].a,kr[1].r*oCl.r+kr[1].g*oCl.g+kr[1].b*oCl.b+kr[1].a,kr[2].r*oCl.r+kr[2].g*oCl.g+kr[2].b*oCl.b+kr[2].a);else if(uFtrT.x<4){vec4 oClVl=oCl*(1.-v);if(uFtrT.y<2)oCl=oClVl+vec4(vec3((oCl.r+oCl.g+oCl.b)/3.),oCl.a)*v;else if(uFtrT.y<3)oCl=oClVl+vec4(vec3(.874,.514,.156)*((oCl.r+oCl.g+oCl.b)/3.),oCl.a)*v;else if(uFtrT.y<4)oCl=oClVl+vec4(1.-oCl.rgb,oCl.a)*v;else if(uFtrT.y<5)oCl.rgb*=rgb*v;else if(uFtrT.y<6)oCl=vec4((round((oCl.rgb*256.)/v)/256.)*v,oCl.a);else if(uFtrT.y<7){vec2 pv=pow(abs(vUv*v),vec2(vl[1]));float cv=clamp((1.-length(pv))*vl[5],0.,1.);oCl.rgb=oCl.rgb*cv+rgb*(1.-cv);}else if(uFtrT.y<8)oCl.rgb+=vec3(vUv.xy*.15,(vUv.x*vUv.y)*.15)*v;else if(uFtrT.y<9)oCl.rgb=vec3((oCl.rgb-.5)*vl[1]+.5+v);else if(uFtrT.y<10)oCl.rgb=pow(oCl.rgb,vec3(v));}else if(uFtrT.x<5){vec2 oft,wh=vec2(v,vl[1]);ivec2 poft;vec4 pcl,clg,cl=oCl;float c=1.;if(uFtrT.y<2){float l=length(vec2(2)),im;"+k("im=1.-(length(oft)/l)*.9;cl+=clg*im;c+=im;")+"float dst=vl[2]<1.?1.:clamp(distance(vec2(vl[3],vl[4]),vTUv)*vl[5],0.,1.);oCl=dst*pcl+(1.-dst)*oCl;}else{float omx=max(oCl.r,max(oCl.g,oCl.b));"+k("if(abs(max(clg.r,max(clg.g,clg.b))-omx)>.3)cl+=clg;c++;")+"oCl+=pcl;}}else if(uFtrT.x<6)oCl=texture(uTex,floor(vTUv/vol)*vol);else if(uFtrT.x<8){vec4 mskCl=texture(uFTex,mod(vec2(vl[1],vl[2])+vTUv,1.)*vec2(vl[5]-vl[3],vl[6]-vl[4]));if(uFtrT.x<7)oCl=texture(uTex,vTUv+(vec2(1,-1)*(mskCl.rg-.5)*2.*vol));else if(uFtrT.x<8)oCl.a*=v<4.?mskCl[int(v)]:(mskCl.r+mskCl.g+mskCl.b+mskCl.a)/4.;}else if(uFtrT.x<9){vec4 pcl=vec4(texture(uFTex,vTUv-vec2(vol.x,0)).r,texture(uFTex,vTUv+vec2(0,vol.y)).g,texture(uFTex,vTUv+vec2(vol.x,0)).b,1);float dst=vl[2]<1.?1.:clamp(distance(vec2(vl[3],vl[4]),vTUv)*vl[5],0.,1.);oCl=dst*pcl+(1.-dst)*oCl;}}}"}};class NormalMapRenderer extends BaseRenderer{constructor(b){b=b||{};b[$[2]]=Utils[$[40]](b[$[2]]);super(b);this[$[94]]=!0;this[$[35]].set(0,0,0,1);this[$[18]]=b[$[18]]};_render(){this[$[6]][$[74]](BlendMode.NORMAL);this._gl.uniform1i(this[$[0]].uTex,this[$[6]][$[69]](this[$[18]],this[$[17]],!0));this[$[19]]();this[$[54]](1)};_createVertexShader(b){return Utils[$[8]](b[$[2]][$[16]])+"in vec2 aPos;uniform float uFlpY;out vec2 vTUv;void main(void){gl_Position=vec4(aPos*2.-1.,1,1);vTUv=vec2(aPos.x,1.-aPos.y);gl_Position.y*=uFlpY;}"};_createFragmentShader(b){return Utils[$[8]](b[$[2]][$[16]])+"#define H 256.\nin vec2 vTUv;uniform sampler2D uTex;out vec4 oCl;void main(void){vec2 its=vec2(textureSize(uTex,0)),ts=1./its,p0=floor(vTUv*its),p1=p0+vec2(1,0),p2=p0+vec2(0,1);vec3 A=vec3(p0,texture(uTex,p0*ts).g*H),B=vec3(p1,texture(uTex,p1*ts).g*H),C=vec3(p2,texture(uTex,p2*ts).g*H),nm=normalize(cross(B-A,C-A));nm.y*=-1.;oCl=vec4(nm*.5+.5,1);}"}};class AmbientOcclusionMapRenderer extends BaseRenderer{constructor(b){b=b||{};b[$[2]]=Utils[$[40]](b[$[2]]);b[$[2]][$[9]]=b[$[2]][$[9]].concat(["uM","uDM"]);super(b);this[$[94]]=!0;this[$[35]].set(0,0,0,1);this[$[18]]=b[$[18]];this.multiplier=10;this.depthMultiplier=2};_render(){this[$[6]][$[74]](BlendMode.NORMAL);this._gl.uniform1i(this[$[0]].uTex,this[$[6]][$[69]](this[$[18]],this[$[17]],!0));this._gl.uniform1f(this[$[0]].uM,this.multiplier);this._gl.uniform1f(this[$[0]].uDM,this.depthMultiplier);this[$[19]]();this[$[54]](1)};_createVertexShader(b){return Utils[$[8]](b[$[2]][$[16]])+"in vec2 aPos;uniform float uFlpY;out vec2 vTUv;void main(void){gl_Position=vec4(aPos*2.-1.,1,1);vTUv=vec2(aPos.x,1.-aPos.y);gl_Position.y*=uFlpY;}"};_createFragmentShader(b){return Utils[$[8]](b[$[2]][$[16]])+"#define H 255.\nin vec2 vTUv;uniform sampler2D uTex;uniform float uFlpY,uM,uDM;out vec4 oCl;void main(void){vec2 its=vec2(textureSize(uTex,0)),ts=1./its,f=floor(vTUv*its),p;float tx=texture(uTex,f*ts).g,v=0.,z,h;for(p.x=-2.;p.x<3.;++p.x)for(p.y=-2.;p.y<3.;++p.y)if(p.x!=0.&&p.y!=0.){h=texture(uTex,(f+p*2.)*ts).g;z=clamp(h-tx,0.,1.);v+=z*uM*(3./length(vec2(p)));}v/=24.;oCl=vec4(vec3(((1.-uDM)*.5+tx*uDM))+(1.-max(0.,v)),1);}"}};class LightRenderer extends BatchRenderer{constructor(f){f=f||{};f[$[2]]=Utils[$[40]](f[$[2]]);f[$[2]][$[9]]=f[$[2]][$[9]].concat(["uNMTex","uSITex","aExt","uTS","uUSIT"]);var h=f[$[86]]=f.lightNum||1;super(f);this[$[94]]=!0;this[$[35]].set(0,0,0,1);this[$[109]]=f[$[109]];this.normalMap=f.normalMap;this[$[18]]=f[$[18]];this[$[63]]=new Buffer("aExt",h,4,4);this._lights=[];for(var i=0;i<h;++i)this._lights.push(new Light(i,this[$[37]].data,this[$[63]].data))};getLight(b){return this._lights[b]};_useTexture(j,g){this._gl.uniform1i(g,this[$[6]][$[69]](j,this[$[17]],!0))};_render(){this[$[6]][$[74]](BlendMode.ADD);var c=this[$[4]];var d=this[$[3]];if(this[$[109]]){this._useTexture(this[$[109]],this[$[0]].uSITex);this._gl.uniform1f(this[$[0]].uUSIT,1)}else this._gl.uniform1f(this[$[0]].uUSIT,0);this.normalMap&&this._useTexture(this.normalMap,this[$[0]].uNMTex);if(this[$[18]]){this._useTexture(this[$[18]],this[$[0]].uTex);c=this[$[18]].width;d=this[$[18]].height};this._gl.uniform2f(this[$[0]].uTS,c,d);this[$[19]]();this[$[54]](this._lights.length)};_uploadBuffers(){this[$[63]].upload(this._gl,this[$[11]]);super[$[19]]()};_createBuffers(){super[$[80]]();this[$[63]].create(this._gl,this[$[0]])};_createVertexShader(f){return Utils[$[8]](f[$[2]][$[16]])+"#define H vec4(1,-1,2,-2)\n#define PI radians(180.)\nin vec2 aPos;in mat4 aExt,aMt;uniform float uFlpY;out float vHS,vD,vSpt;out vec2 vTUv,vSln;out vec4 vUv,vCl,vDt;out mat4 vExt;void main(void){vec3 pos=vec3(aPos*2.-1.,1);vExt=aExt;vCl=aMt[2];vDt=aMt[3];vUv.xy=pos.xy;vHS=vExt[0].z;mat3 mt=mat3(aMt[0].xy,0,aMt[0].zw,0,aMt[1].xy,1);vD=aMt[1].z;if(vExt[0].x<1.){gl_Position=vec4(mt*pos,1);vTUv=(gl_Position.xy+H.xy)/H.zw;vUv.zw=(aMt[1].xy+H.xy)/H.zw;vSpt=PI-aMt[1].w;vSln=vec2(sin(vDt.w),cos(vDt.w));}else{mt[2].xy=vec2(-1,1);gl_Position=vec4(pos,1);vTUv=vec2(aPos.x,1.-aPos.y);vUv.zw=vTUv+((mt*vec3(1)).xy+H.xy)/H.zw;}gl_Position.y*=uFlpY;}"};_createFragmentShader(f){return Utils[$[8]](f[$[2]][$[16]])+"#define H 256.\n#define PI radians(180.)\n#define PIH radians(90.)\nin float vHS,vD,vSpt;in vec2 vTUv,vSln;in vec4 vUv,vCl,vDt;in mat4 vExt;uniform sampler2D uNMTex,uSITex,uTex;uniform float uUSIT;uniform vec2 uTS;out vec4 oCl;void main(void){oCl=vec4(0);if(vDt.x>0.){bool isl=vExt[0].x<1.;vec4 tc=texture(uTex,vTUv);float ph=tc.g*H,shn=tc.b;vec2 tUv=vTUv*uTS,tCnt=vUv.zw*uTS;vec3 sf=vec3(tUv,ph),lp=vec3(tCnt,vHS),sftla=lp-sf;float dst=1.-length(sftla)/vD,vol=vDt.z*vCl.a,spc=0.;if(isl){vol*=dst;if(vol<=0.)discard;float slh=(vHS-ph)/H;vec2 sl=vec2(slh*vSln.y-vUv.x*vSln.x,slh*vSln.x+vUv.x*vSln.y);if((atan(sl.x,length(vec2(sl.y,vUv.y)))+PIH)-vSpt<0.)discard;}int flg=int(vExt[0].y);float fltDst=distance(tCnt,tUv),shdw=1.;if((flg&2)>0){vec3 nm=normalize((texture(uNMTex,vTUv).rgb*2.-1.)*vec3(1,-1,1)),sftl=normalize(sftla),sftv=normalize(vec3(uTS*.5,H)-sf),hlf=normalize(sftl+sftv);vol*=dot(nm,sftl);if(vol<=0.)discard;if(isl)spc=pow(dot(nm,hlf),shn+H)*vExt[1].y;}if((flg&1)>0){vec2 p,opd=(tUv-tCnt)/fltDst,opdm=opd/uTS;float shl=vD/vDt.y,st=ceil(max(1.,max(fltDst/vExt[1].x,vExt[0].w))),hst=(ph-vHS)/fltDst,l=fltDst-st,m=max(st,l-shl),i,pc,opdL=length(opd);for(i=l;i>m;i-=st){p=vUv.zw+i*opdm;pc=vHS+i*hst;tc=texture(uTex,p)*H;if((flg&4)>0&&tc.g>=pc||tc.r<=pc&&tc.g>=pc){shdw*=(fltDst-i*opdL)/shl;if(shdw<=0.)discard;}}}vec3 stCl=uUSIT<1.?vec3(1):texture(uSITex,vTUv).rgb,rCl=(flg&8)>0?vCl.rgb:vec3(1);oCl=vec4((stCl*vCl.rgb+rCl*spc)*shdw*vol,1);}}"}};class Stage2D extends BatchRenderer{constructor(h){h={...{useTint:!0},...(h||{})};h[$[2]]=Utils[$[40]](h[$[2]]);h[$[2]][$[9]]=h[$[2]][$[9]].concat(["aDt","aDst","uWCl","uWA"]);var n=h[$[86]]=h[$[86]]||1e4;super(h);this[$[99]]=new StageContainer(this);this[$[38]]=0;this["_draw"+Item.TYPE]=$ef;this["_draw"+Image.TYPE]=this._drawImage.bind(this);this["_draw"+Container.TYPE]=this._drawContainer.bind(this);this[$[66]]=this[$[66]].bind(this);this._drawItem=this._drawItem.bind(this);this[$[108]]=Point.create();this[$[29]]=new Buffer("aDt",n,3,4);this[$[56]]=new Buffer("aDst",n,4,2)};render(){this.picked=$n;super.render();this[$[124]]=!1};setPickerPoint(f){this[$[124]]=!0;this[$[108]].x=(f.x-this.widthHalf)*this[$[12]][0];this[$[108]].y=(f.y-this.heightHalf)*this[$[12]][4]};_render(){this._drawItem(this[$[99]]);this[$[66]]()};_drawItem(b){b.update(this[$[17]]);b.callback(b,this[$[17]]);b.renderable&&this["_draw"+b.TYPE](b)};_drawContainer(l){this._gl.uniform4fv(this[$[0]].uWCl,l[$[52]]);this._gl.uniform1f(this[$[0]].uWA,l[$[127]]);var k=l[$[28]];for(var i=0,l=k.length;i<l;++i)this._drawItem(k[i])};_drawImage(b){this[$[6]][$[74]](b.blendMode,this[$[66]]);if(this[$[124]]&&b.interactive&&b.isContainsPoint(this[$[108]]))this.picked=b;var c=this[$[38]]*12;var g=this[$[38]]*16;$as(this[$[29]].data,b[$[52]],c);$as(this[$[29]].data,b[$[102]],c+8);this[$[29]].data[c+4]=b.props.alpha;this[$[29]].data[c+5]=b.tintType;this[$[29]].data[c+6]=this[$[6]][$[69]](b.texture,this[$[17]],!1,this[$[66]]);this[$[29]].data[c+7]=b[$[105]].distortTexture;$as(this[$[37]].data,b[$[12]],g);$as(this[$[37]].data,b[$[85]],g+6);$as(this[$[37]].data,b[$[140]],g+12);$as(this[$[56]].data,b[$[119]],this[$[38]]*8);++this[$[38]]===this[$[98]]&&this[$[66]]()};_batchDraw(){if(this[$[38]]>0){this[$[19]]();this._gl.uniform1iv(this[$[0]].uTex,this[$[6]][$[89]]);this[$[54]](this[$[38]]);this[$[38]]=0}};_resize(){super._resize();Matrix3.projection(this[$[4]],this[$[3]],this[$[99]].parent[$[12]]);++this[$[99]].parent[$[13]]};_uploadBuffers(){this[$[29]].upload(this._gl,this[$[11]]);this[$[56]].upload(this._gl,this[$[11]]);super[$[19]]()};_createBuffers(){super[$[80]]();this[$[29]].create(this._gl,this[$[0]]);this[$[56]].create(this._gl,this[$[0]])};_createVertexShader(h){var p=h[$[130]];return Utils[$[8]](h[$[2]][$[16]])+"in vec2 aPos;in mat4x2 aDst;in mat3x4 aDt;in mat4 aMt;uniform float uFlpY,uWA;uniform vec4 uWCl;out float vACl,vTId,vTTp;out vec2 vTUv;out vec4 vTCrop"+(p?",vRR;":";")+"out mat2x4 vCl;vec2 clcQd(vec2 p){return vec2(mix(mix(aDst[0].x,aDst[1].x,p.x),mix(aDst[3].x,aDst[2].x,p.x),p.y),mix(mix(aDst[0].y,aDst[3].y,p.y),mix(aDst[1].y,aDst[2].y,p.y),p.x));}void main(void){mat3 mt=mat3(aMt[0].xy,0,aMt[0].zw,0,aMt[1].xy,1),tMt=mat3(aMt[1].zw,0,aMt[2].xy,0,aMt[2].zw,1);vec3 tPos=vec3(clcQd(aPos),1);gl_Position=vec4(mt*tPos,1);gl_Position.y*=uFlpY;float dt=aDt[1].w;vTUv=(tMt*((dt*vec3(aPos,1))+((1.-dt)*tPos))).xy;vTCrop=aMt[3];vCl=mat2x4(uWCl,aDt[0].rgb*aDt[0].a,1.-aDt[0].a);vACl=uWA*aDt[1].x;vTTp=aDt[1].y;vTId=aDt[1].z;"+(p?"vRR=aDt[2].xyzw;vRR.w=vRR.x+vRR.y;":"")+"}"};_createFragmentShader(h){var r=Utils.INFO[$[79]];var p=h[$[130]];var j=h.useTint;var s=(r)=>{var d="vec4 gtTexCl(float i,vec2 c){";for(var i=0;i<r;++i)d+="if(i<"+(i+1)+".)return texture(uTex["+i+"],c);";d+="return vec4(1);}";return d};var q=(m)=>"gtTexCl(vTId,vTCrop.xy+vTCrop.zw*"+m+")";return Utils[$[8]](h[$[2]][$[16]])+"#define PI radians(180.)\nin float vACl,vTId,vTTp;in vec2 vTUv;in vec4 vTCrop"+(p?",vRR;":";")+"in mat2x4 vCl;uniform sampler2D uTex["+r+"];out vec4 oCl;"+s(r)+"float cosine(float a,float b,float v){v=abs(v);v=v<.5?2.*v*v:1.-pow(-2.*v+2.,2.)/2.;return a*(1.-v)+b*v;}"+(p?Utils.GLSL.RANDOM+"vec4 gtClBUv(vec2 st){vec2 uv=vTUv;float rnd=rand(floor(uv+st)),rndDg=rnd*360.*vRR.x;if(rndDg>0.){vec2 rt=vec2(sin(rndDg),cos(rndDg));uv=vec2(uv.x*rt.y-uv.y*rt.x,uv.x*rt.x+uv.y*rt.y);}return "+q("mod(uv,vec2(1))")+";}float gtRClBUv(vec2 st,vec2 uv){float rnd=rand(floor(vTUv+st));return (1.-(2.*rnd-1.)*vRR.y)*cosine(0.,1.,1.-st.x-uv.x)*cosine(0.,1.,1.-st.y-uv.y);}":"")+"void main(void){if(vTId>-1.){vec2 uv=mod(vTUv,vec2(1));"+(p?"if(vRR.w>0.){vec2 zr=vec2(0,1);float rca,rcb,rcc,rcd;if(vRR.y+vRR.z>0.){rca=gtRClBUv(zr.xx,uv);rcb=gtRClBUv(zr.yx,uv);rcc=gtRClBUv(zr.xy,uv);rcd=gtRClBUv(zr.yy,uv);}oCl=vRR.z>0.?clamp(gtClBUv(zr.xx)*rca+gtClBUv(zr.yx)*rcb+gtClBUv(zr.xy)*rcc+gtClBUv(zr.yy)*rcd,0.,1.):gtClBUv(zr);if(vRR.y>0.)oCl.a=clamp(oCl.a*(rca+rcb+rcc+rcd),0.,1.);}else oCl="+q("uv")+";":"oCl="+q("uv")+";")+"}else oCl+=1.;oCl.a*=vACl;if(oCl.a<=0.)discard;"+(j?"if(vTTp>0.){vec3 cl=vCl[1].rgb+oCl.rgb*vCl[1].a;if(vTTp==1.||(vTTp==2.&&oCl.r==oCl.g&&oCl.r==oCl.b))oCl.rgb*=cl+oCl.rgb*vCl[1].a;else if(vTTp==3.)oCl.rgb=cl;else if(vTTp==4.)oCl.rgb+=cl;}":"")+"oCl*=vCl[0];}"}};class BaseFilter{constructor(b,c,d){this.TYPE=b;this.SUB_TYPE=c;this.on=!0;this.v=new F32A(9);this.kernels=new F32A(16);this.intensity=d||0};get intensity(){return this.v[0]};set intensity(v){this.v[0]=v};get intensityX(){return this.v[0]};set intensityX(v){this.v[0]=v};get intensityY(){return this.v[1]};set intensityY(v){this.v[1]=v};get r(){return this.v[2]};set r(v){this.v[2]=v};get g(){return this.v[3]};set g(v){this.v[3]=v};get b(){return this.v[4]};set b(v){this.v[4]=v}};class DisplacementFilter extends BaseFilter{constructor(d,f,h,j,b,c,g,k){super(6,0,f);this[$[41]]=new FilterTextureProps(this,d,h,j,b,c,g,k)}};class MaskFilter extends BaseFilter{constructor(f,b,h,j,c,d,g,k){super(7,0,b);this[$[41]]=new FilterTextureProps(this,f,h,j,c,d,g,k)};get type(){return this.v[0]};set type(v){this.v[0]=v}};MaskFilter.Type={RED:0,GREEN:1,BLUE:2,ALPHA:3,AVG:4};class PixelateFilter extends BaseFilter{constructor(b){super(5,0,b)}};class EdgeDetectFilter extends BaseFilter{constructor(b){super(1,0,b);$as(this.kernels,[-1,-1,-1,-1,8,-1,-1,-1,-1],0)}};class SharpenFilter extends BaseFilter{constructor(b){super(1,0,b);$as(this.kernels,[-1,-1,-1,-1,16,-1,-1,-1,-1],0)}};class SaturateFilter extends BaseFilter{constructor(b){super(2,0,b)};set intensity(v){this.v[0]=v;var x=(v*2/3)+1;var y=((x-1)*-.5);$as(this.kernels,[x,y,y,0,y,x,y,0,y,y,x,0],0)}};class GrayscaleFilter extends BaseFilter{constructor(b){super(3,1,b)}};class SepiaFilter extends BaseFilter{constructor(b){super(3,2,b)}};class InvertFilter extends BaseFilter{constructor(b){super(3,3,b)}};class TintFilter extends BaseFilter{constructor(c,r,g,b){super(3,4,c);this.r=r;this.g=g;this.b=b}};class ColorLimitFilter extends BaseFilter{constructor(b){super(3,5,b)}};class VignetteFilter extends BaseFilter{constructor(c,d,f,r,g,b){super(3,6,c);this.roundness=d;this.transition=f;this.r=r;this.g=g;this.b=b};get roundness(){return this.v[1]};set roundness(v){this.v[1]=v};get transition(){return 1/this.v[5]};set transition(v){this.v[5]=1/v}};class RainbowFilter extends BaseFilter{constructor(b){super(3,7,b)}};class BrightnessContrastFilter extends BaseFilter{constructor(c,b){super(3,8,c);this.contrast=b};get brightness(){return this.v[0]};set brightness(v){this.v[0]=v};get contrast(){return this.v[1]};set contrast(v){this.v[1]=v}};class GammaFilter extends BaseFilter{constructor(b){super(3,9,b)}};class BlurFilter extends BaseFilter{constructor(f,g,h,c,d,b){super(4,1,f);this.intensityY=g;this.isRadialBlur=h||!1;this.centerX=c||0;this.centerY=d||0;this.size=b||1};get isRadialBlur(){return this.v[2]===1};set isRadialBlur(v){this.v[2]=v?1:0};get centerX(){return this.v[3]};set centerX(v){this.v[3]=v};get centerY(){return this.v[4]};set centerY(v){this.v[4]=v};get size(){return this.v[5]};set size(v){this.v[5]=v}};class GlowFilter extends BaseFilter{constructor(b,c){super(4,2,b);this.intensityY=c}};class ChromaticAberrationFilter extends BaseFilter{constructor(g,f,c,d,b){super(8,0,g);this.isRadial=f||!1;this.centerX=c||0;this.centerY=d||0;this.size=b||1};get isRadial(){return this.v[2]===1};set isRadial(v){this.v[2]=v?1:0};get centerX(){return this.v[3]};set centerX(v){this.v[3]=v};get centerY(){return this.v[4]};set centerY(v){this.v[4]=v};get size(){return this.v[5]};set size(v){this.v[5]=v}};console.log("PWGL.JS (AGL) 1.0.4 230324065639");window.PWGL=window.AGL={BlendMode,BaseProps,BasePositioningProps,ColorProps,ItemProps,LightProps,TextureCrop,TextureProps,DistortionProps,FilterTextureProps,TextureInfo,Texture,Framebuffer,Context,Buffer,Utils,Const,FPS,Matrix3,Point,Rect,BaseItem,Item,BaseDrawable,Light,AnimatedImage,Container,StageContainer,Image,BaseRenderer,BatchRenderer,FilterRenderer,NormalMapRenderer,AmbientOcclusionMapRenderer,LightRenderer,Stage2D,BaseFilter,DisplacementFilter,MaskFilter,PixelateFilter,EdgeDetectFilter,SharpenFilter,SaturateFilter,GrayscaleFilter,SepiaFilter,InvertFilter,TintFilter,ColorLimitFilter,VignetteFilter,RainbowFilter,BrightnessContrastFilter,GammaFilter,BlurFilter,GlowFilter,ChromaticAberrationFilter};}).call({});