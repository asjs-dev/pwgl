(()=>{var $="customData,RENDERING_TYPE,context,height,$transformUpdated,repeatRandomCache,length,sourceTexture,$updated,$locations,$updateScaleFv,$uploadBuffers,transformUpdated,matrixCache,$MAX_RENDER_COUNT,children,$height,$renderTime,initRendererConfig,setLocations,transform,heightMap,addEventListener,texParameteri,maxTextureImageUnits,$attachFramebufferAndClear,canvas,removeEventListener,$drawInstanced,createElement,$currentAglId,activeTexture,$matrixBuffer,$useTextureAt,useActiveTexture,callEventHandler,textureIds,updateSize,colorCache,getPremultipliedAlpha,textureSizes,cosRotationA,cosRotationB,sinRotationA,sinRotationB,scaledHeight,$updateScale,setBlendMode,scaledWidth,measureText,$createBuffers,textureMatrixCache,colorUpdated,textureTransform,textureRepeatRandomCache,interactive,bindTexture,textureCrop,RADIANS_360,$useTexture,depthMultiplier,getPremultipliedUseTint,useTexture,heightHalf,clearColor,webglcontextrestored,$renderSource,clearTextures,getChildIndex,setChildIndex,callbackBeforeRender,container,locations,widthHalf,uniform1f,uniform2f,intensity,getProgramParameter,callbackAfterRender,useTextureAt,roughnessMap,frameLength,$createGLSL,contextAttributes,isWebGl2Supported,uploadTextureInfo,webglcontextlost,bindActiveTexture,deactivateTexture,useRepeatTextures,getShaderInfoLog,specularStrength,textureCropCache,getContext,useProgram,distortion,multiplier,bindVertexArray,bindFramebuffer,distortionCache".split(",");let F32=Float32Array,U16=Uint16Array,$m=Math,$d=document,$n=null;let _1s={a:"Attrib",u:"Uniform"};let _1r=(b,p,n)=>{let g=b.createShader(n);b.shaderSource(g,p);b.compileShader(g);return g};let _1h=$m.PI/180;let Utils={ALPHA:90*_1h,THETA:_1h,GLSL:{VERSION:"#version 300 es\n",DEFINE:{RADIANS_360:"#define RADIANS_360 radians(360.)\n",HEIGHT:"#define HEIGHT 255.\n",Z:"#define Z vec3(0,1,-1)\n",PI:`#define PI ${$m.PI}\n`},RANDOM:"float rand(vec2 p,float s){p=mod(p,vec2(1e4));return fract(sin((p.x*12.9898+p.y*78.233)*s)*43758.5453);}float rand(vec2 p){return rand(p,1.);}",RANDOM2:"float rand2(vec2 p,float s){p=mod(p*100.,vec2(1e4))+100.;return fract(dot(p,vec2(sin(p.x+p.y),cos(p.y-p.x))*s));}float rand2(vec2 p){return rand2(p,1.);}"},INFO:{isWebGl2Supported:0},initContextConfig:(j={})=>({canvas:$d[$[29]]($[26]),...j,contextAttributes:{powerPreference:"high-performance",preserveDrawingBuffer:0,premultipliedAlpha:0,...(j[$[83]]||{})}}),initRendererConfig:(j={})=>({...j,locations:j[$[72]]??[],context:(j.config&&j.config[$[2]])??j[$[2]]??new Context}),setLocations:(j,m)=>(j[$[72]]=[...j[$[72]],...m]),initApplication:(l)=>{let t=()=>l(Utils.INFO[$[84]]);[$[55],"complete"].includes($d.readyState)?t():$d[$[22]]("DOMContentLoaded",t,{once:1})},createProgram:(b,x,A)=>{let q=_1r(b,x,35633),v=_1r(b,A,35632),k=b.createProgram();b.attachShader(k,q);b.attachShader(k,v);b.linkProgram(k);if(!b[$[77]](k,35714)){let w=b[$[90]](q),y=b[$[90]](v);console.error(["Program info: "+b.getProgramInfoLog(k),"Validate status: "+b[$[77]](k,35715),...(w?["","Vertex shader info: "+w,"Vertex shader: "+x]:""),...(y?["","Fragment shader info: "+y,"Fragment shader: "+A]:"")].join("\n"));b.deleteShader(q);b.deleteShader(v);b.deleteProgram(k);throw"WebGL application stoped"};return k},getLocationsFor:(b,k,z)=>{let m={};z.forEach((d)=>(m[d]=b[`get${_1s[d[0]]}Location`](k,d)));return m}};let Const={};let _gl=$d[$[29]]($[26])[$[93]]("webgl2");if(_gl){for(let c in _gl){let f=_gl[c];if(typeof f==="number"&&c===c.toUpperCase())Const[c]=f};Utils.INFO[$[84]]=1;Utils.INFO[$[24]]=_gl.getParameter(34930)};let _2d=(b,c)=>({functionName:"blendFunc"+(b[$[6]]<3?"":"Separate"),functions:b,equationName:"blendEquation"+(!c||c[$[6]]<2?"":"Separate"),equations:c||[32774]});let BlendMode={createBlendMode:_2d,NONE:_2d([0,0]),NORMAL_PM:_2d([1,771]),ADD_PM:_2d([1,1]),MULTIPLY_PM:_2d([774,771,1,771]),SCREEN_PM:_2d([1,769,1,771]),ADD_NPM:_2d([770,1,1,1]),SRC_IN:_2d([772,0]),SRC_OUT:_2d([773,0]),SRC_ATOP:_2d([772,771]),DST_OVER:_2d([773,1]),DST_IN:_2d([0,770]),DST_OUT:_2d([0,771]),DST_ATOP:_2d([773,770]),XOR:_2d([773,771]),NORMAL:_2d([770,771,1,771]),ADD:_2d([770,772,1,772]),MULTIPLY:_2d([774,0]),SCREEN:_2d([770,769,1,769]),OVERLAY:_2d([1,771]),EXCLUSION:_2d([775,769]),LIGHTEN:_2d([1,1],[32776]),DARKEN:_2d([1,1],[32775]),SHADOW:_2d([774,768])};class DTI{constructor(){this.target=3553;this.wrapS=this.wrapT=33071;this.internalFormat=this.format=6408;this.minFilter=this.magFilter=9729;this.maxMipMapLevel=this.baseMipMapLevel=0;this.type=5121;this[$[30]]=this.$cX=-1;this[$[8]]=1;this.$width=this[$[16]]=1};get width(){return this.$width};get height(){return this[$[16]]};get wrapS(){return this.$j};set wrapS(v){this.$j=v;this[$[8]]=1};get wrapT(){return this.$k};set wrapT(v){this.$k=v;this[$[8]]=1};get internalFormat(){return this.$cR};set internalFormat(v){this.$cR=v;this[$[8]]=1};get format(){return this.$s};set format(v){this.$s=v;this[$[8]]=1};get minFilter(){return this.$Y};set minFilter(v){this.$Y=v;this[$[8]]=1};get magFilter(){return this.$Z};set magFilter(v){this.$Z=v;this[$[8]]=1};get maxMipMapLevel(){return this.$cS};set maxMipMapLevel(v){this.$cS=v;this[$[8]]=1};get baseMipMapLevel(){return this.$cY};set baseMipMapLevel(v){this.$cY=v;this[$[8]]=1};get type(){return this.$d};set type(v){this.$d=v;this[$[8]]=1};useActiveTexture(b,c){this[$[31]](b,c);this[$[62]](b)};useActiveTextureAfterUpdate(b,c){this[$[31]](b,c);this.useTextureAfterUpdate(b)};unbindTexture(b,c){this[$[31]](b,c);this.$cX=-1;b[$[56]](this.target,$n)};activeTexture(b,c){this.$cX=c;b[$[31]](33984+c)};bindActiveTexture(b,c){this[$[31]](b,c);b[$[56]](this.target,this.$cs)};useTexture(b){b[$[56]](this.target,this.$cs);this.createTexImage2D(b)};useTextureAfterUpdate(b){b[$[56]](this.target,this.$cs);this[$[85]](b)};createTexImage2D(b){b.texImage2D(this.target,0,this.$cR,this.width,this[$[3]],0,this.$s,this.$d,this[$[66]]);this[$[85]](b)};uploadTextureInfo(b){let d=this.target;b[$[23]](d,10242,this.$j);b[$[23]](d,10243,this.$k);b[$[23]](d,10241,this.$Y);b[$[23]](d,10240,this.$Z);b[$[23]](d,33085,this.$cS);b[$[23]](d,33084,this.$cY);b.generateMipmap(d)}};let $nf=()=>{};let $nfrw=(b)=>()=>b;let $rfa=(c,b)=>{let d=c.indexOf(b);d>-1&&c.splice(d,1)};class Context{constructor(h={}){this.contextId=0;this.isLost=$nfrw(1);this.$t=Utils.initContextConfig(h);this.$cJ=this.$cJ.bind(this);this.$ct=this.$ct.bind(this);let j=this.$t[$[26]];this[$[26]]=j;j[$[22]]($[86],this.$cJ);j[$[22]]($[65],this.$ct);this.$ct()};useBlendMode(p){this.$df=p;let b=this.gl;b[p.equationName].apply(b,p.equations);b[p.functionName].apply(b,p.functions)};setBlendMode(p,v){if(this.$df!==p){v&&v();this.useBlendMode(p)}};destruct(){this.gl[$[94]]($n);let j=this[$[26]];j[$[27]]($[86],this.$cJ);j[$[27]]($[65],this.$ct);this.$cv()};clearTextures(){let l=Utils.INFO[$[24]];let i=-1;while(++i<l){this.$cj[i]=$n;this.$dp[i]=i;this.$dg(i,0,0)};this[$[36]][$[6]]=this[$[40]][$[6]]=0};useTexture(t,s,q=1,n){if(!t)return-1;let r=this.$cj.indexOf(t);if(r<0){if(!this.$dp[$[6]]){n&&n();this[$[67]]();r=0}else r=this.$dp[0];q=1};return this[$[79]](t,r,s,q)};useTextureAt(t,r,s,q=1){t.use(this.gl,r,q,s);this.$cj[r]=t;this.$dg(r,t.width,t[$[3]]);!this[$[36]].includes(r)&&this[$[36]].push(r);$rfa(this.$dp,r);return r};deactivateTexture(t){let r=this.$cj.indexOf(t);r>-1&&t.unbindTexture(this.gl,r)};useProgram(m,c){if(this.$cT!==m){this.$cT=m;this[$[67]]();let b=this.gl;b[$[97]]($n);b[$[94]](m);b[$[97]](c)}};setCanvasSize(f,k){let j=this[$[26]];j.width=f;j[$[3]]=k};setSize(f,k){if(this.$l!==f||this.$v!==k){this.$l=f;this.$v=k;let b=this.gl;b.viewport(0,0,f,k);b.scissor(0,0,f,k)}};$dg(r,f,k){this[$[40]][r*2]=f;this[$[40]][r*2+1]=k};$cJ(g){g.preventDefault();setTimeout(this.$cU,1)};$ct(){let b=(this.gl=this[$[26]][$[93]]("webgl2",this.$t[$[83]]));b.gl_id=++this.contextId;let w=b.getExtension("WEBGL_lose_context");if(w){this.$cU=w.restoreContext.bind(w);this.$cv=w.loseContext.bind(w)}else this.$cU=this.$cv=$nf;this.isLost=b.isContextLost?b.isContextLost.bind(b):$nfrw(1);b.pixelStorei(37441,1);b.enable(3042);b.blendColor(1,1,1,1);b.enable(3089);this.$l=this.$v=this.$cT=this.$df=$n;this.$cj=[];this.$dp=[];this[$[36]]=[];this[$[40]]=[];this[$[67]]();this.setCanvasSize(1,1);this.$t.initCallback&&setTimeout(this.$t.initCallback,1)}};class Buffer{constructor(s,d,f,g,j,h,m,n){let q=f*g;this.data=typeof d==="number"?new F32(d*q):d;this.$cB=s;this.$f=f??1;this.$g=g??1;this.$w=j??34962;this.$d=h??35048;this.$x=q*4;this.$y=g*4;this.$I=m??1;this.$S=n??5126;if(this.$d===35044)this.$x=this.$y=0};create(b,r){this.$T=r[this.$cB];this.$z=b.createBuffer();this.bind(b)};bind(b){b.bindBuffer(this.$w,this.$z)};upload(b){this.bind(b);this.$A(b);b.bufferData(this.$w,this.data,this.$d)};destruct(b){this.bind(b);b.deleteBuffer(this.$z);this.data=this.$z=$n};$A(b){let f=this.$f,p=this.$T,g=this.$g,k=this.$x,l=this.$y,m=this.$I,n=this.$S;let i=-1;while(++i<f){let c=p+i;b.enableVertexAttribArray(c);b.vertexAttribPointer(c,g,n,0,k,i*l);b.vertexAttribDivisor(c,m)}}};let TintType={NONE:0,MULTIPLY:1,GRAYSCALE:2,OVERRIDE:3,ADD:4};let _3r=$d[$[29]]("img");let _3q=(d,f)=>{let j=$d[$[29]](d);j.crossOrigin="anonymous";j.src=f;return j};class Texture extends DTI{constructor(h,n){super();this.$B=_3r;this[$[37]]=this[$[37]].bind(this);this.source=h;this.shouldUpdate=n;this.$dq=0};get source(){return this.$B};set source(g){this.destruct();if(g){this.$B=g;this.isVideo=g.tagName.toLowerCase()==="video";this.$cb=this.isVideo?"canplay":"load";!this[$[37]]()&&g[$[22]](this.$cb,this[$[37]],{once:1})}};destruct(){this.$B&&this.$B[$[27]](this.$cb,this[$[37]]);this[$[66]]=$n};use(b,c,k,l){if(this[$[30]]<b.gl_id){this[$[30]]=b.gl_id;this.$cs=b.createTexture();this[$[34]](b,c)}else if(this[$[8]]||this.$C||(this.shouldUpdate&&this.$dq<l)||(this.isVideo&&!this.$B.paused)){this[$[8]]=this.$C=0;this.$dq=l;this[$[34]](b,c)}else if(this.$cX!==c||k)this[$[87]](b,c)};updateSize(){let h=this.$B,m=h.videoWidth||h.naturalWidth||h.width,p=h.videoHeight||h.naturalHeight||h[$[3]];if(m*p){this.$width=m;this[$[16]]=p;this[$[66]]=this.$B;return this.$C=this[$[8]]=1}}};Texture.loadImage=(f,n)=>new Texture(_3q("img",f),n);Texture.loadVideo=(f)=>new Texture(_3q("video",f));class Framebuffer extends DTI{constructor(){super();this.$J=1};get width(){return this.$width};set width(v){if(this.$width!==v){this.$width=v;this.$J=1}};get height(){return this[$[16]]};set height(v){if(this[$[16]]!==v){this[$[16]]=v;this.$J=1}};setSize(w,h){this.width=w;this[$[3]]=h};bind(b){b[$[98]](36160,this.$cw)};unbind(b){b[$[98]](36160,$n)};use(b,c,d){if(this[$[30]]<b.gl_id){this[$[30]]=b.gl_id;this.$cs=b.createTexture();this[$[34]](b,c);this.$cw=b.createFramebuffer();this.bind(b);b.framebufferTexture2D(36160,36064,3553,this.$cs,0);this.unbind(b)}else if(this[$[8]]){this[$[8]]=0;this.useActiveTextureAfterUpdate(b,c)}else if(this.$J){this.$J=0;this[$[34]](b,c)}else if(this.$cX!==c||d)this[$[87]](b,c)};destruct(){}};class DBT{constructor(){this.$dh=$nf;this[$[41]]=this[$[42]]=1;this[$[43]]=this[$[44]]=this._x=this._y=this.$U=this.$K=this.$L=this.$m=this.$n=0};get x(){return this._x};set x(v){this._x=v;this[$[4]]=1};get y(){return this._y};set y(v){this._y=v;this[$[4]]=1};get rotation(){return this.$U};set rotation(v){this.$U=v;this.$dh=this.$cV};get anchorX(){return this.$K};set anchorX(v){this.$K=v;this[$[4]]=1};get anchorY(){return this.$L};set anchorY(v){this.$L=v;this[$[4]]=1};get skewX(){return this.$m};set skewX(v){this.$m=v;this.$dh=this.$cV};get skewY(){return this.$n};set skewY(v){this.$n=v;this.$dh=this.$cV};update(){this.$dh();this.updated=this[$[4]];this[$[4]]=0};$cV(){this.$dh=$nf;this[$[4]]=1;if(!this.$m&&!this.$n){this[$[43]]=this[$[44]]=$m.sin(this.$U);this[$[41]]=this[$[42]]=$m.cos(this.$U)}else{let b=this.$U-this.$m,c=this.$U+this.$n;this[$[43]]=$m.sin(c);this[$[41]]=$m.cos(c);this[$[44]]=$m.sin(b);this[$[42]]=$m.cos(b)}}};class DIT extends DBT{constructor(){super();this[$[10]]=$nf;this[$[48]]=this[$[45]]=this.$D=this.$E=this.$width=this[$[16]]=1};get scaleX(){return this.$D};set scaleX(v){this.$D=v;this[$[10]]=this[$[46]]};get scaleY(){return this.$E};set scaleY(v){this.$E=v;this[$[10]]=this[$[46]]};get width(){return this.$width};set width(v){this.$width=v;this[$[10]]=this[$[46]]};get height(){return this[$[16]]};set height(v){this[$[16]]=v;this[$[10]]=this[$[46]]};update(){this[$[10]]();super.update()};$updateScale(){this[$[10]]=$nf;this[$[4]]=1;this[$[48]]=this.$width*this.$D;this[$[45]]=this[$[16]]*this.$E}};class DC{constructor(){this.cache=new F32(4);this.set(1,1,1,1)};get r(){return this.cache[0]};set r(v){this.cache[0]=v;this.$cC=1};get g(){return this.cache[1]};set g(v){this.cache[1]=v;this.$cC=1};get b(){return this.cache[2]};set b(v){this.cache[2]=v;this.$cC=1};get a(){return this.cache[3]};set a(v){this.cache[3]=v;this.$cC=1};set(r,g,b,a){this.cache[0]=r;this.cache[1]=g;this.cache[2]=b;this.cache[3]=a;this.$cC=1};update(){this.updated=this.$cC;this.$cC=0}};let GM3={identity:()=>new F32([1,0,0,1,0,0]),projection:(v,k)=>{v[0]=2/k.width;v[1]=v[2]=0;v[3]=-2/k[$[3]];v[4]=-1;v[5]=1},transformLocal:(v,t)=>{let f=t.anchorX,g=t.anchorY,m=t[$[48]],n=t[$[45]];v[0]=t[$[41]]*m;v[1]=t[$[43]]*m;v[2]=-t[$[44]]*n;v[3]=t[$[42]]*n;v[4]=t.x-f*v[0]-g*v[2];v[5]=t.y-f*v[1]-g*v[3]},transform:(v,d,t)=>{let x=t.x,y=t.y,f=t.anchorX,g=t.anchorY,p=t[$[43]],q=t[$[44]],r=t[$[41]],s=t[$[42]],m=t[$[48]],n=t[$[45]];v[0]=(r*d[0]+p*d[2])*m;v[1]=(r*d[1]+p*d[3])*m;v[2]=(s*d[2]-q*d[0])*n;v[3]=(s*d[3]-q*d[1])*n;v[4]=-f*v[0]-g*v[2]+x*d[0]+y*d[2]+d[4];v[5]=-f*v[1]-g*v[3]+x*d[1]+y*d[3]+d[5]},inverse:(v,d)=>{let b=1/(d[0]*d[3]-d[2]*d[1]);v[0]=b*d[3];v[1]=-b*d[1];v[2]=-b*d[2];v[3]=b*d[0];v[4]=b*(d[2]*d[5]-d[3]*d[4]);v[5]=-b*(d[0]*d[5]-d[1]*d[4])},isPointInMatrix:(d,c)=>{let x=c.x*d[0]+c.y*d[2]+d[4],y=c.x*d[1]+c.y*d[3]+d[5];return x>=0&&x<=1&&y>=0&&y<=1},calcCorners:(h,d,k)=>{let j=k[$[73]],l=k[$[63]];h[0].x=j+d[4]*j;h[0].y=k[$[3]]-(l+d[5]*l);h[1].x=h[0].x+(d[0]+d[2])*j;h[1].y=h[0].y-(d[1]+d[3])*l;h[2].x=h[0].x+(d[0]+j*d[2]);h[2].y=h[0].y-(d[1]+l*d[3]);h[3].x=h[0].x+(j*d[0]+d[2]);h[3].y=h[0].y-(l*d[1]+d[3])}};class Item{constructor(){this[$[1]]=Item[$[1]];this[$[13]]=GM3.identity();this[$[38]]=new F32([1,1,1,1]);this[$[20]]=new this.$transformClass;this.color=new DC;this.alpha=1;this[$[70]]=this[$[78]]=$nf;this.renderable=1;this.$bounds={x:0,y:0,width:0,height:0}};get stage(){return this.$parent?this.$parent.stage:$n};get parent(){return this.$parent};set parent(v){this.$parent=v;this.$cK=1};get callbackBeforeRender(){return this.$dB};set callbackBeforeRender(v){this.$dB=v??$nf};get callbackAfterRender(){return this.$dy};set callbackAfterRender(v){this.$dy=v??$nf};callEventHandler(d,b){if(this[$[55]]){let g=this["on"+b.type];g&&g(this,d,b)};let f=this.$parent;f&&f[$[35]](d,b)};destruct(){this.remove()};remove(){let f=this.$parent;f&&f.removeChild(this)};update(){let h=this[$[20]],c=this.color,f=this.$parent,k=this.$cK;this.$cK=0;c.update();this[$[52]]=k||c.updated||f[$[52]];if(this[$[52]]){let j=this[$[38]],m=c.cache,l=f[$[38]];j[0]=l[0]*m[0];j[1]=l[1]*m[1];j[2]=l[2]*m[2];j[3]=l[3]*m[3]};h.update();this[$[12]]=k||h.updated||f[$[12]];this[$[12]]&&GM3[$[20]](this[$[13]],f[$[13]],h)};get $transformClass(){return DIT}};Item[$[1]]="item";class BaseDrawable extends Item{constructor(){super();this.$corners=[{x:0,y:0},{x:0,y:0},{x:0,y:0},{x:0,y:0}]};getBounds(){this.$calcCorners();let g=this.$corners,f=this.$bounds,a=g[0],b=g[1],c=g[2],d=g[3];f.x=$m.min(a.x,b.x,c.x,d.x);f.y=$m.min(a.y,b.y,c.y,d.y);f.width=$m.max(a.x,b.x,c.x,d.x);f[$[3]]=$m.max(a.y,b.y,c.y,d.y);return f};$calcCorners(){this.stage&&GM3.calcCorners(this.$corners,this[$[13]],this.stage.renderer)}};class DLT extends DIT{constructor(){super();this.z=0};get width(){return this.$width};set width(v){this.$width=this[$[16]]=v;this[$[10]]=this[$[46]]};get height(){return this[$[16]]};set height(v){this.width=v}};class Light extends BaseDrawable{constructor(){super();this[$[1]]=Light[$[1]];this.castShadow=this.shading=this.centerReflection=1;this.angle=0;this.spotAngle=180*Utils.THETA;this.type=Light.Type.POINT;this.precision=this.shadowLength=this[$[91]]=1;this.maxShadowStep=128;this.fading=1;this.attenuation=1};get castShadow(){return this.$ck};set castShadow(v){this.$ck=v;this.$cx()};get shading(){return this.$M};set shading(v){this.$M=v;this.$cx()};get flattenShadow(){return this.$cL};set flattenShadow(v){this.$cL=v;this.$cx()};get fading(){return this.$F};set fading(v){this.$F=v;this.$cx()};get centerReflection(){return this.$dj};set centerReflection(v){this.$dj=v;this.$cx()};get $transformClass(){return DLT};$calcCorners(){super.$calcCorners();let f=this.$corners,a=f[0],b=f[1],c=f[2],d=f[3];a.x+=a.x-d.x+(a.x-c.x);a.y+=a.y-d.y+(a.y-c.y);c.x+=c.x-b.x;c.y+=c.y-b.y;d.x+=d.x-b.x;d.y+=d.y-b.y};$cx(){this.flags=this.$ck|(this.$M*2)|(this.$cL*4)|(this.$dj*8)|(this.$F*16)}};Light[$[1]]="light";Light.Type={POINT:0,DIRECTIONAL:1};class DTT extends DBT{constructor(){super();this[$[5]]=new F32([0,0,0,2]);this.repeatX=this.repeatY=1};get repeatX(){return this.$N};set repeatX(v){this.$N=this[$[48]]=v;this[$[4]]=1};get repeatY(){return this.$O};set repeatY(v){this.$O=this[$[45]]=v;this[$[4]]=1};get repeatRandomRotation(){return this[$[5]][0]};set repeatRandomRotation(v){this[$[5]][0]=v};get repeatRandomAlpha(){return this[$[5]][1]};set repeatRandomAlpha(v){this[$[5]][1]=v};get repeatRandomBlur(){return this[$[5]][2]};set repeatRandomBlur(v){this[$[5]][2]=v};get repeatRandomOffset(){return this[$[5]][3]};set repeatRandomOffset(v){this[$[5]][3]=v}};class DTC{constructor(){this.cache=new F32([0,0,1,1]);this.$cM=this.$cy;this.$l=this.$v=1};get x(){return this.cache[0]};set x(v){this.cache[0]=v;this.$cM=this.$cy};get y(){return this.cache[1]};set y(v){this.cache[1]=v;this.$cM=this.$cy};get width(){return this.$l};set width(v){this.$l=v;this.$cM=this.$cy};get height(){return this.$v};set height(v){this.$v=v;this.$cM=this.$cy};setRect(b){this.x=b.x;this.y=b.y;this.width=b.width;this[$[3]]=b[$[3]]};update(){this.$cM();this.updated=this.$cD;this.$cD=0};$cy(){this.$cM=$nf;this.$cD=1;let c=this.cache;c[2]=this.$l-c[0];c[3]=this.$v-c[1]}};class DD{constructor(){this.distortTexture=1;this.cache=new F32([0,0,1,0,1,1,0,1])};get topLeftX(){return this.cache[0]};set topLeftX(v){this.cache[0]=v};get topLeftY(){return this.cache[1]};set topLeftY(v){this.cache[1]=v};get topRightX(){return this.cache[2]};set topRightX(v){this.cache[2]=v};get topRightY(){return this.cache[3]};set topRightY(v){this.cache[3]=v};get bottomRightX(){return this.cache[4]};set bottomRightX(v){this.cache[4]=v};get bottomRightY(){return this.cache[5]};set bottomRightY(v){this.cache[5]=v};get bottomLeftX(){return this.cache[6]};set bottomLeftX(v){this.cache[6]=v};get bottomLeftY(){return this.cache[7]};set bottomLeftY(v){this.cache[7]=v}};class Image extends BaseDrawable{constructor(c){super();this[$[1]]=Image[$[1]];this.texture=c;this.tintType=TintType.MULTIPLY;this.blendMode=BlendMode.NORMAL;this.$dt=new F32(6);this[$[51]]=GM3.identity();this[$[53]]=new DTT;this[$[57]]=new DTC;this[$[95]]=new DD;this[$[92]]=this[$[57]].cache;this[$[54]]=this[$[53]][$[5]];this[$[99]]=this[$[95]].cache};update(){super.update();this[$[57]].update();let d=this[$[53]];d.update();d.updated&&GM3.transformLocal(this[$[51]],d);this[$[55]]&&this[$[12]]&&GM3.inverse(this.$dt,this[$[13]])};isContainsPoint(b){return GM3.isPointInMatrix(this.$dt,b)}};Image[$[1]]="drawable";class AnimatedImage extends Image{constructor(c){super(c);this.$p=0;this[$[81]]=this.$dv=120;this.$G=[];this.$dq=Date.now();this.stop()};get frames(){return this.$G};set frames(v){this.$G=v;let d=this.$G[0];if(d){this.$dv=d[$[6]]??this[$[81]];this.$dq=Date.now()}};gotoAndStop(b){this.stop();this.$p=b;this.$cZ()};gotoAndPlay(b){this.$p=b;this.play()};stop(){this.$dr=$nf;this.isPlaying=0};play(){this.$dr=this.$db;this.isPlaying=1;this.$cZ()};update(f){super.update();this.$dr(f)};destruct(){this.stop();super.destruct()};$db(f){let g=f-this.$dq;if(g>this.$dv){this.$dq=f;this.$p+=~~(g/this.$dv);if(this.$p>=this.$G[$[6]])this.$p=0;this.$cZ()}};$cZ(){let h=this.$G[this.$p];this[$[57]].setRect(h);this.$dv=h[$[6]]??this[$[81]]}};class Container extends Item{constructor(){super();this[$[1]]=Container[$[1]];this[$[15]]=[];this.useTint=1};get parent(){return this.$parent};set parent(v){super.parent=v;if(v){this.$dF=v[$[61]].bind(v);this.$dD=v[$[39]].bind(v)}else this.$dF=this.$dD=$nfrw(1)};getPremultipliedUseTint(){return this.useTint*this.$dF()};getPremultipliedAlpha(){return this.alpha*this.$dD()};destruct(){this.empty();super.destruct()};empty(){while(this[$[15]][$[6]])this.removeChildAt(0)};contains(b){return this[$[68]](b)>-1};addChild(b){this.addChildAt(b,this[$[15]][$[6]])};addChildAt(b,c){if(b){b.remove();this[$[15]].push(b);this[$[69]](b,c);b.parent=this}};removeChild(b){if(b){$rfa(this[$[15]],b);b.parent=$n}};removeChildAt(c){this.removeChild(this.getChildAt(c))};getChildAt(c){return this[$[15]][c]};setChildIndex(b,c){$rfa(this[$[15]],b);this[$[15]].splice(c,0,b)};getChildIndex(b){return this[$[15]].indexOf(b)};swapChildren(d,f){let j=this[$[68]](d),k=this[$[68]](f);if(j>-1&&k>-1){this[$[69]](d,k);this[$[69]](f,j)}};getBounds(){let g=this.$bounds,h=this[$[15]],l=h[$[6]];let i=-1;g.x=g.y=1/0;g.width=g[$[3]]=-1/0;while(++i<l){let m=h[i].getBounds();g.x=$m.min(g.x,m.x);g.y=$m.min(g.y,m.y);g.width=$m.max(g.width,m.width);g[$[3]]=$m.max(g[$[3]],m[$[3]])};return g}};Container[$[1]]=$[71];let _4x=(g,b,h,l)=>{let m="";for(let c=0;c<h[$[6]];c++){let n=m+h[c];if(b[$[49]](n).width<=l)m=n;else{m&&g.push(m);m=h[c]}};m&&g.push(m)};let layoutText=(b,d,l)=>{let g=[],t=d.split("\n");for(let i=0;i<t[$[6]];i++){let v=t[i];if(v.trim()===""){g.push("");continue};let y="",k=0;while(k<v[$[6]]){let w=v.indexOf(" ",k);if(w===-1)w=v[$[6]];let f=v.slice(k,w),q=y+(y===""?"":" ")+f;if(b[$[49]](q).width<=l)y=q;else{if(b[$[49]](f).width>l){if(y){g.push(y);y=""};if(f.includes("-")){let j=f.split(/(-)/);let r="";for(let p=0;p<j[$[6]];p++){let s=r+j[p];if(b[$[49]](s).width<=l)r=s;else{r&&g.push(r);if(b[$[49]](j[p]).width>l){_4x(g,b,[...j[p]],l);r=""}else r=j[p]}};r&&g.push(r)}else _4x(g,b,[...f],l)}else{y&&g.push(y);y=f}};k=w+1};y&&g.push(y)};return g};class Text extends Image{constructor(c="",j={}){let h=$d[$[29]]($[26]);super(new Texture(h,1));this.$H=h;this.$b=h[$[93]]("2d",{alpha:1});this.text=c;this.fontSize=j.fontSize??12;this.lineHeight=j.lineHeight??1.3;this.fontFamily=j.fontFamily??"sans-serif";this.fontColor=j.fontColor??"#000";this.align=j.align??"left"};get text(){return this.$h};set text(v){this.$h=v;this.$V=this.$cN};get fontSize(){return this.$W};set fontSize(v){this.$W=v;this.$V=this.$cN};get fontFamily(){return this.$cl};set fontFamily(v){this.$cl=v;this.$V=this.$cN};get fontColor(){return this.$cc};set fontColor(v){this.$cc=v;this.$V=this.$cN};get align(){return this.$q};set align(v){this.$q=v;this.$V=this.$cN};get lineHeight(){return this.$cm};set lineHeight(v){this.$cm=v;this.$V=this.$cN};update(){super.update();this[$[12]]?this.$cN():this.$V()};$cN(){this.$V=$nf;let b=this.$b,h=this.$H,f=this.$q,k=this.$W,n=this.$cm*k,m=this[$[20]].width;h.width=this[$[20]].width;h[$[3]]=this[$[20]][$[3]];b.font=k+"px "+this.$cl;b.textBaseline="top";b.textAlign=f;b.fillStyle=this.$cc;let g=layoutText(b,this.$h,m),x=f==="center"?m/2:f==="right"?m:0;for(let i=0,l=g[$[6]];i<l;i++){let d=g[i],y=n*i;b.fillText(d,x,y)};this.texture[$[37]]()}};class BaseRenderer{constructor(h){this.$dC=$nf;this.$cE=$nf;this.$cn=1;this.width=this[$[3]]=this[$[73]]=this[$[63]]=this.$dk=this.$ds=this[$[17]]=0;this.setSize(1,1);this[$[64]]=new DC;this.$t=h;this[$[2]]=h[$[2]];Utils[$[19]](h,["aA","uA","uB"]);this.$dw=new Buffer("",new U16([0,1,3,2]),0,0,34963,35044);this.$cW=new Buffer("aA",new U16([0,0,1,0,1,1,0,1]),1,2,34962,35044,0,5123)};set clearBeforeRender(v){this.$dC=v?this.$r:$nf};setSize(c,j){this.width=c;this[$[3]]=j;this.$cE=this.$resize};renderToFramebuffer(r){if(!this[$[2]].isLost()){this.$dc();this[$[25]](r);this.$cz(r);r.unbind(this.$gl)}};render(){if(!this[$[2]].isLost()){this.$dc();this.$gl[$[74]](this[$[9]].uA,1);this.$dC();this.$cz()}};destruct(){};$attachFramebuffer(r){r.bind(this.$gl);r.setSize(this.width,this[$[3]]);this[$[2]][$[62]](r,this[$[17]],0);this[$[2]][$[88]](r);this.$gl[$[74]](this[$[9]].uA,-1)};$attachFramebufferAndClear(r){this.$attachFramebuffer(r);this.$dC()};$drawInstanced(d){this.$gl.drawElementsInstanced(5,4,5123,0,d)};$useTextureAt(k,m,f,n){this.$gl.uniform1i(m,this[$[2]][$[79]](k,f,this[$[17]],n))};$useTexture(k,m,n){this.$gl.uniform1i(m,this[$[2]][$[62]](k,this[$[17]],n))};$uploadBuffers(){let b=this.$gl;this.$cW.upload(b);this.$dw.upload(b)};$createBuffers(){let b=this.$gl,p=this[$[9]];this.$dw.create(b,p);this.$cW.create(b,p)};$resize(){this.resized=1;this.$cE=$nf;this[$[73]]=this.width/2;this[$[63]]=this[$[3]]/2};$cz(r){this[$[17]]=Date.now();this.$render(r)};$dc(){this.$gl=this[$[2]].gl;let l=this[$[2]],q=l.contextId;if(this.$dk!==q||this.$ds!==this.$cn){this.$dk=q;this.$ds=this.$cn;this.$cF()}else this.$cp();this.resized=0;this.$cE();this[$[2]].setSize(this.width,this[$[3]])};$r(){let b=this.$gl,g=this[$[64]];this.$gl[$[64]](g.r,g.g,g.b,g.a);this.$gl.clear(16384)};$cF(){let b=this.$gl,s=Utils.GLSL.VERSION+"precision highp float;\n";this.$P=Utils.createProgram(b,s+this.$createVertexShader(),s+this.$createFragmentShader());this[$[9]]=Utils.getLocationsFor(b,this.$P,this.$t[$[72]]);this.$c=b.createVertexArray();this.$cp();this[$[50]]()};$cp(){this[$[2]][$[94]](this.$P,this.$c)}};class BatchRenderer extends BaseRenderer{constructor(b){Utils[$[19]](b,["aB"]);super(b);this[$[14]]=b.maxRenderCount||1e4;this[$[32]]=new Buffer("aB",this[$[14]],4,4)};$uploadBuffers(){this[$[32]].upload(this.$gl);super[$[11]]()};$createBuffers(){super[$[50]]();this[$[32]].create(this.$gl,this[$[9]])}};let BVS="vec4 pos=vec4(aA*2.-1.,1,1);gl_Position=pos;gl_Position.y*=uA;";let BVSP="vec2(aA.x,1.-aA.y)";let BVSA="in vec2 aA;";let BVSU="uniform float uA;";let BVSI=BVSA+BVSU;let TTS=(b,f,g)=>"if("+b+">0.)if("+b+"==1.||("+b+"==2.&&"+f+".r=="+f+".g&&"+f+".r=="+f+".b))"+f+"*="+g+";else if("+b+"==3.)"+f+"="+g+";else if("+b+"==4.)"+f+"+="+g+";";let CSF=(d)=>"if(v>0.){vec2 wh=vec2(v,uJ[1]);ivec2 mn=ivec2(Z.xx),mx=ivec2(ts)-1;"+["z","yz","zy","y"].reduce((c,v)=>c+="oCl+=texelFetch(uB,clamp(f+ivec2(Z."+v+"*wh),mn,mx),0);","")+d+"}";class FilterRenderer extends BaseRenderer{constructor(j={}){j=Utils[$[18]](j);Utils[$[19]](j,["uF","uH","uI","uJ","uK","uL"]);super(j);this.$dE=this[$[25]];this[$[25]]=$nf;this.filters=j.filters||[];this[$[7]]=j[$[7]];this.$cG=[new Framebuffer,new Framebuffer]};get filters(){return this.$Q};set filters(v){this.$Q=new Proxy(v,{deleteProperty:(k,s)=>{delete k[s];this.$cn++;return 1},set:(k,s,g)=>{k[s]=g;this.$cn++;return 1}});this.$cn++};$render(y){let q=this[$[2]],b=this.$gl,x=this[$[17]],t=this[$[9]],r=this.$Q,l=r[$[6]]||1,d=l-2;let i=-1;q[$[47]](BlendMode.NORMAL);this[$[11]]();this[$[33]](this[$[7]],t.uB,0);b.uniform3f(t.uF,this.width,this[$[3]],x%864e5);while(++i<l){let m=r[i],w=m&&m.on,n=i>d,z=w&&m.texture;let A;z&&this[$[33]](z,t.uH,1);if(n)y?this.$dE(y):b[$[74]](t.uA,1);else if(w){A=this.$cG[i&1];this.$dE(A)};if(w){b.uniform1i(t.uI,m.uniqueId);b.uniform1fv(t.uJ,m.data);b.uniformMatrix2x4fv(t.uL,0,m[$[0]]);b.uniformMatrix3fv(t.uK,0,m.kernels)};(w||n)&&this[$[28]](1);z&&q[$[88]](z);if(A){A.unbind(b);q[$[79]](A,0,x)}}};$createVertexShader(){return BVSI+"out vec4 v0;void main(){"+BVS+"v0=vec4(pos.xy,"+BVSP+");}"};$createFragmentShader(){return Utils.GLSL.DEFINE.Z+Utils.GLSL.DEFINE[$[58]]+"in vec4 v0;uniform float uJ[10];uniform int uI;uniform vec3 uF;uniform mat3 uK;uniform mat2x4 uL;uniform sampler2D uB,uH;out vec4 oCl;"+Utils.GLSL.RANDOM+"float gs(vec3 c){return .3*c.r+.59*c.g+.11*c.b;}void main(){oCl=texture(uB,v0.zw);vec4 tmpCl=oCl;float v=uJ[0];vec2 ts=floor(uF.xy),vol=v/ts;ivec2 f=ivec2(floor(v0.zw*ts));"+this.filters.reduce((c,f)=>{let h=c.findIndex((p)=>p.GLSL===f.GLSL);if(h<0)h=c.push(f)-1;f.uniqueId=h;return c},[]).map((f)=>"if(uI=="+f.uniqueId+"){"+f.GLSL+"}").join("else ")+"vec2 d=abs(v0.zw-vec2(uJ[4],uJ[5]));float p=mix(2.,16.,uJ[8]),ds=mix(pow(pow(d.x,p)+pow(d.y,p),1./p),max(d.x,d.y),smoothstep(.7,1.,uJ[5])),dst=mix(1.,clamp(pow(clamp(ds,0.,1.)/uJ[7],uJ[9]),0.,1.),uJ[3]),mA=mix(dst,1.-dst,uJ[6]);oCl=mix(tmpCl,oCl,mA*uJ[2]);}"}};class NormalMapRenderer extends BaseRenderer{constructor(b={}){b=Utils[$[18]](b);Utils[$[19]](b,["uF"]);super(b);this[$[21]]=b[$[21]]};$render(){let c=this[$[9]];this[$[2]][$[47]](BlendMode.NORMAL);this[$[33]](this[$[21]],c.uB,0);this.$gl[$[75]](c.uF,this.width,this[$[3]]);this[$[11]]();this[$[28]](1)};$createVertexShader(){return BVSI+"out vec2 v0;void main(){"+BVS+"v0="+BVSP+";}"};$createFragmentShader(){return Utils.GLSL.DEFINE.Z+Utils.GLSL.DEFINE.HEIGHT+"in vec2 v0;uniform vec2 uF;uniform sampler2D uB;out vec4 oCl;void main(){vec2 ts=floor(uF),p=1./ts,p0=floor(v0.xy*ts);float h0=texture(uB,p0*p).g,h1=texture(uB,(p0+Z.yx)*p).g,h2=texture(uB,(p0+Z.xy)*p).g;vec3 nm=normalize(cross(vec3(1,0,h1-h0),vec3(0,1,h2-h0)))*HEIGHT*Z.yzy;oCl=vec4(nm*.5+.5,1);}"}};class AmbientOcclusionMapRenderer extends BaseRenderer{constructor(c={}){c=Utils[$[18]](c);Utils[$[19]](c,["uC","uD","uE","uF","uG"]);super(c);this[$[7]]=c[$[7]];this[$[21]]=c[$[21]];this.radius=c.radius??4;this.samples=c.samples??4;this[$[96]]=c[$[96]]??1;this[$[60]]=c[$[60]]??1;this.offsetX=c.offsetX??0;this.offsetY=c.offsetY??0};setOffset(x,y){this.offsetX=x;this.offsetY=y};$render(){let b=this.$gl,d=this[$[9]],f=!!this[$[7]];this[$[2]][$[47]](BlendMode.NORMAL);this[$[33]](this[$[21]],d.uB,0);b[$[75]](d.uF,this.width,this[$[3]]);f&&this[$[33]](this[$[7]],d.uC,1);b[$[74]](d.uE,f);b.uniform4f(d.uD,this.radius,this.samples,this[$[96]],this[$[60]]);b[$[75]](d.uG,this.offsetX,this.offsetY);this[$[11]]();this[$[28]](1)};$createVertexShader(){return Utils.GLSL.DEFINE[$[58]]+BVSI+"uniform vec4 uD;out vec2 v0;flat out vec2 v1;void main(){"+BVS+"float r=RADIANS_360/uD.y;v0="+BVSP+";v1=vec2(cos(r),sin(r));}"};$createFragmentShader(){return Utils.GLSL.DEFINE.Z+Utils.GLSL.DEFINE[$[58]]+"in vec2 v0;flat in vec2 v1;uniform sampler2D uB,uC;uniform float uE;uniform vec2 uF,uG;uniform vec4 uD;out vec4 oCl;"+Utils.GLSL.RANDOM+"void main(){float tx=texture(uB,v0).g,v=0.;if(uD.y>0.&&uD.x>0.){int l=clamp(int(uD.y),1,32);vec2 ts=1./floor(uF);float rnd=rand(v0+floor(uG)*ts),ta=RADIANS_360*rnd,ln=1.-rnd;vec2  rg,n=uD.x*ts*rnd,dr=vec2(cos(ta),sin(ta));for(int i=0;i<l;i++){rg=max(texture(uB,v0+n*dr).rg-tx,Z.xx);v+=max(0.,(rg.y-rg.x)*(1.-rg.x)*ln);dr=vec2(v1.x*dr.x-v1.y*dr.y,v1.y*dr.x+v1.x*dr.y);}v/=float(l);}vec3 stCl=uE>0.?texture(uC,v0).rgb:Z.yyy;oCl=vec4(stCl*mix(1.,tx,uD.w)*(1.-v*uD.z),1);}"}};let $as=(c,d,b=0)=>{let i=d[$[6]];while(--i>-1)c[b+i]=d[i];return c};class LightRenderer extends BatchRenderer{constructor(g={}){g=Utils[$[18]](g);Utils[$[19]](g,["aC","uC","uF","uM","uN","uO"]);super(g);this.clearBeforeRender=1;this[$[64]].set(0,0,0,1);this.$R=this;this[$[7]]=g[$[7]];this.normalMap=g.normalMap;this[$[21]]=g[$[21]];this[$[80]]=g[$[80]];this.$dd=new Buffer("aC",this[$[14]],2,3)};get sourceTexture(){return this.$cO};set sourceTexture(v){this.$cO=v;if(v)this.$R=v};get normalMap(){return this.$cd};set normalMap(v){this.$cd=v;if(v)this.$R=v};get heightMap(){return this.$cf};set heightMap(v){this.$cf=v;if(v)this.$R=v};get roughnessMap(){return this.$cH};set roughnessMap(v){this.$cH=v;if(v)this.$R=v};addLightForRender(f){let k=this.$cq,h=f.parent;if(k<this[$[14]]&&h){let l=k*16,q=k*6,m=this[$[32]].data,r=this.$dd.data;$as(m,f[$[13]],l);m[l+6]=f[$[20]].width;m[l+7]=f.spotAngle;$as(m,f[$[38]],l+8);m[l+11]*=f.alpha*h[$[39]]();m[l+12]=f.shadowLength;m[l+13]=f.angle;m[l+14]=f.type;r[q]=f.flags;r[q+1]=f[$[20]].z;r[q+2]=f.precision;r[q+3]=f.maxShadowStep;r[q+4]=f[$[91]];r[q+5]=f.attenuation;++this.$cq}};$render(){let b=this.$gl,j=this[$[9]],t=!!this[$[7]],n=!!this.normalMap,s=!!this[$[80]],p=!!this[$[21]];this[$[2]][$[47]](BlendMode.ADD);t&&this[$[59]](this.$cO,j.uC);n&&this[$[59]](this.$cd,j.uM);s&&this[$[59]](this.$cH,j.uN);p&&this[$[59]](this.$cf,j.uB);b.uniform3f(j.uO,t,s,n);b[$[75]](j.uF,this.$R.width,this.$R[$[3]]);this[$[11]]();this[$[28]](this.$cq);this.$cq=0};$uploadBuffers(){this.$dd.upload(this.$gl);super[$[11]]()};$createBuffers(){super[$[50]]();this.$dd.create(this.$gl,this[$[9]])};$createVertexShader(){return Utils.GLSL.DEFINE.Z+Utils.GLSL.DEFINE.PI+"#define P vec4(1,-1,2,-2)\n"+BVSA+"in mat4 aB;in mat2x3 aC;"+BVSU+"out vec2 v0;out vec4 v1;flat out vec4 v2,v3,v4,v5;void main(){vec3 pos=vec3(aA*2.-1.,1);v1.xy=pos.xy;mat3 mt=mat3(aB[0].xy,0,aB[0].zw,0,aB[1].xy,1);v2.x=aB[1].z;v2.y=v2.x*aB[3].x;v3=vec4(aC[1],PI-aB[1].w);v4=vec4(aB[3].z,aC[0]);v5=aB[2];if(v4.x<1.){gl_Position=vec4(mt*pos,1);v0=(gl_Position.xy+P.xy)/P.zw;v1.zw=(aB[1].xy+P.xy)/P.zw;v2.zw=vec2(sin(aB[3].y),cos(aB[3].y));}else{mt[2].xy=Z.zy;gl_Position=vec4(pos,1);v0=(gl_Position.xy+P.xy)/P.zw;v1.zw=v0+((mt*vec3(1)).xy+P.xy)/P.zw;}gl_Position.y*=uA;}"};$createFragmentShader(){let c=(d)=>"for(i=m;i<l;i+=st){p=ivec2((v1.zw+i*opdm)*uF);tc=texelFetch(uB,p,0)*HEIGHT;"+d+"}";return Utils.GLSL.DEFINE.HEIGHT+Utils.GLSL.DEFINE.Z+"in vec2 v0;in vec4 v1;flat in vec4 v2,v3,v4,v5;uniform vec2 uF;uniform vec3 uO;uniform sampler2D uB,uC,uM,uN;out vec4 oCl;"+Utils.GLSL.RANDOM+"void main(){float vol=v5.a;if(vol<=0.)discard;vec2 tUv=v0*uF,tCnt=v1.zw*uF;vec4 tc=texelFetch(uB,ivec2(tUv),0);int flg=int(v4.y);float ph=tc.g*HEIGHT,spc=0.;vec3 sf=vec3(tUv,ph),lp=vec3(tCnt,v4.z),sftla=lp-sf;if(v4.x<1.){float d=length(sftla)/v2.x,od=1.-d,dv=(flg&16)>0?pow(od,v3.z):1.;vol*=dv;float slh=(v4.z-ph)/HEIGHT;vec2 sl=vec2(slh*v2.w-v1.x*v2.z,slh*v2.z+v1.x*v2.w);if(vol<=0.||od<=0.||atan(sl.x,length(vec2(sl.y,v1.y)))+"+Utils.ALPHA+"-v3.w<0.)discard;}float fltDst=distance(tCnt,tUv),shdw=1.;if((flg&2)>0){vec3 nm=uO.z>0.?normalize((texture(uM,v0).rgb*2.-1.)*Z.yzy):Z.xxy,sftl=normalize(sftla),sftv=normalize(vec3((flg&8)>0?uF*.5:tUv,HEIGHT)-sf),hlf=normalize(sftl+sftv);vol*=dot(nm,sftl);if(vol<=0.)discard;float rgh=1.,shn=uO.y>0.?texture(uN,v0).r:tc.b;spc=pow(max(dot(nm,hlf),0.),32.)*shn*v3.y;}if((flg&1)>0){ivec2 p;vec2 opd=(tUv-tCnt)/fltDst,opdm=opd/uF;float i,pc,st=max(1.,ceil(fltDst/v3.x)),l=min(fltDst-st,4096.),m=max(st,l-v2.y);if((flg&4)>0)"+c("if(tc.g>=v4.z)discard;")+"else{float opdL=length(opd),hst=(ph-v4.z)/fltDst,rnd=v4.w*rand(v0);"+c("st+=rnd;pc=v4.z+i*hst;shdw*=mix(1.,(fltDst-i*opdL)/v2.y,step(tc.r,pc)*step(pc,tc.g));")+"}}vec3 stCl=uO.x>0.?texture(uC,v0).rgb:Z.yyy;oCl=vec4((stCl+spc)*v5.rgb*vol*shdw,1);}"}};class DSC extends Container{constructor(c){super();this.renderer=c;this[$[38]]=this.color.cache;delete this.parent;delete this[$[20]]};get stage(){return this};getPremultipliedUseTint(){return this.useTint};getPremultipliedAlpha(){return this.alpha};update(){let b=this.color,c=this.renderer;b.update();this[$[52]]=b.updated;this[$[12]]=c.resized;this[$[12]]&&GM3.projection(this[$[13]],c)}};let _5O="_draw",_5U="mousemove",_5V="mousedown",_5S="mouseup",_5Q="click",_5X="touchstart",_5W="touchmove",_5T="touchend",_5cf="PointerClick",_5cb="PointerDown",_5cc="PointerMove",_5Y="PointerUp",_5Z="PointerOut",_5cd="PointerOver",_5P=[_5U,_5V,_5S,_5Q,_5X,_5W,_5T],_5R={[_5Q]:_5cf,[_5V]:_5cb,[_5X]:_5cb,[_5U]:_5cc,[_5W]:_5cc,[_5S]:_5Y,[_5T]:_5Y};class Stage2D extends BatchRenderer{constructor(h={}){h=Utils[$[18]](h);h.useTint=h.useTint??1;Utils[$[19]](h,["aD","aE","uF"]);super(h);let G=this[$[14]];this[$[71]]=new DSC(this);this.$cq=0;this[_5O+Item[$[1]]]=this[_5O+Light[$[1]]]=$nf;this[_5O+Image[$[1]]]=this.$cg;this[_5O+Container[$[1]]]=this.$cP;this.$ch=this.$ch.bind(this);this.$cQ={x:0,y:0};this.$cr=new Buffer("aD",G,3,4);this.$dl=new Buffer("aE",G,4,2);this.$dz=this.$dz.bind(this);let j=this[$[2]][$[26]],E=h.lightRenderer;_5P.forEach((c)=>j[$[22]](c,this.$dz));E&&this.attachLightRenderer(E)};attachLightRenderer(v){this[_5O+Light[$[1]]]=v.addLightForRender.bind(v)};detachLightRenderer(){this[_5O+Light[$[1]]]=$nf};destruct(){let j=this[$[2]][$[26]];_5P.forEach((c)=>j[$[27]](c,this.$dz))};$dn(){let B=this.$cI,z=this.$cA,M=this.$dA;if(B){if(z!==M){let n={...B};M&&M[$[35]](M,{...n,type:_5Z});z&&z[$[35]](z,{...n,type:_5cd})};z&&z[$[35]](z,{...B,type:_5R[B.type]});this.$dA=z};this.$cI=$n};$dm(x,y){this.$dx=1;let A=this[$[71]][$[13]],F=this.$cQ;F.x=(x-this[$[73]])*A[0];F.y=(y-this[$[63]])*A[3]};$X(d){let s=this[$[17]];d.update(s);d[$[70]](d,s);d.renderable&&this[_5O+d[$[1]]](d);d[$[78]](d,s)};$cP(q){let p=q[$[15]],l=p[$[6]];let i=-1;while(++i<l)this.$X(p[i])};$cg(f){this[$[2]][$[47]](f.blendMode,this.$ch);let t=this.$cq,C=t*12,H=t*16,w=f.parent,I=this.$cr.data,J=this[$[32]].data;if(w){if(this.$dx&&f[$[55]]&&f.isContainsPoint(this.$cQ))this.$cA=f;$as(I,f[$[38]],C);$as(I,f[$[54]],C+8);I[C+4]=f.alpha*w[$[39]]();I[C+5]=f.tintType*w[$[61]]();I[C+6]=this[$[2]][$[62]](f.texture,this[$[17]],0,this.$ch);I[C+7]=f[$[95]].distortTexture;$as(J,f[$[13]],H);$as(J,f[$[51]],H+6);$as(J,f[$[92]],H+12);$as(this.$dl.data,f[$[99]],t*8);++this.$cq===this[$[14]]&&this.$ch()}};$ch(){let b=this.$gl,r=this[$[9]],k=this[$[2]],t=this.$cq;if(t){if(k[$[36]][$[6]]){b.uniform1iv(r.uB,k[$[36]]);b.uniform2fv(r.uF,k[$[40]])};this[$[11]]();this[$[28]](t);this.$cq=0}};$dz(g){this.$cI=g;let j=this[$[2]][$[26]];this.$dm((j.width/j.offsetWidth)*g.offsetX,(j[$[3]]/j.offsetHeight)*g.offsetY)};$render(){this.$cA=$n;this.$X(this[$[71]]);this.$ch();this.$dx=0;this.$dn()};$uploadBuffers(){let b=this.$gl;this.$cr.upload(b);this.$dl.upload(b);super[$[11]]()};$createBuffers(){let b=this.$gl,r=this[$[9]];super[$[50]]();this.$cr.create(b,r);this.$dl.create(b,r)};$createVertexShader(){let K=this.$t[$[89]],N=Utils.INFO[$[24]];return Utils.GLSL.DEFINE.Z+BVSA+"in mat4x2 aE;in mat3x4 aD;in mat4 aB;"+BVSU+"uniform vec2 uF["+N+"];out vec2 v0;flat out float v1;flat out vec4 v2,v3,v4"+(K?",v5;":";")+"vec2 clcQd(vec2 p){return mix(mix(aE[0],aE[1],p.x),mix(aE[3],aE[2],p.x),p.y);}void main(){vec2 tPs=clcQd(aA);gl_Position=vec4(mat3(aB[0].xy,0,aB[0].zw,0,aB[1].xy,1)*vec3(tPs,1.),1)*vec4(1.,uA,1.,1.);v0=(mat3(aB[1].zw,0,aB[2].xy,0,aB[2].zw,1)*vec3(mix(tPs,aA,aD[1].w),1.)).xy;v1=aD[1].x;v2.xy=aD[1].yz;v2.zw=v2.y>-1.?.5/uF[int(v2.y)]:Z.yy;v3=aB[3];v4=aD[0];"+(K?"v5=aD[2];":"")+"}"};$createFragmentShader(){let h=this.$t,N=Utils.INFO[$[24]],K=h[$[89]],m=h.useTint;let L=(D)=>"gTxC(v2.y,v3,"+D+")";return Utils.GLSL.DEFINE.Z+Utils.GLSL.DEFINE[$[58]]+"in vec2 v0;flat in float v1;flat in vec4 v2,v3,v4"+(K?",v5;":";")+"uniform sampler2D uB["+N+"];out vec4 oCl;vec4 gTxC(float i,vec4 s,vec2 m){vec2 sxy=s.xy,szw=s.zw,ofs=szw*m,cp=clamp(sxy+ofs,sxy+v2.zw,sxy+szw-v2.zw);"+Array(N).fill().map((v,i)=>"if(i<"+(i+1)+".)return texture(uB["+i+"],cp);").join("")+"return Z.yyyy;}float cs(float a,float b,float v){v=abs(v);float t=-2.*v+2.;v=mix(2.*v*v,1.-t*t*.5,step(.5,v));return a*(1.-v)+b*v;}"+(K?Utils.GLSL.RANDOM2+"vec4 gCB(vec2 st){vec2 uv=v0;float rnd=rand2(floor(uv+st)/100.),rndDg=rnd*RADIANS_360*v5.x;if(rndDg>0.){vec2 rt=vec2(sin(rndDg),cos(rndDg));uv=vec2(uv.x*rt.y-uv.y*rt.x,uv.x*rt.x+uv.y*rt.y);}return "+L("mod(uv,Z.yy)")+";}float gRCB(vec2 st,vec2 uv){float rnd=rand2(floor(v0+st)/100.);return (1.-(v5.w*rnd-v5.w*.5)*v5.y)*cs(0.,1.,1.-st.x-uv.x)*cs(0.,1.,1.-st.y-uv.y);}":"")+"void main(){if(v2.y>-1.){vec2 uv=mod(v0,Z.yy);"+(K?"if(v5.x>0.||v5.y>0.){vec4 rc=vec4(gRCB(Z.xx,uv),gRCB(Z.yx,uv),gRCB(Z.xy,uv),gRCB(Z.yy,uv));oCl=mix(gCB(Z.xy),clamp(gCB(Z.xx)*rc.x+gCB(Z.yx)*rc.y+gCB(Z.xy)*rc.z+gCB(Z.yy)*rc.w,0.,1.),vec4(v5.z));oCl.a=mix(oCl.a,clamp(oCl.a*(rc.x+rc.y+rc.z+rc.w),0.,1.),v5.y);}else oCl="+L("uv")+";":"oCl="+L("uv")+";")+"}else oCl+=1.;oCl.a*=v1;if(oCl.a<=0.)discard;"+(m?TTS("v2.x","oCl","v4"):"")+"}"}};class BaseFilter{constructor(b={}){this.data=new F32(10);this[$[0]]=new F32(8);this.kernels=new F32(9);this.on=b.on??1;this[$[76]]=b[$[76]]??1;this.intensityX=b.intensityX??b.deg??this[$[76]];this.intensityY=b.intensityY??this[$[76]];this.mix=b.mix??1;this.isRadial=b.isRadial??0;this.centerX=b.centerX??.5;this.centerY=b.centerY??.5;this.invertRadial=b.invertRadial??0;this.size=b.size??1;this.roundness=b.roundness??1;this.transition=b.transition??1;b.kernels&&$as(this.kernels,b.kernels)};get intensity(){return this.data[0]};set intensity(v){this.data[0]=this.data[1]=v};get intensityX(){return this.data[0]};set intensityX(v){this.data[0]=v};get intensityY(){return this.data[1]};set intensityY(v){this.data[1]=v};get mix(){return this.data[2]};set mix(v){this.data[2]=v};get isRadial(){return this.data[3]};set isRadial(v){this.data[3]=v};get centerX(){return this.data[4]};set centerX(v){this.data[4]=v};get centerY(){return this.data[5]};set centerY(v){this.data[5]=v};get invertRadial(){return this.data[6]};set invertRadial(v){this.data[6]=v};get size(){return this.data[7]};set size(v){this.data[7]=v};get roundness(){return this.data[8]};set roundness(v){this.data[8]=v};get transition(){return 1/this.data[9]};set transition(v){this.data[9]=1/v}};class BaseKernelFilter extends BaseFilter{get GLSL(){return"mat3 kr=uK*v;oCl.rgb=(texelFetch(uB,f-ivec2(1),0)*kr[0].x+texelFetch(uB,f+ivec2(0,-1),0)*kr[0].y+texelFetch(uB,f+ivec2(1,-1),0)*kr[0].z+texelFetch(uB,f+ivec2(-1,0),0)*kr[1].x+oCl*kr[1].y+texelFetch(uB,f+ivec2(1,0),0)*kr[1].z+texelFetch(uB,f+ivec2(-1,1),0)*kr[2].x+texelFetch(uB,f+ivec2(0,1),0)*kr[2].y+texelFetch(uB,f+ivec2(1),0)*kr[2].z).rgb;"}};class BaseTextureFilter extends BaseFilter{constructor(c={}){super(c);this.texture=c.texture;this.translateX=c.translateX??0;this.translateY=c.translateY??0;this.cropX=c.cropX??0;this.cropY=c.cropY??0;this.cropWidth=c.cropWidth??1;this.cropHeight=c.cropHeight??1};get translateX(){return this[$[0]][0]};set translateX(v){this[$[0]][0]=v};get translateY(){return this[$[0]][1]};set translateY(v){this[$[0]][1]=v};get cropX(){return this[$[0]][2]};set cropX(v){this[$[0]][2]=v};get cropY(){return this[$[0]][3]};set cropY(v){this[$[0]][3]=v};get cropWidth(){return this[$[0]][4]};set cropWidth(v){this[$[0]][4]=v};get cropHeight(){return this[$[0]][5]};set cropHeight(v){this[$[0]][5]=v}};BaseTextureFilter[$[82]]=(b)=>"vec4 txCl=texture(uH,mod(vec2(uL[0].x,uL[0].y)+v0.zw,1.)*vec2(uL[1].x-uL[0].z,uL[1].y-uL[0].w));"+b;let _6b=BaseTextureFilter[$[82]]("oCl=texture(uB,v0.zw+(Z.yz*(txCl.rg-.5)*2.*vol));");class DisplacementFilter extends BaseTextureFilter{get GLSL(){return _6b}};let _7b=BaseTextureFilter[$[82]]("int v2=int(uL[1].z);oCl.a*=v2<4?txCl[v2]:(txCl.r+txCl.g+txCl.b+txCl.a)/4.;");class MaskFilter extends BaseTextureFilter{constructor(c={}){super(c);this.type=c.type??MaskFilter.Type.RED};get GLSL(){return _7b};get type(){return this[$[0]][6]};set type(v){this[$[0]][6]=v}};MaskFilter.Type={RED:0,GREEN:1,BLUE:2,ALPHA:3,AVG:4};class PixelateFilter extends BaseFilter{get GLSL(){return"oCl=texture(uB,floor(v0.zw/vol)*vol);"}};class EdgeDetectFilter extends BaseKernelFilter{constructor(b){super({...b,kernels:[-1,-1,-1,-1,8,-1,-1,-1,-1]})}};class SharpenFilter extends BaseKernelFilter{constructor(b){super({...b,kernels:[0,-1,0,-1,5,-1,0,-1,0]})}};class SaturateFilter extends BaseFilter{get GLSL(){return"vec3 sv=(1.-v)*vec3(.3,.59,.11);mat3 kr=mat3(sv.r+v,sv.g,sv.b,sv.r,sv.g+v,sv.b,sv.r,sv.g,sv.b+v);oCl.rgb=vec3(kr[0].r*oCl.r+kr[0].g*oCl.g+kr[0].b*oCl.b,kr[1].r*oCl.r+kr[1].g*oCl.g+kr[1].b*oCl.b,kr[2].r*oCl.r+kr[2].g*oCl.g+kr[2].b*oCl.b);"}};class GrayscaleFilter extends BaseFilter{get GLSL(){return"oCl=vec4(vec3(gs(oCl.rgb)),oCl.a);"}};class SepiaFilter extends BaseFilter{get GLSL(){return"oCl=vec4(vec3(.874,.514,.156)*gs(oCl.rgb),oCl.a);"}};class InvertFilter extends BaseFilter{get GLSL(){return"oCl=vec4(1.-oCl.rgb,oCl.a);"}};class TintFilter extends BaseFilter{constructor(c={}){super(c);this.set(c.r??1,c.g??1,c.b??1,c.a??1);this.type=c.type??TintType.MULTIPLY};get GLSL(){return TTS("uL[1].x","oCl","uL[0]")};get r(){return this[$[0]][0]};set r(v){this[$[0]][0]=v};get g(){return this[$[0]][1]};set g(v){this[$[0]][1]=v};get b(){return this[$[0]][2]};set b(v){this[$[0]][2]=v};get a(){return this[$[0]][3]};set a(v){this[$[0]][3]=v};get type(){return this[$[0]][4]};set type(v){this[$[0]][4]=v};set(r,g,b,a){this.r=r;this.g=g;this.b=b;this.a=a}};class PosterizeFilter extends BaseFilter{get GLSL(){return"float l=dot(oCl.rgb,vec3(.299,.587,.114)),q=floor(l*v+.5)/v;oCl.rgb*=q/max(l,1e-5);"}};class RainbowFilter extends BaseFilter{get GLSL(){return"oCl.rgb+=vec3(v0.xy*.15,(v0.x*v0.y)*.15)*v;"}};class BrightnessFilter extends BaseFilter{get GLSL(){return"oCl.rgb*=v;"}};class ContrastFilter extends BaseFilter{get GLSL(){return"oCl.rgb=(oCl.rgb-.5)*v+.5;"}};class GammaFilter extends BaseFilter{get GLSL(){return"oCl.rgb=pow(oCl.rgb,vec3(1./v));"}};let _8b=CSF("oCl*=.2;");class BlurFilter extends BaseFilter{get GLSL(){return _8b}};let _9b=CSF("float t=uL[0].x,k=uL[0].y,l=dot(oCl.rgb,vec3(.2126,.7152,.0722)),s=clamp((l-t+k)/(2.*k),0.,1.),b=max(l-t,0.)+s*s*k;oCl.rgb=tmpCl.rgb+oCl.rgb*b*uL[0].z;oCl.a=tmpCl.a;");class GlowFilter extends BaseFilter{constructor(c={}){super(c);this.threshold=c.threshold??.7;this.knee=c.knee??1;this.bloom=c.bloom??.01};get GLSL(){return _9b};get threshold(){return this[$[0]][0]};set threshold(v){this[$[0]][0]=v};get knee(){return this[$[0]][1]};set knee(v){this[$[0]][1]=v};get bloom(){return this[$[0]][2]};set bloom(v){this[$[0]][2]=v}};class ChromaticAberrationFilter extends BaseFilter{get GLSL(){return"vec2 am=vec2(vol.x,0);oCl=vec4(texture(uB,v0.zw-am).r,oCl.g,texture(uB,v0.zw+am).b,1);"}};class HueRotateFilter extends BaseFilter{get GLSL(){return"float ca=cos(v),sa=sin(v);oCl.rgb*=mat3(.299+.701*ca+.168*sa,.587-.587*ca+.330*sa,.114-.114*ca-.497*sa,.299-.299*ca-.328*sa,.587+.413*ca+.035*sa,.114-.114*ca+.292*sa,.299-.300*ca+1.250*sa,.587-.588*ca-1.050*sa,.114+.886*ca-.203*sa);"}};window.PWGL=window.AGL={version:"7.0.0",BlendMode,TintType,Texture,Framebuffer,Context,Buffer,Utils,Const,Item,BaseDrawable,Light,AnimatedImage,Container,Image,Text,BaseRenderer,BatchRenderer,FilterRenderer,NormalMapRenderer,AmbientOcclusionMapRenderer,LightRenderer,Stage2D,BaseFilter,BaseKernelFilter,BaseTextureFilter,DisplacementFilter,MaskFilter,PixelateFilter,EdgeDetectFilter,SharpenFilter,SaturateFilter,GrayscaleFilter,SepiaFilter,InvertFilter,TintFilter,PosterizeFilter,RainbowFilter,BrightnessFilter,ContrastFilter,HueRotateFilter,GammaFilter,BlurFilter,GlowFilter,ChromaticAberrationFilter};console.log(`%cPWGL v${AGL.version}\nhttps:\/\/github.com/asjs-dev/pwgl`,"background:#222;color:#0F0");})();