!function(e){"function"==typeof define&&define.amd?define(e):e()}(function(){"use strict";const e=(e,a)=>(e&a)===a,a=()=>{},r=(()=>{const e={fps:0,delay:0};let r=0,t=0,s=0,n=Date.now();return e.update=()=>{const a=Date.now();r++,e.delay=(a-n)/16.6667,n=a,a>=s&&(e.fps=1e3*r/(a-t),t=a,s=a+1e3,r=0)},e.init=e.start=a,e})(),t=(e,a,r,t)=>({icon:e,label:a,style:`background: ${t}; color: ${r}; font-family: monospace;`}),s={BASE:t("·","----","#999","#000"),PROGRAM:t("◉","PROG","#7CFF9B","#0b3d1f"),BINDING:t("↔","BIND","#4FC3F7","#002233"),RESOURCES:t("□","RESOURCE","#FFD54F","#3a2a00"),BUFFER_UPLOAD:t("↑","UPLD","#FF7043","#3b1200"),TEXTURE_PARAMS:t("▦","TEXT","#c792ea","#2a1433"),UNIFORMS:t("≡","UNIF","#FF7AA2","#2a0f1a"),VERTEX_ATTRIBUTES:t("▣","ATTR","#26E6A6","#00382f"),VIEWPORT:t("▢","FRAM","#90a4ae","#1c262b"),BLENDING:t("≈","BLND","#69f0ae","#032"),SAMPLERS:t("⇅","SAMP","#000","#33F"),FRAMEBUFFERS:t("▭","FBO ","#fff","#4a148c"),RENDERBUFFERS:t("▩","RBO ","#fff","#004d40"),DEPTH_STENCIL:t("∠","DPTH","#999","#333"),DRAW:t("●","DRAW","#fff","#d50000"),ALERT:t("■","ALRT","#fff","#b00020"),WARN:t("▲","WARN","#000","#fc0")},n=["DEPTH_TEST","CULL_FACE","STENCIL_TEST"],c=e=>e,o=()=>"\n |"+(new Error).stack.split("\n").slice(3).map(e=>e.trim().slice(3)).join("\n |"),u=(a,t={})=>{const u=(i=t.maxFrameCount??5,l=0,f=20,Math.max(i,Math.min(l,f)));var i,l,f;const S=t.flags??0,m=[],E=[],d=PWGL?Object.entries(PWGL.Const).reduce((e,[a,r])=>(e[r]=a,e),{}):{};let R,g,p,F,b,A=-1;const D=e=>e.map(e=>d[e]??e),T=e(S,4)?c:e=>e.map(e=>e&&(Array.isArray(e)||e.constructor?.name?.endsWith("Array"))?`[${e.constructor.name}(${e.length})]`:e),M=e(S,2)?c:D,P=e(S,1)?o:(e=>()=>e)(""),h={canvas:a.canvas,snapshots:m,toString:()=>{m.forEach((e,a)=>{console.log("%c > FRAME #"+a+" => ","background:#000;color:#00ff00;font-weight:bold;");const r=E[a];e.forEach(e=>{const a=((e,a,r)=>{if(e>5)return s.ALERT;if(e>2)return s.WARN;switch(a){case"createProgram":case"attachShader":case"linkProgram":case"validateProgram":case"deleteProgram":case"useProgram":return s.PROGRAM;case"createShader":case"shaderSource":case"compileShader":case"deleteShader":case"getBufferSubData":case"finish":case"flush":case"readPixels":return s.WARN;case"getError":return s.ALERT;case"bindVertexArray":case"bindBuffer":case"activeTexture":case"bindTexture":return s.BINDING;case"createBuffer":return s.RESOURCES;case"bufferData":case"texImage2D":case"bufferSubData":case"copyBufferSubData":case"texSubImage2D":case"texStorage2D":case"copyTexImage2D":case"copyTexSubImage2D":case"compressedTexImage2D":case"compressedTexSubImage2D":return s.BUFFER_UPLOAD;case"texParameteri":case"generateMipmap":return s.TEXTURE_PARAMS;case"bindBufferBase":case"bindBufferRange":return s.UNIFORMS;case"enableVertexAttribArray":case"vertexAttribPointer":case"vertexAttribDivisor":case"vertexAttribIPointer":case"disableVertexAttribArray":return s.VERTEX_ATTRIBUTES;case"viewport":case"scissor":case"clearColor":case"clear":return s.VIEWPORT;case"blendEquation":case"blendFuncSeparate":return s.BLENDING;case"drawElementsInstanced":case"drawArrays":case"drawElements":case"drawArraysInstanced":case"drawRangeElements":case"drawBuffers":case"drawElementsInstancedBaseVertex":return s.DRAW;case"createSampler":case"samplerParameteri":case"bindSampler":case"deleteSampler":return s.SAMPLERS;case"createFramebuffer":case"bindFramebuffer":case"framebufferTexture2D":case"framebufferRenderbuffer":case"checkFramebufferStatus":case"blitFramebuffer":return s.FRAMEBUFFERS;case"createRenderbuffer":case"bindRenderbuffer":case"renderbufferStorage":case"renderbufferStorageMultisample":return s.RENDERBUFFERS;case"depthFunc":case"depthMask":case"cullFace":case"frontFace":case"stencilFunc":case"stencilOp":return s.DEPTH_STENCIL}return a.startsWith("createTexture")?s.RESOURCES:a.startsWith("uniform")?s.UNIFORMS:a.startsWith("enable")&&n.includes(r[0])?s.DEPTH_STENCIL:s.BASE})(e.currentCallDurationMS,e.prop,D(e.args));console.log("%c "+a.icon+" "+a.label+`|${String(e.sumFrameDurationMS).padStart(r.sumFrameDurationMS)}ms|${String(e.currentCallDurationMS).padStart(r.currentCallDurationMS)}ms| ${String(e.prop).padStart(r.prop)}`+(e.args.length?`( ${M(e.args).join(" ")} )`:"")+e.stackTrace,a.style)})})}};return((e,a=0)=>{const t={};let s,n,c,o,u,i=Date.now(),l=!1;const f=()=>{r.update(),e(r.fps,r.delay)},S=()=>{const e=Date.now(),a=e-i;a>=o&&(o=2*c-a,i=e,f())},m=()=>{l&&(s(),u=requestAnimationFrame(m))};t.isPlaying=()=>l,t.clearMaxFPS=()=>{n=1/0,s=f},t.getMaxFPS=()=>n,t.setMaxFPS=e=>{if(!e||e<=0)return t.clearMaxFPS();n=e,o=c=Math.floor(1e3/n)-1,s=S},t.start=()=>{l||(l=!0,m())},t.stop=()=>{cancelAnimationFrame(u),l=!1},t.setMaxFPS(a),t.start()})(()=>A++),PWGLDebugger.instances.push(h),console.log("PWGL Debugger",h),new Proxy(a,{get(e,a){const r=e[a];return"function"==typeof r?((e,a,r)=>function(...t){if(A<=u&&(R!==A&&(p=[],F={},m[A]=p,E[A]=F,R=A,g=Date.now(),b=0),R>=0)){const e=p.length,a=Date.now(),s=a-g;b+=s,g=a,e>0&&(p[e-1].currentCallDurationMS=s,F.currentCallDurationMS=Math.max(String(s).length,F.currentCallDurationMS??0)),p.push({stackTrace:P(),currentCallDurationMS:0,sumFrameDurationMS:b,prop:r,args:T(t)}),F.sumFrameDurationMS=Math.max(String(b).length,F.sumFrameDurationMS??0),F.prop=Math.max(r.length,F.prop??0)}return e.apply(a,t)})(r,e,a):r}})};window.PWGLDebugger={version:"0.0.2",SHOW_CALL_STACKS:1,SHOW_ORIGINAL_VALUES:2,SHOW_ARRAYS:4,init:(e={})=>{const a=HTMLCanvasElement.prototype.getContext;HTMLCanvasElement.prototype.getContext=function(...r){const t=a.call(this,...r);return r[0]&&r[0].startsWith("webgl")?u(t,e):t}},instances:[]},console.log(`%cPWGL Debugger v${PWGLDebugger.version}\nhttps://github.com/asjs-dev/pwgl`,"background:#222;color:#0F0")});
