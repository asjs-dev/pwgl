(()=>{var $="updateId,removeEventListener,config,context,addEventListener,height,createVersion,locations,propsUpdateId,matrixCache,heightMap,precision,useActiveTexture,children,clearColor,initRendererConfig,textureProps,updateAnimation,colorCache,createElement,activeTexture,texParameteri,useTexture,setBlendMode,sinRotationB,cosRotationB,sinRotationA,cosRotationA,maxTextureImageUnits,container,textureMatrixCache,maxBatchItems,colorUpdateId,textureIds,clearBeforeRender,scaledHeight,useTextureAt,placeholderImage,textureRepeatRandomCache,sourceImage,textureCrop,scaledWidth,removeChild,bindTexture,distortionProps,webglcontextrestored,useProgram,clearTextures,getChildIndex,setChildIndex,distortionPropsCache,normalMap,getProgramParameter,contextId,initCallback,premultipliedAlpha,interactive,webglcontextlost,frameLength,readystatechange,deactivateTexture,uploadTextureInfo,contextAttributes,useRepeatTextures,textureCropCache,getShaderInfoLog,_MAX_TEXTURE_NUM,renderable,heightHalf,depthMultiplier,bindVertexArray,bindFramebuffer,updateRotation,distortTexture,_draw,naturalWidth,number,touchstart,mousedown,touchmove,mousemove,Separate,touchend".split(",");"use strict";var F32A=Float32Array,$m=Math,$d=document,$n=null,$o=Object;var $rfa=(d,b)=>{var f=d.indexOf(b);f>-1&&d.splice(f,1)};var noop=()=>{};var $as=(g,h,c)=>{var i=h.length;while(--i>-1)g[c+i]=h[i]};var _4s={a:"Attrib",u:"Uniform"};var _4r=(b,n,p)=>{var g=b.createShader(n);b.shaderSource(g,p);b.compileShader(g);return g};var Utils={THETA:$m.PI/180,GLSL:{RANDOM:"float rand(vec2 p,float s){return fract(sin(dot(p,vec2(sin(p.x+p.y),cos(p.y-p.x)*s))*s)*.5+.5);}float rand(vec2 p){return rand(p,1.);}"},INFO:{isWebGl2Supported:!1},initContextConfig:(h)=>({canvas:(h=h||{}).canvas||$d[$[19]]("canvas"),initCallback:h[$[54]],contextAttributes:{...{powerPreference:"high-performance",preserveDrawingBuffer:!1,premultipliedAlpha:!1},...(h[$[62]]||{})}}),initRendererConfig:(h)=>({locations:(h=h||{})[$[7]]||[],precision:h[$[11]]||"highp",context:h[$[3]]||new Context()}),createVersion:(m)=>"#version 300 es\nprecision "+m+" float;\n",initApplication:(k)=>{var v=()=>{if([$[56],"complete"].indexOf($d.readyState)>-1){$d[$[1]]($[59],v);k(Utils.INFO.isWebGl2Supported)}else $d[$[4]]($[59],v)};v()},createProgram:(b,w,y)=>{var q=_4r(b,35633,w);var t=_4r(b,35632,y);var j=b.createProgram();b.attachShader(j,q);b.attachShader(j,t);b.linkProgram(j);if(!b[$[52]](j,35714)){console.error("Program info:",b.getProgramInfoLog(j),"\n","Validate status:",b[$[52]](j,35715),"\n","Vertex shader info:",b[$[65]](q),"\n","Fragment shader info:",b[$[65]](t));b.deleteShader(q);b.deleteShader(t);b.deleteProgram(j);throw"WebGL application stoped"};return j},getLocationsFor:(b,j,x)=>{var l={};x.forEach((d)=>{l[d]=b["get"+_4s[d[0]]+"Location"](j,d)});return l}};var Const={};var _gl=$d[$[19]]("canvas").getContext("webgl2");if(_gl){for(var c in _gl){var f=_gl[c];if(typeof f===$[76]&&c===c.toUpperCase())Const[c]=f};Utils.INFO.isWebGl2Supported=!0;Utils.INFO[$[28]]=_gl.getParameter(34930)};var _5d=(c,b)=>({functionName:"blendFunc"+(c.length<3?"":$[81]),functions:c,equationName:"blendEquation"+(!b||b.length<2?"":$[81]),equations:b||[32774]});var BlendMode={NONE:_5d([0,0]),NORMAL_PM:_5d([1,771]),ADD_PM:_5d([1,1]),MULTIPLY_PM:_5d([774,771,1,771]),SCREEN_PM:_5d([1,769,1,771]),ADD_NPM:_5d([770,1,1,1]),SRC_IN:_5d([772,0]),SRC_OUT:_5d([773,0]),SRC_ATOP:_5d([772,771]),DST_OVER:_5d([773,1]),DST_IN:_5d([0,770]),DST_OUT:_5d([0,771]),DST_ATOP:_5d([773,770]),XOR:_5d([773,771]),NORMAL:_5d([770,771,1,771]),ADD:_5d([770,772,1,772]),MULTIPLY:_5d([774,0]),SCREEN:_5d([770,769,1,769]),OVERLAY:_5d([1,771]),EXCLUSION:_5d([775,769]),LIGHTEN:_5d([1,1],[32776]),DARKEN:_5d([1,1],[32775]),SHADOW:_5d([774,768])};class TextureInfo{constructor(){this.target=3553;this._$cK=-1;this.$currentAglId=this.$updateId=this.$currentUpdateId=0;this.wrapS=this.wrapT=33071;this.internalFormat=this.format=6408;this.minFilter=9986;this.magFilter=9728;this.$width=this.$height=1;this.type=5121};get width(){return this.$width};get height(){return this.$height};get wrapS(){return this._$k};set wrapS(v){if(this._$k!==v){this._$k=v;++this.$updateId}};get wrapT(){return this._$r};set wrapT(v){if(this._$r!==v){this._$r=v;++this.$updateId}};get internalFormat(){return this._$cQ};set internalFormat(v){if(this._$cQ!==v){this._$cQ=v;++this.$updateId}};get format(){return this._$G};set format(v){if(this._$G!==v){this._$G=v;++this.$updateId}};get minFilter(){return this._$cd};set minFilter(v){if(this._$cd!==v){this._$cd=v;++this.$updateId}};get magFilter(){return this._$Y};set magFilter(v){if(this._$Y!==v){this._$Y=v;++this.$updateId}};get type(){return this._$f};set type(v){if(this._$f!==v){this._$f=v;++this.$updateId}};use(b,c,d,f){if(!this.$hasNeedToDraw(b,c,f)&&(this._$cK!==c||d))this.bindActiveTexture(b,c)};useActiveTexture(b,c){this[$[20]](b,c);this[$[22]](b)};useActiveTextureAfterUpdate(b,c){this[$[20]](b,c);this.useTextureAfterUpdate(b)};unbindTexture(b,c){this[$[20]](b,c);this._$cK=-1;b[$[43]](this.target,$n)};activeTexture(b,c){this._$cK=c;b[$[20]](33984+c)};bindActiveTexture(b,c){this[$[20]](b,c);b[$[43]](this.target,this._$cq)};useTexture(b){b[$[43]](this.target,this._$cq);this.createTexImage2D(b)};useTextureAfterUpdate(b){b[$[43]](this.target,this._$cq);this[$[61]](b)};createTexImage2D(b){b.texImage2D(this.target,0,this._$cQ,this.width,this[$[5]],0,this._$G,this._$f,this._$cA);this[$[61]](b)};uploadTextureInfo(b){b[$[21]](this.target,10242,this._$k);b[$[21]](this.target,10243,this._$r);b[$[21]](this.target,10241,this._$cd);b[$[21]](this.target,10240,this._$Y);b[$[21]](this.target,33085,0);b.generateMipmap(this.target)};destruct(){};$hasNeedToDraw(){}};class Context{constructor(g){this[$[53]]=0;this._$y=Utils.initContextConfig(g||{});this.canvas=this._$y.canvas;this[$[66]]=Utils.INFO[$[28]];this._$cH=this._$cH.bind(this);this._$cp=this._$cp.bind(this);this._$cP=this._$cP.bind(this);this.canvas[$[4]]($[57],this._$cH);this.canvas[$[4]]($[45],this._$cp);this._$cp()};isLost(){return this.gl&&this.gl.isContextLost&&this.gl.isContextLost()};useBlendMode(l){this._$cX=l;this.gl[l.equationName].apply(this.gl,l.equations);this.gl[l.functionName].apply(this.gl,l.functions)};setBlendMode(l,r){if(this._$cX!==l){r&&r();this.useBlendMode(l)}};destruct(){this.gl[$[46]]($n);this.canvas[$[1]]($[57],this._$cH);this.canvas[$[1]]($[45],this._$cp);this._$cO&&this._$cO.loseContext()};clearTextures(){for(var i=0;i<this[$[66]];++i){this._$ch[i]=$n;this._$dg[i]=i};this[$[33]].length=0};useTexture(q,p,m,k){if(!q)return-1;var n=this._$ch.indexOf(q);if(n<0){n=this._$dg[0];m=!0};if(this._$dg.length<1){k&&k();this[$[47]]();n=0;m=!0};return this[$[36]](q,n,p,m)};useTextureAt(q,n,p,m){q.use(this.gl,n,m,p);this._$ch[n]=q;this[$[33]].indexOf(n)<0&&this[$[33]].push(n);$rfa(this._$dg,n);return n};deactivateTexture(q){var n=this._$ch.indexOf(q);n>-1&&q.unbindTexture(this.gl,n)};useProgram(j,c){if(this._$cN!==j){this._$cN=j;this[$[47]]();var b=this.gl;b[$[70]]($n);b[$[46]](j);b[$[70]](c);return!0};return!1};setCanvasSize(d,h){this.canvas.width=d;this.canvas[$[5]]=h};setSize(d,h){if(this._$h!==d||this._$z!==h){this._$h=d;this._$z=h;this.gl.viewport(0,0,d,h);this.gl.scissor(0,0,d,h)}};_$cH(f){f.preventDefault();this._$cO&&setTimeout(this._$cP,1)};_$cP(){this._$cO.restoreContext()};_$cp(){var b=(this.gl=this.canvas.getContext("webgl2",this._$y[$[62]]));b.agl_id=++this[$[53]];this._$cO=b.getExtension("WEBGL_lose_context");b.pixelStorei(37441,!0);b.enable(3042);b.blendColor(1,1,1,1);b.enable(3089);this._$h=this._$z=this._$cN=this._$cX=$n;this._$ch=[];this._$dg=[];this[$[33]]=[];this[$[47]]();this.setCanvasSize(1,1);this._$y[$[54]]&&setTimeout(this._$y[$[54]],1)}};class Buffer{constructor(p,d,f,g,j,h,m){var k=f*g;this.data=typeof d===$[76]?new F32A(d*k):d;this._$cB=p;this._$c=f;this._$d=g;this._$E=j||34962;this._$f=h||35048;this._$H=k*4;this._$F=g*4;this._$O=typeof m===$[76]?m:1;if(this._$f===35044)this._$H=this._$F=0};create(b,n){this._$V=n[this._$cB];this._$J=b.createBuffer();this.bind(b)};bind(b){b.bindBuffer(this._$E,this._$J)};upload(b,l){this.bind(b);l&&this._$I(b);b.bufferData(this._$E,this.data,this._$f)};destruct(){this.data=$n};_$I(b){var i=-1;while(++i<this._$c){var c=this._$V+i;b.enableVertexAttribArray(c);b.vertexAttribPointer(c,this._$d,5126,!1,this._$H,i*this._$F);b.vertexAttribDivisor(c,this._$O)}}};var FPS={start:function(c=60){this._$X=this._$g=this._$D=this._$W=this.fps=this.delay=0;this._$g=Date.now();this._$X=1e3/c},update:function(){this._$D++;var b=Date.now();this.delay=(b-this._$g)/this._$X;if(b>=this._$W+1e3){this.fps=(this._$D*1e3)/(b-this._$W);this._$W=b;this._$D=0};this._$g=b}};class BaseProps{constructor(){this[$[0]]=0}};class BasePositioningProps extends BaseProps{constructor(){super();this._$cY=this._$dw=this[$[26]]=this[$[24]]=this._x=this._y=this._$T=this._$R=this._$Q=this._$j=this._$l=0;this[$[27]]=this[$[25]]=1};get x(){return this._x};set x(v){if(this._x!==v){this._x=v;++this[$[0]]}};get y(){return this._y};set y(v){if(this._y!==v){this._y=v;++this[$[0]]}};get rotation(){return this._$T};set rotation(v){if(this._$T!==v){this._$T=v;++this._$cY}};get anchorX(){return this._$R};set anchorX(v){if(this._$R!==v){this._$R=v;++this[$[0]]}};get anchorY(){return this._$Q};set anchorY(v){if(this._$Q!==v){this._$Q=v;++this[$[0]]}};get skewX(){return this._$j};set skewX(v){if(this._$j!==v){this._$j=v;++this._$cY}};get skewY(){return this._$l};set skewY(v){if(this._$l!==v){this._$l=v;++this._$cY}};updateRotation(){if(this._$dw<this._$cY){this._$dw=this._$cY;++this[$[0]];if(this._$j===0&&this._$l===0){this[$[26]]=this[$[24]]=$m.sin(this._$T);this[$[27]]=this[$[25]]=$m.cos(this._$T)}else{var k=this._$T-this._$j;var l=this._$T+this._$l;this[$[26]]=$m.sin(l);this[$[27]]=$m.cos(l);this[$[24]]=$m.sin(k);this[$[25]]=$m.cos(k)}}}};class ColorProps extends BaseProps{constructor(){super();this.items=[1,1,1,1]};get r(){return this.items[0]};set r(v){if(this.items[0]!==v){this.items[0]=v;++this[$[0]]}};get g(){return this.items[1]};set g(v){if(this.items[1]!==v){this.items[1]=v;++this[$[0]]}};get b(){return this.items[2]};set b(v){if(this.items[2]!==v){this.items[2]=v;++this[$[0]]}};get a(){return this.items[3]};set a(v){if(this.items[3]!==v){this.items[3]=v;++this[$[0]]}};set(r,g,b,a){this.r=r;this.g=g;this.b=b;this.a=a}};class ItemProps extends BasePositioningProps{constructor(){super();this.$scaleUpdateId=this._$ds=0;this[$[41]]=this[$[35]]=this._$w=this._$t=this.$width=this.$height=this.alpha=1};get scaleX(){return this._$w};set scaleX(v){if(this._$w!==v){this._$w=v;++this.$scaleUpdateId}};get scaleY(){return this._$t};set scaleY(v){if(this._$t!==v){this._$t=v;++this.$scaleUpdateId}};get width(){return this.$width};set width(v){if(this.$width!==v){this.$width=v;++this.$scaleUpdateId}};get height(){return this.$height};set height(v){if(this.$height!==v){this.$height=v;++this.$scaleUpdateId}};updateScale(){if(this._$ds<this.$scaleUpdateId){this._$ds=this.$scaleUpdateId;++this[$[0]];this[$[41]]=this.$width*this._$w;this[$[35]]=this.$height*this._$t}}};class LightProps extends ItemProps{constructor(){super();this.z=0};get width(){return this.$width};set width(v){if(this.$width!==v){this.$width=this.$height=v;++this.$scaleUpdateId}};get height(){return this.$height};set height(v){}};var RectangleUtilities={create:(x,y,c,d)=>({x:x||0,y:y||0,width:c||0,height:d||0}),toRelativeSize:(b,c,d)=>({x:b.x/c,y:b.y/d,width:b.width/c,height:b[$[5]]/d})};class TextureCrop extends BaseProps{constructor(){super();this._$cR=0;this.items=[0,0,1,1];this._$h=this._$z=1};get x(){return this.items[0]};set x(v){if(this.items[0]!==v){this.items[0]=v;++this[$[0]]}};get y(){return this.items[1]};set y(v){if(this.items[1]!==v){this.items[1]=v;++this[$[0]]}};get width(){return this._$h};set width(v){if(this._$h!==v){this._$h=v;++this[$[0]]}};get height(){return this._$z};set height(v){if(this._$z!==v){this._$z=v;++this[$[0]]}};updateCrop(){if(this._$cR<this[$[0]]){this._$cR=this[$[0]];this.items[2]=this._$h-this.items[0];this.items[3]=this._$z-this.items[1]}};setRect(b){this.x=b.x;this.y=b.y;this.width=b.width;this[$[5]]=b[$[5]]}};class TextureProps extends BasePositioningProps{constructor(){super();this._$P=this._$K=1;this.items=[0,0,0]};get scaledWidth(){return this._$P};get scaledHeight(){return this._$K};get repeatX(){return this._$P};set repeatX(v){if(this._$P!==v){this._$P=v;++this[$[0]]}};get repeatY(){return this._$K};set repeatY(v){if(this._$K!==v){this._$K=v;++this[$[0]]}};get repeatRandomRotation(){return this.items[0]};set repeatRandomRotation(v){this.items[0]=v};get repeatRandomAlpha(){return this.items[1]};set repeatRandomAlpha(v){this.items[1]=v};get repeatRandomBlur(){return this.items[2]};set repeatRandomBlur(v){this.items[2]=v}};class DistortionProps{constructor(){this[$[73]]=!0;this.items=[0,0,1,0,1,1,0,1]};get topLeftX(){return this.items[0]};set topLeftX(v){this.items[0]=v};get topLeftY(){return this.items[1]};set topLeftY(v){this.items[1]=v};get topRightX(){return this.items[2]};set topRightX(v){this.items[2]=v};get topRightY(){return this.items[3]};set topRightY(v){this.items[3]=v};get bottomRightX(){return this.items[4]};set bottomRightX(v){this.items[4]=v};get bottomRightY(){return this.items[5]};set bottomRightY(v){this.items[5]=v};get bottomLeftX(){return this.items[6]};set bottomLeftX(v){this.items[6]=v};get bottomLeftY(){return this.items[7]};set bottomLeftY(v){this.items[7]=v}};class BaseFilter{constructor(b,c,d){this.TYPE=b;this.SUB_TYPE=c;this.on=!0;this.v=new F32A(9);this.kernels=new F32A(16);this.intensity=d||0};get intensity(){return this.v[0]};set intensity(v){this.v[0]=v};get intensityX(){return this.v[0]};set intensityX(v){this.v[0]=v};get intensityY(){return this.v[1]};set intensityY(v){this.v[1]=v};get r(){return this.v[2]};set r(v){this.v[2]=v};get g(){return this.v[3]};set g(v){this.v[3]=v};get b(){return this.v[4]};set b(v){this.v[4]=v}};class FilterTextureProps{constructor(d,f,h,j,b,c,g,k){this._$C=d;this.texture=f;this.translateX=h||0;this.translateY=j||0;this.cropX=b||0;this.cropY=c||0;this.cropWidth=g||1;this.cropHeight=k||1};get translateX(){return this._$C.v[1]};set translateX(v){this._$C.v[1]=v};get translateY(){return this._$C.v[2]};set translateY(v){this._$C.v[2]=v};get cropX(){return this._$C.v[3]};set cropX(v){this._$C.v[3]=v};get cropY(){return this._$C.v[4]};set cropY(v){this._$C.v[4]=v};get cropWidth(){return this._$C.v[5]};set cropWidth(v){this._$C.v[5]=v};get cropHeight(){return this._$C.v[6]};set cropHeight(v){this._$C.v[6]=v}};class Texture extends TextureInfo{constructor(j,m){super();this._$x=Texture[$[37]];this._$cW=this._$cW.bind(this);this.source=j;this.shouldUpdate=m;this._$dk="width";this._$dn=$[5];this._$dj=this._$cy=this._$dm=0;this._$cf};get width(){return this._$cr||1};get height(){return this._$cz||1};get source(){return this._$x};set source(f){if(f){this._$A=!1;this._$x[$[1]](this._$cf,this._$cW);this._$x=f?f:Texture[$[37]];this.isVideo=f.tagName?f.tagName.toLowerCase()==="video":!1;this._$cf=this.isVideo?"canplay":"load";if(f){this._$cW();!this._$A&&f[$[4]](this._$cf,this._$cW)}}};destruct(){this._$x[$[1]](this._$cf,this._$cW)};$hasNeedToDraw(b,c,l){if(this.$currentAglId<b.agl_id){this.$currentAglId=b.agl_id;this._$cq=b.createTexture();this[$[12]](b,c);return!0};if(this.$currentUpdateId<this.$updateId){this.$currentUpdateId=this.$updateId;this[$[12]](b,c);return!0};if(this._$dm<this._$cy){this._$dm=this._$cy;this[$[12]](b,c);return!0};if(this.shouldUpdate&&this._$dj<l){this._$dj=l;this[$[12]](b,c);return!0};if(this.isVideo&&!this._$x.paused){this[$[12]](b,c);return!0};return!1};get _$cr(){return this._$x[this._$dk]};get _$cz(){return this._$x[this._$dn]};_$cW(){this._$dk="width";this._$dn=$[5];if(this._$x[$[75]]){this._$dk=$[75];this._$dn="naturalHeight"}else if(this._$x.videoWidth){this._$dk="videoWidth";this._$dn="videoHeight"};this._$A=this._$cr*this._$cz>0;if(this._$A){this._$cA=this._$x;++this._$cy}else this._$cA=$n}};Texture[$[37]]=$d[$[19]]("img");Texture.loadImage=(d,m)=>{var g=$d[$[19]]("img");var k=new Texture(g,m);g.src=d;return k};Texture.loadVideo=(d,m)=>{var h=$d[$[19]]("video");var k=new Texture(h,m);h.src=d;return k};class Framebuffer extends TextureInfo{constructor(){super();this._$cM=this._$dt=0};get width(){return this.$width};set width(v){if(this.$width!==v&&v>0){this.$width=v;++this._$cM}};get height(){return this.$height};set height(v){if(this.$height!==v&&v>0){this.$height=v;++this._$cM}};setSize(w,h){this.width=w;this[$[5]]=h};bind(b){b[$[71]](36160,this._$cv)};unbind(b){b[$[71]](36160,$n)};$hasNeedToDraw(b,c){if(this.$currentAglId<b.agl_id){this.$currentAglId=b.agl_id;this._$cq=b.createTexture();this[$[12]](b,c);this._$cv=b.createFramebuffer();this.bind(b);b.framebufferTexture2D(36160,36064,3553,this._$cq,0);this.unbind(b);return!0};if(this.$currentUpdateId<this.$updateId){this.$currentUpdateId=this.$updateId;this.useActiveTextureAfterUpdate(b,c);return!0};if(this._$dt<this._$cM){this._$dt=this._$cM;this[$[12]](b,c);return!0};return!1}};var PointUtilities={create:(x,y)=>({x:x||0,y:y||0})};var Matrix3Utilities={identity:()=>new F32A([1,0,0,1,0,0]),projection:(v,m)=>{v[0]=2/m.width;v[1]=v[2]=0;v[3]=-2/m[$[5]];v[4]=-1;v[5]=1},transformLocal:(c,v)=>{var g=c.anchorX;var h=c.anchorY;var n=c[$[41]];var t=c[$[35]];v[0]=c[$[27]]*n;v[1]=c[$[26]]*n;v[2]=-c[$[24]]*t;v[3]=c[$[25]]*t;v[4]=c.x-g*v[0]-h*v[2];v[5]=c.y-g*v[1]-h*v[3]},transform:(f,c,v)=>{var x=c.x;var y=c.y;var g=c.anchorX;var h=c.anchorY;var s=c[$[26]];var p=c[$[24]];var q=c[$[27]];var r=c[$[25]];var n=c[$[41]];var t=c[$[35]];v[0]=(q*f[0]+s*f[2])*n;v[1]=(q*f[1]+s*f[3])*n;v[2]=(r*f[2]-p*f[0])*t;v[3]=(r*f[3]-p*f[1])*t;v[4]=-g*v[0]-h*v[2]+x*f[0]+y*f[2]+f[4];v[5]=-g*v[1]-h*v[3]+x*f[1]+y*f[3]+f[5]},inverse:(f,v)=>{var b=1/(f[0]*f[3]-f[2]*f[1]);v[0]=b*f[3];v[1]=-b*f[1];v[2]=-b*f[2];v[3]=b*f[0];v[4]=b*(f[2]*f[5]-f[3]*f[4]);v[5]=-b*(f[0]*f[5]-f[1]*f[4])},isPointInMatrix:(f,d)=>{var x=d.x*f[0]+d.y*f[2]+f[4];var y=d.x*f[1]+d.y*f[3]+f[5];return x>=0&&x<=1&&y>=0&&y<=1},calcCorners:(f,j,m)=>{var k=m.widthHalf;var l=m[$[68]];j[0].x=k+f[4]*k;j[0].y=m[$[5]]-(l+f[5]*l);j[1].x=j[0].x+(f[0]+f[2])*k;j[1].y=j[0].y-(f[1]+f[3])*l;j[2].x=j[0].x+(f[0]+k*f[2]);j[2].y=j[0].y-(f[1]+l*f[3]);j[3].x=j[0].x+(k*f[0]+f[2]);j[3].y=j[0].y-(l*f[1]+f[3])}};class BaseItem{constructor(){this[$[9]]=Matrix3Utilities.identity();this[$[32]]=this[$[8]]=0;this[$[18]]=[1,1,1,1]};handleEvent(c,b){if(this[$[56]]){var f=b.type;var d=this["on"+f];d&&d(this,c,b)};if(this.$parent)this.$parent.handleEvent(c,b)};destruct(){}};class Item extends BaseItem{constructor(){super();this.TYPE=Item.TYPE;this[$[67]]=!0;this.props=new ItemProps();this.color=new ColorProps();this._$dr=this.$currentColorUpdateId=this._$dx=this.$currentParentColorUpdateId=this.$currentAdditionalPropsUpdateId=0;this.callback=noop;this.$bounds=RectangleUtilities.create()};get stage(){return this.$parent?this.$parent.stage:$n};get parent(){return this.$parent};set parent(v){if(this.$parent!==v){this.$parent=v;this._$dx=this.$currentParentColorUpdateId=this.$currentAdditionalPropsUpdateId=0}};get callback(){return this._$U};set callback(v){this._$U=v||noop};getBounds(){return this.$bounds};destruct(){this.$parent&&this.$parent[$[42]]&&this.$parent[$[42]](this);super.destruct()};update(){this.$updateProps()};$updateProps(){var b=this.props;b[$[72]]();b.updateScale();var c=this.$parent;(this._$dx<c[$[8]]||this._$dr<b[$[0]])&&this.$updateTransform(b,c)};$updateTransform(b,c){this._$dx=c[$[8]];this._$dr=b[$[0]];++this[$[8]];Matrix3Utilities.transform(c[$[9]],b,this[$[9]])}};Item.TYPE="item";class BaseDrawable extends Item{constructor(){super();this.$inverseMatrixCache=new F32A(6);this.$corners=[PointUtilities.create(),PointUtilities.create(),PointUtilities.create(),PointUtilities.create()]};getCorners(){this.$updateAdditionalData();return this.$corners};getBounds(){this.$updateAdditionalData();return this.$bounds};$calcCorners(){Matrix3Utilities.calcCorners(this[$[9]],this.$corners,this.stage.renderer)};$calcBounds(){this.$calcCorners();var j=this.$corners;var h=this.$bounds;var a=j[0];var b=j[1];var c=j[2];var d=j[3];h.x=$m.min(a.x,b.x,c.x,d.x);h.y=$m.min(a.y,b.y,c.y,d.y);h.width=$m.max(a.x,b.x,c.x,d.x);h[$[5]]=$m.max(a.y,b.y,c.y,d.y)};$updateAdditionalData(){if(this.$currentAdditionalPropsUpdateId<this[$[8]]){this.$currentAdditionalPropsUpdateId=this[$[8]];Matrix3Utilities.inverse(this[$[9]],this.$inverseMatrixCache);this.$calcBounds()}}};class Container extends Item{constructor(){super();this.TYPE=Container.TYPE;this[$[13]]=[]};destruct(){this.empty();super.destruct()};empty(){while(this[$[13]].length)this.removeChildAt(0)};contains(b){return this[$[48]](b)>-1};addChild(b){this.addChildAt(b,this[$[13]].length)};addChildAt(b,c){if(b){b.parent&&b.parent[$[42]](b);this[$[13]].push(b);this[$[49]](b,c);b.parent=this}};removeChild(b){if(b){$rfa(this[$[13]],b);b.parent=$n}};removeChildAt(c){this[$[42]](this.getChildAt(c))};getChildAt(c){return this[$[13]][c]};setChildIndex(b,c){$rfa(this[$[13]],b);this[$[13]].splice(c,0,b)};getChildIndex(b){return this[$[13]].indexOf(b)};swapChildren(f,g){var l=this[$[48]](f);var m=this[$[48]](g);if(l>-1&&m>-1){this[$[49]](f,m);this[$[49]](g,l)}};getBounds(){var h=this.$bounds;h.x=h.y=1/0;h.width=h[$[5]]=-1/0;for(var i=0,l=this[$[13]].length;i<l;++i){var n=this[$[13]][i].getBounds();h.x=$m.min(h.x,n.x);h.y=$m.min(h.y,n.y);h.width=$m.max(h.width,n.width);h[$[5]]=$m.max(h[$[5]],n[$[5]])};return h};update(){this.$updateProps();this._$cw()};get premultipliedAlpha(){return this.props.alpha*this.$parent[$[55]]};_$cw(){var j=this.$parent;var d=this.color;if(this.$currentParentColorUpdateId<j[$[32]]||this.$currentColorUpdateId<d[$[0]]){this.$currentColorUpdateId=d[$[0]];this.$currentParentColorUpdateId=j[$[32]];++this[$[32]];var k=this[$[18]];var p=j[$[18]];k[0]=p[0]*d.r;k[1]=p[1]*d.g;k[2]=p[2]*d.b;k[3]=p[3]*d.a}}};Container.TYPE=$[29];class Light extends BaseDrawable{constructor(f,n,p){super();this.props=new LightProps();this.color.a=0;this._id=f;this._$m=f*16;this._$s=this._$m+4;this._$p=this._$m+8;this._$n=this._$m+12;this._$cb=n;this._$cG=p;this.castShadow=this.shading=!0;this.flattenShadow=!1;this.centerReflection=!0;this.angle=0;this.spotAngle=180*Utils.THETA;this.type=Light.Type.POINT;this[$[11]]=this.diffuse=this.reflectionSize=1;this.maxShadowStep=128};get type(){return this._$cG[this._$m]};set type(v){this._$cG[this._$m]=v};get castShadow(){return this._$cj};set castShadow(v){this._$cj=v;this._$dc()};get shading(){return this._$N};set shading(v){this._$N=v;this._$dc()};get flattenShadow(){return this._$cE};set flattenShadow(v){this._$cE=v;this._$dc()};get colorProofReflection(){return this._$dq};set colorProofReflection(v){this._$dq=v;this._$dc()};get centerReflection(){return this._$df};set centerReflection(v){this._$df=v;this._$dc()};get maxShadowStep(){return this._$cG[this._$s]};set maxShadowStep(v){this._$cG[this._$s]=v};get reflectionSize(){return this._$cG[this._$s+1]};set reflectionSize(v){this._$cG[this._$s+1]=v};get precision(){return this._$cG[this._$m+3]};set precision(v){this._$cG[this._$m+3]=v};get angle(){return this._$cb[this._$n+3]};set angle(v){this._$cb[this._$n+3]=v};get spotAngle(){return this._$cb[this._$m+7]};set spotAngle(v){this._$cb[this._$m+7]=v};isOn(){return this[$[67]]&&this.stage!==$n};update(){var n=this._$cb;var g=this._$n;if(this.isOn()){this.$updateProps();this._$cw();n[g]=n[g-1]>0?1:0;n[g+1]=this.diffuse;n[g+2]=this.props.alpha;n[this._$m+6]=this.props.width;this._$cG[this._$m+2]=this.props.z}else n[g]=0};_$dc(){this._$cG[this._$m+1]=(this._$cj*1)|(this._$N*2)|(this._$cE*4)|(this._$dq*8)|(this._$df*16)};$updateAdditionalData(){if(this.isOn()&&this.$currentAdditionalPropsUpdateId<this[$[8]]){this.$currentAdditionalPropsUpdateId=this[$[8]];this.$calcBounds()}};$calcCorners(){Matrix3Utilities.calcCorners(this[$[9]],this.$corners,this.stage.renderer);var m=this.$corners;var a=m[0];var b=m[1];var c=m[2];var d=m[3];a.x+=a.x-d.x+(a.x-c.x);a.y+=a.y-d.y+(a.y-c.y);c.x+=c.x-b.x;c.y+=c.y-b.y;d.x+=d.x-b.x;d.y+=d.y-b.y};$updateTransform(h,l){super.$updateTransform(h,l);$as(this._$cb,this[$[9]],this._$m)};_$cw(){var j=this.color;if(this.$currentColorUpdateId<j[$[0]]){this.$currentColorUpdateId=j[$[0]];var n=this._$cb;var q=this.$parent[$[18]];var k=this._$p;n[k]=q[0]*j.r;n[k+1]=q[1]*j.g;n[k+2]=q[2]*j.b;n[k+3]=q[3]*j.a}}};Light.Type={POINT:0,DIRECTIONAL:1};class Image extends BaseDrawable{constructor(texture){super();this.TYPE=Image.TYPE;this[$[30]]=Matrix3Utilities.identity();this.tintType=Image.TintType.NONE;this.blendMode=BlendMode.NORMAL;this[$[16]]=new TextureProps();this[$[40]]=new TextureCrop();this[$[44]]=new DistortionProps();this._$dy=0;this[$[64]]=this[$[40]].items;this[$[38]]=this[$[16]].items;this[$[50]]=this[$[44]].items;this[$[18]]=this.color.items;this.texture=texture};update(){this.$updateProps();this._$cF();this[$[40]].updateCrop()};isContainsPoint(c){this.$updateAdditionalData();return Matrix3Utilities.isPointInMatrix(this.$inverseMatrixCache,c)};_$cF(){var d=this[$[16]];d[$[72]]();if(this._$dy<d[$[0]]){this._$dy=d[$[0]];Matrix3Utilities.transformLocal(d,this[$[30]])}}};Image.TYPE="drawable";Image.TintType={NONE:0,NORMAL:1,GRAYSCALE:2,OVERRIDE:3,ADD:4};class AnimatedImage extends Image{constructor(c){super(c);this[$[58]]=120;this.frames=[];this.frame=0;this._$dj=Date.now();this[$[17]];this.stop()};get isPlaying(){return this[$[17]]===this._$cU};gotoAndStop(b){this.stop();this.frame=b;this._$cV()};gotoAndPlay(b){this.frame=b;this.play()};stop(){this[$[17]]=noop};play(){this[$[17]]=this._$cU};update(d){super.update();this[$[17]](d)};destruct(){this.stop();super.destruct()};_$cU(d){var f=d-this._$dj;if(f>this[$[58]]){this._$dj=d;this.frame+=~~(f/this[$[58]]);this.frame>=this.frames.length&&(this.frame=0);this._$cV()}};_$cV(){this[$[40]].setRect(this.frames[this.frame])}};class BaseRenderer{constructor(f){this.$attachFramebufferCustom=this._$dh;this.$attachFramebufferAndClearCustom=this.$attachFramebufferAndClear;this._$dv=noop;this[$[14]]=new ColorProps();this._$dd=this.$renderTime=0;this._$M=f;this._$y=this._$M[$[2]];this[$[3]]=this._$y[$[3]];this._$y[$[7]]=this._$y[$[7]].concat(["uFlpY","aPos","uTex"]);this.$enableBuffers=!1;this._$dl=new Buffer("",new Uint16Array([0,1,3,2]),0,0,34963,35044);this._$cJ=new Buffer("aPos",new F32A([0,0,1,0,1,1,0,1]),1,2,34962,35044,0)};get clearBeforeRender(){return this._$dv===this._$q};set clearBeforeRender(v){this._$dv=v?this._$q:noop};setSize(b,d){this.width=b;this[$[5]]=d};renderToFramebuffer(g){if(!this[$[3]].isLost()){this._$cT();this.$attachFramebufferAndClearCustom(g);this._$ct(g);g.unbind(this.$gl)}};render(){if(!this[$[3]].isLost()){this._$cT();this.$gl.uniform1f(this._$Z.uFlpY,1);this._$dv();this._$ct()}};destruct(){};_$ct(g){this.$renderTime=Date.now();this.$render(g);this.$gl.flush()};_$cT(){this.$gl=this[$[3]].gl;if(this._$dd<this[$[3]][$[53]]){this._$dd=this[$[3]][$[53]];this._$cC();this.$enableBuffers=!0}else if(this[$[3]][$[46]](this._$L,this._$b))this.$enableBuffers=!0;this.$resize()};_$dh(g){g.bind(this.$gl);g.setSize(this.width,this[$[5]]);this[$[3]][$[22]](g,this.$renderTime);this[$[3]][$[60]](g);this.$gl.uniform1f(this._$Z.uFlpY,-1)};$attachFramebufferAndClear(g){this._$dh(g);this._$dv()};_$q(){this.$gl[$[14]](this[$[14]].r,this[$[14]].g,this[$[14]].b,this[$[14]].a);this.$gl.clear(16384)};$resize(){this.widthHalf=this.width/2;this[$[68]]=this[$[5]]/2;this[$[3]].setSize(this.width,this[$[5]])};$drawInstanced(c){this.$gl.drawElementsInstanced(5,4,5123,0,c)};_$cC(){var f=this._$M;this._$L=Utils.createProgram(this.$gl,this.$createVertexShader(f),this.$createFragmentShader(f));this._$Z=Utils.getLocationsFor(this.$gl,this._$L,this._$y[$[7]]);this._$b=this.$gl.createVertexArray();this[$[3]][$[46]](this._$L,this._$b);this.$createBuffers()};$uploadBuffers(){this._$cJ.upload(this.$gl,this.$enableBuffers);this._$dl.upload(this.$gl);this.$enableBuffers=!1};$createBuffers(){this._$dl.create(this.$gl,this._$Z);this._$cJ.create(this.$gl,this._$Z)}};class BatchRenderer extends BaseRenderer{constructor(b){b[$[2]][$[7]]=b[$[2]][$[7]].concat(["aMt"]);super(b);this.$MAX_BATCH_ITEMS=b[$[31]]||1;this.$matrixBuffer=new Buffer("aMt",this.$MAX_BATCH_ITEMS,4,4)};$uploadBuffers(){this.$matrixBuffer.upload(this.$gl,this.$enableBuffers);super.$uploadBuffers()};$createBuffers(){super.$createBuffers();this.$matrixBuffer.create(this.$gl,this._$Z)}};class StageContainer extends Container{constructor(b){super();this.renderer=b;this.$parent=new BaseItem()};get stage(){return this};get parent(){return this.$parent};get premultipliedAlpha(){return this.props.alpha}};class FilterRenderer extends BaseRenderer{constructor(h){h=h||{};h[$[2]]=Utils[$[15]](h[$[2]]);h[$[2]][$[7]]=h[$[2]][$[7]].concat(["uFTex","uFtrT","uFtrV","uFtrK"]);super(h);this.$attachFramebufferCustom=this.$attachFramebufferAndClearCustom=noop;this.filters=h.filters||[];this.texture=h.texture;this._$cD=[new Framebuffer(),new Framebuffer()]};$render(q){var j=this[$[3]];var b=this.$gl;var p=this.$renderTime;var m=this._$Z;j[$[23]](BlendMode.NORMAL);this.$uploadBuffers();j[$[36]](this.texture,0,p,!0);b.uniform1i(m.uTex,0);var l=this.filters.length||1;var c=l-2;for(var i=0;i<l;++i){var s;var f=this.filters[i];var n=f&&f.on;var g=i>c;var r=n&&f[$[16]]&&f[$[16]].texture;if(r){j[$[36]](r,1,p,!0);b.uniform1i(m.uFTex,1)};if(g)q?this.$attachFramebufferAndClear(q):b.uniform1f(m.uFlpY,1);else if(n){s=this._$cD[i&1];this.$attachFramebufferAndClear(s)};if(n){b.uniform1fv(m.uFtrV,f.v);b.uniformMatrix4fv(m.uFtrK,!1,f.kernels);b.uniform2i(m.uFtrT,f.TYPE,f.SUB_TYPE)};(n||g)&&this.$drawInstanced(1);r&&j[$[60]](r);if(s){s.unbind(b);j[$[36]](s,0,p,!0)}}};$createVertexShader(h){return Utils[$[6]](h[$[2]][$[11]])+"in vec2 aPos;uniform float uFlpY;out vec2 vUv,vTUv;void main(void){gl_Position=vec4(aPos*2.-1.,1,1);vUv=gl_Position.xy;gl_Position.y*=uFlpY;vTUv=vec2(aPos.x,1.-aPos.y);}"};$createFragmentShader(h){var k=(d)=>"for(oft.x=-2.;oft.x<3.;++oft.x)for(oft.y=-2.;oft.y<3.;++oft.y)if(oft.x!=0.&&oft.y!=0.){poft=clamp(f+ivec2(floor(wh*oft)),P.xx,ts-1);clg=texelFetch(uTex,poft,0);"+d+"}pcl=cl/c;";return Utils[$[6]](h[$[2]][$[11]])+"#define P ivec2(0,1)\nuniform sampler2D uTex,uFTex;uniform ivec2 uFtrT;uniform float uFtrV[9];uniform mat4 uFtrK;in vec2 vUv,vTUv;out vec4 oCl;void main(void){oCl=texture(uTex,vTUv);if(uFtrT.x>0){float vl[]=uFtrV,v=vl[0];ivec2 ts=textureSize(uTex,0),f=ivec2(floor(vTUv*vec2(ts)));vec2 vol=v*(1./vec2(ts));vec3 rgb=vec3(vl[2],vl[3],vl[4]);mat4 kr=uFtrK;if(uFtrT.x<2){kr*=v;oCl=vec4((texelFetch(uTex,f-ivec2(1),0)*kr[0].x+texelFetch(uTex,f+ivec2(0,-1),0)*kr[0].y+texelFetch(uTex,f+ivec2(1,-1),0)*kr[0].z+texelFetch(uTex,f+ivec2(-1,0),0)*kr[0].w+oCl*kr[1].x+texelFetch(uTex,f+ivec2(1,0),0)*kr[1].y+texelFetch(uTex,f+ivec2(-1,1),0)*kr[1].z+texelFetch(uTex,f+ivec2(0,1),0)*kr[1].w+texelFetch(uTex,f+ivec2(1),0)*kr[2].x).rgb,oCl.a);}else if(uFtrT.x<3)oCl.rgb=vec3(kr[0].r*oCl.r+kr[0].g*oCl.g+kr[0].b*oCl.b+kr[0].a,kr[1].r*oCl.r+kr[1].g*oCl.g+kr[1].b*oCl.b+kr[1].a,kr[2].r*oCl.r+kr[2].g*oCl.g+kr[2].b*oCl.b+kr[2].a);else if(uFtrT.x<4){vec4 oClVl=oCl*(1.-v);if(uFtrT.y<2)oCl=oClVl+vec4(vec3((oCl.r+oCl.g+oCl.b)/3.),oCl.a)*v;else if(uFtrT.y<3)oCl=oClVl+vec4(vec3(.874,.514,.156)*((oCl.r+oCl.g+oCl.b)/3.),oCl.a)*v;else if(uFtrT.y<4)oCl=oClVl+vec4(1.-oCl.rgb,oCl.a)*v;else if(uFtrT.y<5)oCl.rgb*=rgb*v;else if(uFtrT.y<6)oCl=vec4((round((oCl.rgb*256.)/v)/256.)*v,oCl.a);else if(uFtrT.y<7){vec2 pv=pow(abs(vUv*v),vec2(vl[1]));float cv=clamp((1.-length(pv))*vl[5],0.,1.);oCl.rgb=oCl.rgb*cv+rgb*(1.-cv);}else if(uFtrT.y<8)oCl.rgb+=vec3(vUv.xy*.15,(vUv.x*vUv.y)*.15)*v;else if(uFtrT.y<9)oCl.rgb=vec3((oCl.rgb-.5)*vl[1]+.5+v);else if(uFtrT.y<10)oCl.rgb=pow(oCl.rgb,vec3(v));}else if(uFtrT.x<5){vec2 oft,wh=vec2(v,vl[1]);ivec2 poft;vec4 pcl,clg,cl=oCl;float c=1.;if(uFtrT.y<2){float l=length(vec2(2)),im;"+k("im=1.-(length(oft)/l)*.9;cl+=clg*im;c+=im;")+"float dst=vl[2]<1.?1.:clamp(distance(vec2(vl[3],vl[4]),vTUv)*vl[5],0.,1.);oCl=dst*pcl+(1.-dst)*oCl;}else{float omx=max(oCl.r,max(oCl.g,oCl.b));"+k("if(abs(max(clg.r,max(clg.g,clg.b))-omx)>.3)cl+=clg;c++;")+"oCl+=pcl;}}else if(uFtrT.x<6)oCl=texture(uTex,floor(vTUv/vol)*vol);else if(uFtrT.x<8){vec4 mskCl=texture(uFTex,mod(vec2(vl[1],vl[2])+vTUv,1.)*vec2(vl[5]-vl[3],vl[6]-vl[4]));if(uFtrT.x<7)oCl=texture(uTex,vTUv+(vec2(1,-1)*(mskCl.rg-.5)*2.*vol));else if(uFtrT.x<8)oCl.a*=v<4.?mskCl[int(v)]:(mskCl.r+mskCl.g+mskCl.b+mskCl.a)/4.;}else if(uFtrT.x<9){vec4 pcl=vec4(texture(uFTex,vTUv-vec2(vol.x,0)).r,texture(uFTex,vTUv+vec2(0,vol.y)).g,texture(uFTex,vTUv+vec2(vol.x,0)).b,1);float dst=vl[2]<1.?1.:clamp(distance(vec2(vl[3],vl[4]),vTUv)*vl[5],0.,1.);oCl=dst*pcl+(1.-dst)*oCl;}}}"}};class NormalMapRenderer extends BaseRenderer{constructor(b){b=b||{};b[$[2]]=Utils[$[15]](b[$[2]]);super(b);this[$[34]]=!0;this[$[14]].set(0,0,0,1);this[$[10]]=b[$[10]]};$render(){this[$[3]][$[23]](BlendMode.NORMAL);this.$gl.uniform1i(this._$Z.uTex,this[$[3]][$[22]](this[$[10]],this.$renderTime,!0));this.$uploadBuffers();this.$drawInstanced(1)};$createVertexShader(b){return Utils[$[6]](b[$[2]][$[11]])+"in vec2 aPos;uniform float uFlpY;out vec2 vTUv;void main(void){gl_Position=vec4(aPos*2.-1.,1,1);vTUv=vec2(aPos.x,1.-aPos.y);gl_Position.y*=uFlpY;}"};$createFragmentShader(b){return Utils[$[6]](b[$[2]][$[11]])+"#define H 256.\nin vec2 vTUv;uniform sampler2D uTex;out vec4 oCl;void main(void){vec2 its=vec2(textureSize(uTex,0)),ts=1./its,p0=floor(vTUv*its),p1=p0+vec2(1,0),p2=p0+vec2(0,1);vec3 A=vec3(p0,texture(uTex,p0*ts).g*H),B=vec3(p1,texture(uTex,p1*ts).g*H),C=vec3(p2,texture(uTex,p2*ts).g*H),nm=normalize(cross(B-A,C-A));nm.y*=-1.;oCl=vec4(nm*.5+.5,1);}"}};class AmbientOcclusionMapRenderer extends BaseRenderer{constructor(b){b=b||{};b[$[2]]=Utils[$[15]](b[$[2]]);b[$[2]][$[7]]=b[$[2]][$[7]].concat(["uM","uDM"]);super(b);this[$[34]]=!0;this[$[14]].set(0,0,0,1);this[$[10]]=b[$[10]];this.multiplier=10;this[$[69]]=2};$render(){this[$[3]][$[23]](BlendMode.NORMAL);this.$gl.uniform1i(this._$Z.uTex,this[$[3]][$[22]](this[$[10]],this.$renderTime,!0));this.$gl.uniform1f(this._$Z.uM,this.multiplier);this.$gl.uniform1f(this._$Z.uDM,this[$[69]]);this.$uploadBuffers();this.$drawInstanced(1)};$createVertexShader(b){return Utils[$[6]](b[$[2]][$[11]])+"in vec2 aPos;uniform float uFlpY;out vec2 vTUv;void main(void){gl_Position=vec4(aPos*2.-1.,1,1);vTUv=vec2(aPos.x,1.-aPos.y);gl_Position.y*=uFlpY;}"};$createFragmentShader(b){return Utils[$[6]](b[$[2]][$[11]])+"#define H 255.\nin vec2 vTUv;uniform sampler2D uTex;uniform float uFlpY,uM,uDM;out vec4 oCl;void main(void){vec2 its=vec2(textureSize(uTex,0)),ts=1./its,f=floor(vTUv*its),p;float tx=texture(uTex,f*ts).g,v=0.,z,h;for(p.x=-2.;p.x<3.;++p.x)for(p.y=-2.;p.y<3.;++p.y)if(p.x!=0.&&p.y!=0.){h=texture(uTex,(f+p*2.)*ts).g;z=clamp(h-tx,0.,1.);v+=z*uM*(3./length(vec2(p)));}v/=24.;oCl=vec4(vec3(((1.-uDM)*.5+tx*uDM))+(1.-max(0.,v)),1);}"}};class LightRenderer extends BatchRenderer{constructor(f){f=f||{};f[$[2]]=Utils[$[15]](f[$[2]]);f[$[2]][$[7]]=f[$[2]][$[7]].concat(["uNMTex","uSITex","aExt","uTS","uUSIT"]);var h=(f[$[31]]=f.lightNum||1);super(f);this[$[34]]=!0;this[$[14]].set(0,0,0,1);this[$[39]]=f[$[39]];this[$[51]]=f[$[51]];this[$[10]]=f[$[10]];this._$cS=new Buffer("aExt",h,4,4);this._$B=[];for(var i=0;i<h;++i)this._$B.push(new Light(i,this.$matrixBuffer.data,this._$cS.data))};getLight(b){return this._$B[b]};_$cl(j,g){this.$gl.uniform1i(g,this[$[3]][$[22]](j,this.$renderTime,!0))};$render(){this[$[3]][$[23]](BlendMode.ADD);var c=this.width;var d=this[$[5]];if(this[$[39]]){this._$cl(this[$[39]],this._$Z.uSITex);this.$gl.uniform1f(this._$Z.uUSIT,1)}else this.$gl.uniform1f(this._$Z.uUSIT,0);this[$[51]]&&this._$cl(this[$[51]],this._$Z.uNMTex);if(this[$[10]]){this._$cl(this[$[10]],this._$Z.uTex);c=this[$[10]].width;d=this[$[10]][$[5]]};this.$gl.uniform2f(this._$Z.uTS,c,d);this.$uploadBuffers();this.$drawInstanced(this._$B.length)};$uploadBuffers(){this._$cS.upload(this.$gl,this.$enableBuffers);super.$uploadBuffers()};$createBuffers(){super.$createBuffers();this._$cS.create(this.$gl,this._$Z)};$createVertexShader(f){return Utils[$[6]](f[$[2]][$[11]])+"#define H vec4(1,-1,2,-2)\n#define PI radians(180.)\nin vec2 aPos;in mat4 aExt,aMt;uniform float uFlpY;out float vHS,vD,vSpt;out vec2 vTUv,vSln;out vec4 vUv,vCl,vDt;out mat4 vExt;void main(void){vec3 pos=vec3(aPos*2.-1.,1);vExt=aExt;vCl=aMt[2];vDt=aMt[3];vUv.xy=pos.xy;vHS=vExt[0].z;mat3 mt=mat3(aMt[0].xy,0,aMt[0].zw,0,aMt[1].xy,1);vD=aMt[1].z;if(vExt[0].x<1.){gl_Position=vec4(mt*pos,1);vTUv=(gl_Position.xy+H.xy)/H.zw;vUv.zw=(aMt[1].xy+H.xy)/H.zw;vSpt=PI-aMt[1].w;vSln=vec2(sin(vDt.w),cos(vDt.w));}else{mt[2].xy=vec2(-1,1);gl_Position=vec4(pos,1);vTUv=vec2(aPos.x,1.-aPos.y);vUv.zw=vTUv+((mt*vec3(1)).xy+H.xy)/H.zw;}gl_Position.y*=uFlpY;}"};$createFragmentShader(f){return Utils[$[6]](f[$[2]][$[11]])+"#define H 256.\n#define PI radians(180.)\n#define PIH radians(90.)\nin float vHS,vD,vSpt;in vec2 vTUv,vSln;in vec4 vUv,vCl,vDt;in mat4 vExt;uniform sampler2D uNMTex,uSITex,uTex;uniform float uUSIT;uniform vec2 uTS;out vec4 oCl;void main(void){oCl=vec4(0);if(vDt.x>0.){bool isl=vExt[0].x<1.;vec4 tc=texture(uTex,vTUv);float ph=tc.g*H,shn=tc.b;vec2 tUv=vTUv*uTS,tCnt=vUv.zw*uTS;vec3 sf=vec3(tUv,ph),lp=vec3(tCnt,vHS),sftla=lp-sf;float dst=1.-length(sftla)/vD,vol=vDt.z*vCl.a,spc=0.;if(isl){vol*=dst;if(vol<=0.)discard;float slh=(vHS-ph)/H;vec2 sl=vec2(slh*vSln.y-vUv.x*vSln.x,slh*vSln.x+vUv.x*vSln.y);if((atan(sl.x,length(vec2(sl.y,vUv.y)))+PIH)-vSpt<0.)discard;}int flg=int(vExt[0].y);float fltDst=distance(tCnt,tUv),shdw=1.;if((flg&2)>0){vec3 nm=normalize((texture(uNMTex,vTUv).rgb*2.-1.)*vec3(1,-1,1)),sftl=normalize(sftla),sftv=normalize(vec3((flg&16)>0?uTS*.5:tUv,H)-sf),hlf=normalize(sftl+sftv);vol*=dot(nm,sftl);if(vol<=0.)discard;if(isl)spc=pow(dot(nm,hlf),shn+H)*vExt[1].y;}if((flg&1)>0){vec2 p,opd=(tUv-tCnt)/fltDst,opdm=opd/uTS;float shl=vD/vDt.y,st=ceil(max(1.,max(fltDst/vExt[1].x,vExt[0].w))),hst=(ph-vHS)/fltDst,l=fltDst-st,m=max(st,l-shl),i,pc,opdL=length(opd);for(i=l;i>m;i-=st){p=vUv.zw+i*opdm;tc=texture(uTex,p)*H;if((flg&4)>0&&tc.g>=vHS)discard;pc=vHS+i*hst;if(tc.r<=pc&&tc.g>=pc){shdw*=(fltDst-i*opdL)/shl;if(shdw<=0.)discard;}}}vec3 stCl=uUSIT<1.?vec3(1):texture(uSITex,vTUv).rgb,rCl=(flg&8)>0?vCl.rgb:vec3(1);oCl=vec4((stCl*vCl.rgb+rCl*spc)*shdw*vol,1);}}"}};class Stage2D extends BatchRenderer{constructor(q){q={...{useTint:!0},...(q||{})};q[$[2]]=Utils[$[15]](q[$[2]]);q[$[2]][$[7]]=q[$[2]][$[7]].concat(["aDt","aDst","uWCl","uWA"]);var w=(q[$[31]]=q[$[31]]||1e4);super(q);this[$[29]]=new StageContainer(this);this._$cm=0;this[$[74]+Item.TYPE]=noop;this[$[74]+Image.TYPE]=this._$cg.bind(this);this[$[74]+Container.TYPE]=this._$cI.bind(this);this._$cc=this._$cc.bind(this);this._$S=this._$S.bind(this);this._$cs=PointUtilities.create();this._$ck=new Buffer("aDt",w,3,4);this._$db=new Buffer("aDst",w,4,2);this._$dp=this._$dp.bind(this);var b=$d.body;b[$[4]]($[80],this._$dp);b[$[4]]($[78],this._$dp);b[$[4]]("mouseup",this._$dp);b[$[4]]("click",this._$dp);b[$[4]]($[77],this._$dp);b[$[4]]($[79],this._$dp);b[$[4]]($[82],this._$dp)};render(){this._$v=$n;super.render();this._$cn=!1;this._$cZ()};destruct(){var b=$d.body;b[$[1]]($[80],this._$dp);b[$[1]]($[78],this._$dp);b[$[1]]("mouseup",this._$dp);b[$[1]]("click",this._$dp);b[$[1]]($[77],this._$dp);b[$[1]]($[79],this._$dp);b[$[1]]($[82],this._$dp)};_$cZ(){this._$v&&this._$v.handleEvent(this._$v,this._$cx)};_$cL(x,y){this._$cn=!0;var t=this[$[29]].parent[$[9]];this._$cs.x=(x-this.widthHalf)*t[0];this._$cs.y=(y-this[$[68]])*t[3]};$render(){this._$S(this[$[29]]);this._$cc()};_$S(d){d.update(this.$renderTime);d.callback(d,this.$renderTime);d[$[67]]&&this[$[74]+d.TYPE](d)};_$cI(s){this.$gl.uniform4fv(this._$Z.uWCl,s[$[18]]);this.$gl.uniform1f(this._$Z.uWA,s[$[55]]);var r=s[$[13]];for(var i=0,l=r.length;i<l;++i)this._$S(r[i])};_$cg(d){this[$[3]][$[23]](d.blendMode,this._$cc);if(this._$cn&&d[$[56]]&&d.isContainsPoint(this._$cs))this._$v=d;var f=this._$cm*12;var h=this._$cm*16;$as(this._$ck.data,d[$[18]],f);$as(this._$ck.data,d[$[38]],f+8);this._$ck.data[f+4]=d.props.alpha;this._$ck.data[f+5]=d.tintType;this._$ck.data[f+6]=this[$[3]][$[22]](d.texture,this.$renderTime,!1,this._$cc);this._$ck.data[f+7]=d[$[44]][$[73]];$as(this.$matrixBuffer.data,d[$[9]],h);$as(this.$matrixBuffer.data,d[$[30]],h+6);$as(this.$matrixBuffer.data,d[$[64]],h+12);$as(this._$db.data,d[$[50]],this._$cm*8);++this._$cm===this.$MAX_BATCH_ITEMS&&this._$cc()};_$cc(){if(this._$cm>0){this.$uploadBuffers();this.$gl.uniform1iv(this._$Z.uTex,this[$[3]][$[33]]);this.$drawInstanced(this._$cm);this._$cm=0}};$resize(){super.$resize();Matrix3Utilities.projection(this[$[29]].parent[$[9]],this);++this[$[29]].parent[$[8]]};$uploadBuffers(){this._$ck.upload(this.$gl,this.$enableBuffers);this._$db.upload(this.$gl,this.$enableBuffers);super.$uploadBuffers()};$createBuffers(){super.$createBuffers();this._$ck.create(this.$gl,this._$Z);this._$db.create(this.$gl,this._$Z)};_$dp(g){var k=this[$[3]].canvas;if(g.target===k){this._$cx=g;var l=k.width/k.offsetWidth;var j=k[$[5]]/k.offsetHeight;var p=l*g.offsetX;var n=j*g.offsetY;this._$cL(p,n)}};$createVertexShader(q){var z=q[$[63]];return Utils[$[6]](q[$[2]][$[11]])+"in vec2 aPos;in mat4x2 aDst;in mat3x4 aDt;in mat4 aMt;uniform float uFlpY,uWA;uniform vec4 uWCl;out float vACl,vTId,vTTp;out vec2 vTUv;out vec4 vTCrop"+(z?",vRR;":";")+"out mat2x4 vCl;vec2 clcQd(vec2 p){return vec2(mix(mix(aDst[0].x,aDst[1].x,p.x),mix(aDst[3].x,aDst[2].x,p.x),p.y),mix(mix(aDst[0].y,aDst[3].y,p.y),mix(aDst[1].y,aDst[2].y,p.y),p.x));}void main(void){mat3 mt=mat3(aMt[0].xy,0,aMt[0].zw,0,aMt[1].xy,1),tMt=mat3(aMt[1].zw,0,aMt[2].xy,0,aMt[2].zw,1);vec3 tPos=vec3(clcQd(aPos),1);gl_Position=vec4(mt*tPos,1);gl_Position.y*=uFlpY;float dt=aDt[1].w;vTUv=(tMt*((dt*vec3(aPos,1))+((1.-dt)*tPos))).xy;vTCrop=aMt[3];vCl=mat2x4(uWCl,aDt[0].rgb*aDt[0].a,1.-aDt[0].a);vACl=uWA*aDt[1].x;vTTp=aDt[1].y;vTId=aDt[1].z;"+(z?"vRR=aDt[2].xyzw;vRR.w=vRR.x+vRR.y;":"")+"}"};$createFragmentShader(q){var B=Utils.INFO[$[28]];var z=q[$[63]];var m=q.useTint;var C=(B)=>{var c="vec4 gtTexCl(float i,vec2 c){";for(var i=0;i<B;++i)c+="if(i<"+(i+1)+".)return texture(uTex["+i+"],c);";c+="return vec4(1);}";return c};var A=(v)=>"gtTexCl(vTId,vTCrop.xy+vTCrop.zw*"+v+")";return Utils[$[6]](q[$[2]][$[11]])+"#define PI radians(180.)\nin float vACl,vTId,vTTp;in vec2 vTUv;in vec4 vTCrop"+(z?",vRR;":";")+"in mat2x4 vCl;uniform sampler2D uTex["+B+"];out vec4 oCl;"+C(B)+"float cosine(float a,float b,float v){v=abs(v);v=v<.5?2.*v*v:1.-pow(-2.*v+2.,2.)/2.;return a*(1.-v)+b*v;}"+(z?Utils.GLSL.RANDOM+"vec4 gtClBUv(vec2 st){vec2 uv=vTUv;float rnd=rand(floor(uv+st)),rndDg=rnd*360.*vRR.x;if(rndDg>0.){vec2 rt=vec2(sin(rndDg),cos(rndDg));uv=vec2(uv.x*rt.y-uv.y*rt.x,uv.x*rt.x+uv.y*rt.y);}return "+A("mod(uv,vec2(1))")+";}float gtRClBUv(vec2 st,vec2 uv){float rnd=rand(floor(vTUv+st));return (1.-(2.*rnd-1.)*vRR.y)*cosine(0.,1.,1.-st.x-uv.x)*cosine(0.,1.,1.-st.y-uv.y);}":"")+"void main(void){if(vTId>-1.){vec2 uv=mod(vTUv,vec2(1));"+(z?"if(vRR.w>0.){vec2 zr=vec2(0,1);float rca,rcb,rcc,rcd;if(vRR.y+vRR.z>0.){rca=gtRClBUv(zr.xx,uv);rcb=gtRClBUv(zr.yx,uv);rcc=gtRClBUv(zr.xy,uv);rcd=gtRClBUv(zr.yy,uv);}oCl=vRR.z>0.?clamp(gtClBUv(zr.xx)*rca+gtClBUv(zr.yx)*rcb+gtClBUv(zr.xy)*rcc+gtClBUv(zr.yy)*rcd,0.,1.):gtClBUv(zr);if(vRR.y>0.)oCl.a=clamp(oCl.a*(rca+rcb+rcc+rcd),0.,1.);}else oCl="+A("uv")+";":"oCl="+A("uv")+";")+"}else oCl+=1.;oCl.a*=vACl;if(oCl.a<=0.)discard;"+(m?"if(vTTp>0.){vec3 cl=vCl[1].rgb+oCl.rgb*vCl[1].a;if(vTTp==1.||(vTTp==2.&&oCl.r==oCl.g&&oCl.r==oCl.b))oCl.rgb*=cl+oCl.rgb*vCl[1].a;else if(vTTp==3.)oCl.rgb=cl;else if(vTTp==4.)oCl.rgb+=cl;}":"")+"oCl*=vCl[0];}"}};class DisplacementFilter extends BaseFilter{constructor(d,f,h,j,b,c,g,k){super(6,0,f);this[$[16]]=new FilterTextureProps(this,d,h,j,b,c,g,k)}};class MaskFilter extends BaseFilter{constructor(f,b,h,j,c,d,g,k){super(7,0,b);this[$[16]]=new FilterTextureProps(this,f,h,j,c,d,g,k)};get type(){return this.v[0]};set type(v){this.v[0]=v}};MaskFilter.Type={RED:0,GREEN:1,BLUE:2,ALPHA:3,AVG:4};class PixelateFilter extends BaseFilter{constructor(b){super(5,0,b)}};class EdgeDetectFilter extends BaseFilter{constructor(b){super(1,0,b);$as(this.kernels,[-1,-1,-1,-1,8,-1,-1,-1,-1],0)}};class SharpenFilter extends BaseFilter{constructor(b){super(1,0,b);$as(this.kernels,[-1,-1,-1,-1,16,-1,-1,-1,-1],0)}};class SaturateFilter extends BaseFilter{constructor(b){super(2,0,b)};set intensity(v){this.v[0]=v;var x=(v*2)/3+1;var y=-(x-1)/2;$as(this.kernels,[x,y,y,0,y,x,y,0,y,y,x,0],0)}};class GrayscaleFilter extends BaseFilter{constructor(b){super(3,1,b)}};class SepiaFilter extends BaseFilter{constructor(b){super(3,2,b)}};class InvertFilter extends BaseFilter{constructor(b){super(3,3,b)}};class TintFilter extends BaseFilter{constructor(c,r,g,b){super(3,4,c);this.r=r;this.g=g;this.b=b}};class ColorLimitFilter extends BaseFilter{constructor(b){super(3,5,b)}};class VignetteFilter extends BaseFilter{constructor(c,d,f,r,g,b){super(3,6,c);this.roundness=d;this.transition=f;this.r=r;this.g=g;this.b=b};get roundness(){return this.v[1]};set roundness(v){this.v[1]=v};get transition(){return 1/this.v[5]};set transition(v){this.v[5]=1/v}};class RainbowFilter extends BaseFilter{constructor(b){super(3,7,b)}};class BrightnessContrastFilter extends BaseFilter{constructor(c,b){super(3,8,c);this.contrast=b};get brightness(){return this.v[0]};set brightness(v){this.v[0]=v};get contrast(){return this.v[1]};set contrast(v){this.v[1]=v}};class GammaFilter extends BaseFilter{constructor(b){super(3,9,b)}};class BlurFilter extends BaseFilter{constructor(f,g,h,c,d,b){super(4,1,f);this.intensityY=g;this.isRadialBlur=h||!1;this.centerX=c||0;this.centerY=d||0;this.size=b||1};get isRadialBlur(){return this.v[2]===1};set isRadialBlur(v){this.v[2]=v?1:0};get centerX(){return this.v[3]};set centerX(v){this.v[3]=v};get centerY(){return this.v[4]};set centerY(v){this.v[4]=v};get size(){return this.v[5]};set size(v){this.v[5]=v}};class GlowFilter extends BaseFilter{constructor(b,c){super(4,2,b);this.intensityY=c}};class ChromaticAberrationFilter extends BaseFilter{constructor(g,f,c,d,b){super(8,0,g);this.isRadial=f||!1;this.centerX=c||0;this.centerY=d||0;this.size=b||1};get isRadial(){return this.v[2]===1};set isRadial(v){this.v[2]=v?1:0};get centerX(){return this.v[3]};set centerX(v){this.v[3]=v};get centerY(){return this.v[4]};set centerY(v){this.v[4]=v};get size(){return this.v[5]};set size(v){this.v[5]=v}};window.PWGL=window.AGL={version:"1.2.1",buildDate:"230402082703",BlendMode,BaseProps,BasePositioningProps,ColorProps,ItemProps,LightProps,TextureCrop,TextureProps,DistortionProps,FilterTextureProps,TextureInfo,Texture,Framebuffer,Context,Buffer,Utils,Const,FPS,Matrix3Utilities,PointUtilities,RectangleUtilities,BaseItem,Item,BaseDrawable,Light,AnimatedImage,Container,StageContainer,Image,BaseRenderer,BatchRenderer,FilterRenderer,NormalMapRenderer,AmbientOcclusionMapRenderer,LightRenderer,Stage2D,BaseFilter,DisplacementFilter,MaskFilter,PixelateFilter,EdgeDetectFilter,SharpenFilter,SaturateFilter,GrayscaleFilter,SepiaFilter,InvertFilter,TintFilter,ColorLimitFilter,VignetteFilter,RainbowFilter,BrightnessContrastFilter,GammaFilter,BlurFilter,GlowFilter,ChromaticAberrationFilter};})();