(()=>{var $="startsWith,lastCallMS,DEPTH_STENCIL".split(",");let $m=Math,$c=console;let SHOW_CALL_STACK=1;let SHOW_ORIGINAL_VALUES=2;let SHOW_ARRAYS=4;let enumCheck=(c,b)=>(c&b)===b;let noop=()=>{};let FPS=(()=>{let d={fps:0,delay:0};let h=16.6667;let f=0,j=0,k=0,c=Date.now();d.update=()=>{let b=Date.now();f++;d.delay=(b-c)/h;c=b;if(b>=k){d.fps=(f*1e3)/(b-j);j=b;k=b+1e3;f=0}};d.init=d.start=noop;return d})();let getFPS=async()=>new Promise((g)=>{requestAnimationFrame((c)=>requestAnimationFrame((b)=>g($m.round(1e3/(b-c)))))});let enterFrame=(k,l=0)=>{let f={};let p,h,g,n,c=Date.now(),s,m=0;let q=()=>{FPS.update();k(FPS.fps,FPS.delay)};let r=()=>{let b=Date.now();let d=b-c;if(d>=n){n=2*g-d;c=b;q()}};let j=()=>{if(m){p();s=requestAnimationFrame(j)}};f.isPlaying=()=>m;f.clearMaxFPS=()=>{h=1/0;p=q};f.getMaxFPS=()=>h;f.setMaxFPS=(l)=>{if(!l||l<=0)return f.clearMaxFPS();h=l;n=g=$m.floor(1e3/h)-1;p=r};f.start=()=>{if(!m){m=1;j()}};f.stop=()=>{cancelAnimationFrame(s);m=0};f.setMaxFPS(l);f.start();return f};let clamp=(b,c,d)=>$m.max(b,$m.min(c,d));let _1l=(b,d,j,m)=>({icon:b,label:d,style:`background: ${m}; color: ${j};`});let _1f={BASE:_1l("·","    ","#999","#000"),PROGRAM:_1l("◉","PROGRAM","#7CFF9B","#0b3d1f"),BINDING:_1l("↔","BIND","#4FC3F7","#002233"),RESOURCES:_1l("□","RESOURCE","#FFD54F","#3a2a00"),BUFFER_UPLOAD:_1l("↑","UPLOAD","#FF7043","#3b1200"),TEXTURE_PARAMS:_1l("▦","TEX","#c792ea","#2a1433"),UNIFORMS:_1l("≡","UNIFORM","#FF7AA2","#2a0f1a"),VERTEX_ATTRIBUTES:_1l("▣","ATTR","#26E6A6","#00382f"),VIEWPORT:_1l("▢","FRAME","#90a4ae","#1c262b"),BLENDING:_1l("≈","BLEND","#69f0ae","#032"),SAMPLERS:_1l("⇅","SAMPLER","#000","#33F"),FRAMEBUFFERS:_1l("▭","FBO","#fff","#4a148c"),RENDERBUFFERS:_1l("▩","RBO","#fff","#004d40"),DEPTH_STENCIL:_1l("∠","DEPTH","#999","#333"),DRAW:_1l("●","DRAW","#fff","#d50000"),ALERT:_1l("■","ALERT","#fff","#b00020"),WARN:_1l("▲","WARN","#000","#fc0")};let _1k=["DEPTH_TEST","CULL_FACE","STENCIL_TEST"];let getFormat=(h,g,c)=>{if(h>5)return _1f.ALERT;if(h>2)return _1f.WARN;switch(g){case"createProgram":case"attachShader":case"linkProgram":case"validateProgram":case"deleteProgram":case"useProgram":return _1f.PROGRAM;case"createShader":case"shaderSource":case"compileShader":case"deleteShader":case"getBufferSubData":case"finish":case"flush":case"readPixels":return _1f.WARN;case"getError":return _1f.ALERT;case"bindVertexArray":case"bindBuffer":case"activeTexture":case"bindTexture":return _1f.BINDING;case"createBuffer":return _1f.RESOURCES;case"bufferData":case"texImage2D":case"bufferSubData":case"copyBufferSubData":case"texSubImage2D":case"texStorage2D":case"copyTexImage2D":case"copyTexSubImage2D":case"compressedTexImage2D":case"compressedTexSubImage2D":return _1f.BUFFER_UPLOAD;case"texParameteri":case"generateMipmap":return _1f.TEXTURE_PARAMS;case"bindBufferBase":case"bindBufferRange":return _1f.UNIFORMS;case"enableVertexAttribArray":case"vertexAttribPointer":case"vertexAttribDivisor":case"vertexAttribIPointer":case"disableVertexAttribArray":return _1f.VERTEX_ATTRIBUTES;case"viewport":case"scissor":case"clearColor":case"clear":return _1f.VIEWPORT;case"blendEquation":case"blendFuncSeparate":return _1f.BLENDING;case"drawElementsInstanced":case"drawArrays":case"drawElements":case"drawArraysInstanced":case"drawRangeElements":case"drawBuffers":case"drawElementsInstancedBaseVertex":return _1f.DRAW;case"createSampler":case"samplerParameteri":case"bindSampler":case"deleteSampler":return _1f.SAMPLERS;case"createFramebuffer":case"bindFramebuffer":case"framebufferTexture2D":case"framebufferRenderbuffer":case"checkFramebufferStatus":case"blitFramebuffer":return _1f.FRAMEBUFFERS;case"createRenderbuffer":case"bindRenderbuffer":case"renderbufferStorage":case"renderbufferStorageMultisample":return _1f.RENDERBUFFERS;case"depthFunc":case"depthMask":case"cullFace":case"frontFace":case"stencilFunc":case"stencilOp":return _1f[$[2]]};if(g[$[0]]("createTexture"))return _1f.RESOURCES;if(g[$[0]]("uniform"))return _1f.UNIFORMS;if(g[$[0]]("enable")&&_1k.includes(c[0]))return _1f[$[2]];return _1f.BASE};let _2F=(n)=>n;let _2I=()=>"\n"+(new Error).stack.split("\n").slice(3).map((v)=>v.trim().slice(3)).join("\n")+"\n->";let _2p=(x,J=2)=>{let B=[];let k=new Map;let C=PWGL?Object.entries(PWGL.Const).reduce((c,d)=>{c[d[1]]=d[0];return c},{}):{};let R=(n)=>n.map((v)=>C[v]??v);let q=()=>{if(w===J)b.stop();w++};let D=(y=0)=>{let K=enumCheck(y,SHOW_CALL_STACK);let L=enumCheck(y,SHOW_ARRAYS)?_2F:(n)=>n.map((v)=>v&&(Array.isArray(v)||v.constructor.name.endsWith("Array"))?`[${v.constructor.name}(${v.length})]`:v);let z=enumCheck(y,SHOW_ORIGINAL_VALUES)?_2F:R;let G=0;k.forEach((A)=>{$c.log(`%c < CONTEXT #${++G} > `,"background: #000; color: #00ff00; font-weight: bold;");A.map((g)=>{let r=getFormat(g[$[1]],g.prop,R(g.args));$c.log("%c"+r.icon+" "+`${r.label}: `+[...(K?[g.stackTrace]:[]),`frame #${g.frame}`,`${g.sumMS}ms`,`${g[$[1]]}ms`,`[${g.prop}]`,`( ${z(L(g.args)).join(", ")} )`].join(" | "),r.style)})})};let M=(l,s,h)=>function(...j){if(w<=J){if(h==="useProgram"){let A=j[0];if(!B.includes(A)){B.push(A);k.set(A,[]);N=A;O=Date.now();m=0}else N=null};if(N){let Q=k.get(N);let t=Q.length;let f=Date.now();let E=f-O;m+=E;O=f;if(t>0)Q[t-1][$[1]]=E;Q.push({stackTrace:_2I(),frame:w,lastCallMS:0,sumMS:m,prop:h,args:j})}};return l.apply(s,j)};let N;let O;let m;let b;let w=0;b=enterFrame(q);let P={canvas:x.canvas,snapshots:k,toString:D};PWGLDebugger.instances.push(P);$c.log("PWGL Debugger",P);return new Proxy(x,{get(s,h){let l=s[h];return typeof l==="function"?M(l,s,h):l}})};let init=(J=2)=>{let H=HTMLCanvasElement.prototype.getContext;HTMLCanvasElement.prototype.getContext=function(...j){let x=H.call(this,...j);return j[0][$[0]]("webgl")?_2p(x,clamp(J,2,20)):x}};window.PWGLDebugger={version:"0.0.2",SHOW_CALL_STACK,SHOW_ORIGINAL_VALUES,SHOW_ARRAYS,init,instances:[]};$c.log(`%cPWGL Debugger v${PWGLDebugger.version}\nhttps:\/\/github.com/asjs-dev/pwgl`,"background:#222;color:#0F0");})();