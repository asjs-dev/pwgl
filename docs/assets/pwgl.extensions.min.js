(()=>{var $="$nodesConnected,removeEventListener,textureTransform,addEventListener,disconnect,$feedbackGainNode,$lowPassNode,$delayNode,lightRenderer,connect,filterRenderer,$gainNode,$highPassNode,transform,getOwnPropertyNames,$nodesCreated,$panNode,$disconnectNodes,highPassFilterFrequency,lowPassFilterFrequency,$setConfig,$connectNodes,object,isPlaying,renderToFramebuffer,$createNodes,createBiquadFilter,reverbFeedbackGain,currentTime,addLightForRender,touchmove,reverbDelayTime,touchstart,mousedown,mousemove,touchend".split(",");let $m=Math,$w=window,$n=null,$o=Object;let noop=()=>{};let FPS=(()=>{let d={fps:0,delay:0};let h=16.6667;let f=0,j=0,k=0,c=Date.now();d.update=()=>{let b=Date.now();f++;d.delay=(b-c)/h;c=b;if(b>=k){d.fps=(f*1e3)/(b-j);j=b;k=b+1e3;f=0}};d.init=d.start=noop;return d})();let getFPS=async()=>new Promise((g)=>{requestAnimationFrame((c)=>requestAnimationFrame((b)=>g($m.round(1e3/(b-c)))))});class PressState{constructor(){this.$g={};this.$C={};this.$B={}};isDown(b){return this.$g[b]===0};isUp(b){return this.$g[b]===1};isPressed(b){return this.isUp(b)&&this.$B[b]<=200};isLongPressed(b){return this.isUp(b)&&this.$B[b]>200};getDuration(b){return Date.now()-this.$C[b]};update(){for(let c in this.$g)if(this.$g[c]){delete this.$g[c];delete this.$B[c];delete this.$C[c]}};$setDownState(b){this.$g[b]=0;this.$C[b]=Date.now()};$setUpState(b){let d=Date.now();this.$g[b]=1;this.$B[b]=d-this.$C[b];this.$C[b]=d}};class Mouse extends PressState{constructor(c){super();this.position={x:0,y:0};this.$p=c??$w;this.$y={mousedown:1,mouseup:1,touchstart:0,touchend:0};this.$J=this.$J.bind(this);this.$D=this.$D.bind(this);this.$K=this.$K.bind(this);this.$p[$[3]]($[33],this.$J);this.$p[$[3]]("mouseup",this.$D);this.$p[$[3]]($[34],this.$K);this.$p[$[3]]($[32],this.$J);this.$p[$[3]]($[35],this.$D);this.$p[$[3]]($[30],this.$K)};destruct(){this.$p[$[1]]($[33],this.$J);this.$p[$[1]]("mouseup",this.$D);this.$p[$[1]]($[34],this.$K);this.$p[$[1]]($[32],this.$J);this.$p[$[1]]($[35],this.$D);this.$p[$[1]]($[30],this.$K)};$J(b){if(this.$y[b.type]===b.which){this.$setDownState(0)}};$D(b){if(this.$y[b.type]===b.which){this.$setUpState(0)}};$K(b){let d=b.type===$[30]?b.touches[0]:b;this.position.x=d.clientX;this.position.y=d.clientY}};class Keyboard extends PressState{constructor(c){super();this.$p=c??$w;this.$E=this.$E.bind(this);this.$z=this.$z.bind(this);this.$p[$[3]]("keydown",this.$E);this.$p[$[3]]("keyup",this.$z)};destruct(){this.$p[$[1]]("keydown",this.$E);this.$p[$[1]]("keyup",this.$z)};$E(b){this.$setDownState(b.key)};$z(b){this.$setUpState(b.key)}};class Gamepad{get gamepads(){return navigator.getGamepads?navigator.getGamepads():navigator.webkitGetGamepads||[]};get(b){let f=this.gamepads[b];return f?{axes:f.axes.map((c)=>$m.abs(c)>=.05?c:0),buttons:f.buttons.map((d)=>typeof d==="number"?{pressed:d===1,touched:d===1,value:d}:d),timestamp:f.timestamp}:$n}};let clone=(c)=>{if(typeof c!==$[22]||c===$n||c===undefined)return c;let f=$o[$[14]](c);let d=Array.isArray(c)?[]:{},b,i=f.length;while((b=f[--i]))d[b]=typeof c[b]===$[22]?clone(c[b]):c[b];return d};let createDataObserver=(h={})=>{let b=0;let f=clone(h);let c=new Proxy(h,{set(target,prop,value){b=1;target[prop]=value;return 1}});let d=()=>{if(!b)return $n;let g=clone(c);let j=f;f=g;b=0;return{state:g,prevState:j}};return{c,d}};let mix=(a,b,c)=>c*a+(1-c)*b;let fadeAudioVolume=(g,b,c,d)=>(g.volume=mix(b,c,d));let crossFadeAudioVolumes=(h,j,b,c,d)=>{let f=mix(b,c,d);h.volume=f;j.volume=1-f};class ABA{get volume(){return this.$q};set volume(c){this.$q=c;if(this[$[0]])this[$[11]].gain.value=c};get pan(){return this.$b};set pan(b){this.$b=b;if(this[$[0]])this[$[16]].pan.value=b};get reverbDelayTime(){return this.$O};set reverbDelayTime(g){this.$O=g;if(this[$[0]])this[$[7]].delayTime.value=g};get reverbFeedbackGain(){return this.$Q};set reverbFeedbackGain(k){this.$Q=k;if(this[$[0]])this[$[5]].gain.value=k};get lowPassFilterFrequency(){return this.$R};set lowPassFilterFrequency(h){this.$R=h;if(this[$[0]])this[$[6]].frequency.value=h};get highPassFilterFrequency(){return this.$S};set highPassFilterFrequency(h){this.$S=h;if(this[$[0]])this[$[12]].frequency.value=h};$createNodes(f){if(f){this[$[11]]=f.createGain();this[$[16]]=f.createStereoPanner();this[$[7]]=f.createDelay();this[$[5]]=f.createGain();this[$[6]]=f[$[26]]();this[$[6]].type="lowpass";this[$[12]]=f[$[26]]();this[$[12]].type="highpass";this[$[15]]=1}};$connectNodes(j){if(j&&this[$[15]]){this[$[11]][$[9]](this[$[16]]);this[$[16]][$[9]](this[$[7]]);this[$[7]][$[9]](this[$[5]]);this[$[5]][$[9]](this[$[7]]);this[$[7]][$[9]](this[$[12]]);this[$[12]][$[9]](this[$[6]]);this[$[6]][$[9]](j);this[$[0]]=1}};$disconnectNodes(){if(this[$[0]]){this[$[11]][$[4]]();this[$[16]][$[4]]();this[$[7]][$[4]]();this[$[5]][$[4]]();this[$[6]][$[4]]();this[$[11]]=this[$[16]]=this[$[7]]=this[$[5]]=this[$[6]]=$n;this[$[0]]=this[$[15]]=0}};$setConfig(d){this.volume=d.volume??1;this.pan=d.pan??0;this[$[31]]=d[$[31]]??0;this[$[27]]=d[$[27]]??0;this[$[19]]=d[$[19]]??22050;this[$[18]]=d[$[18]]??0}};class AudioItem extends ABA{constructor(b=$n,h={}){super();this[$[20]](h);this.load(b)};get loop(){return this.$c};set loop(d){this.$c=d;if(this[$[0]])this.$r.loop=d};get pitch(){return this.$h};set pitch(g){this.$h=g;if(this[$[0]])this.$r.playbackRate.value=g};async load(b){if(b){this.url=b;this.$M=await fetch(b);this.$s()}};unload(){this[$[4]]();this.$t=$n};connect(l){if(this.$G!==l){this[$[4]]();this.$G=l;this.$s();l[$[9]](this)}};disconnect(){if(this.$G){this.stop();this.$G[$[4]](this);this.$G=$n}};play(f=0){this.stop();this[$[23]]=1;let l=this.$G,k=l.context;this[$[25]](k);this[$[21]](l.node);if(k){this.$F=k[$[28]];try{this[$[0]]&&this.$r.start(k[$[28]],f)}catch(e){}};this[$[20]](this)};stop(){this[$[23]]=0;let l=this.$G,j=this.$t;if(l&&j)this.$F=(l.context[$[28]]-this.$F)%j.duration;this[$[17]]()};resume(){this.play(this.$F)};$createNodes(k){let j=this.$t;if(k&&j){this.$r=k.createBufferSource();this.$r.buffer=j;super[$[25]](k)}};$connectNodes(m){if(m&&this[$[15]]){this.$r[$[9]](this[$[11]]);super[$[21]](m)}};$disconnectNodes(){if(this[$[0]]){this.$r.stop();this.$r[$[4]]();this.$r=$n;super[$[17]]()}};$setConfig(h={}){this.loop=h.loop??0;this.pitch=h.pitch??1;super[$[20]](h)};async $s(){let p=this.$M,l=this.$G;if(p&&l){let n=await p.arrayBuffer();this.$t=await l.context.decodeAudioData(n);this[$[23]]&&this.play()}}};class AudioMixer extends ABA{constructor(c={}){super();let d=new($w.AudioContext||$w.webkitAudioContext)();this.$A=d;this.$j=[];this[$[25]](d);this[$[21]](d.destination);this[$[20]](c)};get context(){return this.$A};get node(){return this[$[11]]};play(){this.$j.forEach((b)=>b.play())};stop(){this.$j.forEach((b)=>b.stop())};destruct(){this.stop();this[$[17]]()};resume(){this.$j.forEach((b)=>b.resume())};connect(f){if(!this.$j.includes(f)){this.$j.push(f);f[$[9]](this)}};disconnect(f){if(this.$j.includes(f)){this.$j.splice(this.$j.indexOf(f),1);f[$[4]]()}}};let SmoothLight=$w.PWGL?class SmoothLight extends PWGL.Image{constructor(b={}){super();this.$L=new PWGL.Framebuffer;this[$[8]]=new PWGL.LightRenderer(b);this.$v=new PWGL.BlurFilter;this[$[10]]=new PWGL.FilterRenderer({context:this[$[8]].context,sourceTexture:this.$L,filters:[this.$v]});this[$[10]].clearColor.set(0,0,0,0);this[$[10]].clearBeforeRender=1;this[$[29]]=this[$[8]][$[29]].bind(this[$[8]]);this.blendMode=PWGL.BlendMode.SHADOW;this.$P=new PWGL.Framebuffer;this.texture=this.$P;this.blur=typeof b.blur==="number"?b.blur:1};get blur(){return this.$d};set blur(v){this.$d=this.$v.intensityX=this.$v.intensityY=v};render(){this.$H();this[$[8]][$[24]](this.$L);this[$[10]][$[24]](this.$P)};setSize(w,h){this.$k=w;this.$w=h;this.$H=this.$x};$x(){this.$H=noop;this[$[8]].setSize(this.$k,this.$w);this[$[10]].setSize(this.$k,this.$w)}}:$n;let AnimatedWater=$w.PWGL?class AnimatedWater extends PWGL.Container{constructor(n,b=1,c=0,d=1){super();this.$k=1;this.$w=1;let p=PWGL.Texture.loadImage(n);p.magFilter=PWGL.Const.LINEAR;this.$N=new PWGL.Image;this.addChild(this.$N);this.$T=new PWGL.Image(p);this.$T.blendMode=PWGL.BlendMode.ADD;this.$T[$[2]].repeatX=.7;this.$T.tintType=PWGL.Image.TintType.GRAYSCALE;this.addChild(this.$T);this.$U=new PWGL.Image(p);this.$U.blendMode=PWGL.BlendMode.ADD;this.$U[$[2]].repeatX=4;this.$U[$[2]].repeatRandomRotation=1;this.$U.tintType=PWGL.Image.TintType.GRAYSCALE;this.addChild(this.$U);this.speed=b;this.level=c;this.scale=d;this.$I={x:0,y:0};this.$f=0};get speed(){return this.$l};set speed(v){this.$l=v};get scale(){return this.$m};set scale(v){this.$m=v;this.$T.color.set(0,.1*v,.75,1);this.$U.color.set(0,.06*v,.75,1)};get level(){return this.$n};set level(v){this.$n=v;this.$N.color.g=v};setSize(w,h){this.$k=w;this.$w=h;let f=h/w;this.$U[$[13]].width=this.$T[$[13]].width=this.$N[$[13]].width=w;this.$U[$[13]].height=this.$T[$[13]].height=this.$N[$[13]].height=h;this.$U[$[2]].repeatY=this.$U[$[2]].repeatX*f;this.$T[$[2]].repeatY=this.$T[$[2]].repeatX*f};render(g){let l=this.$l*g,m=l*2;this.$f+=l*2.5;let j=$m.sin(this.$f)*.3,k=$m.cos(this.$f)*.3;let q=this.$T[$[2]];q.x=this.$I.x*q.repeatX+((l*.75+j)%1);q.y=this.$I.y*q.repeatY+((m*.75+k)%1);q=this.$U[$[2]];q.x=this.$I.x*q.repeatX+((l*2-j)%1);q.y=this.$I.y*q.repeatY+((m*2-k)%1)};move(x,y){this.$I.x=x/this.$k;this.$I.y=y/this.$w}}:$n;let areObjectsEqual=(a,b)=>{if(a===b)return 1;if(typeof a!==typeof b)return 0;if(typeof a!==$[22]||a===$n||b===$n)return 0;let d=$o[$[14]](a),f=$o[$[14]](b);if(d.length!==f.length)return 0;let g,h,j,c,i=d.length;while((g=d[--i])){h=a[g];j=b[g];if(h!==j){c=0;if(typeof h===$[22]&&typeof j===$[22])c=areObjectsEqual(h,j);if(!c)return 0}};return 1};let clamp=(b,c,d)=>$m.max(b,$m.min(c,d));let cross=(a,b)=>a.x*b.y-a.y*b.x;let dot=(a,b)=>a.x*b.x+a.y*b.y;let distanceBetweenPointAndLine=(p,l)=>{let j={x:l.b.x-l.a.x,y:l.b.y-l.a.y},k={x:p.x-l.a.x,y:p.y-l.a.y},m={x:p.x-l.b.x,y:p.y-l.b.y},n=dot(j,k)<0,q=dot(j,m)>0;if(!n&&!q)return $m.abs(cross(j,k))/$m.hypot(j.x,j.y);let P=n?k:m;return $m.hypot(P.x,P.y)};let areTwoLinesCollided=(r,s)=>{let a=r.b.y-r.a.y,b=r.b.x-r.a.x,c=s.b.y-s.a.y,d=s.b.x-s.a.x,t=b*c-d*a;if(t!==0){let e=s.b.x-r.a.x,f=s.a.x-s.b.x,g=s.b.y-r.a.y,h=r.a.y-r.b.y,y=(c*e+f*g)/t,v=(h*e+b*g)/t;if(y>0&&y<1&&v>0&&v<1)return{lambda:y,gamma:v}}};let lineToLineIntersection=(r,s)=>{let z=areTwoLinesCollided(r,s);return z?{x:r.a.x+(r.b.x-r.a.x)*z.lambda,y:r.a.y+(r.b.y-r.a.y)*z.lambda}:$n};let areTwoRectsCollided=(w,x)=>w.width>x.x&&w.x<x.width&&w.height>x.y&&w.y<x.height;let rectToRectIntersection=(w,x)=>areTwoRectsCollided(w,x)?{x:$m.max(w.x,x.x),y:$m.max(w.y,x.y),width:$m.min(w.width,x.width),height:$m.min(w.height,x.height)}:$n;let enterFrame=(k,l=0)=>{let f={};let p,h,g,n,c=Date.now(),s,m=0;let q=()=>{FPS.update();k(FPS.fps,FPS.delay)};let r=()=>{let b=Date.now();let d=b-c;if(d>=n){n=2*g-d;c=b;q()}};let j=()=>{if(m){p();s=requestAnimationFrame(j)}};f[$[23]]=()=>m;f.clearMaxFPS=()=>{h=1/0;p=q};f.getMaxFPS=()=>h;f.setMaxFPS=(l)=>{if(!l||l<=0)return f.clearMaxFPS();h=l;n=g=$m.floor(1e3/h)-1;p=r};f.start=()=>{if(!m){m=1;j()}};f.stop=()=>{cancelAnimationFrame(s);m=0};f.setMaxFPS(l);f.start();return f};let enumCheck=(c,b)=>(c&b)===b;let fract=(f)=>f%1;let nthCall=(g,b,d=0)=>{let f=b-(d+1);return(...c)=>!(f=f>-1?(1+f)%b:++f)&&g(...c)};let getRandomFrom=(b)=>b[$m.floor($m.random()*b.length)];let coordToVector=(x,y,w)=>x+y*w;let vectorToCoord=(i,w)=>({x:i%w,y:~~(i/w)});let generateDungeon=(F,J)=>{let G=[{x:1,y:0},{x:1,y:1},{x:0,y:1},{x:-1,y:1},{x:-1,y:0},{x:-1,y:-1},{x:0,y:-1}],p=[];let d=1/0,f=1/0,g=-1/0,j=-1/0;for(let i=0;i<F;i++){let C=getRandomFrom(G),H=clone(getRandomFrom(J));if($m.random()<.5)H.data.reverse();let k={...H,x:0,y:0};let z=100;while(z--){let D=0;for(let I of p){if(areTwoRectsCollided({x:I.x,y:I.y,width:I.x+I.width,height:I.y+I.height},{x:k.x,y:k.y,width:k.x+k.width,height:k.y+k.height})){let b=$m.random()-.5,L=$m.round(($m.random()-.5)*2);k.x+=C.x?b>=0||!C.y?C.x:L:L;k.y+=C.y?b<0||!C.x?C.y:L:L;D=1;break}};if(!D)break};d=$m.min(k.x,d);f=$m.min(k.y,f);g=$m.max(k.x+k.width,g);j=$m.max(k.y+k.height,j);p.push(k)};let q=g-d,t=j-f,l=Array(q*t).fill(0);p.forEach(({x,y,width:w,height:h,data:A})=>{let m=x-d,n=y-f;A.forEach((r,s)=>{const{x:px,y:py}=vectorToCoord(s,w);l[coordToVector(m+px,n+py,q)]=r})});for(let i=0,c=l.length-q;i<c;i++){const{x:px,y:py}=vectorToCoord(i,q);if(px<q-1&&l[i]>0){let E=coordToVector(px,py+1,q),B=coordToVector(px+1,py,q),M=coordToVector(px+1,py+1,q),v=coordToVector(px-1,py,q),K=coordToVector(px-1,py+1,q);if(l[E]===l[B]&&l[i]===l[M]&&l[i]!==l[B]){l[E]=l[B]=1};if(px>0&&l[E]===l[v]&&l[i]===l[K]&&l[i]!==l[v]){l[E]=l[v]=1}}};return{width:q,height:t,data:l}};let noopReturnsWith=(b)=>()=>b;let arraySet=(c,d,b=0)=>{let i=d.length;while(--i>-1)c[b+i]=d[i];return c};let removeFromArray=(c,b)=>{let d=c.indexOf(b);d>-1&&c.splice(d,1)};let hashNoise2D=(x,y,b)=>fract($m.sin(dot({x,y},{x:$m.sin(x+y),y:$m.cos(y-x)*b}))*b)*.5+.5;let hash=1;let stepNoise=(x,y,b)=>(hash=$m.abs(fract(hash*(.12+34.56*x+b*y*78.9))));$w.PWGLExtensions=$w.AGLExtensions={version:"3.0.0",controls:{PressState,Mouse,Keyboard,Gamepad},audio:{AudioItem,AudioMixer,fadeAudioVolume,crossFadeAudioVolumes},display:{AnimatedWater,SmoothLight},utils:{FPS,createDataObserver,areObjectsEqual,clamp,mix,clone,collisionDetection:{distanceBetweenPointAndLine,areTwoLinesCollided,lineToLineIntersection,areTwoRectsCollided,rectToRectIntersection},cross,dot,enterFrame,enumCheck,fract,getFPS,nthCall,generateDungeon,noop,noopReturnsWith,arraySet,removeFromArray,gridMapping:{coordToVector,vectorToCoord},random:{getRandomFrom,hashNoise2D,stepNoise}}};console.log(`%cPWGL Extensions v${AGLExtensions.version}\nhttps:\/\/github.com/asjs-dev/pwgl`,"background:#222;color:#0F0");})();