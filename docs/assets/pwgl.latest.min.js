(()=>{var $="$locations,RENDERING_TYPE,updateId,context,sourceTexture,$parent,height,$updateId,uniform1f,config,propsUpdateId,$renderTime,$enableBuffers,$uploadBuffers,textureTransform,heightMap,matrixCache,$MAX_RENDER_COUNT,updateRotation,locations,removeEventListener,children,$height,updateScale,initRendererConfig,addEventListener,texParameteri,$attachFramebufferAndClear,VERSION,updateCrop,clearColor,$drawInstanced,createElement,$currentAglId,activeTexture,$matrixBuffer,$useTextureAt,useActiveTexture,callEventHandler,$updateAdditionalData,cosRotationA,cosRotationB,sinRotationA,sinRotationB,setBlendMode,roughnessMap,updateAnimation,maxTextureImageUnits,container,$createBuffers,textureMatrixCache,premultipliedAlpha,colorUpdateId,$sizeUpdateId,textureIds,colorCache,scaledHeight,transform,normalMap,textureRepeatRandomCache,_draw,interactive,bindTexture,scaledWidth,removeChild,textureCrop,$useTexture,distortionProps,depthMultiplier,$corners,useTexture,heightHalf,webglcontextrestored,clearTextures,getChildIndex,setChildIndex,callbackBeforeRender,distortionPropsCache,widthHalf,getProgramParameter,callbackAfterRender,useTextureAt,frameLength,contextAttributes,isWebGl2Supported,uploadTextureInfo,webglcontextlost,bindActiveTexture,deactivateTexture,useRepeatTextures,getShaderInfoLog,specularStrength,textureCropCache,useProgram,RADIAN_360,bindVertexArray,bindFramebuffer,distortTexture,naturalWidth,Separate".split(",");"use strict";var F32A=Float32Array,$m=Math,$d=document,$n=null;var $rfa=(d,b)=>{var f=d.indexOf(b);f>-1&&d.splice(f,1)};var noop=()=>{};var $as=(g,h,c)=>{var i=h.length;while(--i>-1)g[c+i]=h[i]};var _4s={a:"Attrib",u:"Uniform"};var _4r=(b,p,n)=>{var g=b.createShader(n);b.shaderSource(g,p);b.compileShader(g);return g};var _4h=$m.PI/180;var Utils={ALPHA:90*_4h,THETA:_4h,GLSL:{VERSION:"#version 300 es\n",DEFINE:{RADIAN_360:"#define RADIAN_360 "+$m.PI*2+"\n",HEIGHT:"#define HEIGHT 255.\n",Z:"#define Z vec3(0,1,-1)\n",PI:"#define PI "+$m.PI+"\n"},RANDOM:"float rand(vec2 p,float s){p=mod(p,vec2(10000));return fract(sin(dot(p,vec2(sin(p.x+p.y),cos(p.y-p.x))))*s);}float rand(vec2 p){return rand(p,1.);}"},INFO:{isWebGl2Supported:0},initContextConfig:(j={})=>({canvas:$d[$[32]]("canvas"),...j,contextAttributes:{...{powerPreference:"high-performance",preserveDrawingBuffer:0,premultipliedAlpha:0},...(j[$[83]]||{})}}),initRendererConfig:(j={})=>({locations:j[$[19]]||[],context:j[$[3]]||new Context}),initApplication:(l)=>{var t=()=>l(Utils.INFO[$[84]]);[$[61],"complete"].includes($d.readyState)?t():$d[$[25]]("DOMContentLoaded",t,{once:1})},createProgram:(b,w,y)=>{var q=_4r(b,w,35633),v=_4r(b,y,35632),k=b.createProgram();b.attachShader(k,q);b.attachShader(k,v);b.linkProgram(k);if(!b[$[79]](k,35714)){console.error("Program info:",b.getProgramInfoLog(k),"\n","Validate status:",b[$[79]](k,35715),"\n","Vertex shader info:",b[$[90]](q),"\n","Fragment shader info:",b[$[90]](v));b.deleteShader(q);b.deleteShader(v);b.deleteProgram(k);throw"WebGL application stoped"};return k},getLocationsFor:(b,k,x)=>{var m={};x.forEach((d)=>(m[d]=b["get"+_4s[d[0]]+"Location"](k,d)));return m}};var Const={};var _gl=$d[$[32]]("canvas").getContext("webgl2");if(_gl){for(var c in _gl){var f=_gl[c];if(typeof f==="number"&&c===c.toUpperCase())Const[c]=f};Utils.INFO[$[84]]=1;Utils.INFO[$[47]]=_gl.getParameter(34930)};class DTI{constructor(){this.target=3553;this.wrapS=this.wrapT=33071;this.internalFormat=this.format=6408;this.minFilter=this.magFilter=9729;this.maxMipMapLevel=this.baseMipMapLevel=0;this.type=5121;this[$[33]]=this._$cB=-1;this[$[7]]=this.$width=this[$[22]]=1};get width(){return this.$width};get height(){return this[$[22]]};get wrapS(){return this._$g};set wrapS(v){if(this._$g!==v){this._$g=v;++this[$[7]]}};get wrapT(){return this._$h};set wrapT(v){if(this._$h!==v){this._$h=v;++this[$[7]]}};get internalFormat(){return this._$cC};set internalFormat(v){if(this._$cC!==v){this._$cC=v;++this[$[7]]}};get format(){return this._$p};set format(v){if(this._$p!==v){this._$p=v;++this[$[7]]}};get minFilter(){return this._$O};set minFilter(v){if(this._$O!==v){this._$O=v;++this[$[7]]}};get magFilter(){return this._$P};set magFilter(v){if(this._$P!==v){this._$P=v;++this[$[7]]}};get maxMipMapLevel(){return this._$cD};set maxMipMapLevel(v){if(this._$cD!==v){this._$cD=v;++this[$[7]]}};get baseMipMapLevel(){return this._$cK};set baseMipMapLevel(v){if(this._$cK!==v){this._$cK=v;++this[$[7]]}};get type(){return this._$c};set type(v){if(this._$c!==v){this._$c=v;++this[$[7]]}};useActiveTexture(b,c){this[$[34]](b,c);this[$[70]](b)};useActiveTextureAfterUpdate(b,c){this[$[34]](b,c);this.useTextureAfterUpdate(b)};unbindTexture(b,c){this[$[34]](b,c);this._$cB=-1;b[$[62]](this.target,$n)};activeTexture(b,c){this._$cB=c;b[$[34]](33984+c)};bindActiveTexture(b,c){this[$[34]](b,c);b[$[62]](this.target,this._$cc)};useTexture(b){b[$[62]](this.target,this._$cc);this.createTexImage2D(b)};useTextureAfterUpdate(b){b[$[62]](this.target,this._$cc);this[$[85]](b)};createTexImage2D(b){b.texImage2D(this.target,0,this._$cC,this.width,this[$[6]],0,this._$p,this._$c,this._$cp);this[$[85]](b)};uploadTextureInfo(b){b[$[26]](this.target,10242,this._$g);b[$[26]](this.target,10243,this._$h);b[$[26]](this.target,10241,this._$O);b[$[26]](this.target,10240,this._$P);b[$[26]](this.target,33085,this._$cD);b[$[26]](this.target,33084,this._$cK);b.generateMipmap(this.target)}};var BlendMode=(()=>{var b=(c,d)=>({functionName:"blendFunc"+(c.length<3?"":$[99]),functions:c,equationName:"blendEquation"+(!d||d.length<2?"":$[99]),equations:d||[32774]});return{createBlendMode:b,NONE:b([0,0]),NORMAL_PM:b([1,771]),ADD_PM:b([1,1]),MULTIPLY_PM:b([774,771,1,771]),SCREEN_PM:b([1,769,1,771]),ADD_NPM:b([770,1,1,1]),SRC_IN:b([772,0]),SRC_OUT:b([773,0]),SRC_ATOP:b([772,771]),DST_OVER:b([773,1]),DST_IN:b([0,770]),DST_OUT:b([0,771]),DST_ATOP:b([773,770]),XOR:b([773,771]),NORMAL:b([770,771,1,771]),ADD:b([770,772,1,772]),MULTIPLY:b([774,0]),SCREEN:b([770,769,1,769]),OVERLAY:b([1,771]),EXCLUSION:b([775,769]),LIGHTEN:b([1,1],[32776]),DARKEN:b([1,1],[32775]),SHADOW:b([774,768])}})();class Context{constructor(h={}){this.contextId=0;this._$q=Utils.initContextConfig(h);this._$cw=this._$cw.bind(this);this._$cd=this._$cd.bind(this);this._$cE=this._$cE.bind(this);this.canvas=this._$q.canvas;this.canvas[$[25]]($[86],this._$cw);this.canvas[$[25]]($[72],this._$cd);this._$cd()};isLost(){return this.gl&&this.gl.isContextLost&&this.gl.isContextLost()};useBlendMode(n){this._$cQ=n;this.gl[n.equationName].apply(this.gl,n.equations);this.gl[n.functionName].apply(this.gl,n.functions)};setBlendMode(n,t){if(this._$cQ!==n){t&&t();this.useBlendMode(n)}};destruct(){this.gl[$[93]]($n);this.canvas[$[20]]($[86],this._$cw);this.canvas[$[20]]($[72],this._$cd);this._$cF&&this._$cF.loseContext()};clearTextures(){var l=Utils.INFO[$[47]];for(var i=0;i<l;++i){this._$T[i]=$n;this._$cX[i]=i};this[$[54]].length=0};useTexture(s,r,p=1,m){if(!s)return-1;var q=this._$T.indexOf(s);if(q<0){if(this._$cX.length<1){m&&m();this[$[73]]();q=0}else q=this._$cX[0];p=1};return this[$[81]](s,q,r,p)};useTextureAt(s,q,r,p=1){s.use(this.gl,q,p,r);this._$T[q]=s;!this[$[54]].includes(q)&&this[$[54]].push(q);$rfa(this._$cX,q);return q};deactivateTexture(s){var q=this._$T.indexOf(s);q>-1&&s.unbindTexture(this.gl,q)};useProgram(k,c){if(this._$cG!==k){this._$cG=k;this[$[73]]();var b=this.gl;b[$[95]]($n);b[$[93]](k);b[$[95]](c);return 1}};setCanvasSize(f,j){this.canvas.width=f;this.canvas[$[6]]=j};setSize(f,j){if(this._$j!==f||this._$r!==j){this._$j=f;this._$r=j;this.gl.viewport(0,0,f,j);this.gl.scissor(0,0,f,j)}};_$cw(g){g.preventDefault();this._$cF&&setTimeout(this._$cE,1)};_$cE(){this._$cF.restoreContext()};_$cd(){var b=(this.gl=this.canvas.getContext("webgl2",this._$q[$[83]]));b.agl_id=++this.contextId;this._$cF=b.getExtension("WEBGL_lose_context");b.pixelStorei(37441,1);b.enable(3042);b.blendColor(1,1,1,1);b.enable(3089);this._$j=this._$r=this._$cG=this._$cQ=$n;this._$T=[];this._$cX=[];this[$[54]]=[];this[$[73]]();this.setCanvasSize(1,1);this._$q.initCallback&&setTimeout(this._$q.initCallback,1)}};class Buffer{constructor(r,d,f,g,j,h,n=1){var k=f*g;this.data=typeof d==="number"?new F32A(d*k):d;this._$cq=r;this._$d=f;this._$f=g;this._$s=j??34962;this._$c=h??35048;this._$t=k*4;this._$v=g*4;this._$D=n;if(this._$c===35044)this._$t=this._$v=0};create(b,q){this._$L=q[this._$cq];this._$w=b.createBuffer();this.bind(b)};bind(b){b.bindBuffer(this._$s,this._$w)};upload(b,l){this.bind(b);l&&this._$x(b);b.bufferData(this._$s,this.data,this._$c)};destruct(){this.data=$n};_$x(b){var f=this._$d,p=this._$L,g=this._$f,k=this._$t,m=this._$v,n=this._$D;var i=-1;while(++i<f){var c=p+i;b.enableVertexAttribArray(c);b.vertexAttribPointer(c,g,5126,0,k,i*m);b.vertexAttribDivisor(c,n)}}};var _8n=$d[$[32]]("img");class Texture extends DTI{constructor(j,m){super();this.isVideo=0;this._$y=_8n;this._$cR=this._$cR.bind(this);this.source=j;this.shouldUpdate=m;this._$cZ="width";this._$dg=$[6];this._$cY=this._$cr=0};get width(){return this._$cf||1};get height(){return this._$cs||1};get source(){return this._$y};set source(f){if(f){this._$y[$[20]](this._$Q,this._$cR);this._$y=f;this.isVideo=f.tagName.toLowerCase()==="video";this._$Q=this.isVideo?"canplay":"load";!this._$cR()&&f[$[25]](this._$Q,this._$cR,{once:1})}};destruct(){this._$y[$[20]](this._$Q,this._$cR)};use(b,c,k,l){if(this[$[33]]<b.agl_id){this[$[33]]=b.agl_id;this._$cc=b.createTexture();this[$[37]](b,c)}else if(this[$[7]]||this._$cr||(this.shouldUpdate&&this._$cY<l)||(this.isVideo&&!this._$y.paused)){this[$[7]]=this._$cr=0;this._$cY=l;this[$[37]](b,c)}else if(this._$cB!==c||k)this[$[87]](b,c)};get _$cf(){return this._$y[this._$cZ]};get _$cs(){return this._$y[this._$dg]};_$cR(){this._$cZ="width";this._$dg=$[6];if(this._$y[$[98]]){this._$cZ=$[98];this._$dg="naturalHeight"}else if(this._$y.videoWidth){this._$cZ="videoWidth";this._$dg="videoHeight"};if(this._$cf*this._$cs){this._$cp=this._$y;++this._$cr;return 1};this._$cp=$n}};Texture.loadImage=(d,m)=>{var g=$d[$[32]]("img");g.src=d;return new Texture(g,m)};Texture.loadVideo=(d,m)=>{var h=$d[$[32]]("video");h.src=d;return new Texture(h,m)};class Framebuffer extends DTI{constructor(){super();this._$cH=1};get width(){return this.$width};set width(v){if(this.$width!==v&&v){this.$width=v;++this._$cH}};get height(){return this[$[22]]};set height(v){if(this[$[22]]!==v&&v){this[$[22]]=v;++this._$cH}};setSize(w,h){this.width=w;this[$[6]]=h};bind(b){b[$[96]](36160,this._$cg)};unbind(b){b[$[96]](36160,$n)};use(b,c,d){if(this[$[33]]<b.agl_id){this[$[33]]=b.agl_id;this._$cc=b.createTexture();this[$[37]](b,c);this._$cg=b.createFramebuffer();this.bind(b);b.framebufferTexture2D(36160,36064,3553,this._$cc,0);this.unbind(b)}else if(this[$[7]]){this[$[7]]=0;this.useActiveTextureAfterUpdate(b,c)}else if(this._$cH){this._$cH=0;this[$[37]](b,c)}else if(this._$cB!==c||d)this[$[87]](b,c)};destruct(){}};class DBTP{constructor(){this[$[18]]=noop;this[$[40]]=this[$[41]]=1;this[$[2]]=this[$[42]]=this[$[43]]=this._x=this._y=this._$M=this._$E=this._$F=this._$k=this._$l=0};get x(){return this._x};set x(v){if(this._x!==v){this._x=v;++this[$[2]]}};get y(){return this._y};set y(v){if(this._y!==v){this._y=v;++this[$[2]]}};get rotation(){return this._$M};set rotation(v){if(this._$M!==v){this._$M=v;this[$[18]]=this._$cI}};get anchorX(){return this._$E};set anchorX(v){if(this._$E!==v){this._$E=v;++this[$[2]]}};get anchorY(){return this._$F};set anchorY(v){if(this._$F!==v){this._$F=v;++this[$[2]]}};get skewX(){return this._$k};set skewX(v){if(this._$k!==v){this._$k=v;this[$[18]]=this._$cI}};get skewY(){return this._$l};set skewY(v){if(this._$l!==v){this._$l=v;this[$[18]]=this._$cI}};_$cI(){this[$[18]]=noop;++this[$[2]];if(this._$k===0&&this._$l===0){this[$[42]]=this[$[43]]=$m.sin(this._$M);this[$[40]]=this[$[41]]=$m.cos(this._$M)}else{var b=this._$M-this._$k,c=this._$M+this._$l;this[$[42]]=$m.sin(c);this[$[40]]=$m.cos(c);this[$[43]]=$m.sin(b);this[$[41]]=$m.cos(b)}}};class DITP extends DBTP{constructor(){super();this[$[23]]=noop;this[$[63]]=this[$[56]]=this._$z=this._$A=this.$width=this[$[22]]=1};get scaleX(){return this._$z};set scaleX(v){if(this._$z!==v){this._$z=v;this[$[23]]=this._$ch}};get scaleY(){return this._$A};set scaleY(v){if(this._$A!==v){this._$A=v;this[$[23]]=this._$ch}};get width(){return this.$width};set width(v){if(this.$width!==v){this.$width=v;this[$[23]]=this._$ch}};get height(){return this[$[22]]};set height(v){if(this[$[22]]!==v){this[$[22]]=v;this[$[23]]=this._$ch}};_$ch(){this[$[23]]=noop;++this[$[2]];this[$[63]]=this.$width*this._$z;this[$[56]]=this[$[22]]*this._$A}};class DCP{constructor(){this[$[2]]=1;this.cache=[1,1,1,1]};get r(){return this.cache[0]};set r(v){if(this.cache[0]!==v){this.cache[0]=v;++this[$[2]]}};get g(){return this.cache[1]};set g(v){if(this.cache[1]!==v){this.cache[1]=v;++this[$[2]]}};get b(){return this.cache[2]};set b(v){if(this.cache[2]!==v){this.cache[2]=v;++this[$[2]]}};get a(){return this.cache[3]};set a(v){if(this.cache[3]!==v){this.cache[3]=v;++this[$[2]]}};set(r,g,b,a){this.r=r;this.g=g;this.b=b;this.a=a}};var GM3U={identity:()=>new F32A([1,0,0,1,0,0]),projection:(v,k)=>{v[0]=2/k.width;v[1]=v[2]=0;v[3]=-2/k[$[6]];v[4]=-1;v[5]=1},transformLocal:(t,v)=>{var f=t.anchorX,g=t.anchorY,m=t[$[63]],n=t[$[56]];v[0]=t[$[40]]*m;v[1]=t[$[42]]*m;v[2]=-t[$[43]]*n;v[3]=t[$[41]]*n;v[4]=t.x-f*v[0]-g*v[2];v[5]=t.y-f*v[1]-g*v[3]},transform:(d,t,v)=>{var x=t.x,y=t.y,f=t.anchorX,g=t.anchorY,p=t[$[42]],q=t[$[43]],r=t[$[40]],s=t[$[41]],m=t[$[63]],n=t[$[56]];v[0]=(r*d[0]+p*d[2])*m;v[1]=(r*d[1]+p*d[3])*m;v[2]=(s*d[2]-q*d[0])*n;v[3]=(s*d[3]-q*d[1])*n;v[4]=-f*v[0]-g*v[2]+x*d[0]+y*d[2]+d[4];v[5]=-f*v[1]-g*v[3]+x*d[1]+y*d[3]+d[5]},inverse:(d,v)=>{var b=1/(d[0]*d[3]-d[2]*d[1]);v[0]=b*d[3];v[1]=-b*d[1];v[2]=-b*d[2];v[3]=b*d[0];v[4]=b*(d[2]*d[5]-d[3]*d[4]);v[5]=-b*(d[0]*d[5]-d[1]*d[4])},isPointInMatrix:(d,c)=>{var x=c.x*d[0]+c.y*d[2]+d[4],y=c.x*d[1]+c.y*d[3]+d[5];return x>=0&&x<=1&&y>=0&&y<=1},calcCorners:(d,h,k)=>{var j=k[$[78]],l=k[$[71]];h[0].x=j+d[4]*j;h[0].y=k[$[6]]-(l+d[5]*l);h[1].x=h[0].x+(d[0]+d[2])*j;h[1].y=h[0].y-(d[1]+d[3])*l;h[2].x=h[0].x+(d[0]+j*d[2]);h[2].y=h[0].y-(d[1]+l*d[3]);h[3].x=h[0].x+(j*d[0]+d[2]);h[3].y=h[0].y-(l*d[1]+d[3])}};class Item{constructor(){this[$[1]]=Item[$[1]];this[$[16]]=GM3U.identity();this[$[52]]=this[$[10]]=0;this[$[57]]=new this.$transformClass;this.color=new DCP;this[$[55]]=[1,1,1,1];this[$[61]]=0;this.alpha=1;this[$[76]]=this[$[80]]=noop;this._$dl=this._$dm=-1;this._$U=1;this.$bounds={x:0,y:0,width:0,height:0}};get renderable(){return this._$U};set renderable(v){this._$U=v};get stage(){return this[$[5]]?this[$[5]].stage:$n};get parent(){return this[$[5]]};set parent(v){if(this[$[5]]!==v){this[$[5]]=v;this._$ds=this._$dt=-1}};get callbackBeforeRender(){return this._$dn};set callbackBeforeRender(v){this._$dn=v??noop};get callbackAfterRender(){return this._$dh};set callbackAfterRender(v){this._$dh=v??noop};callEventHandler(d,b){if(this[$[61]]){var g=this["on"+b.type];g&&g(this,d,b)};this[$[5]]&&this[$[5]][$[38]](d,b)};getBounds(){return this.$bounds};destruct(){this[$[5]]&&this[$[5]][$[64]]&&this[$[5]][$[64]](this)};update(){var h=this[$[57]],f=this[$[5]];this._$cj();h[$[18]]();h[$[23]]();(this._$ds<f[$[10]]||this._$dm<h[$[2]])&&this._$cL(h,f)};get $transformClass(){return DITP};_$cL(h,f){this._$ds=f[$[10]];this._$dm=h[$[2]];++this[$[10]];GM3U[$[57]](f[$[16]],h,this[$[16]])};_$cj(){var f=this[$[5]],c=this.color;if(this._$dt<f[$[52]]||this._$dl<c[$[2]]){this._$dt=f[$[52]];this._$dl=c[$[2]];++this[$[52]];var j=this[$[55]],k=f[$[55]];j[0]=k[0]*c.r;j[1]=k[1]*c.g;j[2]=k[2]*c.b;j[3]=k[3]*c.a}}};Item[$[1]]="item";class BaseDrawable extends Item{constructor(){super();this[$[69]]=[{x:0,y:0},{x:0,y:0},{x:0,y:0},{x:0,y:0}]};get parent(){return this[$[5]]};set parent(v){if(this[$[5]]!==v){super.parent=v;this._$dv=-1}};getCorners(){this[$[39]]();return this[$[69]]};getBounds(){this[$[39]]();return this.$bounds};$calcCorners(){GM3U.calcCorners(this[$[16]],this[$[69]],this.stage.renderer)};$updateAdditionalData(){if(this.renderable&&this._$dv<this[$[10]]){this._$dv=this[$[10]];this._$V();return 1}};_$V(){this.$calcCorners();var g=this[$[69]],f=this.$bounds,a=g[0],b=g[1],c=g[2],d=g[3];f.x=$m.min(a.x,b.x,c.x,d.x);f.y=$m.min(a.y,b.y,c.y,d.y);f.width=$m.max(a.x,b.x,c.x,d.x);f[$[6]]=$m.max(a.y,b.y,c.y,d.y)}};class DLTP extends DITP{constructor(){super();this.z=0};get width(){return this.$width};set width(v){if(this.$width!==v){this.$width=this[$[22]]=v;this[$[23]]=this._$ch}};get height(){return this[$[22]]};set height(v){this.width=v}};class Light extends BaseDrawable{constructor(){super();this[$[1]]=Light[$[1]];this.castShadow=this.shading=this.centerReflection=1;this.flattenShadow=0;this.angle=0;this.spotAngle=180*Utils.THETA;this.type=Light.Type.POINT;this.precision=this.shadowLength=this[$[91]]=1;this.maxShadowStep=128};get castShadow(){return this._$W};set castShadow(v){this._$W=v;this._$ck()};get shading(){return this._$G};set shading(v){this._$G=v;this._$ck()};get flattenShadow(){return this._$cx};set flattenShadow(v){this._$cx=v;this._$ck()};get centerReflection(){return this._$cS};set centerReflection(v){this._$cS=v;this._$ck()};get $transformClass(){return DLTP};$calcCorners(){super.$calcCorners();var f=this[$[69]],a=f[0],b=f[1],c=f[2],d=f[3];a.x+=a.x-d.x+(a.x-c.x);a.y+=a.y-d.y+(a.y-c.y);c.x+=c.x-b.x;c.y+=c.y-b.y;d.x+=d.x-b.x;d.y+=d.y-b.y};_$ck(){this.flags=(this._$W*1)|(this._$G*2)|(this._$cx*4)|(this._$cS*8)}};Light[$[1]]="light";Light.Type={POINT:0,DIRECTIONAL:1};class DTTP extends DBTP{constructor(){super();this.cache=[0,0,0];this._$H=this._$I=1};get scaledWidth(){return this._$H};get scaledHeight(){return this._$I};get repeatX(){return this._$H};set repeatX(v){if(this._$H!==v){this._$H=v;++this[$[2]]}};get repeatY(){return this._$I};set repeatY(v){if(this._$I!==v){this._$I=v;++this[$[2]]}};get repeatRandomRotation(){return this.cache[0]};set repeatRandomRotation(v){this.cache[0]=v};get repeatRandomAlpha(){return this.cache[1]};set repeatRandomAlpha(v){this.cache[1]=v};get repeatRandomBlur(){return this.cache[2]};set repeatRandomBlur(v){this.cache[2]=v}};class DTC{constructor(){this[$[29]]=this._$X;this.cache=[0,0,1,1];this._$j=this._$r=1};get x(){return this.cache[0]};set x(v){if(this.cache[0]!==v){this.cache[0]=v;this[$[29]]=this._$X}};get y(){return this.cache[1]};set y(v){if(this.cache[1]!==v){this.cache[1]=v;this[$[29]]=this._$X}};get width(){return this._$j};set width(v){if(this._$j!==v){this._$j=v;this[$[29]]=this._$X}};get height(){return this._$r};set height(v){if(this._$r!==v){this._$r=v;this[$[29]]=this._$X}};setRect(b){this.x=b.x;this.y=b.y;this.width=b.width;this[$[6]]=b[$[6]]};_$X(){this[$[29]]=noop;this.cache[2]=this._$j-this.cache[0];this.cache[3]=this._$r-this.cache[1]}};class DDP{constructor(){this[$[97]]=1;this.cache=[0,0,1,0,1,1,0,1]};get topLeftX(){return this.cache[0]};set topLeftX(v){this.cache[0]=v};get topLeftY(){return this.cache[1]};set topLeftY(v){this.cache[1]=v};get topRightX(){return this.cache[2]};set topRightX(v){this.cache[2]=v};get topRightY(){return this.cache[3]};set topRightY(v){this.cache[3]=v};get bottomRightX(){return this.cache[4]};set bottomRightX(v){this.cache[4]=v};get bottomRightY(){return this.cache[5]};set bottomRightY(v){this.cache[5]=v};get bottomLeftX(){return this.cache[6]};set bottomLeftX(v){this.cache[6]=v};get bottomLeftY(){return this.cache[7]};set bottomLeftY(v){this.cache[7]=v}};class Image extends BaseDrawable{constructor(c){super();this._$db=new F32A(6);this[$[1]]=Image[$[1]];this[$[50]]=GM3U.identity();this.tintType=Image.TintType.NORMAL;this.blendMode=BlendMode.NORMAL;this.texture=c;this[$[14]]=new DTTP;this[$[65]]=new DTC;this[$[67]]=new DDP;this[$[92]]=this[$[65]].cache;this[$[59]]=this[$[14]].cache;this[$[77]]=this[$[67]].cache;this._$dw=-1};get parent(){return this[$[5]]};set parent(v){if(this[$[5]]!==v){super.parent=v;this._$dx=-1}};update(){super.update();this._$cy();this[$[65]][$[29]]()};isContainsPoint(b){this._$dq();return GM3U.isPointInMatrix(this._$db,b)};$updateAdditionalData(){if(super[$[39]]())this._$dq()};_$dq(){if(this._$dx<this[$[10]]){this._$dx=this[$[10]];GM3U.inverse(this[$[16]],this._$db)}};_$cy(){var d=this[$[14]];d[$[18]]();if(this._$dw<d[$[2]]){this._$dw=d[$[2]];GM3U.transformLocal(d,this[$[50]])}}};Image[$[1]]="drawable";Image.TintType={NONE:0,NORMAL:1,GRAYSCALE:2,OVERRIDE:3,ADD:4};class AnimatedImage extends Image{constructor(c){super(c);this._$m=0;this[$[82]]=this._$dc=120;this._$B=[];this._$cY=Date.now();this.stop()};get isPlaying(){return this[$[46]]===this._$cM};get frames(){return this._$B};set frames(v){this._$B=v;var d=this._$B[0];if(d){this._$dc=d.length??this[$[82]];this._$cY=Date.now()}};gotoAndStop(b){this.stop();this._$m=b;this._$cN()};gotoAndPlay(b){this._$m=b;this.play()};stop(){this[$[46]]=noop};play(){this[$[46]]=this._$cM;this._$cN()};update(f){super.update();this[$[46]](f)};destruct(){this.stop();super.destruct()};_$cM(f){var g=f-this._$cY;if(g>this._$dc){this._$cY=f;this._$m+=~~(g/this._$dc);if(this._$m>=this._$B.length)this._$m=0;this._$cN()}};_$cN(){var h=this._$B[this._$m];this[$[65]].setRect(h);this._$dc=h.length??this[$[82]]}};class Container extends Item{constructor(){super();this[$[1]]=Container[$[1]];this[$[21]]=[]};get premultipliedAlpha(){return this.alpha*this[$[5]][$[51]]};destruct(){this.empty();super.destruct()};empty(){while(this[$[21]].length)this.removeChildAt(0)};contains(b){return this[$[74]](b)>-1};addChild(b){this.addChildAt(b,this[$[21]].length)};addChildAt(b,c){if(b){b.parent&&b.parent[$[64]](b);this[$[21]].push(b);this[$[75]](b,c);b.parent=this}};removeChild(b){if(b){$rfa(this[$[21]],b);b.parent=$n}};removeChildAt(c){this[$[64]](this.getChildAt(c))};getChildAt(c){return this[$[21]][c]};setChildIndex(b,c){$rfa(this[$[21]],b);this[$[21]].splice(c,0,b)};getChildIndex(b){return this[$[21]].indexOf(b)};swapChildren(d,f){var j=this[$[74]](d),k=this[$[74]](f);if(j>-1&&k>-1){this[$[75]](d,k);this[$[75]](f,j)}};getBounds(){var g=this.$bounds,h=this[$[21]],l=h.length;g.x=g.y=1/0;g.width=g[$[6]]=-1/0;for(var i=0;i<l;++i){var m=h[i].getBounds();g.x=$m.min(g.x,m.x);g.y=$m.min(g.y,m.y);g.width=$m.max(g.width,m.width);g[$[6]]=$m.max(g[$[6]],m[$[6]])};return g}};Container[$[1]]=$[48];class BaseRenderer{constructor(h){this._$dp=noop;this[$[53]]=1;this.width=this[$[6]]=this[$[78]]=this[$[71]]=this._$cT=this[$[11]]=0;this[$[30]]=new DCP;this._$J=h;var f=this._$J[$[9]];this[$[3]]=f[$[3]];f[$[19]]=[...f[$[19]],"uFlpY","aPos","uTex"];this[$[12]]=0;this._$dd=new Buffer("",new Uint16Array([0,1,3,2]),0,0,34963,35044);this._$cJ=new Buffer("aPos",new F32A([0,0,1,0,1,1,0,1]),1,2,34962,35044,0)};get clearBeforeRender(){return this._$dp===this._$n};set clearBeforeRender(v){this._$dp=v?this._$n:noop};setSize(b,g){this.width=b;this[$[6]]=g;++this[$[53]]};renderToFramebuffer(p){if(!this[$[3]].isLost()){this._$cO();this[$[27]](p);this._$cl(p);p.unbind(this.$gl)}};render(){if(!this[$[3]].isLost()){this._$cO();this.$gl[$[8]](this[$[0]].uFlpY,1);this._$dp();this._$cl()}};destruct(){};$attachFramebuffer(p){p.bind(this.$gl);p.setSize(this.width,this[$[6]]);this[$[3]][$[70]](p,this[$[11]],0);this[$[3]][$[88]](p);this.$gl[$[8]](this[$[0]].uFlpY,-1)};$attachFramebufferAndClear(p){this.$attachFramebuffer(p);this._$dp()};$resize(){this[$[78]]=this.width/2;this[$[71]]=this[$[6]]/2;this[$[3]].setSize(this.width,this[$[6]])};$drawInstanced(c){this.$gl.drawElementsInstanced(5,4,5123,0,c)};$useTextureAt(j,l,d,m){this.$gl.uniform1i(l,this[$[3]][$[81]](j,d,this[$[11]],m))};$useTexture(j,l,m){this.$gl.uniform1i(l,this[$[3]][$[70]](j,this[$[11]],m))};$uploadBuffers(){this._$cJ.upload(this.$gl,this[$[12]]);this._$dd.upload(this.$gl);this[$[12]]=0};$createBuffers(){this._$dd.create(this.$gl,this[$[0]]);this._$cJ.create(this.$gl,this[$[0]])};_$cl(p){this[$[11]]=Date.now();this.$render(p);this.$gl.flush()};_$cO(){this.$gl=this[$[3]].gl;var k=this[$[3]],n=k.contextId;if(this._$cT!==n){this._$cT=n;this._$ct()}else this._$Y();this.$resize()};_$n(){this.$gl[$[30]](this[$[30]].r,this[$[30]].g,this[$[30]].b,this[$[30]].a);this.$gl.clear(16384)};_$ct(){this._$K=Utils.createProgram(this.$gl,this.$createVertexShader(),this.$createFragmentShader());this[$[0]]=Utils.getLocationsFor(this.$gl,this._$K,this._$J[$[9]][$[19]]);this._$b=this.$gl.createVertexArray();this._$Y();this[$[49]]()};_$Y(){if(this[$[3]][$[93]](this._$K,this._$b))this[$[12]]=1}};class BatchRenderer extends BaseRenderer{constructor(b){b[$[9]][$[19]]=[...b[$[9]][$[19]],"aMt"];super(b);this[$[17]]=b.maxRenderCount||1e4;this[$[35]]=new Buffer("aMt",this[$[17]],4,4)};$uploadBuffers(){this[$[35]].upload(this.$gl,this[$[12]]);super[$[13]]()};$createBuffers(){super[$[49]]();this[$[35]].create(this.$gl,this[$[0]])}};class FilterRenderer extends BaseRenderer{constructor(h={}){h[$[9]]=Utils[$[24]](h[$[9]]);h[$[9]][$[19]]=["uFTex","uFtrT","uFtrV","uFtrK"];super(h);this._$dr=this[$[27]];this[$[27]]=noop;this.filters=h.filters||[];this[$[4]]=h[$[4]];this._$cv=[new Framebuffer,new Framebuffer]};$render(r){var j=this[$[3]],b=this.$gl,q=this[$[11]],n=this[$[0]],k=this.filters,l=k.length||1,c=l-2;j[$[44]](BlendMode.NORMAL);this[$[13]]();this[$[36]](this[$[4]],n.uTex,0);for(var i=0;i<l;++i){var t;var f=k[i],p=f&&f.on,g=i>c,s=p&&f[$[14]]&&f[$[14]].texture;s&&this[$[36]](s,n.uFTex,1);if(g)r?this._$dr(r):b[$[8]](n.uFlpY,1);else if(p){t=this._$cv[i&1];this._$dr(t)};if(p){b.uniform1fv(n.uFtrV,f.v);b.uniformMatrix4fv(n.uFtrK,0,f.kernels);b.uniform2i(n.uFtrT,f.TYPE,f.SUB_TYPE)};(p||g)&&this[$[31]](1);s&&j[$[88]](s);if(t){t.unbind(b);j[$[81]](t,0,q)}}};$createVertexShader(){return Utils.GLSL[$[28]]+"precision highp float;\nin vec2 aPos;uniform float uFlpY;out vec2 vUv,vTUv;void main(void){gl_Position=vec4(aPos*2.-1.,1,1);vUv=gl_Position.xy;gl_Position.y*=uFlpY;vTUv=vec2(aPos.x,1.-aPos.y);}"};$createFragmentShader(){var m=(d)=>"for(float i=0.;i<RADIAN_360;i+=t){poft=clamp(f+ivec2(floor(wh*vec2(cos(i),sin(i)))),ivec2(Z.xx),ts-1);clg=texelFetch(uTex,poft,0);"+d+"}";return Utils.GLSL[$[28]]+"precision highp float;\n"+Utils.GLSL.DEFINE.Z+Utils.GLSL.DEFINE[$[94]]+"uniform sampler2D uTex,uFTex;uniform ivec2 uFtrT;uniform float uFtrV[9];uniform mat4 uFtrK;in vec2 vUv,vTUv;out vec4 oCl;"+Utils.GLSL.RANDOM+"float gtGS(vec4 cl){return .3*oCl.r+.59*oCl.g+.11*oCl.b;}void main(void){oCl=texture(uTex,vTUv);float vl[]=uFtrV,v=vl[0];ivec2 ts=textureSize(uTex,0),f=ivec2(floor(vTUv*vec2(ts)));vec2 vol=v/vec2(ts);vec3 rgb=vec3(vl[2],vl[3],vl[4]);mat4 kr=uFtrK;if(uFtrT.x<2){kr*=v;oCl.rgb=(oCl.rgb*(1.-vl[1]))+(texelFetch(uTex,f-ivec2(1),0)*kr[0].x+texelFetch(uTex,f+ivec2(0,-1),0)*kr[0].y+texelFetch(uTex,f+ivec2(1,-1),0)*kr[0].z+texelFetch(uTex,f+ivec2(-1,0),0)*kr[0].w+oCl*kr[1].x+texelFetch(uTex,f+ivec2(1,0),0)*kr[1].y+texelFetch(uTex,f+ivec2(-1,1),0)*kr[1].z+texelFetch(uTex,f+ivec2(0,1),0)*kr[1].w+texelFetch(uTex,f+ivec2(1),0)*kr[2].x).rgb*vl[1];}else if(uFtrT.x<3)oCl.rgb=(oCl.rgb*(1.-vl[1]))+vec3(kr[0].r*oCl.r+kr[0].g*oCl.g+kr[0].b*oCl.b,kr[1].r*oCl.r+kr[1].g*oCl.g+kr[1].b*oCl.b,kr[2].r*oCl.r+kr[2].g*oCl.g+kr[2].b*oCl.b);else if(uFtrT.x<4){vec4 oClVl=oCl*(1.-v);if(uFtrT.y<2)oCl=oClVl+vec4(vec3(gtGS(oCl)),oCl.a)*v;else if(uFtrT.y<3)oCl=oClVl+vec4(vec3(.874,.514,.156)*gtGS(oCl),oCl.a)*v;else if(uFtrT.y<4)oCl=oClVl+vec4(1.-oCl.rgb,oCl.a)*v;else if(uFtrT.y<5)oCl.rgb*=rgb*v;else if(uFtrT.y<6)oCl.rgb=(round((oCl.rgb*255.)/v)/255.)*v;else if(uFtrT.y<7){vec2 pv=pow(abs(vUv*v),vec2(vl[1]));float cv=clamp((1.-length(pv))*vl[5],0.,1.);oCl.rgb=oCl.rgb*cv+rgb*(1.-cv);}else if(uFtrT.y<8)oCl.rgb+=vec3(vUv.xy*.15,(vUv.x*vUv.y)*.15)*v;else if(uFtrT.y<9)oCl.rgb=(vl[1]+1.)*oCl.rgb*v-.5*vl[1];else if(uFtrT.y<10)oCl.rgb=pow(oCl.rgb,vec3(1./v));}else if(uFtrT.x<5){vec2 wh=vec2(v,vl[1]);ivec2 poft;vec4 clg,cl=oCl;float cnt=1.,rnd=rand(vTUv*100.+50.),t=RADIAN_360/(3.+ceil(3.*rnd));if(uFtrT.y<2){"+m("cl+=clg;cnt++;")+"cl/=cnt;}else{float omx=max(oCl.r,max(oCl.g,oCl.b));cl=vec4(0);"+m("if(max(clg.r,max(clg.g,clg.b))>omx){cl+=clg;cnt++;}")+"cl=(oCl+cl)/cnt;}float dst=vl[2]<1.?1.:clamp(distance(vec2(vl[3],vl[4]),vTUv)*vl[5],0.,1.);oCl=dst*cl+(1.-dst)*oCl;}else if(uFtrT.x<6)oCl=texture(uTex,floor(vTUv/vol)*vol);else if(uFtrT.x<8){vec4 mskCl=texture(uFTex,mod(vec2(vl[1],vl[2])+vTUv,1.)*vec2(vl[5]-vl[3],vl[6]-vl[4]));if(uFtrT.x<7)oCl=texture(uTex,vTUv+(Z.yz*(mskCl.rg-.5)*2.*vol));else if(uFtrT.x<8)oCl.a*=v<4.?mskCl[int(v)]:(mskCl.r+mskCl.g+mskCl.b+mskCl.a)/4.;}else if(uFtrT.x<9){vec4 pcl=vec4(texture(uFTex,vTUv-vec2(vol.x,0)).r,oCl.g,texture(uFTex,vTUv+vec2(vol.x,0)).b,1);float dst=vl[2]<1.?1.:clamp(distance(vec2(vl[3],vl[4]),vTUv),0.,1.),mA=vl[5]==0.?dst:1.-dst,mB=1.-mA;oCl=mA*pcl+mB*oCl;}}"}};class NormalMapRenderer extends BaseRenderer{constructor(b={}){b[$[9]]=Utils[$[24]](b[$[9]]);super(b);this[$[15]]=b[$[15]]};$render(){this[$[3]][$[44]](BlendMode.NORMAL);this[$[36]](this[$[15]],this[$[0]].uTex,0);this[$[13]]();this[$[31]](1)};$createVertexShader(){return Utils.GLSL[$[28]]+"precision highp float;\nin vec2 aPos;uniform float uFlpY;out vec2 vTUv;void main(void){gl_Position=vec4(aPos*2.-1.,1,1);vTUv=vec2(aPos.x,1.-aPos.y);gl_Position.y*=uFlpY;}"};$createFragmentShader(){return Utils.GLSL[$[28]]+"precision highp float;\n"+Utils.GLSL.DEFINE.HEIGHT+Utils.GLSL.DEFINE.Z+"in vec2 vTUv;uniform sampler2D uTex;out vec4 oCl;void main(void){vec2 its=vec2(textureSize(uTex,0)),ts=1./its,p0=floor(vTUv*its),p1=p0+Z.yx,p2=p0+Z.yy;vec3 A=vec3(p0,texture(uTex,p0*ts).g),B=vec3(p1,texture(uTex,p1*ts).g),C=vec3(p2,texture(uTex,p2*ts).g),nm=normalize(cross(B-A,C-A))*HEIGHT*Z.yzy;oCl=vec4(nm*.5+.5,1);}"}};class AmbientOcclusionMapRenderer extends BaseRenderer{constructor(b={}){b[$[9]]=Utils[$[24]](b[$[9]]);b[$[9]][$[19]]=["uSTTex","uR","uS","uDM","uUSTT"];super(b);this[$[4]]=b[$[4]];this[$[15]]=b[$[15]];this.radius=b.radius??4;this.samples=b.samples??4;this[$[68]]=b[$[68]]??1};$render(){this[$[3]][$[44]](BlendMode.NORMAL);this[$[36]](this[$[15]],this[$[0]].uTex,0);if(this[$[4]]){this[$[36]](this[$[4]],this[$[0]].uSTTex,1);this.$gl[$[8]](this[$[0]].uUSTT,1)}else this.$gl[$[8]](this[$[0]].uUSTT,0);this.$gl[$[8]](this[$[0]].uR,this.radius);this.$gl[$[8]](this[$[0]].uS,this.samples);this.$gl[$[8]](this[$[0]].uDM,this[$[68]]);this[$[13]]();this[$[31]](1)};$createVertexShader(){return Utils.GLSL[$[28]]+"precision highp float;\nin vec2 aPos;uniform float uFlpY;out vec2 vTUv;void main(void){gl_Position=vec4(aPos*2.-1.,1,1);vTUv=vec2(aPos.x,1.-aPos.y);gl_Position.y*=uFlpY;}"};$createFragmentShader(){return Utils.GLSL[$[28]]+"precision highp float;\n"+Utils.GLSL.DEFINE.HEIGHT+Utils.GLSL.DEFINE[$[94]]+Utils.GLSL.DEFINE.PI+Utils.GLSL.DEFINE.Z+"in vec2 vTUv;uniform sampler2D uSTTex,uTex;uniform float uR,uS,uUSTT,uDM;out vec4 oCl;"+Utils.GLSL.RANDOM+"void main(void){float tx=texture(uTex,vTUv).g,v=0.;if(uS>0.&&uR>0.){vec2 its=vec2(textureSize(uTex,0)),ts=uR/its,dr=Z.yx,p;float lng=length(ts),l=3.+ceil(uS*rand(vTUv*100.+50.)),t=RADIAN_360/l,rad;vec2 sts=ts*(.8+rand(vTUv*100.+50.)*.4),r=vec2(cos(t),sin(t));for(rad=0.;rad<RADIAN_360;rad+=t){p=dr*sts;v+=(texture(uTex,vTUv+p).g-tx)*length(p)/lng;dr=vec2(dr.x*r.x-dr.y*r.y,dr.x*r.y+dr.y*r.x);}v/=l;}vec3 stCl=uUSTT<1.?Z.yyy:texture(uSTTex,vTUv).rgb;oCl=vec4(stCl*(1.-(1.-tx)*uDM-clamp(v,0.,1.)),1);}"}};class LightRenderer extends BatchRenderer{constructor(h={}){h[$[9]]=Utils[$[24]](h[$[9]]);h[$[9]][$[19]]=["aExt","uNMTex","uSTTex","uRGTex","uTS","uUSTT","uUNMT","uURGT"];super(h);this.clearBeforeRender=1;this[$[30]].set(0,0,0,1);this[$[4]]=h[$[4]];this[$[58]]=h[$[58]];this[$[15]]=h[$[15]];this[$[45]]=h[$[45]];this._$cP=new Buffer("aExt",this[$[17]],2,4)};addLightForRender(d){if(this._$Z<this[$[17]]){var f=this._$Z*16,g=this._$Z*8,j=this[$[35]].data,k=this._$cP.data;$as(j,d[$[16]],f);j[f+6]=d[$[57]].width;j[f+7]=d.spotAngle;$as(j,d[$[55]],f+8);j[f+12]=d.shadowLength;j[f+13]=d.alpha*d.parent[$[51]];j[f+14]=d.angle;k[g]=d.type;k[g+1]=d.flags;k[g+2]=d[$[57]].z;k[g+3]=d.precision;k[g+4]=d.maxShadowStep;k[g+5]=d[$[91]];this._$Z++}};$render(){this[$[3]][$[44]](BlendMode.ADD);var l=this;if(this[$[4]]){this[$[66]](this[$[4]],this[$[0]].uSTTex);l=this[$[4]];this.$gl[$[8]](this[$[0]].uUSTT,1)}else this.$gl[$[8]](this[$[0]].uUSTT,0);if(this[$[58]]){this[$[66]](this[$[58]],this[$[0]].uNMTex);l=this[$[58]];this.$gl[$[8]](this[$[0]].uUNMT,1)}else this.$gl[$[8]](this[$[0]].uUNMT,0);if(this[$[45]]){this[$[66]](this[$[45]],this[$[0]].uRGTex);l=this[$[45]];this.$gl[$[8]](this[$[0]].uURGT,1)}else this.$gl[$[8]](this[$[0]].uURGT,0);if(this[$[15]]){this[$[66]](this[$[15]],this[$[0]].uTex);l=this[$[15]]};this.$gl.uniform2f(this[$[0]].uTS,l.width,l[$[6]]);this[$[13]]();this[$[31]](this._$Z);this._$Z=0};$uploadBuffers(){this._$cP.upload(this.$gl,this[$[12]]);super[$[13]]()};$createBuffers(){super[$[49]]();this._$cP.create(this.$gl,this[$[0]])};$createVertexShader(){return Utils.GLSL[$[28]]+"precision highp float;\n"+Utils.GLSL.DEFINE.PI+Utils.GLSL.DEFINE.Z+"#define P vec4(1,-1,2,-2)\nin vec2 aPos;in mat4 aMt;in mat2x4 aExt;uniform float uFlpY;out float vHS,vD,vShl,vSpt;out vec2 vTUv,vSln;out vec4 vUv,vCl,vDt;out mat2x4 vExt;out vec4 flg;void main(void){vec3 pos=vec3(aPos*2.-1.,1);vExt=aExt;vCl=aMt[2];vDt=aMt[3];int f=int(vExt[0].y);flg=vec4(f&1,f&2,f&4,f&8);vUv.xy=pos.xy;vHS=vExt[0].z;mat3 mt=mat3(aMt[0].xy,0,aMt[0].zw,0,aMt[1].xy,1);vD=aMt[1].z;vShl=vD*vDt.x;if(vExt[0].x<1.){gl_Position=vec4(mt*pos,1);vTUv=(gl_Position.xy+P.xy)/P.zw;vUv.zw=(aMt[1].xy+P.xy)/P.zw;vSpt=PI-aMt[1].w;vSln=vec2(sin(vDt.z),cos(vDt.z));}else{mt[2].xy=Z.zy;gl_Position=vec4(pos,1);vTUv=vec2(aPos.x,1.-aPos.y);vUv.zw=vTUv+((mt*vec3(1)).xy+P.xy)/P.zw;}gl_Position.y*=uFlpY;}"};$createFragmentShader(){var b=(c)=>"for(i=m;i<l;i+=st){p=ivec2((vUv.zw+i*opdm)*uTS);tc=texelFetch(uTex,p,0)*HEIGHT;"+c+"}";return Utils.GLSL[$[28]]+"precision highp float;\n"+Utils.GLSL.DEFINE.HEIGHT+Utils.GLSL.DEFINE.PI+Utils.GLSL.DEFINE.Z+"in float vHS,vD,vShl,vSpt;in vec2 vTUv,vSln;in vec4 vUv,vCl,vDt;in mat2x4 vExt;in vec4 flg;uniform sampler2D uNMTex,uSTTex,uRGTex,uTex;uniform float uUSTT,uURGT,uUNMT;uniform vec2 uTS;out vec4 oCl;"+Utils.GLSL.RANDOM+"void main(void){vec2 tUv=vTUv*uTS,tCnt=vUv.zw*uTS;vec4 tc=texelFetch(uTex,ivec2(tUv),0);float ph=tc.g*HEIGHT,shn=tc.b,rgh=1.;vec3 sf=vec3(tUv,ph),lp=vec3(tCnt,vHS),sftla=lp-sf;float dst=1.-length(sftla)/vD,vol=vDt.y*vCl.a,spc=0.;if(vol<=0.)discard;if(vExt[0].x<1.){vol*=dst;if(vol<=0.)discard;float slh=(vHS-ph)/HEIGHT;vec2 sl=vec2(slh*vSln.y-vUv.x*vSln.x,slh*vSln.x+vUv.x*vSln.y);if(atan(sl.x,length(vec2(sl.y,vUv.y)))+"+Utils.ALPHA+"-vSpt<0.)discard;}float fltDst=distance(tCnt,tUv),shdw=1.;if(flg.y>0.){vec3 nm=uUNMT<1.?Z.xxy:normalize((texture(uNMTex,vTUv).rgb*2.-1.)*Z.yzy),sftl=normalize(sftla),sftv=normalize(vec3(flg.w>0.?uTS*.5:tUv,HEIGHT)-sf),hlf=normalize(sftl+sftv);float lght=dot(nm,sftl);vol*=lght;if(vol<=0.)discard;if(uURGT>0.){vec2 rgt=texture(uRGTex,vTUv).rg;rgh=rgt.r;shn=rgt.g;}spc=pow(dot(nm,hlf),rgh*HEIGHT)*shn*vExt[1].y;}if(flg.x>0.){ivec2 p;vec2 opd=(tUv-tCnt)/fltDst,opdm=opd/uTS;float shl=vShl,st=max(1.,ceil(fltDst/vExt[1].x)),hst=(ph-vHS)/fltDst,opdL=length(opd),i,pc,l=fltDst-st,m=max(st,l-shl);if(flg.z>0.){"+b("if(tc.g>=vHS)discard;")+"}else{float rnd=vExt[0].w*rand(vTUv*100.+50.);"+b("st+=rnd;pc=vHS+i*hst;if(tc.r<=pc&&tc.g>=pc)shdw*=(fltDst-i*opdL)/shl;")+"}}if(shdw<=0.)discard;vec3 stCl=uUSTT<1.?Z.yyy:texture(uSTTex,vTUv).rgb;oCl=vec4((stCl+spc)*vCl.rgb*vol*shdw,1);}"}};class DSC extends Container{constructor(b){super();this.renderer=b;this[$[5]]=new Item};get stage(){return this};get parent(){return this[$[5]]};get premultipliedAlpha(){return this.alpha}};var _32H=["mousemove","mousedown","mouseup","click","touchstart","touchmove","touchend"];class Stage2D extends BatchRenderer{constructor(p={}){p[$[9]]=Utils[$[24]](p[$[9]]);p[$[9]][$[19]]=["aDt","aDst"];super(p);var D=this[$[17]];this[$[48]]=new DSC(this);this._$Z=0;this[$[60]+Item[$[1]]]=this[$[60]+Light[$[1]]]=noop;this[$[60]+Image[$[1]]]=this._$R;this[$[60]+Container[$[1]]]=this._$cz;this._$S=this._$S.bind(this);this._$cA={x:0,y:0};this._$cb=new Buffer("aDt",D,3,4);this._$cU=new Buffer("aDst",D,4,2);this._$dj=this._$dj.bind(this);var c=$d.body;_32H.forEach((d)=>c[$[25]](d,this._$dj))};attachLightRenderer(v){this[$[60]+Light[$[1]]]=v.addLightForRender.bind(v)};detachLightRenderer(){this[$[60]+Light[$[1]]]=noop};render(){this._$cm=$n;super.render();this._$df=0;this._$cV()};destruct(){var c=$d.body;_32H.forEach((d)=>c[$[20]](d,this._$dj))};_$cV(){if(this._$cn){if(this._$cm!==this._$dk){var q={};for(var b in this._$cn)q[b]=this._$cn[b];this._$dk&&this._$dk[$[38]](this._$dk,{...q,type:"mouseout"});this._$cm&&this._$cm[$[38]](this._$cm,{...q,type:"mouseover"})};this._$cm&&this._$cm[$[38]](this._$cm,this._$cn);this._$dk=this._$cm};this._$cn=$n};_$cW(x,y){this._$df=1;var A=this[$[48]].parent[$[16]];this._$cA.x=(x-this[$[78]])*A[0];this._$cA.y=(y-this[$[71]])*A[3]};_$N(f){f.update(this[$[11]]);f[$[76]](f,this[$[11]]);f.renderable&&this[$[60]+f[$[1]]](f);f[$[80]](f,this[$[11]])};_$cz(s){var r=s[$[21]],l=r.length;for(var i=0;i<l;++i)this._$N(r[i])};_$R(j){this[$[3]][$[44]](j.blendMode,this._$S);if(this._$df&&j[$[61]]&&j.isContainsPoint(this._$cA))this._$cm=j;var g=this._$Z*12,k=this._$Z*16,t=j.parent,w=j[$[55]],z=this._$cb.data,B=this[$[35]].data;$as(z,w,g);$as(z,j[$[59]],g+8);z[g+4]=j.alpha*t[$[51]];z[g+5]=j.tintType;z[g+6]=this[$[3]][$[70]](j.texture,this[$[11]],0,this._$S);z[g+7]=j[$[67]][$[97]];$as(B,j[$[16]],k);$as(B,j[$[50]],k+6);$as(B,j[$[92]],k+12);$as(this._$cU.data,j[$[77]],this._$Z*8);++this._$Z===this[$[17]]&&this._$S()};_$S(){if(this._$Z){this[$[13]]();this.$gl.uniform1iv(this[$[0]].uTex,this[$[3]][$[54]]);this[$[31]](this._$Z);this._$Z=0}};_$dj(m){var n=this[$[3]].canvas;if(m.target===n){this._$cn=m;this._$cW((n.width/n.offsetWidth)*m.offsetX,(n[$[6]]/n.offsetHeight)*m.offsetY)}};$render(){this._$N(this[$[48]]);this._$S()};$resize(){super.$resize();if(this[$[53]]){this[$[53]]=0;GM3U.projection(this[$[48]].parent[$[16]],this);++this[$[48]].parent[$[10]]}};$uploadBuffers(){this._$cb.upload(this.$gl,this[$[12]]);this._$cU.upload(this.$gl,this[$[12]]);super[$[13]]()};$createBuffers(){super[$[49]]();this._$cb.create(this.$gl,this[$[0]]);this._$cU.create(this.$gl,this[$[0]])};$createVertexShader(){var E=this._$J[$[89]];return Utils.GLSL[$[28]]+"precision highp float;\nin vec2 aPos;in mat4x2 aDst;in mat3x4 aDt;in mat4 aMt;uniform float uFlpY;out float vACl,vTId,vTTp;out vec2 vTUv;out vec4 vTCrop,vCl"+(E?",vRR;":";")+"vec2 clcQd(vec2 p){vec3 P0=vec3(aDst[0],1.),P1=vec3(aDst[1],1.),P2=vec3(aDst[2],1.),P3=vec3(aDst[3],1.),t=mix(P0,P1,p.x),b=mix(P3,P2,p.x),r=mix(t,b,p.y);return r.xy/r.z;}void main(void){mat3 mt=mat3(aMt[0].xy,0,aMt[0].zw,0,aMt[1].xy,1),tMt=mat3(aMt[1].zw,0,aMt[2].xy,0,aMt[2].zw,1);vec3 tPos=vec3(clcQd(aPos),1);gl_Position=vec4(mt*tPos,1);gl_Position.y*=uFlpY;float dt=aDt[1].w;vTUv=(tMt*((dt*vec3(aPos,1))+((1.-dt)*tPos))).xy;vTCrop=aMt[3];vCl=aDt[0];vACl=aDt[1].x;vTTp=aDt[1].y;vTId=aDt[1].z;"+(E?"vRR=aDt[2].xyzw;vRR.w=vRR.x+vRR.y;":"")+"}"};$createFragmentShader(){var p=this._$J,G=Utils.INFO[$[47]],E=p[$[89]];var I=(G)=>{var h="vec4 gtTexCl(float i,vec4 s,vec2 m){vec2 tsh;";for(var i=0;i<G;++i)h+="if(i<"+(i+1)+".){tsh=.5/vec2(textureSize(uTex["+i+"],0));return texture(uTex["+i+"],clamp(s.xy+s.zw*m,s.xy+tsh,s.xy+s.zw-tsh));}";h+="return Z.yyyy;}";return h};var F=(C)=>"gtTexCl(vTId,vTCrop,"+C+")";return Utils.GLSL[$[28]]+"precision highp float;\n"+Utils.GLSL.DEFINE[$[94]]+Utils.GLSL.DEFINE.Z+"in float vACl,vTId,vTTp;in vec2 vTUv;in vec4 vTCrop,vCl"+(E?",vRR;":";")+"uniform sampler2D uTex["+G+"];out vec4 oCl;"+I(G)+"float cosine(float a,float b,float v){v=abs(v);v=v<.5?2.*v*v:1.-pow(-2.*v+2.,2.)/2.;return a*(1.-v)+b*v;}"+(E?Utils.GLSL.RANDOM+"vec4 gtClBUv(vec2 st){vec2 uv=vTUv;float rnd=rand(floor(uv+st)),rndDg=rnd*RADIAN_360*vRR.x;if(rndDg>0.){vec2 rt=vec2(sin(rndDg),cos(rndDg));uv=vec2(uv.x*rt.y-uv.y*rt.x,uv.x*rt.x+uv.y*rt.y);}return "+F("mod(uv,Z.yy)")+";}float gtRClBUv(vec2 st,vec2 uv){float rnd=rand(floor(vTUv+st));return (1.-(2.*rnd-1.)*vRR.y)*cosine(0.,1.,1.-st.x-uv.x)*cosine(0.,1.,1.-st.y-uv.y);}":"")+"void main(void){if(vTId>-1.){vec2 uv=mod(vTUv,Z.yy);"+(E?"if(vRR.w>0.){float rca,rcb,rcc,rcd;if(vRR.y+vRR.z>0.){rca=gtRClBUv(Z.xx,uv);rcb=gtRClBUv(Z.yx,uv);rcc=gtRClBUv(Z.xy,uv);rcd=gtRClBUv(Z.yy,uv);}oCl=vRR.z>0.?clamp(gtClBUv(Z.xx)*rca+gtClBUv(Z.yx)*rcb+gtClBUv(Z.xy)*rcc+gtClBUv(Z.yy)*rcd,0.,1.):gtClBUv(Z.xy);if(vRR.y>0.)oCl.a=clamp(oCl.a*(rca+rcb+rcc+rcd),0.,1.);}else oCl="+F("uv")+";":"oCl="+F("uv")+";")+"}else oCl+=1.;oCl.a*=vACl;if(oCl.a<=0.)discard;if(vTTp>0.)if(vTTp==1.||(vTTp==2.&&oCl.r==oCl.g&&oCl.r==oCl.b))oCl*=vCl;else if(vTTp==3.)oCl=vCl;else if(vTTp==4.)oCl+=vCl;}"}};class FBF{constructor(b,c,d=0){this.TYPE=b;this.SUB_TYPE=c;this.on=1;this.v=new F32A(9);this.kernels=new F32A(16);this.intensity=d};get intensity(){return this.v[0]};set intensity(v){this.v[0]=v};get intensityX(){return this.v[0]};set intensityX(v){this.v[0]=v};get intensityY(){return this.v[1]};set intensityY(v){this.v[1]=v};get mix(){return this.v[1]};set mix(v){this.v[1]=v};get r(){return this.v[2]};set r(v){this.v[2]=v};get g(){return this.v[3]};set g(v){this.v[3]=v};get b(){return this.v[4]};set b(v){this.v[4]=v}};class DFTTP{constructor(d,f,h=0,j=0,b=0,c=0,g=1,k=1){this._$C=d;this.texture=f;this.translateX=h;this.translateY=j;this.cropX=b;this.cropY=c;this.cropWidth=g;this.cropHeight=k};get translateX(){return this._$C.v[1]};set translateX(v){this._$C.v[1]=v};get translateY(){return this._$C.v[2]};set translateY(v){this._$C.v[2]=v};get cropX(){return this._$C.v[3]};set cropX(v){this._$C.v[3]=v};get cropY(){return this._$C.v[4]};set cropY(v){this._$C.v[4]=v};get cropWidth(){return this._$C.v[5]};set cropWidth(v){this._$C.v[5]=v};get cropHeight(){return this._$C.v[6]};set cropHeight(v){this._$C.v[6]=v}};class DisplacementFilter extends FBF{constructor(d,f,h,j,b,c,g,k){super(6,0,f);this[$[14]]=new DFTTP(this,d,h,j,b,c,g,k)}};class MaskFilter extends FBF{constructor(f,b,h,j,c,d,g,k){super(7,0,b);this[$[14]]=new DFTTP(this,f,h,j,c,d,g,k)};get type(){return this.v[0]};set type(v){this.v[0]=v}};MaskFilter.Type={RED:0,GREEN:1,BLUE:2,ALPHA:3,AVG:4};class PixelateFilter extends FBF{constructor(b){super(5,0,b)}};class EdgeDetectFilter extends FBF{constructor(c,b=1){super(1,0,c);this.mix=b;$as(this.kernels,[-1,-1,-1,-1,8,-1,-1,-1,-1],0)}};class SharpenFilter extends FBF{constructor(c,b=1){super(1,0,c);this.mix=b;$as(this.kernels,[0,-1,0,-1,5,-1,0,-1,0],0)}};class SaturateFilter extends FBF{constructor(h,c=1){super(2,0,h);this.mix=c};set intensity(v){this.v[0]=v;var b=1-v,d=b*.3,f=b*.59,g=b*.11;$as(this.kernels,[d+v,f,g,0,d,f+v,g,0,d,f,g+v,0],0)}};class GrayscaleFilter extends FBF{constructor(b){super(3,1,b)}};class SepiaFilter extends FBF{constructor(b){super(3,2,b)}};class InvertFilter extends FBF{constructor(b){super(3,3,b)}};class TintFilter extends FBF{constructor(c,r,g,b){super(3,4,c);this.r=r;this.g=g;this.b=b}};class ColorLimitFilter extends FBF{constructor(b){super(3,5,b)}};class VignetteFilter extends FBF{constructor(c,d,f,r,g,b){super(3,6,c);this.roundness=d;this.transition=f;this.r=r;this.g=g;this.b=b};get roundness(){return this.v[1]};set roundness(v){this.v[1]=v};get transition(){return 1/this.v[5]};set transition(v){this.v[5]=1/v}};class RainbowFilter extends FBF{constructor(b){super(3,7,b)}};class BrightnessContrastFilter extends FBF{constructor(c,b){super(3,8,c);this.contrast=b};get brightness(){return this.v[0]};set brightness(v){this.v[0]=v};get contrast(){return this.v[1]*100};set contrast(v){this.v[1]=v/100}};class GammaFilter extends FBF{constructor(b){super(3,9,b)}};class FBSF extends FBF{constructor(b,j,k,h=0,f=.5,g=.5,c=1){super(4,b,j);this.intensityY=k;this.isRadial=h;this.centerX=f;this.centerY=g;this.size=c};get isRadial(){return this.v[2]===1};set isRadial(v){this.v[2]=v?1:0};get centerX(){return this.v[3]};set centerX(v){this.v[3]=v};get centerY(){return this.v[4]};set centerY(v){this.v[4]=v};get size(){return this.v[5]};set size(v){this.v[5]=v}};class BlurFilter extends FBSF{constructor(h,j,g=0,d=.5,f=.5,b=1){super(1,h,j,g,d,f,b)}};class GlowFilter extends FBSF{constructor(h,j,g=0,d=.5,f=.5,b=1){super(2,h,j,g,d,f,b)}};class ChromaticAberrationFilter extends FBF{constructor(g,f=0,c=.5,d=.5,h=0){super(8,0,g);this.isRadial=f;this.centerX=c;this.centerY=d;this.invertRadial=h};get isRadial(){return this.v[2]===1};set isRadial(v){this.v[2]=v?1:0};get centerX(){return this.v[3]};set centerX(v){this.v[3]=v};get centerY(){return this.v[4]};set centerY(v){this.v[4]=v};get invertRadial(){return this.v[5]};set invertRadial(v){this.v[5]=v}};window.PWGL=window.AGL={version:"4.0.1",BlendMode,Texture,Framebuffer,Context,Buffer,Utils,Const,Item,BaseDrawable,Light,AnimatedImage,Container,Image,BaseRenderer,BatchRenderer,FilterRenderer,NormalMapRenderer,AmbientOcclusionMapRenderer,LightRenderer,Stage2D,DisplacementFilter,MaskFilter,PixelateFilter,EdgeDetectFilter,SharpenFilter,SaturateFilter,GrayscaleFilter,SepiaFilter,InvertFilter,TintFilter,ColorLimitFilter,VignetteFilter,RainbowFilter,BrightnessContrastFilter,GammaFilter,BlurFilter,GlowFilter,ChromaticAberrationFilter};console.log(`%cPWGL v${AGL.version}\nhttps:\/\/github.com/asjs-dev/pwgl`,"background:#222;color:#0F0");})();