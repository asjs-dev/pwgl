(()=>{var $="RENDERING_TYPE,context,$transformUpdated,sourceTexture,uniform1f,repeatRandomCache,height,$locations,config,$updated,$updateScaleFv,$uploadBuffers,heightMap,matrixCache,$MAX_RENDER_COUNT,transformUpdated,textureTransform,locations,removeEventListener,children,$renderTime,initRendererConfig,$enableBuffers,$height,addEventListener,texParameteri,maxTextureImageUnits,$attachFramebufferAndClear,$drawInstanced,$createGLSL,createElement,$currentAglId,activeTexture,$matrixBuffer,$useTextureAt,useActiveTexture,callEventHandler,colorCache,getPremultipliedAlpha,cosRotationA,cosRotationB,sinRotationA,sinRotationB,$updateScale,setBlendMode,roughnessMap,transform,$createBuffers,textureMatrixCache,textureIds,scaledHeight,colorUpdated,normalMap,textureRepeatRandomCache,interactive,bindTexture,scaledWidth,textureCrop,$useTexture,distortionProps,depthMultiplier,getPremultipliedUseTint,useTexture,heightHalf,clearColor,webglcontextrestored,$renderSource,clearTextures,getChildIndex,setChildIndex,callbackBeforeRender,distortionPropsCache,container,widthHalf,getProgramParameter,callbackAfterRender,useTextureAt,frameLength,RADIANS_360,contextAttributes,isWebGl2Supported,uploadTextureInfo,webglcontextlost,bindActiveTexture,deactivateTexture,useRepeatTextures,getShaderInfoLog,specularStrength,textureCropCache,useProgram,bindVertexArray,bindFramebuffer,distortTexture,naturalWidth,Separate".split(",");"use strict";var F32A=Float32Array,$m=Math,$d=document,$n=null;var $rfa=(d,b)=>{var f=d.indexOf(b);f>-1&&d.splice(f,1)};var $nf=()=>{};var $nfro=()=>1;var $as=(g,h,c=0)=>{var i=h.length;while(--i>-1)g[c+i]=h[i];return g};var _4s={a:"Attrib",u:"Uniform"};var _4r=(b,p,n)=>{var g=b.createShader(n);b.shaderSource(g,p);b.compileShader(g);return g};var _4h=$m.PI/180;var Utils={ALPHA:90*_4h,THETA:_4h,GLSL:{VERSION:"#version 300 es\n",DEFINE:{RADIANS_360:"#define RADIANS_360 radians(360.)\n",HEIGHT:"#define HEIGHT 255.\n",Z:"#define Z vec3(0,1,-1)\n",PI:`#define PI ${$m.PI}\n`},RANDOM:"float rand(vec2 p,float s){p=mod(p,vec2(1e4));return fract(sin(dot(p,vec2(sin(p.x+p.y),cos(p.y-p.x))))*s);}float rand(vec2 p){return rand(p,1.);}"},INFO:{isWebGl2Supported:0},initContextConfig:(j={})=>({canvas:$d[$[30]]("canvas"),...j,contextAttributes:{...{powerPreference:"high-performance",preserveDrawingBuffer:0,premultipliedAlpha:0},...(j[$[79]]||{})}}),initRendererConfig:(j={})=>({locations:j[$[17]]||[],context:j[$[1]]||new Context}),initApplication:(l)=>{var t=()=>l(Utils.INFO[$[80]]);[$[54],"complete"].includes($d.readyState)?t():$d[$[24]]("DOMContentLoaded",t,{once:1})},createProgram:(b,x,A)=>{var q=_4r(b,x,35633),v=_4r(b,A,35632),k=b.createProgram();b.attachShader(k,q);b.attachShader(k,v);b.linkProgram(k);if(!b[$[74]](k,35714)){var w=b[$[86]](q),y=b[$[86]](v);console.error(["Program info: "+b.getProgramInfoLog(k),"Validate status: "+b[$[74]](k,35715),...(w?["","Vertex shader info: "+w,"Vertex shader: "+x]:[]),...(y?["","Fragment shader info: "+y,"Fragment shader: "+A]:[])].join("\n"));b.deleteShader(q);b.deleteShader(v);b.deleteProgram(k);throw"WebGL application stoped"};return k},getLocationsFor:(b,k,z)=>{var m={};z.forEach((d)=>(m[d]=b[`get${_4s[d[0]]}Location`](k,d)));return m}};var Const={};var _gl=$d[$[30]]("canvas").getContext("webgl2");if(_gl){for(var c in _gl){var f=_gl[c];if(typeof f==="number"&&c===c.toUpperCase())Const[c]=f};Utils.INFO[$[80]]=1;Utils.INFO[$[26]]=_gl.getParameter(34930)};class DTI{constructor(){this.target=3553;this.wrapS=this.wrapT=33071;this.internalFormat=this.format=6408;this.minFilter=this.magFilter=9729;this.maxMipMapLevel=this.baseMipMapLevel=0;this.type=5121;this[$[31]]=this.$cG=-1;this[$[9]]=1;this.$width=this[$[23]]=1};get width(){return this.$width};get height(){return this[$[23]]};get wrapS(){return this.$g};set wrapS(v){this.$g=v;this[$[9]]=1};get wrapT(){return this.$h};set wrapT(v){this.$h=v;this[$[9]]=1};get internalFormat(){return this.$cH};set internalFormat(v){this.$cH=v;this[$[9]]=1};get format(){return this.$p};set format(v){this.$p=v;this[$[9]]=1};get minFilter(){return this.$T};set minFilter(v){this.$T=v;this[$[9]]=1};get magFilter(){return this.$U};set magFilter(v){this.$U=v;this[$[9]]=1};get maxMipMapLevel(){return this.$cI};set maxMipMapLevel(v){this.$cI=v;this[$[9]]=1};get baseMipMapLevel(){return this.$cN};set baseMipMapLevel(v){this.$cN=v;this[$[9]]=1};get type(){return this.$c};set type(v){this.$c=v;this[$[9]]=1};useActiveTexture(b,c){this[$[32]](b,c);this[$[62]](b)};useActiveTextureAfterUpdate(b,c){this[$[32]](b,c);this.useTextureAfterUpdate(b)};unbindTexture(b,c){this[$[32]](b,c);this.$cG=-1;b[$[55]](this.target,$n)};activeTexture(b,c){this.$cG=c;b[$[32]](33984+c)};bindActiveTexture(b,c){this[$[32]](b,c);b[$[55]](this.target,this.$cg)};useTexture(b){b[$[55]](this.target,this.$cg);this.createTexImage2D(b)};useTextureAfterUpdate(b){b[$[55]](this.target,this.$cg);this[$[81]](b)};createTexImage2D(b){b.texImage2D(this.target,0,this.$cH,this.width,this[$[6]],0,this.$p,this.$c,this[$[66]]);this[$[81]](b)};uploadTextureInfo(b){b[$[25]](this.target,10242,this.$g);b[$[25]](this.target,10243,this.$h);b[$[25]](this.target,10241,this.$T);b[$[25]](this.target,10240,this.$U);b[$[25]](this.target,33085,this.$cI);b[$[25]](this.target,33084,this.$cN);b.generateMipmap(this.target)}};var BlendMode=(()=>{var b=(c,d)=>({functionName:"blendFunc"+(c.length<3?"":$[94]),functions:c,equationName:"blendEquation"+(!d||d.length<2?"":$[94]),equations:d||[32774]});return{createBlendMode:b,NONE:b([0,0]),NORMAL_PM:b([1,771]),ADD_PM:b([1,1]),MULTIPLY_PM:b([774,771,1,771]),SCREEN_PM:b([1,769,1,771]),ADD_NPM:b([770,1,1,1]),SRC_IN:b([772,0]),SRC_OUT:b([773,0]),SRC_ATOP:b([772,771]),DST_OVER:b([773,1]),DST_IN:b([0,770]),DST_OUT:b([0,771]),DST_ATOP:b([773,770]),XOR:b([773,771]),NORMAL:b([770,771,1,771]),ADD:b([770,772,1,772]),MULTIPLY:b([774,0]),SCREEN:b([770,769,1,769]),OVERLAY:b([1,771]),EXCLUSION:b([775,769]),LIGHTEN:b([1,1],[32776]),DARKEN:b([1,1],[32775]),SHADOW:b([774,768])}})();class Context{constructor(h={}){this.contextId=0;this.isLost=$nfro;this.$q=Utils.initContextConfig(h);this.$cA=this.$cA.bind(this);this.$ch=this.$ch.bind(this);var j=this.$q.canvas;this.canvas=j;j[$[24]]($[82],this.$cA);j[$[24]]($[65],this.$ch);this.$ch()};useBlendMode(p){this.$cS=p;var b=this.gl;b[p.equationName].apply(b,p.equations);b[p.functionName].apply(b,p.functions)};setBlendMode(p,v){if(this.$cS!==p){v&&v();this.useBlendMode(p)}};destruct(){this.gl[$[89]]($n);var j=this.canvas;j[$[18]]($[82],this.$cA);j[$[18]]($[65],this.$ch);this.$cj()};clearTextures(){var l=Utils.INFO[$[26]];for(var i=0;i<l;i++){this.$Y[i]=$n;this.$db[i]=i};this[$[49]].length=0};useTexture(t,s,q=1,n){if(!t)return-1;var r=this.$Y.indexOf(t);if(r<0){if(!this.$db.length){n&&n();this[$[67]]();r=0}else r=this.$db[0];q=1};return this[$[76]](t,r,s,q)};useTextureAt(t,r,s,q=1){t.use(this.gl,r,q,s);this.$Y[r]=t;!this[$[49]].includes(r)&&this[$[49]].push(r);$rfa(this.$db,r);return r};deactivateTexture(t){var r=this.$Y.indexOf(t);r>-1&&t.unbindTexture(this.gl,r)};useProgram(m,c){if(this.$cJ!==m){this.$cJ=m;this[$[67]]();var b=this.gl;b[$[90]]($n);b[$[89]](m);b[$[90]](c);return 1}};setCanvasSize(f,k){var j=this.canvas;j.width=f;j[$[6]]=k};setSize(f,k){if(this.$j!==f||this.$r!==k){this.$j=f;this.$r=k;var b=this.gl;b.viewport(0,0,f,k);b.scissor(0,0,f,k)}};$cA(g){g.preventDefault();setTimeout(this.$cK,1)};$ch(){var b=(this.gl=this.canvas.getContext("webgl2",this.$q[$[79]]));b.agl_id=++this.contextId;var w=b.getExtension("WEBGL_lose_context");if(w){this.$cK=w.restoreContext.bind(w);this.$cj=w.loseContext.bind(w)}else this.$cK=this.$cj=$nf;this.isLost=b.isContextLost?b.isContextLost.bind(b):$nfro;b.pixelStorei(37441,1);b.enable(3042);b.blendColor(1,1,1,1);b.enable(3089);this.$j=this.$r=this.$cJ=this.$cS=$n;this.$Y=[];this.$db=[];this[$[49]]=[];this[$[67]]();this.setCanvasSize(1,1);this.$q.initCallback&&setTimeout(this.$q.initCallback,1)}};class Buffer{constructor(r,d,f,g,j,h,n=1){var k=f*g;this.data=typeof d==="number"?new F32A(d*k):d;this.$cs=r;this.$d=f;this.$f=g;this.$s=j??34962;this.$c=h??35048;this.$t=k*4;this.$v=g*4;this.$F=n;if(this.$c===35044)this.$t=this.$v=0};create(b,q){this.$Q=q[this.$cs];this.$w=b.createBuffer();this.bind(b)};bind(b){b.bindBuffer(this.$s,this.$w)};upload(b,l){this.bind(b);l&&this.$x(b);b.bufferData(this.$s,this.data,this.$c)};destruct(){this.data=$n};$x(b){var f=this.$d,p=this.$Q,g=this.$f,k=this.$t,m=this.$v,n=this.$F;var i=-1;while(++i<f){var c=p+i;b.enableVertexAttribArray(c);b.vertexAttribPointer(c,g,5126,0,k,i*m);b.vertexAttribDivisor(c,n)}}};var _8n=$d[$[30]]("img");class Texture extends DTI{constructor(j,m){super();this.$y=_8n;this.$cT=this.$cT.bind(this);this.source=j;this.shouldUpdate=m;this.$dc=0};get width(){return this.$ck||1};get height(){return this.$ct||1};get source(){return this.$y};set source(f){if(f){this.$y[$[18]](this.$V,this.$cT);this.$y=f;this.isVideo=f.tagName.toLowerCase()==="video";this.$V=this.isVideo?"canplay":"load";!this.$cT()&&f[$[24]](this.$V,this.$cT,{once:1})}};destruct(){this.$y[$[18]](this.$V,this.$cT)};use(b,c,k,l){if(this[$[31]]<b.agl_id){this[$[31]]=b.agl_id;this.$cg=b.createTexture();this[$[35]](b,c)}else if(this[$[9]]||this.$z||(this.shouldUpdate&&this.$dc<l)||(this.isVideo&&!this.$y.paused)){this[$[9]]=this.$z=0;this.$dc=l;this[$[35]](b,c)}else if(this.$cG!==c||k)this[$[83]](b,c)};get $ck(){return this.$y[this.$dg]};get $ct(){return this.$y[this.$dm]};$cT(){this.$dg="width";this.$dm=$[6];if(this.$y[$[93]]){this.$dg=$[93];this.$dm="naturalHeight"}else if(this.$y.videoWidth){this.$dg="videoWidth";this.$dm="videoHeight"};if(this.$ck*this.$ct){this[$[66]]=this.$y;this.$z=1;return 1};this[$[66]]=$n}};Texture.loadImage=(d,m)=>{var g=$d[$[30]]("img");g.src=d;return new Texture(g,m)};Texture.loadVideo=(d)=>{var h=$d[$[30]]("video");h.src=d;return new Texture(h)};class Framebuffer extends DTI{constructor(){super();this.$G=1};get width(){return this.$width};set width(v){if(this.$width!==v){this.$width=v;this.$G=1}};get height(){return this[$[23]]};set height(v){if(this[$[23]]!==v){this[$[23]]=v;this.$G=1}};setSize(w,h){this.width=w;this[$[6]]=h};bind(b){b[$[91]](36160,this.$cl)};unbind(b){b[$[91]](36160,$n)};use(b,c,d){if(this[$[31]]<b.agl_id){this[$[31]]=b.agl_id;this.$cg=b.createTexture();this[$[35]](b,c);this.$cl=b.createFramebuffer();this.bind(b);b.framebufferTexture2D(36160,36064,3553,this.$cg,0);this.unbind(b)}else if(this[$[9]]){this[$[9]]=0;this.useActiveTextureAfterUpdate(b,c)}else if(this.$G){this.$G=0;this[$[35]](b,c)}else if(this.$cG!==c||d)this[$[83]](b,c)};destruct(){}};class DBTP{constructor(){this.$cU=$nf;this[$[39]]=this[$[40]]=1;this[$[41]]=this[$[42]]=this._x=this._y=this.$R=this.$H=this.$I=this.$k=this.$l=0};get x(){return this._x};set x(v){this._x=v;this[$[2]]=1};get y(){return this._y};set y(v){this._y=v;this[$[2]]=1};get rotation(){return this.$R};set rotation(v){this.$R=v;this.$cU=this.$cL};get anchorX(){return this.$H};set anchorX(v){this.$H=v;this[$[2]]=1};get anchorY(){return this.$I};set anchorY(v){this.$I=v;this[$[2]]=1};get skewX(){return this.$k};set skewX(v){this.$k=v;this.$cU=this.$cL};get skewY(){return this.$l};set skewY(v){this.$l=v;this.$cU=this.$cL};update(){this.$cU();this.updated=this[$[2]];this[$[2]]=0};$cL(){this.$cU=$nf;this[$[2]]=1;if(!this.$k&&!this.$l){this[$[41]]=this[$[42]]=$m.sin(this.$R);this[$[39]]=this[$[40]]=$m.cos(this.$R)}else{var b=this.$R-this.$k,c=this.$R+this.$l;this[$[41]]=$m.sin(c);this[$[39]]=$m.cos(c);this[$[42]]=$m.sin(b);this[$[40]]=$m.cos(b)}}};class DITP extends DBTP{constructor(){super();this[$[10]]=$nf;this[$[56]]=this[$[50]]=this.$A=this.$B=this.$width=this[$[23]]=1};get scaleX(){return this.$A};set scaleX(v){this.$A=v;this[$[10]]=this[$[43]]};get scaleY(){return this.$B};set scaleY(v){this.$B=v;this[$[10]]=this[$[43]]};get width(){return this.$width};set width(v){this.$width=v;this[$[10]]=this[$[43]]};get height(){return this[$[23]]};set height(v){this[$[23]]=v;this[$[10]]=this[$[43]]};update(){this[$[10]]();super.update()};$updateScale(){this[$[10]]=$nf;this[$[2]]=1;this[$[56]]=this.$width*this.$A;this[$[50]]=this[$[23]]*this.$B}};class DCP{constructor(){this.cache=[];this.set(1,1,1,1)};get r(){return this.cache[0]};set r(v){this.cache[0]=v;this.$cv=1};get g(){return this.cache[1]};set g(v){this.cache[1]=v;this.$cv=1};get b(){return this.cache[2]};set b(v){this.cache[2]=v;this.$cv=1};get a(){return this.cache[3]};set a(v){this.cache[3]=v;this.$cv=1};set(r,g,b,a){this.cache[0]=r;this.cache[1]=g;this.cache[2]=b;this.cache[3]=a;this.$cv=1};update(){this.updated=this.$cv;this.$cv=0}};var GM3U={identity:()=>new F32A([1,0,0,1,0,0]),projection:(v,k)=>{v[0]=2/k.width;v[1]=v[2]=0;v[3]=-2/k[$[6]];v[4]=-1;v[5]=1},transformLocal:(v,t)=>{var f=t.anchorX,g=t.anchorY,m=t[$[56]],n=t[$[50]];v[0]=t[$[39]]*m;v[1]=t[$[41]]*m;v[2]=-t[$[42]]*n;v[3]=t[$[40]]*n;v[4]=t.x-f*v[0]-g*v[2];v[5]=t.y-f*v[1]-g*v[3]},transform:(v,d,t)=>{var x=t.x,y=t.y,f=t.anchorX,g=t.anchorY,p=t[$[41]],q=t[$[42]],r=t[$[39]],s=t[$[40]],m=t[$[56]],n=t[$[50]];v[0]=(r*d[0]+p*d[2])*m;v[1]=(r*d[1]+p*d[3])*m;v[2]=(s*d[2]-q*d[0])*n;v[3]=(s*d[3]-q*d[1])*n;v[4]=-f*v[0]-g*v[2]+x*d[0]+y*d[2]+d[4];v[5]=-f*v[1]-g*v[3]+x*d[1]+y*d[3]+d[5]},inverse:(v,d)=>{var b=1/(d[0]*d[3]-d[2]*d[1]);v[0]=b*d[3];v[1]=-b*d[1];v[2]=-b*d[2];v[3]=b*d[0];v[4]=b*(d[2]*d[5]-d[3]*d[4]);v[5]=-b*(d[0]*d[5]-d[1]*d[4])},isPointInMatrix:(d,c)=>{var x=c.x*d[0]+c.y*d[2]+d[4],y=c.x*d[1]+c.y*d[3]+d[5];return x>=0&&x<=1&&y>=0&&y<=1},calcCorners:(h,d,k)=>{var j=k[$[73]],l=k[$[63]];h[0].x=j+d[4]*j;h[0].y=k[$[6]]-(l+d[5]*l);h[1].x=h[0].x+(d[0]+d[2])*j;h[1].y=h[0].y-(d[1]+d[3])*l;h[2].x=h[0].x+(d[0]+j*d[2]);h[2].y=h[0].y-(d[1]+l*d[3]);h[3].x=h[0].x+(j*d[0]+d[2]);h[3].y=h[0].y-(l*d[1]+d[3])}};class Item{constructor(){this[$[0]]=Item[$[0]];this[$[13]]=GM3U.identity();this[$[37]]=[1,1,1,1];this[$[46]]=new this.$transformClass;this.color=new DCP;this.alpha=1;this[$[70]]=this[$[75]]=$nf;this.renderable=1;this.$bounds={x:0,y:0,width:0,height:0}};get stage(){return this.$parent?this.$parent.stage:$n};get parent(){return this.$parent};set parent(v){this.$parent=v;this.$cB=1};get callbackBeforeRender(){return this.$dr};set callbackBeforeRender(v){this.$dr=v??$nf};get callbackAfterRender(){return this.$dn};set callbackAfterRender(v){this.$dn=v??$nf};callEventHandler(d,b){if(this[$[54]]){var g=this["on"+b.type];g&&g(this,d,b)};var f=this.$parent;f&&f[$[36]](d,b)};getBounds(){return this.$bounds};destruct(){this.remove()};remove(){var f=this.$parent;f&&f.removeChild(this)};update(){var h=this[$[46]],c=this.color,f=this.$parent,k=this.$cB;this.$cB=0;c.update();this[$[51]]=k||c.updated||f[$[51]];if(this[$[51]]){var j=this[$[37]],m=c.cache,l=f[$[37]];j[0]=l[0]*m[0];j[1]=l[1]*m[1];j[2]=l[2]*m[2];j[3]=l[3]*m[3]};h.update();this[$[15]]=k||h.updated||f[$[15]];this[$[15]]&&GM3U[$[46]](this[$[13]],f[$[13]],h)};get $transformClass(){return DITP}};Item[$[0]]="item";class BaseDrawable extends Item{constructor(){super();this.$corners=[{x:0,y:0},{x:0,y:0},{x:0,y:0},{x:0,y:0}]};getCorners(){this.$calcCorners();return this.$corners};getBounds(){var h=this.getCorners(),g=this.$bounds,a=h[0],b=h[1],c=h[2],d=h[3];g.x=$m.min(a.x,b.x,c.x,d.x);g.y=$m.min(a.y,b.y,c.y,d.y);g.width=$m.max(a.x,b.x,c.x,d.x);g[$[6]]=$m.max(a.y,b.y,c.y,d.y);return g};$calcCorners(){var f=this.stage;f&&GM3U.calcCorners(this.$corners,this[$[13]],f.renderer)}};class DLTP extends DITP{constructor(){super();this.z=0};get width(){return this.$width};set width(v){this.$width=this[$[23]]=v;this[$[10]]=this[$[43]]};get height(){return this[$[23]]};set height(v){this.width=v}};class Light extends BaseDrawable{constructor(){super();this[$[0]]=Light[$[0]];this.castShadow=this.shading=this.centerReflection=1;this.angle=0;this.spotAngle=180*Utils.THETA;this.type=Light.Type.POINT;this.precision=this.shadowLength=this[$[87]]=1;this.maxShadowStep=128;this.fading=1;this.attenuation=1};get castShadow(){return this.$Z};set castShadow(v){this.$Z=v;this.$cm()};get shading(){return this.$J};set shading(v){this.$J=v;this.$cm()};get flattenShadow(){return this.$cC};set flattenShadow(v){this.$cC=v;this.$cm()};get fading(){return this.$C};set fading(v){this.$C=v;this.$cm()};get centerReflection(){return this.$cV};set centerReflection(v){this.$cV=v;this.$cm()};get $transformClass(){return DLTP};$calcCorners(){super.$calcCorners();var f=this.$corners,a=f[0],b=f[1],c=f[2],d=f[3];a.x+=a.x-d.x+(a.x-c.x);a.y+=a.y-d.y+(a.y-c.y);c.x+=c.x-b.x;c.y+=c.y-b.y;d.x+=d.x-b.x;d.y+=d.y-b.y};$cm(){this.flags=(this.$Z*1)|(this.$J*2)|(this.$cC*4)|(this.$cV*8)|(this.$C*16)}};Light[$[0]]="light";Light.Type={POINT:0,DIRECTIONAL:1};class DTTP extends DBTP{constructor(){super();this[$[5]]=[0,0,0];this.$K=this.$L=1};get scaledWidth(){return this.$K};get scaledHeight(){return this.$L};get repeatX(){return this.$K};set repeatX(v){this.$K=v;this[$[2]]=1};get repeatY(){return this.$L};set repeatY(v){this.$L=v;this[$[2]]=1};get repeatRandomRotation(){return this[$[5]][0]};set repeatRandomRotation(v){this[$[5]][0]=v};get repeatRandomAlpha(){return this[$[5]][1]};set repeatRandomAlpha(v){this[$[5]][1]=v};get repeatRandomBlur(){return this[$[5]][2]};set repeatRandomBlur(v){this[$[5]][2]=v}};class DTC{constructor(){this.cache=[0,0,1,1];this.$cD=this.$cn;this.$j=this.$r=1};get x(){return this.cache[0]};set x(v){this.cache[0]=v;this.$cD=this.$cn};get y(){return this.cache[1]};set y(v){this.cache[1]=v;this.$cD=this.$cn};get width(){return this.$j};set width(v){this.$j=v;this.$cD=this.$cn};get height(){return this.$r};set height(v){this.$r=v;this.$cD=this.$cn};setRect(b){this.x=b.x;this.y=b.y;this.width=b.width;this[$[6]]=b[$[6]]};update(){this.$cD();this.updated=this.$cw;this.$cw=0};$cn(){this.$cD=$nf;this.$cw=1;this.cache[2]=this.$j-this.cache[0];this.cache[3]=this.$r-this.cache[1]}};class DDP{constructor(){this[$[92]]=1;this.cache=[0,0,1,0,1,1,0,1]};get topLeftX(){return this.cache[0]};set topLeftX(v){this.cache[0]=v};get topLeftY(){return this.cache[1]};set topLeftY(v){this.cache[1]=v};get topRightX(){return this.cache[2]};set topRightX(v){this.cache[2]=v};get topRightY(){return this.cache[3]};set topRightY(v){this.cache[3]=v};get bottomRightX(){return this.cache[4]};set bottomRightX(v){this.cache[4]=v};get bottomRightY(){return this.cache[5]};set bottomRightY(v){this.cache[5]=v};get bottomLeftX(){return this.cache[6]};set bottomLeftX(v){this.cache[6]=v};get bottomLeftY(){return this.cache[7]};set bottomLeftY(v){this.cache[7]=v}};class Image extends BaseDrawable{constructor(c){super();this[$[0]]=Image[$[0]];this.texture=c;this.tintType=Image.TintType.NORMAL;this.blendMode=BlendMode.NORMAL;this.$dh=new F32A(6);this[$[48]]=GM3U.identity();this[$[16]]=new DTTP;this[$[57]]=new DTC;this[$[59]]=new DDP;this[$[88]]=this[$[57]].cache;this[$[53]]=this[$[16]][$[5]];this[$[71]]=this[$[59]].cache};update(){super.update();this[$[57]].update();var d=this[$[16]];d.update();d.updated&&GM3U.transformLocal(this[$[48]],d);this[$[54]]&&this[$[15]]&&GM3U.inverse(this.$dh,this[$[13]])};isContainsPoint(b){return GM3U.isPointInMatrix(this.$dh,b)}};Image[$[0]]="drawable";Image.TintType={NONE:0,NORMAL:1,GRAYSCALE:2,OVERRIDE:3,ADD:4};class AnimatedImage extends Image{constructor(c){super(c);this.$m=0;this[$[77]]=this.$dj=120;this.$D=[];this.$dc=Date.now();this.stop()};get frames(){return this.$D};set frames(v){this.$D=v;var d=this.$D[0];if(d){this.$dj=d.length??this[$[77]];this.$dc=Date.now()}};gotoAndStop(b){this.stop();this.$m=b;this.$cO()};gotoAndPlay(b){this.$m=b;this.play()};stop(){this.$dd=$nf;this.isPlaying=0};play(){this.$dd=this.$cP;this.isPlaying=1;this.$cO()};update(f){super.update();this.$dd(f)};destruct(){this.stop();super.destruct()};$cP(f){var g=f-this.$dc;if(g>this.$dj){this.$dc=f;this.$m+=~~(g/this.$dj);if(this.$m>=this.$D.length)this.$m=0;this.$cO()}};$cO(){var h=this.$D[this.$m];this[$[57]].setRect(h);this.$dj=h.length??this[$[77]]}};class Container extends Item{constructor(){super();this[$[0]]=Container[$[0]];this[$[19]]=[];this.useTint=1};get parent(){return this.$parent};set parent(v){super.parent=v;if(v){this.$dw=v[$[61]].bind(v);this.$dt=v[$[38]].bind(v)}else this.$dw=this.$dt=$nfro};getPremultipliedUseTint(){return this.useTint*this.$dw()};getPremultipliedAlpha(){return this.alpha*this.$dt()};destruct(){this.empty();super.destruct()};empty(){while(this[$[19]].length)this.removeChildAt(0)};contains(b){return this[$[68]](b)>-1};addChild(b){this.addChildAt(b,this[$[19]].length)};addChildAt(b,c){if(b){b.remove();this[$[19]].push(b);this[$[69]](b,c);b.parent=this}};removeChild(b){if(b){$rfa(this[$[19]],b);b.parent=$n}};removeChildAt(c){this.removeChild(this.getChildAt(c))};getChildAt(c){return this[$[19]][c]};setChildIndex(b,c){$rfa(this[$[19]],b);this[$[19]].splice(c,0,b)};getChildIndex(b){return this[$[19]].indexOf(b)};swapChildren(d,f){var j=this[$[68]](d),k=this[$[68]](f);if(j>-1&&k>-1){this[$[69]](d,k);this[$[69]](f,j)}};getBounds(){var g=this.$bounds,h=this[$[19]],l=h.length;g.x=g.y=1/0;g.width=g[$[6]]=-1/0;for(var i=0;i<l;i++){var m=h[i].getBounds();g.x=$m.min(g.x,m.x);g.y=$m.min(g.y,m.y);g.width=$m.max(g.width,m.width);g[$[6]]=$m.max(g[$[6]],m[$[6]])};return g}};Container[$[0]]=$[72];class BaseRenderer{constructor(k){this.$ds=$nf;this.$cx=$nf;this.$cb=1;this.width=this[$[6]]=this[$[73]]=this[$[63]]=this.$cW=this.$df=this[$[20]]=0;this.setSize(1,1);this[$[64]]=new DCP;this.$M=k;var h=this.$M[$[8]];this[$[1]]=h[$[1]];h[$[17]]=[...h[$[17]],"uFlpY","aPos","uTex"];this.$dk=new Buffer("",new Uint16Array([0,1,3,2]),0,0,34963,35044);this.$cM=new Buffer("aPos",new F32A([0,0,1,0,1,1,0,1]),1,2,34962,35044,0)};set clearBeforeRender(v){this.$ds=v?this.$n:$nf};setSize(c,j){this.width=c;this[$[6]]=j;this.$cx=this.$resize};renderToFramebuffer(s){if(!this[$[1]].isLost()){this.$cQ();this[$[27]](s);this.$cp(s);s.unbind(this.$gl)}};render(){if(!this[$[1]].isLost()){this.$cQ();this.$gl[$[4]](this[$[7]].uFlpY,1);this.$ds();this.$cp()}};destruct(){};$attachFramebuffer(s){s.bind(this.$gl);s.setSize(this.width,this[$[6]]);this[$[1]][$[62]](s,this[$[20]],0);this[$[1]][$[84]](s);this.$gl[$[4]](this[$[7]].uFlpY,-1)};$attachFramebufferAndClear(s){this.$attachFramebuffer(s);this.$ds()};$drawInstanced(d){this.$gl.drawElementsInstanced(5,4,5123,0,d)};$useTextureAt(l,n,f,p){this.$gl.uniform1i(n,this[$[1]][$[76]](l,f,this[$[20]],p))};$useTexture(l,n,p){this.$gl.uniform1i(n,this[$[1]][$[62]](l,this[$[20]],p))};$uploadBuffers(){var b=this.$gl;this.$cM.upload(b,this[$[22]]);this.$dk.upload(b);this[$[22]]=0};$createBuffers(){var b=this.$gl,q=this[$[7]];this.$dk.create(b,q);this.$cM.create(b,q)};$resize(){this.resized=1;this.$cx=$nf;this[$[73]]=this.width/2;this[$[63]]=this[$[6]]/2};$cp(s){this[$[20]]=Date.now();this.$render(s)};$cQ(){this.$gl=this[$[1]].gl;var m=this[$[1]],r=m.contextId;if(this.$cW!==r||this.$df!==this.$cb){this.$cW=r;this.$df=this.$cb;this.$cy()}else this.$cc();this.resized=0;this.$cx();this[$[1]].setSize(this.width,this[$[6]])};$n(){var b=this.$gl,g=this[$[64]];this.$gl[$[64]](g.r,g.g,g.b,g.a);this.$gl.clear(16384)};$cy(){var b=this.$gl,t=Utils.GLSL.VERSION+"precision highp float;\n";this.$N=Utils.createProgram(b,t+this.$createVertexShader(),t+this.$createFragmentShader());this[$[7]]=Utils.getLocationsFor(b,this.$N,this.$M[$[8]][$[17]]);this.$b=b.createVertexArray();this.$cc();this[$[47]]()};$cc(){if(this[$[1]][$[89]](this.$N,this.$b))this[$[22]]=1}};class BatchRenderer extends BaseRenderer{constructor(b){b[$[8]][$[17]]=[...b[$[8]][$[17]],"aMt"];super(b);this[$[14]]=b.maxRenderCount||1e4;this[$[33]]=new Buffer("aMt",this[$[14]],4,4)};$uploadBuffers(){this[$[33]].upload(this.$gl,this[$[22]]);super[$[11]]()};$createBuffers(){super[$[47]]();this[$[33]].create(this.$gl,this[$[7]])}};class FilterRenderer extends BaseRenderer{constructor(p={}){p[$[8]]=Utils[$[21]](p[$[8]]);p[$[8]][$[17]]=["uFTex","uFtrT","uFtrV","uFtrK","uFRt"];super(p);this.$dv=this[$[27]];this[$[27]]=$nf;this.filters=p.filters||[];this[$[3]]=p[$[3]];this.$cz=[new Framebuffer,new Framebuffer]};get filters(){return this.$O};set filters(v){this.$O=new Proxy(v,{deleteProperty:(j,s)=>{delete j[s];this.$cb++;return 1},set:(j,s,g)=>{j[s]=g;this.$cb++;return 1}});this.$cb++};$render(y){var q=this[$[1]],b=this.$gl,x=this[$[20]],t=this[$[7]],r=this.$O,l=r.length||1,d=l-2;q[$[44]](BlendMode.NORMAL);this[$[11]]();b[$[4]](t.uFRt,x%864e5);this[$[34]](this[$[3]],t.uTex,0);for(var i=0;i<l;i++){var A;var k=r[i],w=k&&k.on,m=i>d,z=w&&k[$[16]]&&k[$[16]].texture;z&&this[$[34]](z,t.uFTex,1);if(m)y?this.$dv(y):b[$[4]](t.uFlpY,1);else if(w){A=this.$cz[i&1];this.$dv(A)};if(w){b.uniform1i(t.uFtrT,k.uniqueId);b.uniform1fv(t.uFtrV,k.v);k.kernels&&b.uniformMatrix4fv(t.uFtrK,0,k.kernels)};(w||m)&&this[$[28]](1);z&&q[$[84]](z);if(A){A.unbind(b);q[$[76]](A,0,x)}}};$createVertexShader(){return"in vec2 aPos;uniform float uFlpY;uniform sampler2D uTex;out vec2 vTs,vUv,vTUv;void main(void){gl_Position=vec4(aPos*2.-1.,1,1);vUv=gl_Position.xy;gl_Position.y*=uFlpY;vTUv=vec2(aPos.x,1.-aPos.y);vTs=vec2(textureSize(uTex,0));}"};$createFragmentShader(){return""+Utils.GLSL.DEFINE.Z+Utils.GLSL.DEFINE[$[78]]+"in vec2 vTs,vUv,vTUv;uniform sampler2D uTex,uFTex;uniform int uFtrT;uniform float uFRt,uFtrV[9];uniform mat4 uFtrK;out vec4 oCl;"+Utils.GLSL.RANDOM+"float gtGS(vec4 cl){return .3*cl.r+.59*cl.g+.11*cl.b;}void main(void){oCl=texture(uTex,vTUv);float vl[]=uFtrV,v=vl[0];ivec2 f=ivec2(floor(vTUv*vTs));vec2 vol=v/vTs;vec3 rgb=vec3(vl[2],vl[3],vl[4]);vec4 oClVl=oCl*(1.-v);mat4 kr=uFtrK;"+this.filters.reduce((c,f)=>{var h=c.findIndex((n)=>n.GLSL===f.GLSL);if(h<0)h=c.push(f)-1;f.uniqueId=h;return c},[]).map((f)=>"if(uFtrT=="+f.uniqueId+"){"+f.GLSL+"}").join("else ")+"}"}};class NormalMapRenderer extends BaseRenderer{constructor(b={}){b[$[8]]=Utils[$[21]](b[$[8]]);super(b);this[$[12]]=b[$[12]]};$render(){this[$[1]][$[44]](BlendMode.NORMAL);this[$[34]](this[$[12]],this[$[7]].uTex,0);this[$[11]]();this[$[28]](1)};$createVertexShader(){return"in vec2 aPos;uniform float uFlpY;uniform sampler2D uTex;out vec2 vTs,vTUv;void main(void){gl_Position=vec4(aPos*2.-1.,1,1);vec2 its=vec2(textureSize(uTex,0));vTs=1./its;vTUv=vec2(aPos.x,1.-aPos.y)*its;gl_Position.y*=uFlpY;}"};$createFragmentShader(){return""+Utils.GLSL.DEFINE.Z+Utils.GLSL.DEFINE.HEIGHT+"in vec2 vTs,vTUv;uniform sampler2D uTex;out vec4 oCl;void main(void){vec2 p0=floor(vTUv),p1=p0+Z.yx,p2=p0+Z.yy;vec3 A=vec3(p0,texture(uTex,p0*vTs).g),B=vec3(p1,texture(uTex,p1*vTs).g),C=vec3(p2,texture(uTex,p2*vTs).g),nm=normalize(cross(B-A,C-A))*HEIGHT*Z.yzy;oCl=vec4(nm*.5+.5,1);}"}};class AmbientOcclusionMapRenderer extends BaseRenderer{constructor(c={}){c[$[8]]=Utils[$[21]](c[$[8]]);c[$[8]][$[17]]=["uSTTex","uR","uS","uDM","uUSTT"];super(c);this[$[3]]=c[$[3]];this[$[12]]=c[$[12]];this.radius=c.radius??4;this.samples=c.samples??4;this[$[60]]=c[$[60]]??1};$render(){var b=this.$gl,d=this[$[7]];this[$[1]][$[44]](BlendMode.NORMAL);this[$[34]](this[$[12]],d.uTex,0);if(this[$[3]]){this[$[34]](this[$[3]],d.uSTTex,1);b[$[4]](d.uUSTT,1)}else b[$[4]](d.uUSTT,0);b[$[4]](d.uR,this.radius);b[$[4]](d.uS,this.samples);b[$[4]](d.uDM,this[$[60]]);this[$[11]]();this[$[28]](1)};$createVertexShader(){return"in vec2 aPos;uniform float uR,uFlpY;uniform sampler2D uTex;out vec2 vTUv,vTs;void main(void){gl_Position=vec4(aPos*2.-1.,1,1);vTUv=vec2(aPos.x,1.-aPos.y);gl_Position.y*=uFlpY;vTs=uR/vec2(textureSize(uTex,0));}"};$createFragmentShader(){return""+Utils.GLSL.DEFINE.Z+Utils.GLSL.DEFINE[$[78]]+"in vec2 vTUv,vTs;uniform sampler2D uSTTex,uTex;uniform float uR,uS,uUSTT,uDM;out vec4 oCl;"+Utils.GLSL.RANDOM+"void main(void){float tx=texture(uTex,vTUv).g,v=0.;if(uS>0.&&uR>0.){vec2 vh=vTUv*100.+100.;float rad=RADIANS_360*rand(vh-2.),l=max(1.,ceil(uS*rand(vh-1.))),t=RADIANS_360/l;vec2 dr=vec2(cos(rad),sin(rad)),r=vec2(cos(t),sin(t));for(int i=0;i<int(l);i++){v+=texture(uTex,vTUv+dr*vTs*rand(vh+float(i))).g-tx;dr*=mat2(r.x,-r.y,r.y,r.x);}v/=l;}vec3 stCl=uUSTT<1.?Z.yyy:texture(uSTTex,vTUv).rgb;oCl=vec4(stCl*(1.-(1.-tx)*uDM-v),1);}"}};class LightRenderer extends BatchRenderer{constructor(h={}){h[$[8]]=Utils[$[21]](h[$[8]]);h[$[8]][$[17]]=["aExt","uNMTex","uSTTex","uRGTex","uTS","uUSTT","uUNMT","uURGT"];super(h);this.clearBeforeRender=1;this[$[64]].set(0,0,0,1);this[$[3]]=h[$[3]];this[$[52]]=h[$[52]];this[$[12]]=h[$[12]];this[$[45]]=h[$[45]];this.$cR=new Buffer("aExt",this[$[14]],2,4)};addLightForRender(f){var l=this.$cd,g=f.parent;if(l<this[$[14]]&&g){var m=l*16,p=l*8,n=this[$[33]].data,q=this.$cR.data;$as(n,f[$[13]],m);n[m+6]=f[$[46]].width;n[m+7]=f.spotAngle;$as(n,f[$[37]],m+8);n[m+12]=f.shadowLength;n[m+13]=f.alpha*g[$[38]]();n[m+14]=f.angle;q[p]=f.type;q[p+1]=f.flags;q[p+2]=f[$[46]].z;q[p+3]=f.precision;q[p+4]=f.maxShadowStep;q[p+5]=f[$[87]];q[p+6]=f.attenuation;++this.$cd}};$render(){var b=this.$gl,k=this[$[7]];this[$[1]][$[44]](BlendMode.ADD);var j=this;if(this[$[3]]){this[$[58]](this[$[3]],k.uSTTex);j=this[$[3]];b[$[4]](k.uUSTT,1)}else b[$[4]](k.uUSTT,0);if(this[$[52]]){this[$[58]](this[$[52]],k.uNMTex);j=this[$[52]];b[$[4]](k.uUNMT,1)}else b[$[4]](k.uUNMT,0);if(this[$[45]]){this[$[58]](this[$[45]],k.uRGTex);j=this[$[45]];b[$[4]](k.uURGT,1)}else b[$[4]](k.uURGT,0);if(this[$[12]]){this[$[58]](this[$[12]],k.uTex);j=this[$[12]]};b.uniform2f(k.uTS,j.width,j[$[6]]);this[$[11]]();this[$[28]](this.$cd);this.$cd=0};$uploadBuffers(){this.$cR.upload(this.$gl,this[$[22]]);super[$[11]]()};$createBuffers(){super[$[47]]();this.$cR.create(this.$gl,this[$[7]])};$createVertexShader(){return""+Utils.GLSL.DEFINE.Z+Utils.GLSL.DEFINE.PI+"#define P vec4(1,-1,2,-2)\nin vec2 aPos;in mat4 aMt;in mat2x4 aExt;uniform float uFlpY;out float vHS,vD,vShl,vSpt;out vec2 vTUv,vSln;out vec4 vUv,vCl,vDt;out mat2x4 vExt;flat out int[5] flg;void main(void){vec3 pos=vec3(aPos*2.-1.,1);vExt=aExt;vCl=aMt[2];vDt=aMt[3];int f=int(vExt[0].y);flg=int[](f&1,f&2,f&4,f&8,f&16);vUv.xy=pos.xy;vHS=vExt[0].z;mat3 mt=mat3(aMt[0].xy,0,aMt[0].zw,0,aMt[1].xy,1);vD=aMt[1].z;vShl=vD*vDt.x;if(vExt[0].x<1.){gl_Position=vec4(mt*pos,1);vTUv=(gl_Position.xy+P.xy)/P.zw;vUv.zw=(aMt[1].xy+P.xy)/P.zw;vSpt=PI-aMt[1].w;vSln=vec2(sin(vDt.z),cos(vDt.z));}else{mt[2].xy=Z.zy;gl_Position=vec4(pos,1);vTUv=vec2(aPos.x,1.-aPos.y);vUv.zw=vTUv+((mt*vec3(1)).xy+P.xy)/P.zw;}gl_Position.y*=uFlpY;}"};$createFragmentShader(){var c=(d)=>"for(i=m;i<l;i+=st){p=ivec2((vUv.zw+i*opdm)*uTS);tc=texelFetch(uTex,p,0)*HEIGHT;"+d+"}";return""+Utils.GLSL.DEFINE.HEIGHT+Utils.GLSL.DEFINE.Z+"in float vHS,vD,vShl,vSpt;in vec2 vTUv,vSln;in vec4 vUv,vCl,vDt;in mat2x4 vExt;flat in int[5] flg;uniform sampler2D uNMTex,uSTTex,uRGTex,uTex;uniform float uUSTT,uURGT,uUNMT;uniform vec2 uTS;out vec4 oCl;"+Utils.GLSL.RANDOM+"void main(void){vec2 tUv=vTUv*uTS,tCnt=vUv.zw*uTS;vec4 tc=texelFetch(uTex,ivec2(tUv),0);float ph=tc.g*HEIGHT,vol=vDt.y*vCl.a,spc=0.;if(vol<=0.)discard;vec3 sf=vec3(tUv,ph),lp=vec3(tCnt,vHS),sftla=lp-sf;if(vExt[0].x<1.){float d=length(sftla)/vD,od=1.-d,dv=flg[4]>0?pow(od,vExt[1].z):ceil(od);vol*=dv;if(vol<=0.||od<=0.)discard;float slh=(vHS-ph)/HEIGHT;vec2 sl=vec2(slh*vSln.y-vUv.x*vSln.x,slh*vSln.x+vUv.x*vSln.y);if(atan(sl.x,length(vec2(sl.y,vUv.y)))+"+Utils.ALPHA+"-vSpt<0.)discard;}float fltDst=distance(tCnt,tUv),shdw=1.;if(flg[1]>0){vec3 nm=uUNMT<1.?Z.xxy:normalize((texture(uNMTex,vTUv).rgb*2.-1.)*Z.yzy),sftl=normalize(sftla),sftv=normalize(vec3(flg[3]>0?uTS*.5:tUv,HEIGHT)-sf),hlf=normalize(sftl+sftv);vol*=dot(nm,sftl);if(vol<=0.)discard;float rgh=1.,shn=uURGT>0.?texture(uRGTex,vTUv).r:tc.b;spc=pow(max(dot(nm,hlf),0.),32.)*shn*vExt[1].y;}if(flg[0]>0){ivec2 p;vec2 opd=(tUv-tCnt)/fltDst,opdm=opd/uTS;float shl=vShl,st=max(1.,ceil(fltDst/vExt[1].x)),hst=(ph-vHS)/fltDst,opdL=length(opd),i,pc,l=fltDst-st,m=max(st,l-shl);if(flg[2]>0)"+c("if(tc.g>=vHS)discard;")+"else{float rnd=vExt[0].w*rand(vTUv*100.+50.);"+c("st+=rnd;pc=vHS+i*hst;if(tc.r<=pc&&tc.g>=pc)shdw*=(fltDst-i*opdL)/shl;")+"}}if(shdw<=0.)discard;vec3 stCl=uUSTT<1.?Z.yyy:texture(uSTTex,vTUv).rgb;oCl=vec4((stCl+spc)*vCl.rgb*vol*shdw,1);}"}};class DSC extends Container{constructor(c){super();this.renderer=c;this[$[37]]=this.color.cache;delete this.parent;delete this[$[46]]};get stage(){return this};getPremultipliedUseTint(){return this.useTint};getPremultipliedAlpha(){return this.alpha};update(){var b=this.color,c=this.renderer;b.update();this[$[51]]=b.updated;this[$[15]]=c.resized;this[$[15]]&&GM3U.projection(this[$[13]],c)}};var _32O="_draw",_32U="mousemove",_32V="mousedown",_32S="mouseup",_32Q="click",_32X="touchstart",_32W="touchmove",_32T="touchend",_32cf="PointerClick",_32cb="PointerDown",_32cc="PointerMove",_32Y="PointerUp",_32Z="PointerOut",_32cd="PointerOver",_32P=[_32U,_32V,_32S,_32Q,_32X,_32W,_32T],_32R={[_32Q]:_32cf,[_32V]:_32cb,[_32X]:_32cb,[_32U]:_32cc,[_32W]:_32cc,[_32S]:_32Y,[_32T]:_32Y};class Stage2D extends BatchRenderer{constructor(j={}){j[$[8]]=Utils[$[21]](j[$[8]]);j.useTint=j.useTint??1;j[$[8]][$[17]]=["aDt","aDst"];super(j);var G=this[$[14]];this[$[72]]=new DSC(this);this.$cd=0;this[_32O+Item[$[0]]]=this[_32O+Light[$[0]]]=$nf;this[_32O+Image[$[0]]]=this.$W;this[_32O+Container[$[0]]]=this.$cE;this.$X=this.$X.bind(this);this.$cF={x:0,y:0};this.$cf=new Buffer("aDt",G,3,4);this.$cX=new Buffer("aDst",G,4,2);this.$dp=this.$dp.bind(this);var h=this[$[1]].canvas,D=j.lightRenderer;_32P.forEach((c)=>h[$[24]](c,this.$dp));D&&this.attachLightRenderer(D)};attachLightRenderer(v){this[_32O+Light[$[0]]]=v.addLightForRender.bind(v)};detachLightRenderer(){this[_32O+Light[$[0]]]=$nf};destruct(){var h=this[$[1]].canvas;_32P.forEach((c)=>h[$[18]](c,this.$dp))};$cZ(){var w=this.$cq,z=this.$cr,M=this.$dq;if(w){if(z!==M){var m={...w};M&&M[$[36]](M,{...m,type:_32Z});z&&z[$[36]](z,{...m,type:_32cd})};z&&z[$[36]](z,{...w,type:_32R[w.type]});this.$dq=z};this.$cq=$n};$cY(x,y){this.$dl=1;var A=this[$[72]][$[13]],E=this.$cF;E.x=(x-this[$[73]])*A[0];E.y=(y-this[$[63]])*A[3]};$S(d){var r=this[$[20]];d.update(r);d[$[70]](d,r);d.renderable&&this[_32O+d[$[0]]](d);d[$[75]](d,r)};$cE(p){var n=[...p[$[19]]],l=n.length;for(var i=0;i<l;i++)this.$S(n[i])};$W(f){this[$[1]][$[44]](f.blendMode,this.$X);var s=this.$cd,B=s*12,H=s*16,t=f.parent,I=this.$cf.data,J=this[$[33]].data;if(t){if(this.$dl&&f[$[54]]&&f.isContainsPoint(this.$cF))this.$cr=f;$as(I,f[$[37]],B);$as(I,f[$[53]],B+8);I[B+4]=f.alpha*t[$[38]]();I[B+5]=f.tintType*t[$[61]]();I[B+6]=this[$[1]][$[62]](f.texture,this[$[20]],0,this.$X);I[B+7]=f[$[59]][$[92]];$as(J,f[$[13]],H);$as(J,f[$[48]],H+6);$as(J,f[$[88]],H+12);$as(this.$cX.data,f[$[71]],s*8);++this.$cd===this[$[14]]&&this.$X()}};$X(){if(this.$cd){this[$[11]]();this.$gl.uniform1iv(this[$[7]].uTex,this[$[1]][$[49]]);this[$[28]](this.$cd);this.$cd=0}};$dp(g){this.$cq=g;var h=this[$[1]].canvas;this.$cY((h.width/h.offsetWidth)*g.offsetX,(h[$[6]]/h.offsetHeight)*g.offsetY)};$render(){this.$cr=$n;this.$S(this[$[72]]);this.$X();this.$dl=0;this.$cZ()};$uploadBuffers(){var b=this.$gl,F=this[$[22]];this.$cf.upload(b,F);this.$cX.upload(b,F);super[$[11]]()};$createBuffers(){var b=this.$gl,q=this[$[7]];super[$[47]]();this.$cf.create(b,q);this.$cX.create(b,q)};$createVertexShader(){var K=this.$M[$[85]],N=Utils.INFO[$[26]];return""+Utils.GLSL.DEFINE.Z+"in vec2 aPos;in mat4x2 aDst;in mat3x4 aDt;in mat4 aMt;uniform float uFlpY;uniform sampler2D uTex["+N+"];out float vACl,vTId,vTTp;out vec2 vTUv,vTsh;out vec4 vTCrop,vCl"+(K?",vRR;":";")+"vec2 gtTexS(float i){"+Array(N).fill().map((v,i)=>"if(i<"+(i+1)+".)return .5/vec2(textureSize(uTex["+i+"],0));").join("")+"return Z.yy;}vec2 clcQd(vec2 p){return mix(mix(aDst[0],aDst[1],p.x),mix(aDst[3],aDst[2],p.x),p.y);}void main(void){mat3 mt=mat3(aMt[0].xy,0,aMt[0].zw,0,aMt[1].xy,1),tMt=mat3(aMt[1].zw,0,aMt[2].xy,0,aMt[2].zw,1);vec3 tPos=vec3(clcQd(aPos),1);gl_Position=vec4(mt*tPos,1);gl_Position.y*=uFlpY;float dt=aDt[1].w;vTUv=(tMt*((dt*vec3(aPos,1))+((1.-dt)*tPos))).xy;vTCrop=aMt[3];vCl=aDt[0];vACl=aDt[1].x;vTTp=aDt[1].y;vTId=aDt[1].z;vTsh=gtTexS(vTId);"+(K?"vRR=aDt[2].xyzw;vRR.w=vRR.x+vRR.y;":"")+"}"};$createFragmentShader(){var j=this.$M,N=Utils.INFO[$[26]],K=j[$[85]],k=j.useTint;var L=(C)=>"gtTexCl(vTId,vTCrop,"+C+")";return""+Utils.GLSL.DEFINE.Z+Utils.GLSL.DEFINE[$[78]]+"in float vACl,vTId,vTTp;in vec2 vTUv,vTsh;in vec4 vTCrop,vCl"+(K?",vRR;":";")+"uniform sampler2D uTex["+N+"];out vec4 oCl;vec4 gtTexCl(float i,vec4 s,vec2 m){"+Array(N).fill().map((v,i)=>"if(i<"+(i+1)+".)return texture(uTex["+i+"],clamp(s.xy+s.zw*m,s.xy+vTsh,s.xy+s.zw-vTsh));").join("")+"return Z.yyyy;}float cosine(float a,float b,float v){v=abs(v);v=v<.5?2.*v*v:1.-pow(-2.*v+2.,2.)/2.;return a*(1.-v)+b*v;}"+(K?Utils.GLSL.RANDOM+"vec4 gtClBUv(vec2 st){vec2 uv=vTUv;float rnd=rand(floor(uv+st)),rndDg=rnd*RADIANS_360*vRR.x;if(rndDg>0.){vec2 rt=vec2(sin(rndDg),cos(rndDg));uv=vec2(uv.x*rt.y-uv.y*rt.x,uv.x*rt.x+uv.y*rt.y);}return "+L("mod(uv,Z.yy)")+";}float gtRClBUv(vec2 st,vec2 uv){float rnd=rand(floor(vTUv+st));return (1.-(2.*rnd-1.)*vRR.y)*cosine(0.,1.,1.-st.x-uv.x)*cosine(0.,1.,1.-st.y-uv.y);}":"")+"void main(void){if(vTId>-1.){vec2 uv=mod(vTUv,Z.yy);"+(K?"if(vRR.w>0.){float rca,rcb,rcc,rcd;if(vRR.y+vRR.z>0.){rca=gtRClBUv(Z.xx,uv);rcb=gtRClBUv(Z.yx,uv);rcc=gtRClBUv(Z.xy,uv);rcd=gtRClBUv(Z.yy,uv);}oCl=vRR.z>0.?clamp(gtClBUv(Z.xx)*rca+gtClBUv(Z.yx)*rcb+gtClBUv(Z.xy)*rcc+gtClBUv(Z.yy)*rcd,0.,1.):gtClBUv(Z.xy);if(vRR.y>0.)oCl.a=clamp(oCl.a*(rca+rcb+rcc+rcd),0.,1.);}else oCl="+L("uv")+";":"oCl="+L("uv")+";")+"}else oCl+=1.;oCl.a*=vACl;if(oCl.a<=0.)discard;"+(k?"if(vTTp>0.)if(vTTp==1.||(vTTp==2.&&oCl.r==oCl.g&&oCl.r==oCl.b))oCl*=vCl;else if(vTTp==3.)oCl=vCl;else if(vTTp==4.)oCl+=vCl;":"")+"}"}};class BaseFilter{constructor(b=0){this.on=1;this.v=new F32A(9);this.intensity=b};get intensity(){return this.v[0]};set intensity(v){this.v[0]=v};get intensityX(){return this.v[0]};set intensityX(v){this.v[0]=v};get intensityY(){return this.v[1]};set intensityY(v){this.v[1]=v};get mix(){return this.v[1]};set mix(v){this.v[1]=v};get r(){return this.v[2]};set r(v){this.v[2]=v};get g(){return this.v[3]};set g(v){this.v[3]=v};get b(){return this.v[4]};set b(v){this.v[4]=v}};var _35c="kr*=v;oCl.rgb=(oCl.rgb*(1.-vl[1]))+(texelFetch(uTex,f-ivec2(1),0)*kr[0].x+texelFetch(uTex,f+ivec2(0,-1),0)*kr[0].y+texelFetch(uTex,f+ivec2(1,-1),0)*kr[0].z+texelFetch(uTex,f+ivec2(-1,0),0)*kr[0].w+oCl*kr[1].x+texelFetch(uTex,f+ivec2(1,0),0)*kr[1].y+texelFetch(uTex,f+ivec2(-1,1),0)*kr[1].z+texelFetch(uTex,f+ivec2(0,1),0)*kr[1].w+texelFetch(uTex,f+ivec2(1),0)*kr[2].x).rgb*vl[1];";class BaseKernelFilter extends BaseFilter{constructor(d,b=1){super(d);this.mix=b};get GLSL(){return _35c};get kernels(){return this.$P};set kernels(v){this.$P=$as(this.$P??new F32A(16),v)}};class BaseSamplingFilter extends BaseFilter{constructor(j,k,h=0,f=.5,g=.5,b=1){super(j);this.intensityY=k;this.isRadial=h;this.centerX=f;this.centerY=g;this.size=b};get isRadial(){return this.v[2]};set isRadial(v){this.v[2]=v?1:0};get centerX(){return this.v[3]};set centerX(v){this.v[3]=v};get centerY(){return this.v[4]};set centerY(v){this.v[4]=v};get size(){return this.v[5]};set size(v){this.v[5]=v}};BaseSamplingFilter[$[29]]=(l,d)=>"vec2 wh=vec2(v,vl[1]);float lngWH=length(wh);if(lngWH>0.){float rd=rand(vTUv*100.+100.),cnt=1.,l=4.+ceil(4.*rd),t=RADIANS_360/l;vec2 ps,dr=Z.yx,r=vec2(cos(t),sin(t));vec4 clg,cl=oCl;ivec2 mn=ivec2(Z.xx),mx=ivec2(vTs)-1;"+l+"for(int i=0;i<int(l);i++){ps=wh*round(dr)*(.5+rand(vTUv*100.+100.+float(i))*.5);clg=texelFetch(uTex,clamp(f+ivec2(ps),mn,mx),0);dr*=mat2(r.x,-r.y,r.y,r.x);"+d+"}cl/=cnt;float dst=vl[2]<1.?1.:clamp(distance(vec2(vl[3],vl[4]),vTUv)*vl[5],0.,1.);oCl=dst*cl+(1.-dst)*oCl;}";class DFTTP{constructor(d,f,h=0,j=0,b=0,c=0,g=1,k=1){this.$E=d;this.texture=f;this.translateX=h;this.translateY=j;this.cropX=b;this.cropY=c;this.cropWidth=g;this.cropHeight=k};get translateX(){return this.$E.v[1]};set translateX(v){this.$E.v[1]=v};get translateY(){return this.$E.v[2]};set translateY(v){this.$E.v[2]=v};get cropX(){return this.$E.v[3]};set cropX(v){this.$E.v[3]=v};get cropY(){return this.$E.v[4]};set cropY(v){this.$E.v[4]=v};get cropWidth(){return this.$E.v[5]};set cropWidth(v){this.$E.v[5]=v};get cropHeight(){return this.$E.v[6]};set cropHeight(v){this.$E.v[6]=v}};class BaseTextureFilter extends BaseFilter{constructor(f,l,h,j,c,d,g,k){super(l);this[$[16]]=new DFTTP(this,f,h,j,c,d,g,k)}};BaseTextureFilter[$[29]]=(b)=>"vec4 mskCl=texture(uFTex,mod(vec2(vl[1],vl[2])+vTUv,1.)*vec2(vl[5]-vl[3],vl[6]-vl[4]));"+b;var _39b=BaseTextureFilter[$[29]]("oCl=texture(uTex,vTUv+(Z.yz*(mskCl.rg-.5)*2.*vol));");class DisplacementFilter extends BaseTextureFilter{get GLSL(){return _39b}};var _40b=BaseTextureFilter[$[29]]("oCl.a*=v<4.?mskCl[int(v)]:(mskCl.r+mskCl.g+mskCl.b+mskCl.a)/4.;");class MaskFilter extends BaseTextureFilter{get GLSL(){return _40b};get type(){return this.v[0]};set type(v){this.v[0]=v}};MaskFilter.Type={RED:0,GREEN:1,BLUE:2,ALPHA:3,AVG:4};var _41b="oCl=texture(uTex,floor(vTUv/vol)*vol);";class PixelateFilter extends BaseFilter{get GLSL(){return _41b}};class EdgeDetectFilter extends BaseKernelFilter{constructor(c,b=1){super(c,b);this.kernels=[-1,-1,-1,-1,8,-1,-1,-1,-1]}};class SharpenFilter extends BaseKernelFilter{constructor(c,b=1){super(c,b);this.kernels=[0,-1,0,-1,5,-1,0,-1,0]}};var _44g="oCl.rgb=(oCl.rgb*(1.-vl[1]))+vec3(kr[0].r*oCl.r+kr[0].g*oCl.g+kr[0].b*oCl.b,kr[1].r*oCl.r+kr[1].g*oCl.g+kr[1].b*oCl.b,kr[2].r*oCl.r+kr[2].g*oCl.g+kr[2].b*oCl.b);";class SaturateFilter extends BaseKernelFilter{get GLSL(){return _44g};get intensity(){return this.v[0]};set intensity(v){this.v[0]=v;var b=1-v,c=b*.3,d=b*.59,f=b*.11;this.kernels=[c+v,d,f,0,c,d+v,f,0,c,d,f+v,0]}};var _45b="oCl=oClVl+vec4(vec3(gtGS(oCl)),oCl.a)*v;";class GrayscaleFilter extends BaseFilter{get GLSL(){return _45b}};var _46b="oCl=oClVl+vec4(vec3(.874,.514,.156)*gtGS(oCl),oCl.a)*v;";class SepiaFilter extends BaseFilter{get GLSL(){return _46b}};var _47b="oCl=oClVl+vec4(1.-oCl.rgb,oCl.a)*v;";class InvertFilter extends BaseFilter{get GLSL(){return _47b}};var _48b="oCl.rgb*=rgb*v;";class TintFilter extends BaseFilter{constructor(c,r,g,b){super(c);this.r=r;this.g=g;this.b=b};get GLSL(){return _48b}};var _49b="oCl.rgb=(round((oCl.rgb*255.)/v)/255.)*v;";class ColorLimitFilter extends BaseFilter{get GLSL(){return _49b}};var _50b="vec2 pv=pow(abs(vUv*v),vec2(vl[1]));float cv=clamp((1.-length(pv))*vl[5],0.,1.);oCl.rgb=oCl.rgb*cv+rgb*(1.-cv);";class VignetteFilter extends BaseFilter{constructor(c,d,f,r,g,b){super(c);this.roundness=d;this.transition=f;this.r=r;this.g=g;this.b=b};get GLSL(){return _50b};get roundness(){return this.v[1]};set roundness(v){this.v[1]=v};get transition(){return 1/this.v[5]};set transition(v){this.v[5]=1/v}};var _51b="oCl.rgb+=vec3(vUv.xy*.15,(vUv.x*vUv.y)*.15)*v;";class RainbowFilter extends BaseFilter{get GLSL(){return _51b}};var _52b="oCl.rgb=(vl[1]+1.)*oCl.rgb*v-.5*vl[1];";class BrightnessContrastFilter extends BaseFilter{constructor(d,c){super(d);this.contrast=c};get GLSL(){return _52b};get brightness(){return this.v[0]};set brightness(v){this.v[0]=v};get contrast(){return this.v[1]*100};set contrast(v){this.v[1]=v/100}};var _53b="oCl.rgb=pow(oCl.rgb,vec3(1./v));";class GammaFilter extends BaseFilter{get GLSL(){return _53b}};var _54b=BaseSamplingFilter[$[29]]("","cl+=clg;cnt++;");class BlurFilter extends BaseSamplingFilter{get GLSL(){return _54b}};var _55b=BaseSamplingFilter[$[29]]("float lng,omx=gtGS(oCl);","if(gtGS(clg)>omx){lng=lngWH/length(ps);cl+=clg*lng;cnt+=lng;}");class GlowFilter extends BaseSamplingFilter{get GLSL(){return _55b}};var _56b="vec4 pcl=vec4(texture(uTex,vTUv-vec2(vol.x,0)).r,oCl.g,texture(uTex,vTUv+vec2(vol.x,0)).b,1);float dst=vl[2]<1.?1.:clamp(distance(vec2(vl[3],vl[4]),vTUv),0.,1.),mA=vl[5]==0.?dst:1.-dst,mB=1.-mA;oCl=mA*pcl+mB*oCl;";class ChromaticAberrationFilter extends BaseFilter{constructor(h,g=0,d=.5,f=.5,j=0){super(h);this.isRadial=g;this.centerX=d;this.centerY=f;this.invertRadial=j};get GLSL(){return _56b};get isRadial(){return this.v[2]};set isRadial(v){this.v[2]=v?1:0};get centerX(){return this.v[3]};set centerX(v){this.v[3]=v};get centerY(){return this.v[4]};set centerY(v){this.v[4]=v};get invertRadial(){return this.v[5]};set invertRadial(v){this.v[5]=v}};window.PWGL=window.AGL={version:"4.5.8",BlendMode,Texture,Framebuffer,Context,Buffer,Utils,Const,Item,BaseDrawable,Light,AnimatedImage,Container,Image,BaseRenderer,BatchRenderer,FilterRenderer,NormalMapRenderer,AmbientOcclusionMapRenderer,LightRenderer,Stage2D,BaseFilter,BaseKernelFilter,BaseSamplingFilter,BaseTextureFilter,DisplacementFilter,MaskFilter,PixelateFilter,EdgeDetectFilter,SharpenFilter,SaturateFilter,GrayscaleFilter,SepiaFilter,InvertFilter,TintFilter,ColorLimitFilter,VignetteFilter,RainbowFilter,BrightnessContrastFilter,GammaFilter,BlurFilter,GlowFilter,ChromaticAberrationFilter};console.log(`%cPWGL v${AGL.version}\nhttps:\/\/github.com/asjs-dev/pwgl`,"background:#222;color:#0F0");})();